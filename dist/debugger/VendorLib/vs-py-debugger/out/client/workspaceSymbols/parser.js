"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

const path = require("path");

const vscode = require("vscode");

const fs_1 = require("../common/utils/fs"); // tslint:disable:no-require-imports no-var-requires no-suspicious-comment
// TODO: Turn these into imports.


const LineByLineReader = require('line-by-line');

const NamedRegexp = require('named-js-regexp');

const fuzzy = require('fuzzy');

const IsFileRegEx = /\tkind:file\tline:\d+$/g;
const LINE_REGEX = '(?<name>\\w+)\\t(?<file>.*)\\t\\/\\^(?<code>.*)\\$\\/;"\\tkind:(?<type>\\w+)\\tline:(?<line>\\d+)$';

function matchNamedRegEx(data, regex) {
  const compiledRegexp = NamedRegexp(regex, 'g');
  const rawMatch = compiledRegexp.exec(data);

  if (rawMatch !== null) {
    return rawMatch.groups();
  }

  return null;
}

exports.matchNamedRegEx = matchNamedRegEx;
const CTagKinMapping = new Map();
CTagKinMapping.set('_array', vscode.SymbolKind.Array);
CTagKinMapping.set('_boolean', vscode.SymbolKind.Boolean);
CTagKinMapping.set('_class', vscode.SymbolKind.Class);
CTagKinMapping.set('_classes', vscode.SymbolKind.Class);
CTagKinMapping.set('_constant', vscode.SymbolKind.Constant);
CTagKinMapping.set('_constants', vscode.SymbolKind.Constant);
CTagKinMapping.set('_constructor', vscode.SymbolKind.Constructor);
CTagKinMapping.set('_enum', vscode.SymbolKind.Enum);
CTagKinMapping.set('_enums', vscode.SymbolKind.Enum);
CTagKinMapping.set('_enumeration', vscode.SymbolKind.Enum);
CTagKinMapping.set('_enumerations', vscode.SymbolKind.Enum);
CTagKinMapping.set('_field', vscode.SymbolKind.Field);
CTagKinMapping.set('_fields', vscode.SymbolKind.Field);
CTagKinMapping.set('_file', vscode.SymbolKind.File);
CTagKinMapping.set('_files', vscode.SymbolKind.File);
CTagKinMapping.set('_function', vscode.SymbolKind.Function);
CTagKinMapping.set('_functions', vscode.SymbolKind.Function);
CTagKinMapping.set('_member', vscode.SymbolKind.Function);
CTagKinMapping.set('_interface', vscode.SymbolKind.Interface);
CTagKinMapping.set('_interfaces', vscode.SymbolKind.Interface);
CTagKinMapping.set('_key', vscode.SymbolKind.Key);
CTagKinMapping.set('_keys', vscode.SymbolKind.Key);
CTagKinMapping.set('_method', vscode.SymbolKind.Method);
CTagKinMapping.set('_methods', vscode.SymbolKind.Method);
CTagKinMapping.set('_module', vscode.SymbolKind.Module);
CTagKinMapping.set('_modules', vscode.SymbolKind.Module);
CTagKinMapping.set('_namespace', vscode.SymbolKind.Namespace);
CTagKinMapping.set('_namespaces', vscode.SymbolKind.Namespace);
CTagKinMapping.set('_number', vscode.SymbolKind.Number);
CTagKinMapping.set('_numbers', vscode.SymbolKind.Number);
CTagKinMapping.set('_null', vscode.SymbolKind.Null);
CTagKinMapping.set('_object', vscode.SymbolKind.Object);
CTagKinMapping.set('_package', vscode.SymbolKind.Package);
CTagKinMapping.set('_packages', vscode.SymbolKind.Package);
CTagKinMapping.set('_property', vscode.SymbolKind.Property);
CTagKinMapping.set('_properties', vscode.SymbolKind.Property);
CTagKinMapping.set('_objects', vscode.SymbolKind.Object);
CTagKinMapping.set('_string', vscode.SymbolKind.String);
CTagKinMapping.set('_variable', vscode.SymbolKind.Variable);
CTagKinMapping.set('_variables', vscode.SymbolKind.Variable);
CTagKinMapping.set('_projects', vscode.SymbolKind.Package);
CTagKinMapping.set('_defines', vscode.SymbolKind.Module);
CTagKinMapping.set('_labels', vscode.SymbolKind.Interface);
CTagKinMapping.set('_macros', vscode.SymbolKind.Function);
CTagKinMapping.set('_types (structs and records)', vscode.SymbolKind.Class);
CTagKinMapping.set('_subroutine', vscode.SymbolKind.Method);
CTagKinMapping.set('_subroutines', vscode.SymbolKind.Method);
CTagKinMapping.set('_types', vscode.SymbolKind.Class);
CTagKinMapping.set('_programs', vscode.SymbolKind.Class);
CTagKinMapping.set('_Object\'s method', vscode.SymbolKind.Method);
CTagKinMapping.set('_Module or functor', vscode.SymbolKind.Module);
CTagKinMapping.set('_Global variable', vscode.SymbolKind.Variable);
CTagKinMapping.set('_Type name', vscode.SymbolKind.Class);
CTagKinMapping.set('_A function', vscode.SymbolKind.Function);
CTagKinMapping.set('_A constructor', vscode.SymbolKind.Constructor);
CTagKinMapping.set('_An exception', vscode.SymbolKind.Class);
CTagKinMapping.set('_A \'structure\' field', vscode.SymbolKind.Field);
CTagKinMapping.set('_procedure', vscode.SymbolKind.Function);
CTagKinMapping.set('_procedures', vscode.SymbolKind.Function);
CTagKinMapping.set('_constant definitions', vscode.SymbolKind.Constant);
CTagKinMapping.set('_javascript functions', vscode.SymbolKind.Function);
CTagKinMapping.set('_singleton methods', vscode.SymbolKind.Method);
const newValuesAndKeys = {};
CTagKinMapping.forEach((value, key) => {
  newValuesAndKeys[key.substring(1)] = value;
});
Object.keys(newValuesAndKeys).forEach(key => {
  CTagKinMapping.set(key, newValuesAndKeys[key]);
});

function parseTags(workspaceFolder, tagFile, query, token, maxItems = 200) {
  return fs_1.fsExistsAsync(tagFile).then(exists => {
    if (!exists) {
      return Promise.resolve([]);
    }

    return new Promise((resolve, reject) => {
      const lr = new LineByLineReader(tagFile);
      let lineNumber = 0;
      const tags = [];
      lr.on('error', err => {
        reject(err);
      });
      lr.on('line', line => {
        lineNumber = lineNumber + 1;

        if (token.isCancellationRequested) {
          lr.close();
          return;
        }

        const tag = parseTagsLine(workspaceFolder, line, query);

        if (tag) {
          tags.push(tag);
        }

        if (tags.length >= 100) {
          lr.close();
        }
      });
      lr.on('end', () => {
        resolve(tags);
      });
    });
  });
}

exports.parseTags = parseTags;

function parseTagsLine(workspaceFolder, line, searchPattern) {
  if (IsFileRegEx.test(line)) {
    return;
  }

  const match = matchNamedRegEx(line, LINE_REGEX);

  if (!match) {
    return;
  }

  if (!fuzzy.test(searchPattern, match.name)) {
    return;
  }

  let file = match.file;

  if (!path.isAbsolute(file)) {
    file = path.resolve(workspaceFolder, '.vscode', file);
  }

  const symbolKind = CTagKinMapping.get(match.type) || vscode.SymbolKind.Null;
  return {
    fileName: file,
    code: match.code,
    position: new vscode.Position(Number(match.line) - 1, 0),
    symbolName: match.name,
    symbolKind: symbolKind
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcnNlci5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInBhdGgiLCJyZXF1aXJlIiwidnNjb2RlIiwiZnNfMSIsIkxpbmVCeUxpbmVSZWFkZXIiLCJOYW1lZFJlZ2V4cCIsImZ1enp5IiwiSXNGaWxlUmVnRXgiLCJMSU5FX1JFR0VYIiwibWF0Y2hOYW1lZFJlZ0V4IiwiZGF0YSIsInJlZ2V4IiwiY29tcGlsZWRSZWdleHAiLCJyYXdNYXRjaCIsImV4ZWMiLCJncm91cHMiLCJDVGFnS2luTWFwcGluZyIsIk1hcCIsInNldCIsIlN5bWJvbEtpbmQiLCJBcnJheSIsIkJvb2xlYW4iLCJDbGFzcyIsIkNvbnN0YW50IiwiQ29uc3RydWN0b3IiLCJFbnVtIiwiRmllbGQiLCJGaWxlIiwiRnVuY3Rpb24iLCJJbnRlcmZhY2UiLCJLZXkiLCJNZXRob2QiLCJNb2R1bGUiLCJOYW1lc3BhY2UiLCJOdW1iZXIiLCJOdWxsIiwiUGFja2FnZSIsIlByb3BlcnR5IiwiU3RyaW5nIiwiVmFyaWFibGUiLCJuZXdWYWx1ZXNBbmRLZXlzIiwiZm9yRWFjaCIsImtleSIsInN1YnN0cmluZyIsImtleXMiLCJwYXJzZVRhZ3MiLCJ3b3Jrc3BhY2VGb2xkZXIiLCJ0YWdGaWxlIiwicXVlcnkiLCJ0b2tlbiIsIm1heEl0ZW1zIiwiZnNFeGlzdHNBc3luYyIsInRoZW4iLCJleGlzdHMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImxyIiwibGluZU51bWJlciIsInRhZ3MiLCJvbiIsImVyciIsImxpbmUiLCJpc0NhbmNlbGxhdGlvblJlcXVlc3RlZCIsImNsb3NlIiwidGFnIiwicGFyc2VUYWdzTGluZSIsInB1c2giLCJsZW5ndGgiLCJzZWFyY2hQYXR0ZXJuIiwidGVzdCIsIm1hdGNoIiwibmFtZSIsImZpbGUiLCJpc0Fic29sdXRlIiwic3ltYm9sS2luZCIsImdldCIsInR5cGUiLCJmaWxlTmFtZSIsImNvZGUiLCJw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SUFBekMsQ0FBUDtBQUNIOztBQUNELFFBQU1FLFVBQVUsR0FBRzNELGNBQWMsQ0FBQzRELEdBQWYsQ0FBbUJMLEtBQUssQ0FBQ00sSUFBekIsS0FBa0MzRSxNQUFNLENBQUNpQixVQUFQLENBQWtCZ0IsSUFBdkU7QUFDQSxTQUFPO0FBQ0gyQyxJQUFBQSxRQUFRLEVBQUVMLElBRFA7QUFFSE0sSUFBQUEsSUFBSSxFQUFFUixLQUFLLENBQUNRLElBRlQ7QUFHSEMsSUFBQUEsUUFBUSxFQUFFLElBQUk5RSxNQUFNLENBQUMrRSxRQUFYLENBQW9CL0MsTUFBTSxDQUFDcUMsS0FBSyxDQUFDVCxJQUFQLENBQU4sR0FBcUIsQ0FBekMsRUFBNEMsQ0FBNUMsQ0FIUDtBQUlIb0IsSUFBQUEsVUFBVSxFQUFFWCxLQUFLLENBQUNDLElBSmY7QUFLSEcsSUFBQUEsVUFBVSxFQUFFQTtBQUxULEdBQVA7QUFPSCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xuY29uc3QgdnNjb2RlID0gcmVxdWlyZShcInZzY29kZVwiKTtcbmNvbnN0IGZzXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uL3V0aWxzL2ZzXCIpO1xuLy8gdHNsaW50OmRpc2FibGU6bm8tcmVxdWlyZS1pbXBvcnRzIG5vLXZhci1yZXF1aXJlcyBuby1zdXNwaWNpb3VzLWNvbW1lbnRcbi8vIFRPRE86IFR1cm4gdGhlc2UgaW50byBpbXBvcnRzLlxuY29uc3QgTGluZUJ5TGluZVJlYWRlciA9IHJlcXVpcmUoJ2xpbmUtYnktbGluZScpO1xuY29uc3QgTmFtZWRSZWdleHAgPSByZXF1aXJlKCduYW1lZC1qcy1yZWdleHAnKTtcbmNvbnN0IGZ1enp5ID0gcmVxdWlyZSgnZnV6enknKTtcbmNvbnN0IElzRmlsZVJlZ0V4ID0gL1xcdGtpbmQ6ZmlsZVxcdGxpbmU6XFxkKyQvZztcbmNvbnN0IExJTkVfUkVHRVggPSAnKD88bmFtZT5cXFxcdyspXFxcXHQoPzxmaWxlPi4qKVxcXFx0XFxcXC9cXFxcXig/PGNvZGU+LiopXFxcXCRcXFxcLztcIlxcXFx0a2luZDooPzx0eXBlPlxcXFx3KylcXFxcdGxpbmU6KD88bGluZT5cXFxcZCspJCc7XG5mdW5jdGlvbiBtYXRjaE5hbWVkUmVnRXgoZGF0YSwgcmVnZXgpIHtcbiAgICBjb25zdCBjb21waWxlZFJlZ2V4cCA9IE5hbWVkUmVnZXhwKHJlZ2V4LCAnZycpO1xuICAgIGNvbnN0IHJhd01hdGNoID0gY29tcGlsZWRSZWdleHAuZXhlYyhkYXRhKTtcbiAgICBpZiAocmF3TWF0Y2ggIT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHJhd01hdGNoLmdyb3VwcygpO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cbmV4cG9ydHMubWF0Y2hOYW1lZFJlZ0V4ID0gbWF0Y2hOYW1lZFJlZ0V4O1xuY29uc3QgQ1RhZ0tpbk1hcHBpbmcgPSBuZXcgTWFwKCk7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19hcnJheScsIHZzY29kZS5TeW1ib2xLaW5kLkFycmF5KTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX2Jvb2xlYW4nLCB2c2NvZGUuU3ltYm9sS2luZC5Cb29sZWFuKTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX2NsYXNzJywgdnNjb2RlLlN5bWJvbEtpbmQuQ2xhc3MpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfY2xhc3NlcycsIHZzY29kZS5TeW1ib2xLaW5kLkNsYXNzKTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX2NvbnN0YW50JywgdnNjb2RlLlN5bWJvbEtpbmQuQ29uc3RhbnQpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfY29uc3RhbnRzJywgdnNjb2RlLlN5bWJvbEtpbmQuQ29uc3RhbnQpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfY29uc3RydWN0b3InLCB2c2NvZGUuU3ltYm9sS2luZC5Db25zdHJ1Y3Rvcik7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19lbnVtJywgdnNjb2RlLlN5bWJvbEtpbmQuRW51bSk7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19lbnVtcycsIHZzY29kZS5TeW1ib2xLaW5kLkVudW0pO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfZW51bWVyYXRpb24nLCB2c2NvZGUuU3ltYm9sS2luZC5FbnVtKTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX2VudW1lcmF0aW9ucycsIHZzY29kZS5TeW1ib2xLaW5kLkVudW0pO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfZmllbGQnLCB2c2NvZGUuU3ltYm9sS2luZC5GaWVsZCk7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19maWVsZHMnLCB2c2NvZGUuU3ltYm9sS2luZC5GaWVsZCk7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19maWxlJywgdnNjb2RlLlN5bWJvbEtpbmQuRmlsZSk7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19maWxlcycsIHZzY29kZS5TeW1ib2xLaW5kLkZpbGUpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfZnVuY3Rpb24nLCB2c2NvZGUuU3ltYm9sS2luZC5GdW5jdGlvbik7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19mdW5jdGlvbnMnLCB2c2NvZGUuU3ltYm9sS2luZC5GdW5jdGlvbik7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19tZW1iZXInLCB2c2NvZGUuU3ltYm9sS2luZC5GdW5jdGlvbik7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19pbnRlcmZhY2UnLCB2c2NvZGUuU3ltYm9sS2luZC5JbnRlcmZhY2UpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfaW50ZXJmYWNlcycsIHZzY29kZS5TeW1ib2xLaW5kLkludGVyZmFjZSk7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19rZXknLCB2c2NvZGUuU3ltYm9sS2luZC5LZXkpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfa2V5cycsIHZzY29kZS5TeW1ib2xLaW5kLktleSk7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19tZXRob2QnLCB2c2NvZGUuU3ltYm9sS2luZC5NZXRob2QpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfbWV0aG9kcycsIHZzY29kZS5TeW1ib2xLaW5kLk1ldGhvZCk7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19tb2R1bGUnLCB2c2NvZGUuU3ltYm9sS2luZC5Nb2R1bGUpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfbW9kdWxlcycsIHZzY29kZS5TeW1ib2xLaW5kLk1vZHVsZSk7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19uYW1lc3BhY2UnLCB2c2NvZGUuU3ltYm9sS2luZC5OYW1lc3BhY2UpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfbmFtZXNwYWNlcycsIHZzY29kZS5TeW1ib2xLaW5kLk5hbWVzcGFjZSk7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19udW1iZXInLCB2c2NvZGUuU3ltYm9sS2luZC5OdW1iZXIpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfbnVtYmVycycsIHZzY29kZS5TeW1ib2xLaW5kLk51bWJlcik7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19udWxsJywgdnNjb2RlLlN5bWJvbEtpbmQuTnVsbCk7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19vYmplY3QnLCB2c2NvZGUuU3ltYm9sS2luZC5PYmplY3QpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfcGFja2FnZScsIHZzY29kZS5TeW1ib2xLaW5kLlBhY2thZ2UpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfcGFja2FnZXMnLCB2c2NvZGUuU3ltYm9sS2luZC5QYWNrYWdlKTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX3Byb3BlcnR5JywgdnNjb2RlLlN5bWJvbEtpbmQuUHJvcGVydHkpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfcHJvcGVydGllcycsIHZzY29kZS5TeW1ib2xLaW5kLlByb3BlcnR5KTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX29iamVjdHMnLCB2c2NvZGUuU3ltYm9sS2luZC5PYmplY3QpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfc3RyaW5nJywgdnNjb2RlLlN5bWJvbEtpbmQuU3RyaW5nKTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX3ZhcmlhYmxlJywgdnNjb2RlLlN5bWJvbEtpbmQuVmFyaWFibGUpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfdmFyaWFibGVzJywgdnNjb2RlLlN5bWJvbEtpbmQuVmFyaWFibGUpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfcHJvamVjdHMnLCB2c2NvZGUuU3ltYm9sS2luZC5QYWNrYWdlKTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX2RlZmluZXMnLCB2c2NvZGUuU3ltYm9sS2luZC5Nb2R1bGUpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfbGFiZWxzJywgdnNjb2RlLlN5bWJvbEtpbmQuSW50ZXJmYWNlKTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX21hY3JvcycsIHZzY29kZS5TeW1ib2xLaW5kLkZ1bmN0aW9uKTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX3R5cGVzIChzdHJ1Y3RzIGFuZCByZWNvcmRzKScsIHZzY29kZS5TeW1ib2xLaW5kLkNsYXNzKTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX3N1YnJvdXRpbmUnLCB2c2NvZGUuU3ltYm9sS2luZC5NZXRob2QpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfc3Vicm91dGluZXMnLCB2c2NvZGUuU3ltYm9sS2luZC5NZXRob2QpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfdHlwZXMnLCB2c2NvZGUuU3ltYm9sS2luZC5DbGFzcyk7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19wcm9ncmFtcycsIHZzY29kZS5TeW1ib2xLaW5kLkNsYXNzKTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX09iamVjdFxcJ3MgbWV0aG9kJywgdnNjb2RlLlN5bWJvbEtpbmQuTWV0aG9kKTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX01vZHVsZSBvciBmdW5jdG9yJywgdnNjb2RlLlN5bWJvbEtpbmQuTW9kdWxlKTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX0dsb2JhbCB2YXJpYWJsZScsIHZzY29kZS5TeW1ib2xLaW5kLlZhcmlhYmxlKTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX1R5cGUgbmFtZScsIHZzY29kZS5TeW1ib2xLaW5kLkNsYXNzKTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX0EgZnVuY3Rpb24nLCB2c2NvZGUuU3ltYm9sS2luZC5GdW5jdGlvbik7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19BIGNvbnN0cnVjdG9yJywgdnNjb2RlLlN5bWJvbEtpbmQuQ29uc3RydWN0b3IpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfQW4gZXhjZXB0aW9uJywgdnNjb2RlLlN5bWJvbEtpbmQuQ2xhc3MpO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfQSBcXCdzdHJ1Y3R1cmVcXCcgZmllbGQnLCB2c2NvZGUuU3ltYm9sS2luZC5GaWVsZCk7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19wcm9jZWR1cmUnLCB2c2NvZGUuU3ltYm9sS2luZC5GdW5jdGlvbik7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19wcm9jZWR1cmVzJywgdnNjb2RlLlN5bWJvbEtpbmQuRnVuY3Rpb24pO1xuQ1RhZ0tpbk1hcHBpbmcuc2V0KCdfY29uc3RhbnQgZGVmaW5pdGlvbnMnLCB2c2NvZGUuU3ltYm9sS2luZC5Db25zdGFudCk7XG5DVGFnS2luTWFwcGluZy5zZXQoJ19qYXZhc2NyaXB0IGZ1bmN0aW9ucycsIHZzY29kZS5TeW1ib2xLaW5kLkZ1bmN0aW9uKTtcbkNUYWdLaW5NYXBwaW5nLnNldCgnX3NpbmdsZXRvbiBtZXRob2RzJywgdnNjb2RlLlN5bWJvbEtpbmQuTWV0aG9kKTtcbmNvbnN0IG5ld1ZhbHVlc0FuZEtleXMgPSB7fTtcbkNUYWdLaW5NYXBwaW5nLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHtcbiAgICBuZXdWYWx1ZXNBbmRLZXlzW2tleS5zdWJzdHJpbmcoMSldID0gdmFsdWU7XG59KTtcbk9iamVjdC5rZXlzKG5ld1ZhbHVlc0FuZEtleXMpLmZvckVhY2goa2V5ID0+IHtcbiAgICBDVGFnS2luTWFwcGluZy5zZXQoa2V5LCBuZXdWYWx1ZXNBbmRLZXlzW2tleV0pO1xufSk7XG5mdW5jdGlvbiBwYXJzZVRhZ3Mod29ya3NwYWNlRm9sZGVyLCB0YWdGaWxlLCBxdWVyeSwgdG9rZW4sIG1heEl0ZW1zID0gMjAwKSB7XG4gICAgcmV0dXJuIGZzXzEuZnNFeGlzdHNBc3luYyh0YWdGaWxlKS50aGVuKGV4aXN0cyA9PiB7XG4gICAgICAgIGlmICghZXhpc3RzKSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFtdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgbHIgPSBuZXcgTGluZUJ5TGluZVJlYWRlcih0YWdGaWxlKTtcbiAgICAgICAgICAgIGxldCBsaW5lTnVtYmVyID0gMDtcbiAgICAgICAgICAgIGNvbnN0IHRhZ3MgPSBbXTtcbiAgICAgICAgICAgIGxyLm9uKCdlcnJvcicsIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbHIub24oJ2xpbmUnLCAobGluZSkgPT4ge1xuICAgICAgICAgICAgICAgIGxpbmVOdW1iZXIgPSBsaW5lTnVtYmVyICsgMTtcbiAgICAgICAgICAgICAgICBpZiAodG9rZW4uaXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbHIuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCB0YWcgPSBwYXJzZVRhZ3NMaW5lKHdvcmtzcGFjZUZvbGRlciwgbGluZSwgcXVlcnkpO1xuICAgICAgICAgICAgICAgIGlmICh0YWcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFncy5wdXNoKHRhZyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0YWdzLmxlbmd0aCA+PSAxMDApIHtcbiAgICAgICAgICAgICAgICAgICAgbHIuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxyLm9uKCdlbmQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh0YWdzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMucGFyc2VUYWdzID0gcGFyc2VUYWdzO1xuZnVuY3Rpb24gcGFyc2VUYWdzTGluZSh3b3Jrc3BhY2VGb2xkZXIsIGxpbmUsIHNlYXJjaFBhdHRlcm4pIHtcbiAgICBpZiAoSXNGaWxlUmVnRXgudGVzdChsaW5lKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG1hdGNoID0gbWF0Y2hOYW1lZFJlZ0V4KGxpbmUsIExJTkVfUkVHRVgpO1xuICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIWZ1enp5LnRlc3Qoc2VhcmNoUGF0dGVybiwgbWF0Y2gubmFtZSkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgZmlsZSA9IG1hdGNoLmZpbGU7XG4gICAgaWYgKCFwYXRoLmlzQWJzb2x1dGUoZmlsZSkpIHtcbiAgICAgICAgZmlsZSA9IHBhdGgucmVzb2x2ZSh3b3Jrc3BhY2VGb2xkZXIsICcudnNjb2RlJywgZmlsZSk7XG4gICAgfVxuICAgIGNvbnN0IHN5bWJvbEtpbmQgPSBDVGFnS2luTWFwcGluZy5nZXQobWF0Y2gudHlwZSkgfHwgdnNjb2RlLlN5bWJvbEtpbmQuTnVsbDtcbiAgICByZXR1cm4ge1xuICAgICAgICBmaWxlTmFtZTogZmlsZSxcbiAgICAgICAgY29kZTogbWF0Y2guY29kZSxcbiAgICAgICAgcG9zaXRpb246IG5ldyB2c2NvZGUuUG9zaXRpb24oTnVtYmVyKG1hdGNoLmxpbmUpIC0gMSwgMCksXG4gICAgICAgIHN5bWJvbE5hbWU6IG1hdGNoLm5hbWUsXG4gICAgICAgIHN5bWJvbEtpbmQ6IHN5bWJvbEtpbmRcbiAgICB9O1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFyc2VyLmpzLm1hcCJdfQ==
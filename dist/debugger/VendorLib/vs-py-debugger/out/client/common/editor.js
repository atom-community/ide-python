"use strict";

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const dmp = require("diff-match-patch");

const fs = require("fs-extra");

const inversify_1 = require("inversify");

const md5 = require("md5");

const os_1 = require("os");

const path = require("path");

const vscode_1 = require("vscode"); // Code borrowed from goFormat.ts (Go Extension for VS Code)


var EditAction;

(function (EditAction) {
  EditAction[EditAction["Delete"] = 0] = "Delete";
  EditAction[EditAction["Insert"] = 1] = "Insert";
  EditAction[EditAction["Replace"] = 2] = "Replace";
})(EditAction || (EditAction = {}));

const NEW_LINE_LENGTH = os_1.EOL.length;

class Patch {}

class Edit {
  constructor(action, start) {
    this.action = action;
    this.start = start;
    this.text = '';
  }

  apply() {
    switch (this.action) {
      case EditAction.Insert:
        return vscode_1.TextEdit.insert(this.start, this.text);

      case EditAction.Delete:
        return vscode_1.TextEdit.delete(new vscode_1.Range(this.start, this.end));

      case EditAction.Replace:
        return vscode_1.TextEdit.replace(new vscode_1.Range(this.start, this.end), this.text);

      default:
        return new vscode_1.TextEdit(new vscode_1.Range(new vscode_1.Position(0, 0), new vscode_1.Position(0, 0)), '');
    }
  }

}

function getTextEditsFromPatch(before, patch) {
  if (patch.startsWith('---')) {
    // Strip the first two lines
    patch = patch.substring(patch.indexOf('@@'));
  }

  if (patch.length === 0) {
    return [];
  } // Remove the text added by unified_diff
  // # Work around missing newline (http://bugs.python.org/issue2142).


  patch = patch.replace(/\\ No newline at end of file[\r\n]/, '');
  const d = new dmp.diff_match_patch();
  const patches = patch_fromText.call(d, patch);

  if (!Array.isArray(patches) || patches.length === 0) {
    throw new Error('Unable to parse Patch string');
  }

  const textEdits = []; // Add line feeds and build the text edits

  patches.forEach(p => {
    p.diffs.forEach(diff => {
      diff[1] += os_1.EOL;
    });
    getTextEditsInternal(before, p.diffs, p.start1).forEach(edit => textEdits.push(edit.apply()));
  });
  return textEdits;
}

exports.getTextEditsFromPatch = getTextEditsFromPatch;

function getWorkspaceEditsFromPatch(filePatches, workspaceRoot) {
  const workspaceEdit = new vscode_1.WorkspaceEdit();
  filePatches.forEach(patch => {
    const indexOfAtAt = patch.indexOf('@@');

    if (indexOfAtAt === -1) {
      return;
    }

    const fileNameLines = patch.substring(0, indexOfAtAt).split(/\r?\n/g).map(line => line.trim()).filter(line => line.length > 0 && line.toLowerCase().endsWith('.py') && line.indexOf(' a') > 0);

    if (patch.startsWith('---')) {
      // Strip the first two lines
      patch = patch.substring(indexOfAtAt);
    }

    if (patch.length === 0) {
      return;
    } // We can't find the find name


    if (fileNameLines.length === 0) {
      return;
    }

    let fileName = fileNameLines[0].substring(fileNameLines[0].indexOf(' a') + 3).trim();
    fileName = workspaceRoot && !path.isAbsolute(fileName) ? path.resolve(workspaceRoot, fileName) : fileName;

    if (!fs.existsSync(fileName)) {
      return;
    } // Remove the text added by unified_diff
    // # Work around missing newline (http://bugs.python.org/issue2142).


    patch = patch.replace(/\\ No newline at end of file[\r\n]/, '');
    const d = new dmp.diff_match_patch();
    const patches = patch_fromText.call(d, patch);

    if (!Array.isArray(patches) || patches.length === 0) {
      throw new Error('Unable to parse Patch string');
    }

    const fileSource = fs.readFileSync(fileName).toString('utf8');
    const fileUri = vscode_1.Uri.file(fileName); // Add line feeds and build the text edits

    patches.forEach(p => {
      p.diffs.forEach(diff => {
        diff[1] += os_1.EOL;
      });
      getTextEditsInternal(fileSource, p.diffs, p.start1).forEach(edit => {
        switch (edit.action) {
          case EditAction.Delete:
            workspaceEdit.delete(fileUri, new vscode_1.Range(edit.start, edit.end));
            break;

          case EditAction.Insert:
            workspaceEdit.insert(fileUri, edit.start, edit.text);
            break;

          case EditAction.Replace:
            workspaceEdit.replace(fileUri, new vscode_1.Range(edit.start, edit.end), edit.text);
            break;

          default:
            break;
        }
      });
    });
  });
  return workspaceEdit;
}

exports.getWorkspaceEditsFromPatch = getWorkspaceEditsFromPatch;

function getTextEdits(before, after) {
  const d = new dmp.diff_match_patch();
  const diffs = d.diff_main(before, after);
  return getTextEditsInternal(before, diffs).map(edit => edit.apply());
}

exports.getTextEdits = getTextEdits;

function getTextEditsInternal(before, diffs, startLine = 0) {
  let line = startLine;
  let character = 0;

  if (line > 0) {
    const beforeLines = before.split(/\r?\n/g);
    beforeLines.filter((l, i) => i < line).forEach(l => character += l.length + NEW_LINE_LENGTH);
  }

  const edits = [];
  let edit = null; // tslint:disable-next-line:prefer-for-of

  for (let i = 0; i < diffs.length; i += 1) {
    const start = new vscode_1.Position(line, character); // Compute the line/character after the diff is applied.
    // tslint:disable-next-line:prefer-for-of

    for (let curr = 0; curr < diffs[i][1].length; curr += 1) {
      if (diffs[i][1][curr] !== '\n') {
        character += 1;
      } else {
        character = 0;
        line += 1;
      }
    } // tslint:disable-next-line:switch-default


    switch (diffs[i][0]) {
      case dmp.DIFF_DELETE:
        if (edit === null) {
          edit = new Edit(EditAction.Delete, start);
        } else if (edit.action !== EditAction.Delete) {
          throw new Error('cannot format due to an internal error.');
        }

        edit.end = new vscode_1.Position(line, character);
        break;

      case dmp.DIFF_INSERT:
        if (edit === null) {
          edit = new Edit(EditAction.Insert, start);
        } else if (edit.action === EditAction.Delete) {
          edit.action = EditAction.Replace;
        } // insert and replace edits are all relative to the original state
        // of the document, so inserts should reset the current line/character
        // position to the start.


        line = start.line;
        character = start.character;
        edit.text += diffs[i][1];
        break;

      case dmp.DIFF_EQUAL:
        if (edit !== null) {
          edits.push(edit);
          edit = null;
        }

        break;
    }
  }

  if (edit !== null) {
    edits.push(edit);
  }

  return edits;
}

function getTempFileWithDocumentContents(document) {
  return new Promise((resolve, reject) => {
    const ext = path.extname(document.uri.fsPath); // Don't create file in temp folder since external utilities
    // look into configuration files in the workspace and are not able
    // to find custom rules if file is saved in a random disk location.
    // This means temp file has to be created in the same folder
    // as the original one and then removed.
    // tslint:disable-next-line:no-require-imports

    const fileName = `${document.uri.fsPath}.${md5(document.uri.fsPath)}${ext}`;
    fs.writeFile(fileName, document.getText(), ex => {
      if (ex) {
        reject(`Failed to create a temporary file, ${ex.message}`);
      }

      resolve(fileName);
    });
  });
}

exports.getTempFileWithDocumentContents = getTempFileWithDocumentContents;
/**
 * Parse a textual representation of patches and return a list of Patch objects.
 * @param {string} textline Text representation of patches.
 * @return {!Array.<!diff_match_patch.patch_obj>} Array of Patch objects.
 * @throws {!Error} If invalid input.
 */

function patch_fromText(textline) {
  const patches = [];

  if (!textline) {
    return patches;
  } // Start Modification by Don Jayamanne 24/06/2016 Support for CRLF


  const text = textline.split(/[\r\n]/); // End Modification

  let textPointer = 0;
  const patchHeader = /^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;

  while (textPointer < text.length) {
    const m = text[textPointer].match(patchHeader);

    if (!m) {
      throw new Error(`Invalid patch string: ${text[textPointer]}`);
    } // tslint:disable-next-line:no-any


    const patch = new dmp.diff_match_patch.patch_obj();
    patches.push(patch);
    patch.start1 = parseInt(m[1], 10);

    if (m[2] === '') {
      patch.start1 -= 1;
      patch.length1 = 1;
    } else if (m[2] === '0') {
      patch.length1 = 0;
    } else {
      patch.start1 -= 1;
      patch.length1 = parseInt(m[2], 10);
    }

    patch.start2 = parseInt(m[3], 10);

    if (m[4] === '') {
      patch.start2 -= 1;
      patch.length2 = 1;
    } else if (m[4] === '0') {
      patch.length2 = 0;
    } else {
      patch.start2 -= 1;
      patch.length2 = parseInt(m[4], 10);
    }

    textPointer += 1;

    while (textPointer < text.length) {
      const sign = text[textPointer].charAt(0);
      let line;

      try {
        //var line = decodeURI(text[textPointer].substring(1));
        // For some reason the patch generated by python files don't encode any characters
        // And this patch module (code from Google) is expecting the text to be encoded!!
        // Temporary solution, disable decoding
        // Issue #188
        line = text[textPointer].substring(1);
      } catch (ex) {
        // Malformed URI sequence.
        throw new Error('Illegal escape in patch_fromText');
      }

      if (sign === '-') {
        // Deletion.
        patch.diffs.push([dmp.DIFF_DELETE, line]);
      } else if (sign === '+') {
        // Insertion.
        patch.diffs.push([dmp.DIFF_INSERT, line]);
      } else if (sign === ' ') {
        // Minor equality.
        patch.diffs.push([dmp.DIFF_EQUAL, line]);
      } else if (sign === '@') {
        // Start of next patch.
        break;
      } else if (sign === '') {// Blank line?  Whatever.
      } else {
        // WTF?
        throw new Error(`Invalid patch mode '${sign}' in: ${line}`);
      }

      textPointer += 1;
    }
  }

  return patches;
}

let EditorUtils = class EditorUtils {
  getWorkspaceEditsFromPatch(originalContents, patch, uri) {
    const workspaceEdit = new vscode_1.WorkspaceEdit();

    if (patch.startsWith('---')) {
      // Strip the first two lines
      patch = patch.substring(patch.indexOf('@@'));
    }

    if (patch.length === 0) {
      return workspaceEdit;
    } // Remove the text added by unified_diff
    // # Work around missing newline (http://bugs.python.org/issue2142).


    patch = patch.replace(/\\ No newline at end of file[\r\n]/, '');
    const d = new dmp.diff_match_patch();
    const patches = patch_fromText.call(d, patch);

    if (!Array.isArray(patches) || patches.length === 0) {
      throw new Error('Unable to parse Patch string');
    } // Add line feeds and build the text edits


    patches.forEach(p => {
      p.diffs.forEach(diff => {
        diff[1] += os_1.EOL;
      });
      getTextEditsInternal(originalContents, p.diffs, p.start1).forEach(edit => {
        switch (edit.action) {
          case EditAction.Delete:
            workspaceEdit.delete(uri, new vscode_1.Range(edit.start, edit.end));
            break;

          case EditAction.Insert:
            workspaceEdit.insert(uri, edit.start, edit.text);
            break;

          case EditAction.Replace:
            workspaceEdit.replace(uri, new vscode_1.Range(edit.start, edit.end), edit.text);
            break;

          default:
            break;
        }
      });
    });
    return workspaceEdit;
  }

};
EditorUtils = __decorate([inversify_1.injectable()], EditorUtils);
exports.EditorUtils = EditorUtils;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVkaXRvci5qcyJdLCJuYW1lcyI6WyJfX2RlY29yYXRlIiwiZGVjb3JhdG9ycyIsInRhcmdldCIsImtleSIsImRlc2MiLCJjIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImQiLCJSZWZsZWN0IiwiZGVjb3JhdGUiLCJpIiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJkbXAiLCJyZXF1aXJlIiwiZnMiLCJpbnZlcnNpZnlfMSIsIm1kNSIsIm9zXzEiLCJwYXRoIiwidnNjb2RlXzEiLCJFZGl0QWN0aW9uIiwiTkVXX0xJTkVfTEVOR1RIIiwiRU9MIiwiUGF0Y2giLCJFZGl0IiwiY29uc3RydWN0b3IiLCJhY3Rpb24iLCJzdGFydCIsInRleHQiLCJhcHBseSIsIkluc2VydCIsIlRleHRFZGl0IiwiaW5zZXJ0IiwiRGVsZXRlIiwiZGVsZXRlIiwiUmFuZ2UiLCJlbmQiLCJSZXBsYWNlIiwicmVwbGFjZSIsIlBvc2l0aW9uIiwiZ2V0VGV4dEVkaXRzRnJvbVBhdGNoIiwiYmVmb3JlIiwicGF0Y2giLCJzdGFydHNXaXRoIiwic3Vic3RyaW5nIiwiaW5kZXhPZiIsImRpZmZfbWF0Y2hfcGF0Y2giLCJwYXRjaGVzIiwicGF0Y2hfZnJvbVRleHQiLCJjYWxsIiwiQXJyYXkiLCJpc0FycmF5IiwiRXJyb3IiLCJ0ZXh0RWRpdHMiLCJmb3JFYWNoIiwicCIsImRpZmZzIiwiZGlmZiIsImdldFRleHRFZGl0c0ludGVybmFsIiwic3RhcnQxIiwiZWRpdCIsInB1c2giLCJnZXRXb3Jrc3BhY2VFZGl0c0Zyb21QYXRjaCIsImZpbGVQYXRjaGVzIiwid29ya3NwYWNlUm9vdCIsIndvcmtzcGFjZUVkaXQiLCJXb3Jrc3BhY2VFZGl0IiwiaW5kZXhPZkF0QXQiLCJmaWxlTmFtZUxpbmVzIiwic3BsaXQiLCJtYXAiLCJsaW5lIiwidHJpbSIsImZpbHRlciIsInRvTG93ZXJDYXNlIiwiZW5kc1dpdGgiLCJmaWxlTmFtZSIsImlzQWJzb2x1dGUiLCJyZXNvbHZlIiwiZXhpc3RzU3luYyIsImZpbGVTb3VyY2UiLCJyZWFkRmlsZVN5bmMiLCJ0b1N0cmluZyIsImZpbGVVcmkiLCJVcmkiLCJmaWxlIiwiZ2V0VGV4dEVkaXRzIiwiYWZ0ZXIiLCJkaWZmX21haW4iLCJzdGFydExpbmUiLCJjaGFyYWN0ZXIiLCJiZWZvcmVMaW5lcyIsImwiLCJlZGl0cyIsImN1cnIiLCJESUZGX0RFTEVURSIsIkRJRkZfSU5TRVJUIiwiRElGRl9FUVVBTCIsImdldFRlbXBGaWxlV2l0aERvY3VtZW50Q29udGVudHMiLCJkb2N1bWVudCIsIlByb21pc2UiLCJyZWplY3QiLCJleHQiLCJleHRuYW1lIiwidXJpIiwiZnNQYXRoIiwid3JpdGVGaWxlIiwiZ2V0VGV4dCIsImV4IiwibWVzc2FnZSIsInRleHRsaW5lIiwidGV4dFBvaW50ZXIiLCJwYXRjaEhlYWRlciIsIm0iLCJtYXRjaCIsInBhdGNoX29iaiIsInBhcnNlSW50IiwibGVuZ3RoMSIsInN0YXJ0MiIsImxlbmd0aDIiLCJzaWduIiwiY2hhckF0IiwiRWRpdG9yVXRpbHMiLCJvcmlnaW5hbENvbnRlbnRzIiwiaW5qZWN0YWJsZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0EsSUFBSUEsVUFBVSxHQUFJLFVBQVEsU0FBS0EsVUFBZCxJQUE2QixVQUFVQyxVQUFWLEVBQXNCQyxNQUF0QixFQUE4QkMsR0FBOUIsRUFBbUNDLElBQW5DLEVBQXlDO0FBQ25GLE1BQUlDLENBQUMsR0FBR0MsU0FBUyxDQUFDQyxNQUFsQjtBQUFBLE1BQTBCQyxDQUFDLEdBQUdILENBQUMsR0FBRyxDQUFKLEdBQVFILE1BQVIsR0FBaUJFLElBQUksS0FBSyxJQUFULEdBQWdCQSxJQUFJLEdBQUdLLE1BQU0sQ0FBQ0Msd0JBQVAsQ0FBZ0NSLE1BQWhDLEVBQXdDQyxHQUF4QyxDQUF2QixHQUFzRUMsSUFBckg7QUFBQSxNQUEySE8sQ0FBM0g7QUFDQSxNQUFJLE9BQU9DLE9BQVAsS0FBbUIsUUFB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QUFxQnNFLEdBQXJCLEVBQTBCLElBQUlyRixRQUFRLENBQUNnQixLQUFiLENBQW1CeUIsSUFBSSxDQUFDakMsS0FBeEIsRUFBK0JpQyxJQUFJLENBQUN4QixHQUFwQyxDQUExQjtBQUNBOztBQUNKLGVBQUtoQixVQUFVLENBQUNVLE1BQWhCO0FBQ0ltQyxZQUFBQSxhQUFhLENBQUNqQyxNQUFkLENBQXFCd0UsR0FBckIsRUFBMEI1QyxJQUFJLENBQUNqQyxLQUEvQixFQUFzQ2lDLElBQUksQ0FBQ2hDLElBQTNDO0FBQ0E7O0FBQ0osZUFBS1IsVUFBVSxDQUFDaUIsT0FBaEI7QUFDSTRCLFlBQUFBLGFBQWEsQ0FBQzNCLE9BQWQsQ0FBc0JrRSxHQUF0QixFQUEyQixJQUFJckYsUUFBUSxDQUFDZ0IsS0FBYixDQUFtQnlCLElBQUksQ0FBQ2pDLEtBQXhCLEVBQStCaUMsSUFBSSxDQUFDeEIsR0FBcEMsQ0FBM0IsRUFBcUV3QixJQUFJLENBQUNoQyxJQUExRTtBQUNBOztBQUNKO0FBQ0k7QUFYUjtBQWFILE9BZEQ7QUFlSCxLQW5CRDtBQW9CQSxXQUFPcUMsYUFBUDtBQUNIOztBQXhDK0IsQ0FBcEM7QUEwQ0F5RCxXQUFXLEdBQUdoSSxVQUFVLENBQUMsQ0FDckJxQixXQUFXLENBQUM2RyxVQUFaLEVBRHFCLENBQUQsRUFFckJGLFdBRnFCLENBQXhCO0FBR0FoSCxPQUFPLENBQUNnSCxXQUFSLEdBQXNCQSxXQUF0QiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgZG1wID0gcmVxdWlyZShcImRpZmYtbWF0Y2gtcGF0Y2hcIik7XG5jb25zdCBmcyA9IHJlcXVpcmUoXCJmcy1leHRyYVwiKTtcbmNvbnN0IGludmVyc2lmeV8xID0gcmVxdWlyZShcImludmVyc2lmeVwiKTtcbmNvbnN0IG1kNSA9IHJlcXVpcmUoXCJtZDVcIik7XG5jb25zdCBvc18xID0gcmVxdWlyZShcIm9zXCIpO1xuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xuY29uc3QgdnNjb2RlXzEgPSByZXF1aXJlKFwidnNjb2RlXCIpO1xuLy8gQ29kZSBib3Jyb3dlZCBmcm9tIGdvRm9ybWF0LnRzIChHbyBFeHRlbnNpb24gZm9yIFZTIENvZGUpXG52YXIgRWRpdEFjdGlvbjtcbihmdW5jdGlvbiAoRWRpdEFjdGlvbikge1xuICAgIEVkaXRBY3Rpb25bRWRpdEFjdGlvbltcIkRlbGV0ZVwiXSA9IDBdID0gXCJEZWxldGVcIjtcbiAgICBFZGl0QWN0aW9uW0VkaXRBY3Rpb25bXCJJbnNlcnRcIl0gPSAxXSA9IFwiSW5zZXJ0XCI7XG4gICAgRWRpdEFjdGlvbltFZGl0QWN0aW9uW1wiUmVwbGFjZVwiXSA9IDJdID0gXCJSZXBsYWNlXCI7XG59KShFZGl0QWN0aW9uIHx8IChFZGl0QWN0aW9uID0ge30pKTtcbmNvbnN0IE5FV19MSU5FX0xFTkdUSCA9IG9zXzEuRU9MLmxlbmd0aDtcbmNsYXNzIFBhdGNoIHtcbn1cbmNsYXNzIEVkaXQge1xuICAgIGNvbnN0cnVjdG9yKGFjdGlvbiwgc3RhcnQpIHtcbiAgICAgICAgdGhpcy5hY3Rpb24gPSBhY3Rpb247XG4gICAgICAgIHRoaXMuc3RhcnQgPSBzdGFydDtcbiAgICAgICAgdGhpcy50ZXh0ID0gJyc7XG4gICAgfVxuICAgIGFwcGx5KCkge1xuICAgICAgICBzd2l0Y2ggKHRoaXMuYWN0aW9uKSB7XG4gICAgICAgICAgICBjYXNlIEVkaXRBY3Rpb24uSW5zZXJ0OlxuICAgICAgICAgICAgICAgIHJldHVybiB2c2NvZGVfMS5UZXh0RWRpdC5pbnNlcnQodGhpcy5zdGFydCwgdGhpcy50ZXh0KTtcbiAgICAgICAgICAgIGNhc2UgRWRpdEFjdGlvbi5EZWxldGU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZzY29kZV8xLlRleHRFZGl0LmRlbGV0ZShuZXcgdnNjb2RlXzEuUmFuZ2UodGhpcy5zdGFydCwgdGhpcy5lbmQpKTtcbiAgICAgICAgICAgIGNhc2UgRWRpdEFjdGlvbi5SZXBsYWNlOlxuICAgICAgICAgICAgICAgIHJldHVybiB2c2NvZGVfMS5UZXh0RWRpdC5yZXBsYWNlKG5ldyB2c2NvZGVfMS5SYW5nZSh0aGlzLnN0YXJ0LCB0aGlzLmVuZCksIHRoaXMudGV4dCk7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgdnNjb2RlXzEuVGV4dEVkaXQobmV3IHZzY29kZV8xLlJhbmdlKG5ldyB2c2NvZGVfMS5Qb3NpdGlvbigwLCAwKSwgbmV3IHZzY29kZV8xLlBvc2l0aW9uKDAsIDApKSwgJycpO1xuICAgICAgICB9XG4gICAgfVxufVxuZnVuY3Rpb24gZ2V0VGV4dEVkaXRzRnJvbVBhdGNoKGJlZm9yZSwgcGF0Y2gpIHtcbiAgICBpZiAocGF0Y2guc3RhcnRzV2l0aCgnLS0tJykpIHtcbiAgICAgICAgLy8gU3RyaXAgdGhlIGZpcnN0IHR3byBsaW5lc1xuICAgICAgICBwYXRjaCA9IHBhdGNoLnN1YnN0cmluZyhwYXRjaC5pbmRleE9mKCdAQCcpKTtcbiAgICB9XG4gICAgaWYgKHBhdGNoLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIC8vIFJlbW92ZSB0aGUgdGV4dCBhZGRlZCBieSB1bmlmaWVkX2RpZmZcbiAgICAvLyAjIFdvcmsgYXJvdW5kIG1pc3NpbmcgbmV3bGluZSAoaHR0cDovL2J1Z3MucHl0aG9uLm9yZy9pc3N1ZTIxNDIpLlxuICAgIHBhdGNoID0gcGF0Y2gucmVwbGFjZSgvXFxcXCBObyBuZXdsaW5lIGF0IGVuZCBvZiBmaWxlW1xcclxcbl0vLCAnJyk7XG4gICAgY29uc3QgZCA9IG5ldyBkbXAuZGlmZl9tYXRjaF9wYXRjaCgpO1xuICAgIGNvbnN0IHBhdGNoZXMgPSBwYXRjaF9mcm9tVGV4dC5jYWxsKGQsIHBhdGNoKTtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkocGF0Y2hlcykgfHwgcGF0Y2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gcGFyc2UgUGF0Y2ggc3RyaW5nJyk7XG4gICAgfVxuICAgIGNvbnN0IHRleHRFZGl0cyA9IFtdO1xuICAgIC8vIEFkZCBsaW5lIGZlZWRzIGFuZCBidWlsZCB0aGUgdGV4dCBlZGl0c1xuICAgIHBhdGNoZXMuZm9yRWFjaChwID0+IHtcbiAgICAgICAgcC5kaWZmcy5mb3JFYWNoKGRpZmYgPT4ge1xuICAgICAgICAgICAgZGlmZlsxXSArPSBvc18xLkVPTDtcbiAgICAgICAgfSk7XG4gICAgICAgIGdldFRleHRFZGl0c0ludGVybmFsKGJlZm9yZSwgcC5kaWZmcywgcC5zdGFydDEpLmZvckVhY2goZWRpdCA9PiB0ZXh0RWRpdHMucHVzaChlZGl0LmFwcGx5KCkpKTtcbiAgICB9KTtcbiAgICByZXR1cm4gdGV4dEVkaXRzO1xufVxuZXhwb3J0cy5nZXRUZXh0RWRpdHNGcm9tUGF0Y2ggPSBnZXRUZXh0RWRpdHNGcm9tUGF0Y2g7XG5mdW5jdGlvbiBnZXRXb3Jrc3BhY2VFZGl0c0Zyb21QYXRjaChmaWxlUGF0Y2hlcywgd29ya3NwYWNlUm9vdCkge1xuICAgIGNvbnN0IHdvcmtzcGFjZUVkaXQgPSBuZXcgdnNjb2RlXzEuV29ya3NwYWNlRWRpdCgpO1xuICAgIGZpbGVQYXRjaGVzLmZvckVhY2gocGF0Y2ggPT4ge1xuICAgICAgICBjb25zdCBpbmRleE9mQXRBdCA9IHBhdGNoLmluZGV4T2YoJ0BAJyk7XG4gICAgICAgIGlmIChpbmRleE9mQXRBdCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBmaWxlTmFtZUxpbmVzID0gcGF0Y2guc3Vic3RyaW5nKDAsIGluZGV4T2ZBdEF0KS5zcGxpdCgvXFxyP1xcbi9nKVxuICAgICAgICAgICAgLm1hcChsaW5lID0+IGxpbmUudHJpbSgpKVxuICAgICAgICAgICAgLmZpbHRlcihsaW5lID0+IGxpbmUubGVuZ3RoID4gMCAmJlxuICAgICAgICAgICAgbGluZS50b0xvd2VyQ2FzZSgpLmVuZHNXaXRoKCcucHknKSAmJlxuICAgICAgICAgICAgbGluZS5pbmRleE9mKCcgYScpID4gMCk7XG4gICAgICAgIGlmIChwYXRjaC5zdGFydHNXaXRoKCctLS0nKSkge1xuICAgICAgICAgICAgLy8gU3RyaXAgdGhlIGZpcnN0IHR3byBsaW5lc1xuICAgICAgICAgICAgcGF0Y2ggPSBwYXRjaC5zdWJzdHJpbmcoaW5kZXhPZkF0QXQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXRjaC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBXZSBjYW4ndCBmaW5kIHRoZSBmaW5kIG5hbWVcbiAgICAgICAgaWYgKGZpbGVOYW1lTGluZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGZpbGVOYW1lID0gZmlsZU5hbWVMaW5lc1swXS5zdWJzdHJpbmcoZmlsZU5hbWVMaW5lc1swXS5pbmRleE9mKCcgYScpICsgMykudHJpbSgpO1xuICAgICAgICBmaWxlTmFtZSA9IHdvcmtzcGFjZVJvb3QgJiYgIXBhdGguaXNBYnNvbHV0ZShmaWxlTmFtZSkgPyBwYXRoLnJlc29sdmUod29ya3NwYWNlUm9vdCwgZmlsZU5hbWUpIDogZmlsZU5hbWU7XG4gICAgICAgIGlmICghZnMuZXhpc3RzU3luYyhmaWxlTmFtZSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBSZW1vdmUgdGhlIHRleHQgYWRkZWQgYnkgdW5pZmllZF9kaWZmXG4gICAgICAgIC8vICMgV29yayBhcm91bmQgbWlzc2luZyBuZXdsaW5lIChodHRwOi8vYnVncy5weXRob24ub3JnL2lzc3VlMjE0MikuXG4gICAgICAgIHBhdGNoID0gcGF0Y2gucmVwbGFjZSgvXFxcXCBObyBuZXdsaW5lIGF0IGVuZCBvZiBmaWxlW1xcclxcbl0vLCAnJyk7XG4gICAgICAgIGNvbnN0IGQgPSBuZXcgZG1wLmRpZmZfbWF0Y2hfcGF0Y2goKTtcbiAgICAgICAgY29uc3QgcGF0Y2hlcyA9IHBhdGNoX2Zyb21UZXh0LmNhbGwoZCwgcGF0Y2gpO1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocGF0Y2hlcykgfHwgcGF0Y2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5hYmxlIHRvIHBhcnNlIFBhdGNoIHN0cmluZycpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZpbGVTb3VyY2UgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZU5hbWUpLnRvU3RyaW5nKCd1dGY4Jyk7XG4gICAgICAgIGNvbnN0IGZpbGVVcmkgPSB2c2NvZGVfMS5VcmkuZmlsZShmaWxlTmFtZSk7XG4gICAgICAgIC8vIEFkZCBsaW5lIGZlZWRzIGFuZCBidWlsZCB0aGUgdGV4dCBlZGl0c1xuICAgICAgICBwYXRjaGVzLmZvckVhY2gocCA9PiB7XG4gICAgICAgICAgICBwLmRpZmZzLmZvckVhY2goZGlmZiA9PiB7XG4gICAgICAgICAgICAgICAgZGlmZlsxXSArPSBvc18xLkVPTDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZ2V0VGV4dEVkaXRzSW50ZXJuYWwoZmlsZVNvdXJjZSwgcC5kaWZmcywgcC5zdGFydDEpLmZvckVhY2goZWRpdCA9PiB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChlZGl0LmFjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIEVkaXRBY3Rpb24uRGVsZXRlOlxuICAgICAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlRWRpdC5kZWxldGUoZmlsZVVyaSwgbmV3IHZzY29kZV8xLlJhbmdlKGVkaXQuc3RhcnQsIGVkaXQuZW5kKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBFZGl0QWN0aW9uLkluc2VydDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtzcGFjZUVkaXQuaW5zZXJ0KGZpbGVVcmksIGVkaXQuc3RhcnQsIGVkaXQudGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBFZGl0QWN0aW9uLlJlcGxhY2U6XG4gICAgICAgICAgICAgICAgICAgICAgICB3b3Jrc3BhY2VFZGl0LnJlcGxhY2UoZmlsZVVyaSwgbmV3IHZzY29kZV8xLlJhbmdlKGVkaXQuc3RhcnQsIGVkaXQuZW5kKSwgZWRpdC50ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJldHVybiB3b3Jrc3BhY2VFZGl0O1xufVxuZXhwb3J0cy5nZXRXb3Jrc3BhY2VFZGl0c0Zyb21QYXRjaCA9IGdldFdvcmtzcGFjZUVkaXRzRnJvbVBhdGNoO1xuZnVuY3Rpb24gZ2V0VGV4dEVkaXRzKGJlZm9yZSwgYWZ0ZXIpIHtcbiAgICBjb25zdCBkID0gbmV3IGRtcC5kaWZmX21hdGNoX3BhdGNoKCk7XG4gICAgY29uc3QgZGlmZnMgPSBkLmRpZmZfbWFpbihiZWZvcmUsIGFmdGVyKTtcbiAgICByZXR1cm4gZ2V0VGV4dEVkaXRzSW50ZXJuYWwoYmVmb3JlLCBkaWZmcykubWFwKGVkaXQgPT4gZWRpdC5hcHBseSgpKTtcbn1cbmV4cG9ydHMuZ2V0VGV4dEVkaXRzID0gZ2V0VGV4dEVkaXRzO1xuZnVuY3Rpb24gZ2V0VGV4dEVkaXRzSW50ZXJuYWwoYmVmb3JlLCBkaWZmcywgc3RhcnRMaW5lID0gMCkge1xuICAgIGxldCBsaW5lID0gc3RhcnRMaW5lO1xuICAgIGxldCBjaGFyYWN0ZXIgPSAwO1xuICAgIGlmIChsaW5lID4gMCkge1xuICAgICAgICBjb25zdCBiZWZvcmVMaW5lcyA9IGJlZm9yZS5zcGxpdCgvXFxyP1xcbi9nKTtcbiAgICAgICAgYmVmb3JlTGluZXMuZmlsdGVyKChsLCBpKSA9PiBpIDwgbGluZSkuZm9yRWFjaChsID0+IGNoYXJhY3RlciArPSBsLmxlbmd0aCArIE5FV19MSU5FX0xFTkdUSCk7XG4gICAgfVxuICAgIGNvbnN0IGVkaXRzID0gW107XG4gICAgbGV0IGVkaXQgPSBudWxsO1xuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpwcmVmZXItZm9yLW9mXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaWZmcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBjb25zdCBzdGFydCA9IG5ldyB2c2NvZGVfMS5Qb3NpdGlvbihsaW5lLCBjaGFyYWN0ZXIpO1xuICAgICAgICAvLyBDb21wdXRlIHRoZSBsaW5lL2NoYXJhY3RlciBhZnRlciB0aGUgZGlmZiBpcyBhcHBsaWVkLlxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6cHJlZmVyLWZvci1vZlxuICAgICAgICBmb3IgKGxldCBjdXJyID0gMDsgY3VyciA8IGRpZmZzW2ldWzFdLmxlbmd0aDsgY3VyciArPSAxKSB7XG4gICAgICAgICAgICBpZiAoZGlmZnNbaV1bMV1bY3Vycl0gIT09ICdcXG4nKSB7XG4gICAgICAgICAgICAgICAgY2hhcmFjdGVyICs9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjaGFyYWN0ZXIgPSAwO1xuICAgICAgICAgICAgICAgIGxpbmUgKz0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6c3dpdGNoLWRlZmF1bHRcbiAgICAgICAgc3dpdGNoIChkaWZmc1tpXVswXSkge1xuICAgICAgICAgICAgY2FzZSBkbXAuRElGRl9ERUxFVEU6XG4gICAgICAgICAgICAgICAgaWYgKGVkaXQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgZWRpdCA9IG5ldyBFZGl0KEVkaXRBY3Rpb24uRGVsZXRlLCBzdGFydCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGVkaXQuYWN0aW9uICE9PSBFZGl0QWN0aW9uLkRlbGV0ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Nhbm5vdCBmb3JtYXQgZHVlIHRvIGFuIGludGVybmFsIGVycm9yLicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlZGl0LmVuZCA9IG5ldyB2c2NvZGVfMS5Qb3NpdGlvbihsaW5lLCBjaGFyYWN0ZXIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBkbXAuRElGRl9JTlNFUlQ6XG4gICAgICAgICAgICAgICAgaWYgKGVkaXQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgZWRpdCA9IG5ldyBFZGl0KEVkaXRBY3Rpb24uSW5zZXJ0LCBzdGFydCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGVkaXQuYWN0aW9uID09PSBFZGl0QWN0aW9uLkRlbGV0ZSkge1xuICAgICAgICAgICAgICAgICAgICBlZGl0LmFjdGlvbiA9IEVkaXRBY3Rpb24uUmVwbGFjZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gaW5zZXJ0IGFuZCByZXBsYWNlIGVkaXRzIGFyZSBhbGwgcmVsYXRpdmUgdG8gdGhlIG9yaWdpbmFsIHN0YXRlXG4gICAgICAgICAgICAgICAgLy8gb2YgdGhlIGRvY3VtZW50LCBzbyBpbnNlcnRzIHNob3VsZCByZXNldCB0aGUgY3VycmVudCBsaW5lL2NoYXJhY3RlclxuICAgICAgICAgICAgICAgIC8vIHBvc2l0aW9uIHRvIHRoZSBzdGFydC5cbiAgICAgICAgICAgICAgICBsaW5lID0gc3RhcnQubGluZTtcbiAgICAgICAgICAgICAgICBjaGFyYWN0ZXIgPSBzdGFydC5jaGFyYWN0ZXI7XG4gICAgICAgICAgICAgICAgZWRpdC50ZXh0ICs9IGRpZmZzW2ldWzFdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBkbXAuRElGRl9FUVVBTDpcbiAgICAgICAgICAgICAgICBpZiAoZWRpdCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBlZGl0cy5wdXNoKGVkaXQpO1xuICAgICAgICAgICAgICAgICAgICBlZGl0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGVkaXQgIT09IG51bGwpIHtcbiAgICAgICAgZWRpdHMucHVzaChlZGl0KTtcbiAgICB9XG4gICAgcmV0dXJuIGVkaXRzO1xufVxuZnVuY3Rpb24gZ2V0VGVtcEZpbGVXaXRoRG9jdW1lbnRDb250ZW50cyhkb2N1bWVudCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IGV4dCA9IHBhdGguZXh0bmFtZShkb2N1bWVudC51cmkuZnNQYXRoKTtcbiAgICAgICAgLy8gRG9uJ3QgY3JlYXRlIGZpbGUgaW4gdGVtcCBmb2xkZXIgc2luY2UgZXh0ZXJuYWwgdXRpbGl0aWVzXG4gICAgICAgIC8vIGxvb2sgaW50byBjb25maWd1cmF0aW9uIGZpbGVzIGluIHRoZSB3b3Jrc3BhY2UgYW5kIGFyZSBub3QgYWJsZVxuICAgICAgICAvLyB0byBmaW5kIGN1c3RvbSBydWxlcyBpZiBmaWxlIGlzIHNhdmVkIGluIGEgcmFuZG9tIGRpc2sgbG9jYXRpb24uXG4gICAgICAgIC8vIFRoaXMgbWVhbnMgdGVtcCBmaWxlIGhhcyB0byBiZSBjcmVhdGVkIGluIHRoZSBzYW1lIGZvbGRlclxuICAgICAgICAvLyBhcyB0aGUgb3JpZ2luYWwgb25lIGFuZCB0aGVuIHJlbW92ZWQuXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1yZXF1aXJlLWltcG9ydHNcbiAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBgJHtkb2N1bWVudC51cmkuZnNQYXRofS4ke21kNShkb2N1bWVudC51cmkuZnNQYXRoKX0ke2V4dH1gO1xuICAgICAgICBmcy53cml0ZUZpbGUoZmlsZU5hbWUsIGRvY3VtZW50LmdldFRleHQoKSwgZXggPT4ge1xuICAgICAgICAgICAgaWYgKGV4KSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGBGYWlsZWQgdG8gY3JlYXRlIGEgdGVtcG9yYXJ5IGZpbGUsICR7ZXgubWVzc2FnZX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc29sdmUoZmlsZU5hbWUpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuZ2V0VGVtcEZpbGVXaXRoRG9jdW1lbnRDb250ZW50cyA9IGdldFRlbXBGaWxlV2l0aERvY3VtZW50Q29udGVudHM7XG4vKipcbiAqIFBhcnNlIGEgdGV4dHVhbCByZXByZXNlbnRhdGlvbiBvZiBwYXRjaGVzIGFuZCByZXR1cm4gYSBsaXN0IG9mIFBhdGNoIG9iamVjdHMuXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dGxpbmUgVGV4dCByZXByZXNlbnRhdGlvbiBvZiBwYXRjaGVzLlxuICogQHJldHVybiB7IUFycmF5LjwhZGlmZl9tYXRjaF9wYXRjaC5wYXRjaF9vYmo+fSBBcnJheSBvZiBQYXRjaCBvYmplY3RzLlxuICogQHRocm93cyB7IUVycm9yfSBJZiBpbnZhbGlkIGlucHV0LlxuICovXG5mdW5jdGlvbiBwYXRjaF9mcm9tVGV4dCh0ZXh0bGluZSkge1xuICAgIGNvbnN0IHBhdGNoZXMgPSBbXTtcbiAgICBpZiAoIXRleHRsaW5lKSB7XG4gICAgICAgIHJldHVybiBwYXRjaGVzO1xuICAgIH1cbiAgICAvLyBTdGFydCBNb2RpZmljYXRpb24gYnkgRG9uIEpheWFtYW5uZSAyNC8wNi8yMDE2IFN1cHBvcnQgZm9yIENSTEZcbiAgICBjb25zdCB0ZXh0ID0gdGV4dGxpbmUuc3BsaXQoL1tcXHJcXG5dLyk7XG4gICAgLy8gRW5kIE1vZGlmaWNhdGlvblxuICAgIGxldCB0ZXh0UG9pbnRlciA9IDA7XG4gICAgY29uc3QgcGF0Y2hIZWFkZXIgPSAvXkBAIC0oXFxkKyksPyhcXGQqKSBcXCsoXFxkKyksPyhcXGQqKSBAQCQvO1xuICAgIHdoaWxlICh0ZXh0UG9pbnRlciA8IHRleHQubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IG0gPSB0ZXh0W3RleHRQb2ludGVyXS5tYXRjaChwYXRjaEhlYWRlcik7XG4gICAgICAgIGlmICghbSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHBhdGNoIHN0cmluZzogJHt0ZXh0W3RleHRQb2ludGVyXX1gKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55XG4gICAgICAgIGNvbnN0IHBhdGNoID0gbmV3IGRtcC5kaWZmX21hdGNoX3BhdGNoLnBhdGNoX29iaigpO1xuICAgICAgICBwYXRjaGVzLnB1c2gocGF0Y2gpO1xuICAgICAgICBwYXRjaC5zdGFydDEgPSBwYXJzZUludChtWzFdLCAxMCk7XG4gICAgICAgIGlmIChtWzJdID09PSAnJykge1xuICAgICAgICAgICAgcGF0Y2guc3RhcnQxIC09IDE7XG4gICAgICAgICAgICBwYXRjaC5sZW5ndGgxID0gMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChtWzJdID09PSAnMCcpIHtcbiAgICAgICAgICAgIHBhdGNoLmxlbmd0aDEgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcGF0Y2guc3RhcnQxIC09IDE7XG4gICAgICAgICAgICBwYXRjaC5sZW5ndGgxID0gcGFyc2VJbnQobVsyXSwgMTApO1xuICAgICAgICB9XG4gICAgICAgIHBhdGNoLnN0YXJ0MiA9IHBhcnNlSW50KG1bM10sIDEwKTtcbiAgICAgICAgaWYgKG1bNF0gPT09ICcnKSB7XG4gICAgICAgICAgICBwYXRjaC5zdGFydDIgLT0gMTtcbiAgICAgICAgICAgIHBhdGNoLmxlbmd0aDIgPSAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG1bNF0gPT09ICcwJykge1xuICAgICAgICAgICAgcGF0Y2gubGVuZ3RoMiA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBwYXRjaC5zdGFydDIgLT0gMTtcbiAgICAgICAgICAgIHBhdGNoLmxlbmd0aDIgPSBwYXJzZUludChtWzRdLCAxMCk7XG4gICAgICAgIH1cbiAgICAgICAgdGV4dFBvaW50ZXIgKz0gMTtcbiAgICAgICAgd2hpbGUgKHRleHRQb2ludGVyIDwgdGV4dC5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbnN0IHNpZ24gPSB0ZXh0W3RleHRQb2ludGVyXS5jaGFyQXQoMCk7XG4gICAgICAgICAgICBsZXQgbGluZTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgLy92YXIgbGluZSA9IGRlY29kZVVSSSh0ZXh0W3RleHRQb2ludGVyXS5zdWJzdHJpbmcoMSkpO1xuICAgICAgICAgICAgICAgIC8vIEZvciBzb21lIHJlYXNvbiB0aGUgcGF0Y2ggZ2VuZXJhdGVkIGJ5IHB5dGhvbiBmaWxlcyBkb24ndCBlbmNvZGUgYW55IGNoYXJhY3RlcnNcbiAgICAgICAgICAgICAgICAvLyBBbmQgdGhpcyBwYXRjaCBtb2R1bGUgKGNvZGUgZnJvbSBHb29nbGUpIGlzIGV4cGVjdGluZyB0aGUgdGV4dCB0byBiZSBlbmNvZGVkISFcbiAgICAgICAgICAgICAgICAvLyBUZW1wb3Jhcnkgc29sdXRpb24sIGRpc2FibGUgZGVjb2RpbmdcbiAgICAgICAgICAgICAgICAvLyBJc3N1ZSAjMTg4XG4gICAgICAgICAgICAgICAgbGluZSA9IHRleHRbdGV4dFBvaW50ZXJdLnN1YnN0cmluZygxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChleCkge1xuICAgICAgICAgICAgICAgIC8vIE1hbGZvcm1lZCBVUkkgc2VxdWVuY2UuXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbGxlZ2FsIGVzY2FwZSBpbiBwYXRjaF9mcm9tVGV4dCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNpZ24gPT09ICctJykge1xuICAgICAgICAgICAgICAgIC8vIERlbGV0aW9uLlxuICAgICAgICAgICAgICAgIHBhdGNoLmRpZmZzLnB1c2goW2RtcC5ESUZGX0RFTEVURSwgbGluZV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoc2lnbiA9PT0gJysnKSB7XG4gICAgICAgICAgICAgICAgLy8gSW5zZXJ0aW9uLlxuICAgICAgICAgICAgICAgIHBhdGNoLmRpZmZzLnB1c2goW2RtcC5ESUZGX0lOU0VSVCwgbGluZV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoc2lnbiA9PT0gJyAnKSB7XG4gICAgICAgICAgICAgICAgLy8gTWlub3IgZXF1YWxpdHkuXG4gICAgICAgICAgICAgICAgcGF0Y2guZGlmZnMucHVzaChbZG1wLkRJRkZfRVFVQUwsIGxpbmVdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHNpZ24gPT09ICdAJykge1xuICAgICAgICAgICAgICAgIC8vIFN0YXJ0IG9mIG5leHQgcGF0Y2guXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChzaWduID09PSAnJykge1xuICAgICAgICAgICAgICAgIC8vIEJsYW5rIGxpbmU/ICBXaGF0ZXZlci5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFdURj9cbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgcGF0Y2ggbW9kZSAnJHtzaWdufScgaW46ICR7bGluZX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRleHRQb2ludGVyICs9IDE7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHBhdGNoZXM7XG59XG5sZXQgRWRpdG9yVXRpbHMgPSBjbGFzcyBFZGl0b3JVdGlscyB7XG4gICAgZ2V0V29ya3NwYWNlRWRpdHNGcm9tUGF0Y2gob3JpZ2luYWxDb250ZW50cywgcGF0Y2gsIHVyaSkge1xuICAgICAgICBjb25zdCB3b3Jrc3BhY2VFZGl0ID0gbmV3IHZzY29kZV8xLldvcmtzcGFjZUVkaXQoKTtcbiAgICAgICAgaWYgKHBhdGNoLnN0YXJ0c1dpdGgoJy0tLScpKSB7XG4gICAgICAgICAgICAvLyBTdHJpcCB0aGUgZmlyc3QgdHdvIGxpbmVzXG4gICAgICAgICAgICBwYXRjaCA9IHBhdGNoLnN1YnN0cmluZyhwYXRjaC5pbmRleE9mKCdAQCcpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGF0Y2gubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gd29ya3NwYWNlRWRpdDtcbiAgICAgICAgfVxuICAgICAgICAvLyBSZW1vdmUgdGhlIHRleHQgYWRkZWQgYnkgdW5pZmllZF9kaWZmXG4gICAgICAgIC8vICMgV29yayBhcm91bmQgbWlzc2luZyBuZXdsaW5lIChodHRwOi8vYnVncy5weXRob24ub3JnL2lzc3VlMjE0MikuXG4gICAgICAgIHBhdGNoID0gcGF0Y2gucmVwbGFjZSgvXFxcXCBObyBuZXdsaW5lIGF0IGVuZCBvZiBmaWxlW1xcclxcbl0vLCAnJyk7XG4gICAgICAgIGNvbnN0IGQgPSBuZXcgZG1wLmRpZmZfbWF0Y2hfcGF0Y2goKTtcbiAgICAgICAgY29uc3QgcGF0Y2hlcyA9IHBhdGNoX2Zyb21UZXh0LmNhbGwoZCwgcGF0Y2gpO1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocGF0Y2hlcykgfHwgcGF0Y2hlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5hYmxlIHRvIHBhcnNlIFBhdGNoIHN0cmluZycpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEFkZCBsaW5lIGZlZWRzIGFuZCBidWlsZCB0aGUgdGV4dCBlZGl0c1xuICAgICAgICBwYXRjaGVzLmZvckVhY2gocCA9PiB7XG4gICAgICAgICAgICBwLmRpZmZzLmZvckVhY2goZGlmZiA9PiB7XG4gICAgICAgICAgICAgICAgZGlmZlsxXSArPSBvc18xLkVPTDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZ2V0VGV4dEVkaXRzSW50ZXJuYWwob3JpZ2luYWxDb250ZW50cywgcC5kaWZmcywgcC5zdGFydDEpLmZvckVhY2goZWRpdCA9PiB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChlZGl0LmFjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIEVkaXRBY3Rpb24uRGVsZXRlOlxuICAgICAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlRWRpdC5kZWxldGUodXJpLCBuZXcgdnNjb2RlXzEuUmFuZ2UoZWRpdC5zdGFydCwgZWRpdC5lbmQpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIEVkaXRBY3Rpb24uSW5zZXJ0OlxuICAgICAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlRWRpdC5pbnNlcnQodXJpLCBlZGl0LnN0YXJ0LCBlZGl0LnRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgRWRpdEFjdGlvbi5SZXBsYWNlOlxuICAgICAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlRWRpdC5yZXBsYWNlKHVyaSwgbmV3IHZzY29kZV8xLlJhbmdlKGVkaXQuc3RhcnQsIGVkaXQuZW5kKSwgZWRpdC50ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gd29ya3NwYWNlRWRpdDtcbiAgICB9XG59O1xuRWRpdG9yVXRpbHMgPSBfX2RlY29yYXRlKFtcbiAgICBpbnZlcnNpZnlfMS5pbmplY3RhYmxlKClcbl0sIEVkaXRvclV0aWxzKTtcbmV4cG9ydHMuRWRpdG9yVXRpbHMgPSBFZGl0b3JVdGlscztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWVkaXRvci5qcy5tYXAiXX0=
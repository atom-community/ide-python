// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

const getos = require("getos");

const os = require("os");

const semver = require("semver");

const version_1 = require("./version");

var Architecture;

(function (Architecture) {
  Architecture[Architecture["Unknown"] = 1] = "Unknown";
  Architecture[Architecture["x86"] = 2] = "x86";
  Architecture[Architecture["x64"] = 3] = "x64";
})(Architecture = exports.Architecture || (exports.Architecture = {}));

var OSType;

(function (OSType) {
  OSType[OSType["Unknown"] = 0] = "Unknown";
  OSType[OSType["Windows"] = 1] = "Windows";
  OSType[OSType["OSX"] = 2] = "OSX";
  OSType[OSType["Linux"] = 3] = "Linux";
})(OSType = exports.OSType || (exports.OSType = {}));

var OSDistro;

(function (OSDistro) {
  OSDistro[OSDistro["Unknown"] = 0] = "Unknown"; // linux:

  OSDistro[OSDistro["Ubuntu"] = 1] = "Ubuntu";
  OSDistro[OSDistro["Debian"] = 2] = "Debian";
  OSDistro[OSDistro["RHEL"] = 3] = "RHEL";
  OSDistro[OSDistro["Fedora"] = 4] = "Fedora";
  OSDistro[OSDistro["CentOS"] = 5] = "CentOS"; // The remainder aren't officially supported.
  // See: https://code.visualstudio.com/docs/supporting/requirements

  OSDistro[OSDistro["Suse"] = 6] = "Suse";
  OSDistro[OSDistro["Gentoo"] = 7] = "Gentoo";
  OSDistro[OSDistro["Arch"] = 8] = "Arch";
})(OSDistro = exports.OSDistro || (exports.OSDistro = {}));

let local;

function getLocal() {
  if (!local) {
    local = getInfo();
  }

  return local;
}

function getOSType(platform = process.platform) {
  if (/^win/.test(platform)) {
    return OSType.Windows;
  } else if (/^darwin/.test(platform)) {
    return OSType.OSX;
  } else if (/^linux/.test(platform)) {
    return OSType.Linux;
  } else {
    return OSType.Unknown;
  }
}

exports.getOSType = getOSType;

class Info {
  constructor(type, arch = os.arch(), // See:
  //  https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/semver/index.d.ts#L152
  version = new semver.SemVer('0.0.0'), distro = OSDistro.Unknown) {
    this.type = type;
    this.arch = arch;
    this.version = version;
    this.distro = distro;
  }

  get architecture() {
    return this.arch === 'x64' ? Architecture.x64 : Architecture.x86;
  }

  matchPlatform(names) {
    return matchPlatform(names, this);
  }

}

exports.Info = Info;

function getInfo(getArch = os.arch, getRelease = os.release, getDistro = getLinuxDistro, platform) {
  const osType = getOSType(platform);
  const arch = getArch();

  switch (osType) {
    case OSType.Windows:
      return getDefaultInfo(osType, arch, getRelease);

    case OSType.OSX:
      return getDefaultInfo(osType, arch, getRelease);

    case OSType.Linux:
      return getLinuxInfo(arch, getDistro);

    default:
      return new Info(OSType.Unknown, arch);
  }
}

exports.getInfo = getInfo;

function getDefaultInfo(osType, arch, getRelease) {
  const version = version_1.parseVersion(getRelease());
  return new Info(osType, arch, version);
}

function getLinuxInfo(arch, getDistro) {
  const [distro, version] = getDistro();
  return new Info(OSType.Linux, arch, version, distro);
}

function getLinuxDistro() {
  let distro = OSDistro.Unknown;
  let version = new semver.SemVer('0.0.0');
  getos((exc, info) => {
    if (exc) {
      throw exc;
    }

    distro = getLinuxDistroFromName(info.dist);
    version = version_1.parseVersion(info.release);
  });
  return [distro, version];
}

function getLinuxDistroFromName(name) {
  name = name.toLowerCase(); // See https://github.com/zyga/os-release-zoo.

  if (/ubuntu/.test(name)) {
    return OSDistro.Ubuntu;
  } else if (/debian/.test(name)) {
    return OSDistro.Debian;
  } else if (/rhel/.test(name) || /red hat/.test(name)) {
    return OSDistro.RHEL;
  } else if (/fedora/.test(name)) {
    return OSDistro.Fedora;
  } else if (/centos/.test(name)) {
    return OSDistro.CentOS;
  } // The remainder aren't officially supported by VS Code.


  if (/suse/.test(name)) {
    return OSDistro.Suse;
  } else if (/gentoo/.test(name)) {
    return OSDistro.Suse;
  } else if (/arch/.test(name)) {
    return OSDistro.Arch;
  } else {
    return OSDistro.Unknown;
  }
} // helpers


function isWindows(info) {
  if (!info) {
    info = getLocal();
  }

  return info.type === OSType.Windows;
}

exports.isWindows = isWindows;

function isMac(info) {
  if (!info) {
    info = getLocal();
  }

  return info.type === OSType.OSX;
}

exports.isMac = isMac;

function isLinux(info) {
  if (!info) {
    info = getLocal();
  }

  return info.type === OSType.Linux;
}

exports.isLinux = isLinux;

function is64bit(info) {
  if (!info) {
    info = getLocal();
  }

  return info.architecture === Architecture.x64;
}

exports.is64bit = is64bit; // Match the platform string to the given OS info.

function matchPlatform(names, info = getInfo()) {
  if (info.type === OSType.Unknown) {
    return false;
  }

  names = names.trim();

  if (names === '') {
    return true;
  }

  for (let name of names.split('|')) {
    name = name.trim();

    if (matchOnePlatform(name, info)) {
      return true;
    }
  }

  return false;
}

exports.matchPlatform = matchPlatform;

function matchOnePlatform(name, info) {
  if (name === '' || name === '-') {
    return false;
  }

  const negate = name[0] === '-';

  if (negate) {
    name = name.replace(/^-/, '');
  }

  const [osType, distro] = identifyOS(name);

  if (osType === OSType.Unknown) {
    return false;
  }

  let result = false;

  if (osType === info.type) {
    result = true;

    if (osType === OSType.Linux) {
      if (distro !== OSDistro.Unknown) {
        result = distro === info.distro;
      }
    }
  }

  return negate ? !result : result;
}

function identifyOS(name) {
  name = name.toLowerCase();

  if (/win/.test(name)) {
    return [OSType.Windows, OSDistro.Unknown];
  } else if (/darwin|mac|osx/.test(name)) {
    return [OSType.OSX, OSDistro.Unknown];
  } else if (/linux/.test(name)) {
    return [OSType.Linux, OSDistro.Unknown];
  } // Try linux distros.


  const distro = getLinuxDistroFromName(name);

  if (distro !== OSDistro.Unknown) {
    return [OSType.Linux, distro];
  } else {
    return [OSType.Unknown, OSDistro.Unknown];
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBsYXRmb3JtLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZ2V0b3MiLCJyZXF1aXJlIiwib3MiLCJzZW12ZXIiLCJ2ZXJzaW9uXzEiLCJBcmNoaXRlY3R1cmUiLCJPU1R5cGUiLCJPU0Rpc3RybyIsImxvY2FsIiwiZ2V0TG9jYWwiLCJnZXRJbmZvIiwiZ2V0T1NUeXBlIiwicGxhdGZvcm0iLCJwcm9jZXNzIiwidGVzdCIsIldpbmRvd3MiLCJPU1giLCJMaW51eCIsIlVua25vd24iLCJJbmZvIiwiY29uc3RydWN0b3IiLCJ0eXBlIiwiYXJjaCIsInZlcnNpb24iLCJTZW1WZXIiLCJkaXN0cm8iLCJhcmNoaXRlY3R1cmUiLCJ4NjQiLCJ4ODYiLCJtYXRjaFBsYXRmb3JtIiwibmFtZXMiLCJnZXRBcmNoIiwiZ2V0UmVsZWFzZSIsInJlbGVhc2UiLCJnZXREaXN0cm8iLCJnZXRMaW51eERpc3RybyIsIm9zVHlwZSIsImdldERlZmF1bHRJbmZvIiwiZ2V0TGludXhJbmZvIiwicGFyc2VWZXJzaW9uIiwiZXhjIiwiaW5mbyIsImdldExpbnV4RGlzdHJvRnJvbU5hbWUiLCJkaXN0IiwibmFtZSIsInRvTG93ZXJDYXNlIiwiVWJ1bnR1IiwiRGViaWFuIiwiUkhFTCIsIkZlZG9yYSIsIkNlbnRPUyIsIlN1c2UiLCJBcmNoIiwiaXNXaW5kb3dzIiwiaXNNYWMiLCJpc0xpbnV4IiwiaXM2NGJpdCIsInRyaW0iLCJzcGxpdCIsIm1hdGNoT25lUGxhdGZvcm0iLCJuZWdhdGUiLCJyZXBsYWNlIiwiaWRlbnRpZnlPUyIsInJlc3VsdCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUNBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQUVDLEVBQUFBLEtBQUssRUFBRTtBQUFULENBQTdDOztBQUNBLE1BQU1DLEtBQUssR0FBR0MsT0FBTyxDQUFDLE9BQUQsQ0FBckI7O0FBQ0EsTUFBTUMsRUFBRSxHQUFHRCxPQUFPLENBQUMsSUFBRCxDQUFsQjs7QUFDQSxNQUFNRSxNQUFNLEdBQUdGLE9BQU8sQ0FBQyxRQUFELENBQXRCOztBQUNBLE1BQU1HLFNBQVMsR0FBR0gsT0FBTyxDQUFDLFdBQUQsQ0FBekI7O0FBQ0EsSUFBSUksWUFBSjs7QUFDQSxDQUFDLFVBQVVBLFlBQVYsRUFBd0I7QUFDckJBLEVBQUFBLFlBQVksQ0FBQ0EsWUFBWSxDQUFDLFNBQUQsQ0FBWixHQUEwQixDQUEzQixDQUFaLEdBQTRDLFNBQTVDO0FBQ0FBLEVBQUFBLFlBQVksQ0FBQ0EsWUFBWSxDQUFDLEtBQUQsQ0FBWixHQUFzQixDQUF2QixDQUFaLEdBQXdDLEtBQXhDO0FBQ0FBLEVBQUFBLFlBQVksQ0FBQ0EsWUFBWSxDQUFDLEtBQUQsQ0FBWixHQUFzQixDQUF2QixDQUFaLEdBQXdDLEtBQXhDO0FBQ0gsQ0FKRCxFQUlHQSxZQUFZLEdBQUdQLE9BQU8sQ0FBQ08sWUFBUixLQUF5QlAsT0FBTyxDQUFDTyxZQUFSLEdBQXVCLEVBQWhELENBSmxCOztBQUtBLElBQUlDLE1BQUo7O0FBQ0EsQ0FBQyxVQUFVQSxNQUFWLEVBQWtCO0FBQ2ZBLEVBQUFBLE1BQU0sQ0FBQ0EsTUFBTSxDQUFDLFNBQUQsQ0FBTixHQUFvQixDQUFyQixDQUFOLEdBQWdDLFNBQWhDO0FBQ0FBLEVBQUFBLE1BQU0sQ0FBQ0EsTUFBTSxDQUFDLFNBQUQsQ0FBTixHQUFvQixDQUFyQixDQUFOLEdBQWdDLFNBQWhDO0FBQ0FBLEVBQUFBLE1BQU0sQ0FBQ0EsTUFBTSxDQUFDLEtBQUQsQ0FBTixHQUFnQixDQUFqQixDQUFOLEdBQTRCLEtBQTVCO0FBQ0FBLEVBQUFBLE1BQU0sQ0FBQ0EsTUFBTSxDQUFDLE9BQUQsQ0FBTixHQUFrQixDQUFuQixDQUFOLEdBQThCLE9BQTlCO0FBQ0gsQ0FMRCxFQUtHQSxNQUFNLEdBQUdSLE9BQU8sQ0FBQ1EsTUFBUixLQUFtQlIsT0FBTyxDQUFDUSxNQUFSLEdBQWlCLEVBQXBDLENBTFo7O0FBTUEsSUFBSUMsUUFBSjs7QUFDQSxDQUFDLFVBQVVBLFFBQVYsRUFBb0I7QUFDakJBLEVBQUFBLFFBQVEsQ0FBQ0EsUUFBUSxDQUFDLFNBQUQsQ0FBUixHQUFzQixDQUF2QixDQUFSLEdBQW9DLFNBQXBDLENBRGlCLENBRWpCOztBQUNBQSxFQUFBQSxRQUFRLENBQUNBLFFBQVEsQ0FBQyxRQUFELENBQVIsR0FBcUIsQ0FBdEIsQ0FBUixHQUFtQyxRQUFuQztBQUNBQSxFQUFBQSxRQUFRLENBQUNBLFFBQVEsQ0FBQyxRQUFELENBQVIsR0FBcUIsQ0FBdEIsQ0FBUixHQUFtQyxRQUFuQztBQUNBQSxFQUFBQSxRQUFRLENBQUNBLFFBQVEsQ0FBQyxNQUFELENBQVIsR0FBbUIsQ0FBcEIsQ0FBUixHQUFpQyxNQUFqQztBQUNBQSxFQUFBQSxRQUFRLENBQUNBLFFBQVEsQ0FBQyxRQUFELENBQVIsR0FBcUIsQ0FBdEIsQ0FBUixHQUFtQyxRQUFuQztBQUNBQSxFQUFBQSxRQUFRLENBQUNBLFFBQVEsQ0FBQyxRQUFELENBQVIsR0FBcUIsQ0FBdEIsQ0FBUixHQUFtQyxRQUFuQyxDQVBpQixDQVFqQjtBQUNBOztBQUNBQSxFQUFBQSxRQUFRLENBQUNBLFFBQVEsQ0FBQyxNQUFELENBQVIsR0FBbUIsQ0FBcEIsQ0FBUixHQUFpQyxNQUFqQztBQUNBQSxFQUFBQSxRQUFRLENBQUNBLFFBQVEsQ0FBQyxRQUFELENBQVIsR0FBcUIsQ0FBdEIsQ0FBUixHQUFtQyxRQUFuQztBQUNBQSxFQUFBQSxRQUFRLENBQUNBLFFBQVEsQ0FBQyxNQUFELENBQVIsR0FBbUIsQ0FBcEIsQ0FBUixHQUFpQyxNQUFqQztBQUNILENBYkQsRUFhR0EsUUFBUSxHQUFHVCxPQUFPLENBQUNTLFFBQVIsS0FBcUJULE9BQU8sQ0FBQ1MsUUFBUixHQUFtQixFQUF4QyxDQWJkOztBQWNBLElBQUlDLEtBQUo7O0FBQ0EsU0FBU0MsUUFBVCxHQUFvQjtBQUNoQixNQUFJLENBQUNELEtBQUwsRUFBWTtBQUNSQSxJQUFBQSxLQUFLLEdBQUdFLE9BQU8sRUFBZjtBQUNIOztBQUNELFNBQU9GLEtBQVA7QUFDSDs7QUFDRCxTQUFTRyxTQUFULENBQW1CQyxRQUFRLEdBQUdDLE9BQU8sQ0FBQ0QsUUFBdEMsRUFBZ0Q7QUFDNUMsTUFBSSxPQUFPRSxJQUFQLENBQVlGLFFBQVosQ0FBSixFQUEyQjtBQUN2QixXQUFPTixNQUFNLENBQUNTLE9BQWQ7QUFDSCxHQUZELE1BR0ssSUFBSSxVQUFVRCxJQUFWLENBQWVGLFFBQWYsQ0FBSixFQUE4QjtBQUMvQixXQUFPTixNQUFNLENBQUNVLEdBQWQ7QUFDSCxHQUZJLE1BR0EsSUFBSSxTQUFTRixJQUFULENBQWNGLFFBQWQsQ0FBSixFQUE2QjtBQUM5QixXQUFPTixNQUFNLENBQUNXLEtBQWQ7QUFDSCxHQUZJLE1BR0E7QUFDRCxXQUFPWCxNQUFNLENBQUNZLE9BQWQ7QUFDSDtBQUNKOztBQUNEcEIsT0FBTyxDQUFDYSxTQUFSLEdBQW9CQSxTQUFwQjs7QUFDQSxNQUFNUSxJQUFOLENBQVc7QUFDUEMsRUFBQUEsV0FBVyxDQUFDQyxJQUFELEVBQU9DLElBQUksR0FBR3BCLEVBQUUsQ0FBQ29CLElBQUgsRUFBZCxFQUNYO0FBQ0E7QUFDQUMsRUFBQUEsT0FBTyxHQUFHLElBQUlwQixNQUFNLENBQUNxQixNQUFYLENBQWtCLE9BQWxCLENBSEMsRUFHMkJDLE1BQU0sR0FBR2xCLFFBQVEsQ0FBQ1csT0FIN0MsRUFHc0Q7QUFDN0QsU0FBS0csSUFBTCxHQUFZQSxJQUFaO0FBQ0EsU0FBS0MsSUFBTCxHQUFZQSxJQUFaO0FBQ0EsU0FBS0MsT0FBTCxHQUFlQSxPQUFmO0FBQ0EsU0FBS0UsTUFBTCxHQUFjQSxNQUFkO0FBQ0g7O0FBQ2UsTUFBWkMsWUFBWSxHQUFHO0FBQ2YsV0FBTyxLQUFLSixJQUFMLEtBQWMsS0FBZCxHQUFzQmpCLFlBQVksQ0FBQ3NCLEdBQW5DLEdBQXlDdEIsWUFBWSxDQUFDdUIsR0FBN0Q7QUFDSDs7QUFDREMsRUFBQUEsYUFBYSxDQUFDQyxLQUFELEVBQVE7QUFDakIsV0FBT0QsYUFBYSxDQUFDQyxLQUFELEVBQVEsSUFBUixDQUFwQjtBQUNIOztBQWZNOztBQWlCWGhDLE9BQU8sQ0FBQ3FCLElBQVIsR0FBZUEsSUFBZjs7QUFDQSxTQUFTVCxPQUFULENBQWlCcUIsT0FBTyxHQUFHN0IsRUFBRSxDQUFDb0IsSUFBOUIsRUFBb0NVLFVBQVUsR0FBRzlCLEVBQUUsQ0FBQytCLE9BQXBELEVBQTZEQyxTQUFTLEdBQUdDLGNBQXpFLEVBQXlGdkIsUUFBekYsRUFBbUc7QUFDL0YsUUFBTXdCLE1BQU0sR0FBR3pCLFNBQVMsQ0FBQ0MsUUFBRCxDQUF4QjtBQUNBLFFBQU1VLElBQUksR0FBR1MsT0FBTyxFQUFwQjs7QUFDQSxVQUFRSyxNQUFSO0FBQ0ksU0FBSzlCLE1BQU0sQ0FBQ1MsT0FBWjtBQUNJLGFBQU9zQixjQUFjLENBQUNELE1BQUQsRUFBU2QsSUFBVCxFQUFlVSxVQUFmLENBQXJCOztBQUNKLFNBQUsxQixNQUFNLENBQUNVLEdBQVo7QUFDSSxhQUFPcUIsY0FBYyxDQUFDRCxNQUFELEVBQVNkLElBQVQsRUFBZVUsVUFBZixDQUFyQjs7QUFDSixTQUFLMUIsTUFBTSxDQUFDVyxLQUFaO0FBQ0ksYUFBT3FCLFlBQVksQ0FBQ2hCLElBQUQsRUFBT1ksU0FBUCxDQUFuQjs7QUFDSjtBQUNJLGFBQU8sSUFBSWYsSUFBSixDQUFTYixNQUFNLENBQUNZLE9BQWhCLEVBQXlCSSxJQUF6QixDQUFQO0FBUlI7QUFVSDs7QUFDRHhCLE9BQU8sQ0FBQ1ksT0FBUixHQUFrQkEsT0FBbEI7O0FBQ0EsU0FBUzJCLGNBQVQsQ0FBd0JELE1BQXhCLEVBQWdDZCxJQUFoQyxFQUFzQ1UsVUFBdEMsRUFBa0Q7QUFDOUMsUUFBTVQsT0FBTyxHQUFHbkIsU0FBUyxDQUFDbUMsWUFBVixDQUF1QlAsVUFBVSxFQUFqQyxDQUFoQjtBQUNBLFNBQU8sSUFBSWIsSUFBSixDQUFTaUIsTUFBVCxFQUFpQmQsSUFBakIsRUFBdUJDLE9BQXZCLENBQVA7QUFDSDs7QUFDRCxTQUFTZSxZQUFULENBQXNCaEIsSUFBdEIsRUFBNEJZLFNBQTVCLEVBQXVDO0FBQ25DLFFBQU0sQ0FBQ1QsTUFBRCxFQUFTRixPQUFULElBQW9CVyxTQUFTLEVBQW5DO0FBQ0EsU0FBTyxJQUFJZixJQUFKLENBQVNiLE1BQU0sQ0FBQ1csS0FBaEIsRUFBdUJLLElBQXZCLEVBQTZCQyxPQUE3QixFQUFzQ0UsTUFBdEMsQ0FBUDtBQUNIOztBQUNELFNBQVNVLGNBQVQsR0FBMEI7QUFDdEIsTUFBSVYsTUFBTSxHQUFHbEIsUUFBUSxDQUFDVyxPQUF0QjtBQUNBLE1BQUlLLE9BQU8sR0FBRyxJQUFJcEIsTUFBTSxDQUFDcUIsTUFBWCxDQUFrQixPQUFsQixDQUFkO0FBQ0F4QixFQUFBQSxLQUFLLENBQUMsQ0FBQ3dDLEdBQUQsRUFBTUMsSUFBTixLQUFlO0FBQ2pCLFFBQUlELEdBQUosRUFBUztBQUNMLFlBQU1BLEdBQU47QUFDSDs7QUFDRGYsSUFBQUEsTUFBTSxHQUFHaUIsc0JBQXNCLENBQUNELElBQUksQ0FBQ0UsSUFBTixDQUEvQjtBQUNBcEIsSUFBQUEsT0FBTyxHQUFHbkIsU0FBUyxDQUFDbUMsWUFBVixDQUF1QkUsSUFBSSxDQUFDUixPQUE1QixDQUFWO0FBQ0gsR0FOSSxDQUFMO0FBT0EsU0FBTyxDQUFDUixNQUFELEVBQVNGLE9BQVQsQ0FBUDtBQUNIOztBQUNELFNBQVNtQixzQkFBVCxDQUFnQ0UsSUFBaEMsRUFBc0M7QUFDbENBLEVBQUFBLElBQUksR0FBR0EsSUFBSSxDQUFDQyxXQUFMLEVBQVAsQ0FEa0MsQ0FFbEM7O0FBQ0EsTUFBSSxTQUFTL0IsSUFBVCxDQUFjOEIsSUFBZCxDQUFKLEVBQXlCO0FBQ3JCLFdBQU9yQyxRQUFRLENBQUN1QyxNQUFoQjtBQUNILEdBRkQsTUFHSyxJQUFJLFNBQVNoQyxJQUFULENBQWM4QixJQUFkLENBQUosRUFBeUI7QUFDMUIsV0FBT3JDLFFBQVEsQ0FBQ3dDLE1BQWhCO0FBQ0gsR0FGSSxNQUdBLElBQUksT0FBT2pDLElBQVAsQ0FBWThCLElBQVosS0FBcUIsVUFBVTlCLElBQVYsQ0FBZThCLElBQWYsQ0FBekIsRUFBK0M7QUFDaEQsV0FBT3JDLFFBQVEsQ0FBQ3lDLElBQWhCO0FBQ0gsR0FGSSxNQUdBLElBQUksU0FBU2xDLElBQVQsQ0FBYzhCLElBQWQsQ0FBSixFQUF5QjtBQUMxQixXQUFPckMsUUFBUSxDQUFDMEMsTUFBaEI7QUFDSCxHQUZJLE1BR0EsSUFBSSxTQUFTbkMsSUFBVCxDQUFjOEIsSUFBZCxDQUFKLEVBQXlCO0FBQzFCLFdBQU9yQyxRQUFRLENBQUMyQyxNQUFoQjtBQUNILEdBakJpQyxDQWtCbEM7OztBQUNBLE1BQUksT0FBT3BDLElBQVAsQ0FBWThCLElBQVosQ0FBSixFQUF1QjtBQUNuQixXQUFPckMsUUFBUSxDQUFDNEMsSUFBaEI7QUFDSCxHQUZELE1BR0ssSUFBSSxTQUFTckMsSUFBVCxDQUFjOEIsSUFBZCxDQUFKLEVBQXlCO0FBQzFCLFdBQU9yQyxRQUFRLENBQUM0QyxJQUFoQjtBQUNILEdBRkksTUFHQSxJQUFJLE9BQU9yQyxJQUFQLENBQVk4QixJQUFaLENBQUosRUFBdUI7QUFDeEIsV0FBT3JDLFFBQVEsQ0FBQzZDLElBQWhCO0FBQ0gsR0FGSSxNQUdBO0FBQ0QsV0FBTzdDLFFBQVEsQ0FBQ1csT0FBaEI7QUFDSDtBQUNKLEMsQ0FDRDs7O0FBQ0EsU0FBU21DLFNBQVQsQ0FBbUJaLElBQW5CLEVBQXlCO0FBQ3JCLE1BQUksQ0FBQ0EsSUFBTCxFQUFXO0FBQ1BBLElBQUFBLElBQUksR0FBR2hDLFFBQVEsRUFBZjtBQUNIOztBQUNELFNBQU9nQyxJQUFJLENBQUNwQixJQUFMLEtBQWNmLE1BQU0sQ0FBQ1MsT0FBNUI7QUFDSDs7QUFDRGpCLE9BQU8sQ0FBQ3VELFNBQVIsR0FBb0JBLFNBQXBCOztBQUNBLFNBQVNDLEtBQVQsQ0FBZWIsSUFBZixFQUFxQjtBQUNqQixNQUFJLENBQUNBLElBQUwsRUFBVztBQUNQQSxJQUFBQSxJQUFJLEdBQUdoQyxRQUFRLEVBQWY7QUFDSDs7QUFDRCxTQUFPZ0MsSUFBSSxDQUFDcEIsSUFBTCxLQUFjZixNQUFNLENBQUNVLEdBQTVCO0FBQ0g7O0FBQ0RsQixPQUFPLENBQUN3RCxLQUFSLEdBQWdCQSxLQUFoQjs7QUFDQSxTQUFTQyxPQUFULENBQWlCZCxJQUFqQixFQUF1QjtBQUNuQixNQUFJLENBQUNBLElBQUwsRUFBVztBQUNQQSxJQUFBQSxJQUFJLEdBQUdoQyxRQUFRLEVBQWY7QUFDSDs7QUFDRCxTQUFPZ0MsSUFBSSxDQUFDcEIsSUFBTCxLQUFjZixNQUFNLENBQUNXLEtBQTVCO0FBQ0g7O0FBQ0RuQixPQUFPLENBQUN5RCxPQUFSLEdBQWtCQSxPQUFsQjs7QUFDQSxTQUFTQyxPQUFULENBQWlCZixJQUFqQixFQUF1QjtBQUNuQixNQUFJLENBQUNBLElBQUwsRUFBVztBQUNQQSxJQUFBQSxJQUFJLEdBQUdoQyxRQUFRLEVBQWY7QUFDSDs7QUFDRCxTQUFPZ0MsSUFBSSxDQUFDZixZQUFMLEtBQXNCckIsWUFBWSxDQUFDc0IsR0FBMUM7QUFDSDs7QUFDRDdCLE9BQU8sQ0FBQzBELE9BQVIsR0FBa0JBLE9BQWxCLEMsQ0FDQTs7QUFDQSxTQUFTM0IsYUFBVCxDQUF1QkMsS0FBdkIsRUFBOEJXLElBQUksR0FBRy9CLE9BQU8sRUFBNUMsRUFBZ0Q7QUFDNUMsTUFBSStCLElBQUksQ0FBQ3BCLElBQUwsS0FBY2YsTUFBTSxDQUFDWSxPQUF6QixFQUFrQztBQUM5QixXQUFPLEtBQVA7QUFDSDs7QUFDRFksRUFBQUEsS0FBSyxHQUFHQSxLQUFLLENBQUMyQixJQUFOLEVBQVI7O0FBQ0EsTUFBSTNCLEtBQUssS0FBSyxFQUFkLEVBQWtCO0FBQ2QsV0FBTyxJQUFQO0FBQ0g7O0FBQ0QsT0FBSyxJQUFJYyxJQUFULElBQWlCZCxLQUFLLENBQUM0QixLQUFOLENBQVksR0FBWixDQUFqQixFQUFtQztBQUMvQmQsSUFBQUEsSUFBSSxHQUFHQSxJQUFJLENBQUNhLElBQUwsRUFBUDs7QUFDQSxRQUFJRSxnQkFBZ0IsQ0FBQ2YsSUFBRCxFQUFPSCxJQUFQLENBQXBCLEVBQWtDO0FBQzlCLGFBQU8sSUFBUDtBQUNIO0FBQ0o7O0FBQ0QsU0FBTyxLQUFQO0FBQ0g7O0FBQ0QzQyxPQUFPLENBQUMrQixhQUFSLEdBQXdCQSxhQUF4Qjs7QUFDQSxTQUFTOEIsZ0JBQVQsQ0FBMEJmLElBQTFCLEVBQWdDSCxJQUFoQyxFQUFzQztBQUNsQyxNQUFJRyxJQUFJLEtBQUssRUFBVCxJQUFlQSxJQUFJLEtBQUssR0FBNUIsRUFBaUM7QUFDN0IsV0FBTyxLQUFQO0FBQ0g7O0FBQ0QsUUFBTWdCLE1BQU0sR0FBR2hCLElBQUksQ0FBQyxDQUFELENBQUosS0FBWSxHQUEzQjs7QUFDQSxNQUFJZ0IsTUFBSixFQUFZO0FBQ1JoQixJQUFBQSxJQUFJLEdBQUdBLElBQUksQ0FBQ2lCLE9BQUwsQ0FBYSxJQUFiLEVBQW1CLEVBQW5CLENBQVA7QUFDSDs7QUFDRCxRQUFNLENBQUN6QixNQUFELEVBQVNYLE1BQVQsSUFBbUJxQyxVQUFVLENBQUNsQixJQUFELENBQW5DOztBQUNBLE1BQUlSLE1BQU0sS0FBSzlCLE1BQU0sQ0FBQ1ksT0FBdEIsRUFBK0I7QUFDM0IsV0FBTyxLQUFQO0FBQ0g7O0FBQ0QsTUFBSTZDLE1BQU0sR0FBRyxLQUFiOztBQUNBLE1BQUkzQixNQUFNLEtBQUtLLElBQUksQ0FBQ3BCLElBQXBCLEVBQTBCO0FBQ3RCMEMsSUFBQUEsTUFBTSxHQUFHLElBQVQ7O0FBQ0EsUUFBSTNCLE1BQU0sS0FBSzlCLE1BQU0sQ0FBQ1csS0FBdEIsRUFBNkI7QUFDekIsVUFBSVEsTUFBTSxLQUFLbEIsUUFBUSxDQUFDVyxPQUF4QixFQUFpQztBQUM3QjZDLFFBQUFBLE1BQU0sR0FBR3RDLE1BQU0sS0FBS2dCLElBQUksQ0FBQ2hCLE1BQXpCO0FBQ0g7QUFDSjtBQUNKOztBQUNELFNBQU9tQyxNQUFNLEdBQUcsQ0FBQ0csTUFBSixHQUFhQSxNQUExQjtBQUNIOztBQUNELFNBQVNELFVBQVQsQ0FBb0JsQixJQUFwQixFQUEwQjtBQUN0QkEsRUFBQUEsSUFBSSxHQUFHQSxJQUFJLENBQUNDLFdBQUwsRUFBUDs7QUFDQSxNQUFJLE1BQU0vQixJQUFOLENBQVc4QixJQUFYLENBQUosRUFBc0I7QUFDbEIsV0FBTyxDQUFDdEMsTUFBTSxDQUFDUyxPQUFSLEVBQWlCUixRQUFRLENBQUNXLE9BQTFCLENBQVA7QUFDSCxHQUZELE1BR0ssSUFBSSxpQkFBaUJKLElBQWpCLENBQXNCOEIsSUFBdEIsQ0FBSixFQUFpQztBQUNsQyxXQUFPLENBQUN0QyxNQUFNLENBQUNVLEdBQVIsRUFBYVQsUUFBUSxDQUFDVyxPQUF0QixDQUFQO0FBQ0gsR0FGSSxNQUdBLElBQUksUUFBUUosSUFBUixDQUFhOEIsSUFBYixDQUFKLEVBQXdCO0FBQ3pCLFdBQU8sQ0FBQ3RDLE1BQU0sQ0FBQ1csS0FBUixFQUFlVixRQUFRLENBQUNXLE9BQXhCLENBQVA7QUFDSCxHQVZxQixDQVd0Qjs7O0FBQ0EsUUFBTU8sTUFBTSxHQUFHaUIsc0JBQXNCLENBQUNFLElBQUQsQ0FBckM7O0FBQ0EsTUFBSW5CLE1BQU0sS0FBS2xCLFFBQVEsQ0FBQ1csT0FBeEIsRUFBaUM7QUFDN0IsV0FBTyxDQUFDWixNQUFNLENBQUNXLEtBQVIsRUFBZVEsTUFBZixDQUFQO0FBQ0gsR0FGRCxNQUdLO0FBQ0QsV0FBTyxDQUFDbkIsTUFBTSxDQUFDWSxPQUFSLEVBQWlCWCxRQUFRLENBQUNXLE9BQTFCLENBQVA7QUFDSDtBQUNKIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXG4ndXNlIHN0cmljdCc7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBnZXRvcyA9IHJlcXVpcmUoXCJnZXRvc1wiKTtcbmNvbnN0IG9zID0gcmVxdWlyZShcIm9zXCIpO1xuY29uc3Qgc2VtdmVyID0gcmVxdWlyZShcInNlbXZlclwiKTtcbmNvbnN0IHZlcnNpb25fMSA9IHJlcXVpcmUoXCIuL3ZlcnNpb25cIik7XG52YXIgQXJjaGl0ZWN0dXJlO1xuKGZ1bmN0aW9uIChBcmNoaXRlY3R1cmUpIHtcbiAgICBBcmNoaXRlY3R1cmVbQXJjaGl0ZWN0dXJlW1wiVW5rbm93blwiXSA9IDFdID0gXCJVbmtub3duXCI7XG4gICAgQXJjaGl0ZWN0dXJlW0FyY2hpdGVjdHVyZVtcIng4NlwiXSA9IDJdID0gXCJ4ODZcIjtcbiAgICBBcmNoaXRlY3R1cmVbQXJjaGl0ZWN0dXJlW1wieDY0XCJdID0gM10gPSBcIng2NFwiO1xufSkoQXJjaGl0ZWN0dXJlID0gZXhwb3J0cy5BcmNoaXRlY3R1cmUgfHwgKGV4cG9ydHMuQXJjaGl0ZWN0dXJlID0ge30pKTtcbnZhciBPU1R5cGU7XG4oZnVuY3Rpb24gKE9TVHlwZSkge1xuICAgIE9TVHlwZVtPU1R5cGVbXCJVbmtub3duXCJdID0gMF0gPSBcIlVua25vd25cIjtcbiAgICBPU1R5cGVbT1NUeXBlW1wiV2luZG93c1wiXSA9IDFdID0gXCJXaW5kb3dzXCI7XG4gICAgT1NUeXBlW09TVHlwZVtcIk9TWFwiXSA9IDJdID0gXCJPU1hcIjtcbiAgICBPU1R5cGVbT1NUeXBlW1wiTGludXhcIl0gPSAzXSA9IFwiTGludXhcIjtcbn0pKE9TVHlwZSA9IGV4cG9ydHMuT1NUeXBlIHx8IChleHBvcnRzLk9TVHlwZSA9IHt9KSk7XG52YXIgT1NEaXN0cm87XG4oZnVuY3Rpb24gKE9TRGlzdHJvKSB7XG4gICAgT1NEaXN0cm9bT1NEaXN0cm9bXCJVbmtub3duXCJdID0gMF0gPSBcIlVua25vd25cIjtcbiAgICAvLyBsaW51eDpcbiAgICBPU0Rpc3Ryb1tPU0Rpc3Ryb1tcIlVidW50dVwiXSA9IDFdID0gXCJVYnVudHVcIjtcbiAgICBPU0Rpc3Ryb1tPU0Rpc3Ryb1tcIkRlYmlhblwiXSA9IDJdID0gXCJEZWJpYW5cIjtcbiAgICBPU0Rpc3Ryb1tPU0Rpc3Ryb1tcIlJIRUxcIl0gPSAzXSA9IFwiUkhFTFwiO1xuICAgIE9TRGlzdHJvW09TRGlzdHJvW1wiRmVkb3JhXCJdID0gNF0gPSBcIkZlZG9yYVwiO1xuICAgIE9TRGlzdHJvW09TRGlzdHJvW1wiQ2VudE9TXCJdID0gNV0gPSBcIkNlbnRPU1wiO1xuICAgIC8vIFRoZSByZW1haW5kZXIgYXJlbid0IG9mZmljaWFsbHkgc3VwcG9ydGVkLlxuICAgIC8vIFNlZTogaHR0cHM6Ly9jb2RlLnZpc3VhbHN0dWRpby5jb20vZG9jcy9zdXBwb3J0aW5nL3JlcXVpcmVtZW50c1xuICAgIE9TRGlzdHJvW09TRGlzdHJvW1wiU3VzZVwiXSA9IDZdID0gXCJTdXNlXCI7XG4gICAgT1NEaXN0cm9bT1NEaXN0cm9bXCJHZW50b29cIl0gPSA3XSA9IFwiR2VudG9vXCI7XG4gICAgT1NEaXN0cm9bT1NEaXN0cm9bXCJBcmNoXCJdID0gOF0gPSBcIkFyY2hcIjtcbn0pKE9TRGlzdHJvID0gZXhwb3J0cy5PU0Rpc3RybyB8fCAoZXhwb3J0cy5PU0Rpc3RybyA9IHt9KSk7XG5sZXQgbG9jYWw7XG5mdW5jdGlvbiBnZXRMb2NhbCgpIHtcbiAgICBpZiAoIWxvY2FsKSB7XG4gICAgICAgIGxvY2FsID0gZ2V0SW5mbygpO1xuICAgIH1cbiAgICByZXR1cm4gbG9jYWw7XG59XG5mdW5jdGlvbiBnZXRPU1R5cGUocGxhdGZvcm0gPSBwcm9jZXNzLnBsYXRmb3JtKSB7XG4gICAgaWYgKC9ed2luLy50ZXN0KHBsYXRmb3JtKSkge1xuICAgICAgICByZXR1cm4gT1NUeXBlLldpbmRvd3M7XG4gICAgfVxuICAgIGVsc2UgaWYgKC9eZGFyd2luLy50ZXN0KHBsYXRmb3JtKSkge1xuICAgICAgICByZXR1cm4gT1NUeXBlLk9TWDtcbiAgICB9XG4gICAgZWxzZSBpZiAoL15saW51eC8udGVzdChwbGF0Zm9ybSkpIHtcbiAgICAgICAgcmV0dXJuIE9TVHlwZS5MaW51eDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBPU1R5cGUuVW5rbm93bjtcbiAgICB9XG59XG5leHBvcnRzLmdldE9TVHlwZSA9IGdldE9TVHlwZTtcbmNsYXNzIEluZm8ge1xuICAgIGNvbnN0cnVjdG9yKHR5cGUsIGFyY2ggPSBvcy5hcmNoKCksIFxuICAgIC8vIFNlZTpcbiAgICAvLyAgaHR0cHM6Ly9naXRodWIuY29tL0RlZmluaXRlbHlUeXBlZC9EZWZpbml0ZWx5VHlwZWQvYmxvYi9tYXN0ZXIvdHlwZXMvc2VtdmVyL2luZGV4LmQudHMjTDE1MlxuICAgIHZlcnNpb24gPSBuZXcgc2VtdmVyLlNlbVZlcignMC4wLjAnKSwgZGlzdHJvID0gT1NEaXN0cm8uVW5rbm93bikge1xuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLmFyY2ggPSBhcmNoO1xuICAgICAgICB0aGlzLnZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICB0aGlzLmRpc3RybyA9IGRpc3RybztcbiAgICB9XG4gICAgZ2V0IGFyY2hpdGVjdHVyZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXJjaCA9PT0gJ3g2NCcgPyBBcmNoaXRlY3R1cmUueDY0IDogQXJjaGl0ZWN0dXJlLng4NjtcbiAgICB9XG4gICAgbWF0Y2hQbGF0Zm9ybShuYW1lcykge1xuICAgICAgICByZXR1cm4gbWF0Y2hQbGF0Zm9ybShuYW1lcywgdGhpcyk7XG4gICAgfVxufVxuZXhwb3J0cy5JbmZvID0gSW5mbztcbmZ1bmN0aW9uIGdldEluZm8oZ2V0QXJjaCA9IG9zLmFyY2gsIGdldFJlbGVhc2UgPSBvcy5yZWxlYXNlLCBnZXREaXN0cm8gPSBnZXRMaW51eERpc3RybywgcGxhdGZvcm0pIHtcbiAgICBjb25zdCBvc1R5cGUgPSBnZXRPU1R5cGUocGxhdGZvcm0pO1xuICAgIGNvbnN0IGFyY2ggPSBnZXRBcmNoKCk7XG4gICAgc3dpdGNoIChvc1R5cGUpIHtcbiAgICAgICAgY2FzZSBPU1R5cGUuV2luZG93czpcbiAgICAgICAgICAgIHJldHVybiBnZXREZWZhdWx0SW5mbyhvc1R5cGUsIGFyY2gsIGdldFJlbGVhc2UpO1xuICAgICAgICBjYXNlIE9TVHlwZS5PU1g6XG4gICAgICAgICAgICByZXR1cm4gZ2V0RGVmYXVsdEluZm8ob3NUeXBlLCBhcmNoLCBnZXRSZWxlYXNlKTtcbiAgICAgICAgY2FzZSBPU1R5cGUuTGludXg6XG4gICAgICAgICAgICByZXR1cm4gZ2V0TGludXhJbmZvKGFyY2gsIGdldERpc3Rybyk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gbmV3IEluZm8oT1NUeXBlLlVua25vd24sIGFyY2gpO1xuICAgIH1cbn1cbmV4cG9ydHMuZ2V0SW5mbyA9IGdldEluZm87XG5mdW5jdGlvbiBnZXREZWZhdWx0SW5mbyhvc1R5cGUsIGFyY2gsIGdldFJlbGVhc2UpIHtcbiAgICBjb25zdCB2ZXJzaW9uID0gdmVyc2lvbl8xLnBhcnNlVmVyc2lvbihnZXRSZWxlYXNlKCkpO1xuICAgIHJldHVybiBuZXcgSW5mbyhvc1R5cGUsIGFyY2gsIHZlcnNpb24pO1xufVxuZnVuY3Rpb24gZ2V0TGludXhJbmZvKGFyY2gsIGdldERpc3Rybykge1xuICAgIGNvbnN0IFtkaXN0cm8sIHZlcnNpb25dID0gZ2V0RGlzdHJvKCk7XG4gICAgcmV0dXJuIG5ldyBJbmZvKE9TVHlwZS5MaW51eCwgYXJjaCwgdmVyc2lvbiwgZGlzdHJvKTtcbn1cbmZ1bmN0aW9uIGdldExpbnV4RGlzdHJvKCkge1xuICAgIGxldCBkaXN0cm8gPSBPU0Rpc3Ryby5Vbmtub3duO1xuICAgIGxldCB2ZXJzaW9uID0gbmV3IHNlbXZlci5TZW1WZXIoJzAuMC4wJyk7XG4gICAgZ2V0b3MoKGV4YywgaW5mbykgPT4ge1xuICAgICAgICBpZiAoZXhjKSB7XG4gICAgICAgICAgICB0aHJvdyBleGM7XG4gICAgICAgIH1cbiAgICAgICAgZGlzdHJvID0gZ2V0TGludXhEaXN0cm9Gcm9tTmFtZShpbmZvLmRpc3QpO1xuICAgICAgICB2ZXJzaW9uID0gdmVyc2lvbl8xLnBhcnNlVmVyc2lvbihpbmZvLnJlbGVhc2UpO1xuICAgIH0pO1xuICAgIHJldHVybiBbZGlzdHJvLCB2ZXJzaW9uXTtcbn1cbmZ1bmN0aW9uIGdldExpbnV4RGlzdHJvRnJvbU5hbWUobmFtZSkge1xuICAgIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS96eWdhL29zLXJlbGVhc2Utem9vLlxuICAgIGlmICgvdWJ1bnR1Ly50ZXN0KG5hbWUpKSB7XG4gICAgICAgIHJldHVybiBPU0Rpc3Ryby5VYnVudHU7XG4gICAgfVxuICAgIGVsc2UgaWYgKC9kZWJpYW4vLnRlc3QobmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIE9TRGlzdHJvLkRlYmlhbjtcbiAgICB9XG4gICAgZWxzZSBpZiAoL3JoZWwvLnRlc3QobmFtZSkgfHwgL3JlZCBoYXQvLnRlc3QobmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIE9TRGlzdHJvLlJIRUw7XG4gICAgfVxuICAgIGVsc2UgaWYgKC9mZWRvcmEvLnRlc3QobmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIE9TRGlzdHJvLkZlZG9yYTtcbiAgICB9XG4gICAgZWxzZSBpZiAoL2NlbnRvcy8udGVzdChuYW1lKSkge1xuICAgICAgICByZXR1cm4gT1NEaXN0cm8uQ2VudE9TO1xuICAgIH1cbiAgICAvLyBUaGUgcmVtYWluZGVyIGFyZW4ndCBvZmZpY2lhbGx5IHN1cHBvcnRlZCBieSBWUyBDb2RlLlxuICAgIGlmICgvc3VzZS8udGVzdChuYW1lKSkge1xuICAgICAgICByZXR1cm4gT1NEaXN0cm8uU3VzZTtcbiAgICB9XG4gICAgZWxzZSBpZiAoL2dlbnRvby8udGVzdChuYW1lKSkge1xuICAgICAgICByZXR1cm4gT1NEaXN0cm8uU3VzZTtcbiAgICB9XG4gICAgZWxzZSBpZiAoL2FyY2gvLnRlc3QobmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIE9TRGlzdHJvLkFyY2g7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gT1NEaXN0cm8uVW5rbm93bjtcbiAgICB9XG59XG4vLyBoZWxwZXJzXG5mdW5jdGlvbiBpc1dpbmRvd3MoaW5mbykge1xuICAgIGlmICghaW5mbykge1xuICAgICAgICBpbmZvID0gZ2V0TG9jYWwoKTtcbiAgICB9XG4gICAgcmV0dXJuIGluZm8udHlwZSA9PT0gT1NUeXBlLldpbmRvd3M7XG59XG5leHBvcnRzLmlzV2luZG93cyA9IGlzV2luZG93cztcbmZ1bmN0aW9uIGlzTWFjKGluZm8pIHtcbiAgICBpZiAoIWluZm8pIHtcbiAgICAgICAgaW5mbyA9IGdldExvY2FsKCk7XG4gICAgfVxuICAgIHJldHVybiBpbmZvLnR5cGUgPT09IE9TVHlwZS5PU1g7XG59XG5leHBvcnRzLmlzTWFjID0gaXNNYWM7XG5mdW5jdGlvbiBpc0xpbnV4KGluZm8pIHtcbiAgICBpZiAoIWluZm8pIHtcbiAgICAgICAgaW5mbyA9IGdldExvY2FsKCk7XG4gICAgfVxuICAgIHJldHVybiBpbmZvLnR5cGUgPT09IE9TVHlwZS5MaW51eDtcbn1cbmV4cG9ydHMuaXNMaW51eCA9IGlzTGludXg7XG5mdW5jdGlvbiBpczY0Yml0KGluZm8pIHtcbiAgICBpZiAoIWluZm8pIHtcbiAgICAgICAgaW5mbyA9IGdldExvY2FsKCk7XG4gICAgfVxuICAgIHJldHVybiBpbmZvLmFyY2hpdGVjdHVyZSA9PT0gQXJjaGl0ZWN0dXJlLng2NDtcbn1cbmV4cG9ydHMuaXM2NGJpdCA9IGlzNjRiaXQ7XG4vLyBNYXRjaCB0aGUgcGxhdGZvcm0gc3RyaW5nIHRvIHRoZSBnaXZlbiBPUyBpbmZvLlxuZnVuY3Rpb24gbWF0Y2hQbGF0Zm9ybShuYW1lcywgaW5mbyA9IGdldEluZm8oKSkge1xuICAgIGlmIChpbmZvLnR5cGUgPT09IE9TVHlwZS5Vbmtub3duKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgbmFtZXMgPSBuYW1lcy50cmltKCk7XG4gICAgaWYgKG5hbWVzID09PSAnJykge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZm9yIChsZXQgbmFtZSBvZiBuYW1lcy5zcGxpdCgnfCcpKSB7XG4gICAgICAgIG5hbWUgPSBuYW1lLnRyaW0oKTtcbiAgICAgICAgaWYgKG1hdGNoT25lUGxhdGZvcm0obmFtZSwgaW5mbykpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbmV4cG9ydHMubWF0Y2hQbGF0Zm9ybSA9IG1hdGNoUGxhdGZvcm07XG5mdW5jdGlvbiBtYXRjaE9uZVBsYXRmb3JtKG5hbWUsIGluZm8pIHtcbiAgICBpZiAobmFtZSA9PT0gJycgfHwgbmFtZSA9PT0gJy0nKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgbmVnYXRlID0gbmFtZVswXSA9PT0gJy0nO1xuICAgIGlmIChuZWdhdGUpIHtcbiAgICAgICAgbmFtZSA9IG5hbWUucmVwbGFjZSgvXi0vLCAnJyk7XG4gICAgfVxuICAgIGNvbnN0IFtvc1R5cGUsIGRpc3Ryb10gPSBpZGVudGlmeU9TKG5hbWUpO1xuICAgIGlmIChvc1R5cGUgPT09IE9TVHlwZS5Vbmtub3duKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgbGV0IHJlc3VsdCA9IGZhbHNlO1xuICAgIGlmIChvc1R5cGUgPT09IGluZm8udHlwZSkge1xuICAgICAgICByZXN1bHQgPSB0cnVlO1xuICAgICAgICBpZiAob3NUeXBlID09PSBPU1R5cGUuTGludXgpIHtcbiAgICAgICAgICAgIGlmIChkaXN0cm8gIT09IE9TRGlzdHJvLlVua25vd24pIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBkaXN0cm8gPT09IGluZm8uZGlzdHJvO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZWdhdGUgPyAhcmVzdWx0IDogcmVzdWx0O1xufVxuZnVuY3Rpb24gaWRlbnRpZnlPUyhuYW1lKSB7XG4gICAgbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoL3dpbi8udGVzdChuYW1lKSkge1xuICAgICAgICByZXR1cm4gW09TVHlwZS5XaW5kb3dzLCBPU0Rpc3Ryby5Vbmtub3duXTtcbiAgICB9XG4gICAgZWxzZSBpZiAoL2RhcndpbnxtYWN8b3N4Ly50ZXN0KG5hbWUpKSB7XG4gICAgICAgIHJldHVybiBbT1NUeXBlLk9TWCwgT1NEaXN0cm8uVW5rbm93bl07XG4gICAgfVxuICAgIGVsc2UgaWYgKC9saW51eC8udGVzdChuYW1lKSkge1xuICAgICAgICByZXR1cm4gW09TVHlwZS5MaW51eCwgT1NEaXN0cm8uVW5rbm93bl07XG4gICAgfVxuICAgIC8vIFRyeSBsaW51eCBkaXN0cm9zLlxuICAgIGNvbnN0IGRpc3RybyA9IGdldExpbnV4RGlzdHJvRnJvbU5hbWUobmFtZSk7XG4gICAgaWYgKGRpc3RybyAhPT0gT1NEaXN0cm8uVW5rbm93bikge1xuICAgICAgICByZXR1cm4gW09TVHlwZS5MaW51eCwgZGlzdHJvXTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBbT1NUeXBlLlVua25vd24sIE9TRGlzdHJvLlVua25vd25dO1xuICAgIH1cbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBsYXRmb3JtLmpzLm1hcCJdfQ==
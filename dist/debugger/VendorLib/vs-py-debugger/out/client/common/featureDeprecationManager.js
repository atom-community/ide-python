"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __param = void 0 && (void 0).__param || function (paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
};

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

const types_1 = require("./application/types");

const browser_1 = require("./net/browser");

const types_2 = require("./types");

const deprecatedFeatures = [{
  doNotDisplayPromptStateKey: 'SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE',
  message: 'The setting \'python.formatting.formatOnSave\' is deprecated, please use \'editor.formatOnSave\'.',
  moreInfoUrl: 'https://github.com/Microsoft/vscode-python/issues/309',
  setting: {
    setting: 'formatting.formatOnSave',
    values: ['true', true]
  }
}, {
  doNotDisplayPromptStateKey: 'SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE',
  message: 'The setting \'python.linting.lintOnTextChange\' is deprecated, please enable \'python.linting.lintOnSave\' and \'files.autoSave\'.',
  moreInfoUrl: 'https://github.com/Microsoft/vscode-python/issues/313',
  setting: {
    setting: 'linting.lintOnTextChange',
    values: ['true', true]
  }
}, {
  doNotDisplayPromptStateKey: 'SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES',
  message: 'The setting \'python.autoComplete.preloadModules\' is deprecated, please consider using the new Language Server (\'python.jediEnabled = false\').',
  moreInfoUrl: 'https://github.com/Microsoft/vscode-python/issues/1704',
  setting: {
    setting: 'autoComplete.preloadModules'
  }
}];
let FeatureDeprecationManager = class FeatureDeprecationManager {
  constructor(persistentStateFactory, cmdMgr, workspace, appShell) {
    this.persistentStateFactory = persistentStateFactory;
    this.cmdMgr = cmdMgr;
    this.workspace = workspace;
    this.appShell = appShell;
    this.disposables = [];
  }

  dispose() {
    this.disposables.forEach(disposable => disposable.dispose());
  }

  initialize() {
    deprecatedFeatures.forEach(this.registerDeprecation.bind(this));
  }

  registerDeprecation(deprecatedInfo) {
    if (Array.isArray(deprecatedInfo.commands)) {
      deprecatedInfo.commands.forEach(cmd => {
        this.disposables.push(this.cmdMgr.registerCommand(cmd, () => this.notifyDeprecation(deprecatedInfo), this));
      });
    }

    if (deprecatedInfo.setting) {
      this.checkAndNotifyDeprecatedSetting(deprecatedInfo);
    }
  }

  notifyDeprecation(deprecatedInfo) {
    return __awaiter(this, void 0, void 0, function* () {
      const notificationPromptEnabled = this.persistentStateFactory.createGlobalPersistentState(deprecatedInfo.doNotDisplayPromptStateKey, true);

      if (!notificationPromptEnabled.value) {
        return;
      }

      const moreInfo = 'Learn more';
      const doNotShowAgain = 'Never show again';
      const option = yield this.appShell.showInformationMessage(deprecatedInfo.message, moreInfo, doNotShowAgain);

      if (!option) {
        return;
      }

      switch (option) {
        case moreInfo:
          {
            browser_1.launch(deprecatedInfo.moreInfoUrl);
            break;
          }

        case doNotShowAgain:
          {
            yield notificationPromptEnabled.updateValue(false);
            break;
          }

        default:
          {
            throw new Error('Selected option not supported.');
          }
      }

      return;
    });
  }

  checkAndNotifyDeprecatedSetting(deprecatedInfo) {
    let notify = false;

    if (Array.isArray(this.workspace.workspaceFolders) && this.workspace.workspaceFolders.length > 0) {
      this.workspace.workspaceFolders.forEach(workspaceFolder => {
        if (notify) {
          return;
        }

        notify = this.isDeprecatedSettingAndValueUsed(this.workspace.getConfiguration('python', workspaceFolder.uri), deprecatedInfo.setting);
      });
    } else {
      notify = this.isDeprecatedSettingAndValueUsed(this.workspace.getConfiguration('python'), deprecatedInfo.setting);
    }

    if (notify) {
      this.notifyDeprecation(deprecatedInfo).catch(ex => console.error('Python Extension: notifyDeprecation', ex));
    }
  }

  isDeprecatedSettingAndValueUsed(pythonConfig, deprecatedSetting) {
    if (!pythonConfig.has(deprecatedSetting.setting)) {
      return false;
    }

    const configValue = pythonConfig.get(deprecatedSetting.setting);

    if (!Array.isArray(deprecatedSetting.values) || deprecatedSetting.values.length === 0) {
      if (Array.isArray(configValue)) {
        return configValue.length > 0;
      }

      return true;
    }

    if (!Array.isArray(deprecatedSetting.values) || deprecatedSetting.values.length === 0) {
      if (configValue === undefined) {
        return false;
      }

      if (Array.isArray(configValue)) {
        // tslint:disable-next-line:no-any
        return configValue.length > 0;
      } // If we have a value in the setting, then return.


      return true;
    }

    return deprecatedSetting.values.indexOf(pythonConfig.get(deprecatedSetting.setting)) >= 0;
  }

};
FeatureDeprecationManager = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_2.IPersistentStateFactory)), __param(1, inversify_1.inject(types_1.ICommandManager)), __param(2, inversify_1.inject(types_1.IWorkspaceService)), __param(3, inversify_1.inject(types_1.IApplicationShell))], FeatureDeprecationManager);
exports.FeatureDeprecationManager = FeatureDeprecationManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZlYXR1cmVEZXByZWNhdGlvbk1hbmFnZXIuanMiXSwibmFtZXMiOlsiX19kZWNvcmF0ZSIsImRlY29yYXRvcnMiLCJ0YXJnZXQiLCJrZXkiLCJkZXNjIiwiYyIsImFyZ3VtZW50cyIsImxlbmd0aCIsInIiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJkIiwiUmVmbGVjdCIsImRlY29yYXRlIiwiaSIsImRlZmluZVByb3BlcnR5IiwiX19wYXJhbSIsInBhcmFtSW5kZXgiLCJkZWNvcmF0b3IiLCJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiZXhwb3J0cyIsImludmVyc2lmeV8xIiwicmVxdWlyZSIsInR5cGVzXzEiLCJicm93c2VyXzEiLCJ0eXBlc18yIiwiZGVwcmVjYXRlZEZlYXR1cmVzIiwiZG9Ob3REaXNwbGF5UHJvbXB0U3RhdGVLZXkiLCJtZXNzYWdlIiwibW9yZUluZm9VcmwiLCJzZXR0aW5nIiwidmFsdWVzIiwiRmVhdHVyZURlcHJlY2F0aW9uTWFuYWdlciIsImNvbnN0cnVjdG9yIiwicGVyc2lzdGVudFN0YXRlRmFjdG9yeSIsImNtZE1nciIsIndvcmtzcGFjZSIsImFwcFNoZWxsIiwiZGlzcG9zYWJsZXMiLCJkaXNwb3NlIiwiZm9yRWFjaCIsImRpc3Bvc2FibGUiLCJpbml0aWFsaXplIiwicmVnaXN0ZXJEZXByZWNhdGlvbiIsImJpbmQiLCJkZXByZWNhdGVkSW5mbyIsIkFycmF5IiwiaXNBcnJheSIsImNvbW1hbmRzIiwiY21kIiwicHVzaCIsInJlZ2lzdGVyQ29tbWFuZCIsIm5vdGlmeURlcHJlY2F0aW9uIiwiY2hlY2tBbmROb3RpZnlEZXByZWNhdGVkU2V0dGluZyIsIm5vdGlmaWNhdGlvblByb21wdEVuYWJsZWQiLCJjcmVhdGVHbG9iYWxQZXJzaXN0ZW50U3RhdGUiLCJtb3JlSW5mbyIsImRvTm90U2hvd0FnYWluIiwib3B0aW9uIiwic2hvd0luZm9ybWF0aW9uTWVzc2FnZSIsImxhdW5jaCIsInVwZGF0ZVZhbHVlIiwiRXJyb3IiLCJub3RpZnkiLCJ3b3Jrc3BhY2VGb2xkZXJzIiwid29ya3NwYWNlRm9sZGVyIiwiaXNEZXByZWNhdGVkU2V0dGluZ0FuZFZhbHVlVXNlZCIsImdldENvbmZpZ3VyYXRpb24iLCJ1cmkiLCJjYXRjaCIsImV4IiwiY29uc29sZSIsImVycm9yIiwicHl0aG9uQ29uZmlnIiwiZGVwcmVjYXRlZFNldHRpbmciLCJoYXMiLCJjb25maWdWYWx1ZSIsImdldCIsInVuZGVmaW5lZCIsImluZGV4T2YiLCJpbmplY3RhYmxlIiwiaW5qZWN0IiwiSVBlcnNpc3RlbnRTdGF0ZUZhY3RvcnkiLCJJQ29tbWFuZE1hbmFnZXIiLCJJV29ya3NwYWNlU2VydmljZSIsIklBcHBsaWNhdGlvblNoZWxsIl0sIm1hcHBpbmdzIjoiQUFBQSxhLENBQ0E7QUFDQTs7QUFDQSxJQUFJQSxVQUFVLEdBQUksVUFBUSxTQUFLQSxVQUFkLElBQTZCLFVBQVVDLFVBQVYsRUFBc0JDLE1BQXRCLEVBQThCQyxHQUE5QixFQUFtQ0MsSUFBbkMsRUFBeUM7QUFDbkYsTUFBSUMsQ0FBQyxHQUFHQyxTQUFTLENBQUNDLE1BQWxCO0FBQUEsTUFBMEJDLENBQUMsR0FBR0gsQ0FBQyxHQUFHLENBQUosR0FBUUgsTUFBUixHQUFpQkUsSUFBSSxLQUFLLElBQVQsR0FBZ0JBLElBQUksR0FBR0ssTUFBTSxDQUFDQyx3QkFBUCxDQUFnQ1IsTUFBaEMsRUFBd0NDLEdBQXhDLENBQXZCLEdBQXNFQyxJQUFySDtBQUFBLE1BQTJITyxDQUEzSDtBQUNBLE1BQUksT0FBT0MsT0FBUCxLQUFtQixRQUFuQixJQUErQixPQUFPQSxPQUFPLENBQUNDLFFBQWYsS0FBNEIsVUFBL0QsRUFBMkVMLENBQUMsR0FB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ekIsS0FBb0MsQ0FBcEYsRUFBdUY7QUFDbkYsVUFBSXNGLFdBQVcsS0FBS0UsU0FBcEIsRUFBK0I7QUFDM0IsZUFBTyxLQUFQO0FBQ0g7O0FBQ0QsVUFBSWhDLEtBQUssQ0FBQ0MsT0FBTixDQUFjNkIsV0FBZCxDQUFKLEVBQWdDO0FBQzVCO0FBQ0EsZUFBT0EsV0FBVyxDQUFDdEYsTUFBWixHQUFxQixDQUE1QjtBQUNILE9BUGtGLENBUW5GOzs7QUFDQSxhQUFPLElBQVA7QUFDSDs7QUFDRCxXQUFPb0YsaUJBQWlCLENBQUMzQyxNQUFsQixDQUF5QmdELE9BQXpCLENBQWlDTixZQUFZLENBQUNJLEdBQWIsQ0FBaUJILGlCQUFpQixDQUFDNUMsT0FBbkMsQ0FBakMsS0FBaUYsQ0FBeEY7QUFDSDs7QUE3RjJELENBQWhFO0FBK0ZBRSx5QkFBeUIsR0FBR2pELFVBQVUsQ0FBQyxDQUNuQ3NDLFdBQVcsQ0FBQzJELFVBQVosRUFEbUMsRUFFbkNqRixPQUFPLENBQUMsQ0FBRCxFQUFJc0IsV0FBVyxDQUFDNEQsTUFBWixDQUFtQnhELE9BQU8sQ0FBQ3lELHVCQUEzQixDQUFKLENBRjRCLEVBR25DbkYsT0FBTyxDQUFDLENBQUQsRUFBSXNCLFdBQVcsQ0FBQzRELE1BQVosQ0FBbUIxRCxPQUFPLENBQUM0RCxlQUEzQixDQUFKLENBSDRCLEVBSW5DcEYsT0FBTyxDQUFDLENBQUQsRUFBSXNCLFdBQVcsQ0FBQzRELE1BQVosQ0FBbUIxRCxPQUFPLENBQUM2RCxpQkFBM0IsQ0FBSixDQUo0QixFQUtuQ3JGLE9BQU8sQ0FBQyxDQUFELEVBQUlzQixXQUFXLENBQUM0RCxNQUFaLENBQW1CMUQsT0FBTyxDQUFDOEQsaUJBQTNCLENBQUosQ0FMNEIsQ0FBRCxFQU1uQ3JELHlCQU5tQyxDQUF0QztBQU9BWixPQUFPLENBQUNZLHlCQUFSLEdBQW9DQSx5QkFBcEMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XG59O1xudmFyIF9fcGFyYW0gPSAodGhpcyAmJiB0aGlzLl9fcGFyYW0pIHx8IGZ1bmN0aW9uIChwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IGludmVyc2lmeV8xID0gcmVxdWlyZShcImludmVyc2lmeVwiKTtcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi9hcHBsaWNhdGlvbi90eXBlc1wiKTtcbmNvbnN0IGJyb3dzZXJfMSA9IHJlcXVpcmUoXCIuL25ldC9icm93c2VyXCIpO1xuY29uc3QgdHlwZXNfMiA9IHJlcXVpcmUoXCIuL3R5cGVzXCIpO1xuY29uc3QgZGVwcmVjYXRlZEZlYXR1cmVzID0gW1xuICAgIHtcbiAgICAgICAgZG9Ob3REaXNwbGF5UHJvbXB0U3RhdGVLZXk6ICdTSE9XX0RFUFJFQ0FURURfRkVBVFVSRV9QUk9NUFRfRk9STUFUX09OX1NBVkUnLFxuICAgICAgICBtZXNzYWdlOiAnVGhlIHNldHRpbmcgXFwncHl0aG9uLmZvcm1hdHRpbmcuZm9ybWF0T25TYXZlXFwnIGlzIGRlcHJlY2F0ZWQsIHBsZWFzZSB1c2UgXFwnZWRpdG9yLmZvcm1hdE9uU2F2ZVxcJy4nLFxuICAgICAgICBtb3JlSW5mb1VybDogJ2h0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvdnNjb2RlLXB5dGhvbi9pc3N1ZXMvMzA5JyxcbiAgICAgICAgc2V0dGluZzogeyBzZXR0aW5nOiAnZm9ybWF0dGluZy5mb3JtYXRPblNhdmUnLCB2YWx1ZXM6IFsndHJ1ZScsIHRydWVdIH1cbiAgICB9LFxuICAgIHtcbiAgICAgICAgZG9Ob3REaXNwbGF5UHJvbXB0U3RhdGVLZXk6ICdTSE9XX0RFUFJFQ0FURURfRkVBVFVSRV9QUk9NUFRfTElOVF9PTl9URVhUX0NIQU5HRScsXG4gICAgICAgIG1lc3NhZ2U6ICdUaGUgc2V0dGluZyBcXCdweXRob24ubGludGluZy5saW50T25UZXh0Q2hhbmdlXFwnIGlzIGRlcHJlY2F0ZWQsIHBsZWFzZSBlbmFibGUgXFwncHl0aG9uLmxpbnRpbmcubGludE9uU2F2ZVxcJyBhbmQgXFwnZmlsZXMuYXV0b1NhdmVcXCcuJyxcbiAgICAgICAgbW9yZUluZm9Vcmw6ICdodHRwczovL2dpdGh1Yi5jb20vTWljcm9zb2Z0L3ZzY29kZS1weXRob24vaXNzdWVzLzMxMycsXG4gICAgICAgIHNldHRpbmc6IHsgc2V0dGluZzogJ2xpbnRpbmcubGludE9uVGV4dENoYW5nZScsIHZhbHVlczogWyd0cnVlJywgdHJ1ZV0gfVxuICAgIH0sXG4gICAge1xuICAgICAgICBkb05vdERpc3BsYXlQcm9tcHRTdGF0ZUtleTogJ1NIT1dfREVQUkVDQVRFRF9GRUFUVVJFX1BST01QVF9GT1JfQVVUT19DT01QTEVURV9QUkVMT0FEX01PRFVMRVMnLFxuICAgICAgICBtZXNzYWdlOiAnVGhlIHNldHRpbmcgXFwncHl0aG9uLmF1dG9Db21wbGV0ZS5wcmVsb2FkTW9kdWxlc1xcJyBpcyBkZXByZWNhdGVkLCBwbGVhc2UgY29uc2lkZXIgdXNpbmcgdGhlIG5ldyBMYW5ndWFnZSBTZXJ2ZXIgKFxcJ3B5dGhvbi5qZWRpRW5hYmxlZCA9IGZhbHNlXFwnKS4nLFxuICAgICAgICBtb3JlSW5mb1VybDogJ2h0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvdnNjb2RlLXB5dGhvbi9pc3N1ZXMvMTcwNCcsXG4gICAgICAgIHNldHRpbmc6IHsgc2V0dGluZzogJ2F1dG9Db21wbGV0ZS5wcmVsb2FkTW9kdWxlcycgfVxuICAgIH1cbl07XG5sZXQgRmVhdHVyZURlcHJlY2F0aW9uTWFuYWdlciA9IGNsYXNzIEZlYXR1cmVEZXByZWNhdGlvbk1hbmFnZXIge1xuICAgIGNvbnN0cnVjdG9yKHBlcnNpc3RlbnRTdGF0ZUZhY3RvcnksIGNtZE1nciwgd29ya3NwYWNlLCBhcHBTaGVsbCkge1xuICAgICAgICB0aGlzLnBlcnNpc3RlbnRTdGF0ZUZhY3RvcnkgPSBwZXJzaXN0ZW50U3RhdGVGYWN0b3J5O1xuICAgICAgICB0aGlzLmNtZE1nciA9IGNtZE1ncjtcbiAgICAgICAgdGhpcy53b3Jrc3BhY2UgPSB3b3Jrc3BhY2U7XG4gICAgICAgIHRoaXMuYXBwU2hlbGwgPSBhcHBTaGVsbDtcbiAgICAgICAgdGhpcy5kaXNwb3NhYmxlcyA9IFtdO1xuICAgIH1cbiAgICBkaXNwb3NlKCkge1xuICAgICAgICB0aGlzLmRpc3Bvc2FibGVzLmZvckVhY2goZGlzcG9zYWJsZSA9PiBkaXNwb3NhYmxlLmRpc3Bvc2UoKSk7XG4gICAgfVxuICAgIGluaXRpYWxpemUoKSB7XG4gICAgICAgIGRlcHJlY2F0ZWRGZWF0dXJlcy5mb3JFYWNoKHRoaXMucmVnaXN0ZXJEZXByZWNhdGlvbi5iaW5kKHRoaXMpKTtcbiAgICB9XG4gICAgcmVnaXN0ZXJEZXByZWNhdGlvbihkZXByZWNhdGVkSW5mbykge1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShkZXByZWNhdGVkSW5mby5jb21tYW5kcykpIHtcbiAgICAgICAgICAgIGRlcHJlY2F0ZWRJbmZvLmNvbW1hbmRzLmZvckVhY2goY21kID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc3Bvc2FibGVzLnB1c2godGhpcy5jbWRNZ3IucmVnaXN0ZXJDb21tYW5kKGNtZCwgKCkgPT4gdGhpcy5ub3RpZnlEZXByZWNhdGlvbihkZXByZWNhdGVkSW5mbyksIHRoaXMpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkZXByZWNhdGVkSW5mby5zZXR0aW5nKSB7XG4gICAgICAgICAgICB0aGlzLmNoZWNrQW5kTm90aWZ5RGVwcmVjYXRlZFNldHRpbmcoZGVwcmVjYXRlZEluZm8pO1xuICAgICAgICB9XG4gICAgfVxuICAgIG5vdGlmeURlcHJlY2F0aW9uKGRlcHJlY2F0ZWRJbmZvKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBub3RpZmljYXRpb25Qcm9tcHRFbmFibGVkID0gdGhpcy5wZXJzaXN0ZW50U3RhdGVGYWN0b3J5LmNyZWF0ZUdsb2JhbFBlcnNpc3RlbnRTdGF0ZShkZXByZWNhdGVkSW5mby5kb05vdERpc3BsYXlQcm9tcHRTdGF0ZUtleSwgdHJ1ZSk7XG4gICAgICAgICAgICBpZiAoIW5vdGlmaWNhdGlvblByb21wdEVuYWJsZWQudmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBtb3JlSW5mbyA9ICdMZWFybiBtb3JlJztcbiAgICAgICAgICAgIGNvbnN0IGRvTm90U2hvd0FnYWluID0gJ05ldmVyIHNob3cgYWdhaW4nO1xuICAgICAgICAgICAgY29uc3Qgb3B0aW9uID0geWllbGQgdGhpcy5hcHBTaGVsbC5zaG93SW5mb3JtYXRpb25NZXNzYWdlKGRlcHJlY2F0ZWRJbmZvLm1lc3NhZ2UsIG1vcmVJbmZvLCBkb05vdFNob3dBZ2Fpbik7XG4gICAgICAgICAgICBpZiAoIW9wdGlvbikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN3aXRjaCAob3B0aW9uKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBtb3JlSW5mbzoge1xuICAgICAgICAgICAgICAgICAgICBicm93c2VyXzEubGF1bmNoKGRlcHJlY2F0ZWRJbmZvLm1vcmVJbmZvVXJsKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhc2UgZG9Ob3RTaG93QWdhaW46IHtcbiAgICAgICAgICAgICAgICAgICAgeWllbGQgbm90aWZpY2F0aW9uUHJvbXB0RW5hYmxlZC51cGRhdGVWYWx1ZShmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU2VsZWN0ZWQgb3B0aW9uIG5vdCBzdXBwb3J0ZWQuJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY2hlY2tBbmROb3RpZnlEZXByZWNhdGVkU2V0dGluZyhkZXByZWNhdGVkSW5mbykge1xuICAgICAgICBsZXQgbm90aWZ5ID0gZmFsc2U7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMud29ya3NwYWNlLndvcmtzcGFjZUZvbGRlcnMpICYmIHRoaXMud29ya3NwYWNlLndvcmtzcGFjZUZvbGRlcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy53b3Jrc3BhY2Uud29ya3NwYWNlRm9sZGVycy5mb3JFYWNoKHdvcmtzcGFjZUZvbGRlciA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG5vdGlmeSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG5vdGlmeSA9IHRoaXMuaXNEZXByZWNhdGVkU2V0dGluZ0FuZFZhbHVlVXNlZCh0aGlzLndvcmtzcGFjZS5nZXRDb25maWd1cmF0aW9uKCdweXRob24nLCB3b3Jrc3BhY2VGb2xkZXIudXJpKSwgZGVwcmVjYXRlZEluZm8uc2V0dGluZyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG5vdGlmeSA9IHRoaXMuaXNEZXByZWNhdGVkU2V0dGluZ0FuZFZhbHVlVXNlZCh0aGlzLndvcmtzcGFjZS5nZXRDb25maWd1cmF0aW9uKCdweXRob24nKSwgZGVwcmVjYXRlZEluZm8uc2V0dGluZyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vdGlmeSkge1xuICAgICAgICAgICAgdGhpcy5ub3RpZnlEZXByZWNhdGlvbihkZXByZWNhdGVkSW5mbylcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXggPT4gY29uc29sZS5lcnJvcignUHl0aG9uIEV4dGVuc2lvbjogbm90aWZ5RGVwcmVjYXRpb24nLCBleCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlzRGVwcmVjYXRlZFNldHRpbmdBbmRWYWx1ZVVzZWQocHl0aG9uQ29uZmlnLCBkZXByZWNhdGVkU2V0dGluZykge1xuICAgICAgICBpZiAoIXB5dGhvbkNvbmZpZy5oYXMoZGVwcmVjYXRlZFNldHRpbmcuc2V0dGluZykpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb25maWdWYWx1ZSA9IHB5dGhvbkNvbmZpZy5nZXQoZGVwcmVjYXRlZFNldHRpbmcuc2V0dGluZyk7XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShkZXByZWNhdGVkU2V0dGluZy52YWx1ZXMpIHx8IGRlcHJlY2F0ZWRTZXR0aW5nLnZhbHVlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvbmZpZ1ZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb25maWdWYWx1ZS5sZW5ndGggPiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGRlcHJlY2F0ZWRTZXR0aW5nLnZhbHVlcykgfHwgZGVwcmVjYXRlZFNldHRpbmcudmFsdWVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgaWYgKGNvbmZpZ1ZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWdWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZ1ZhbHVlLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJZiB3ZSBoYXZlIGEgdmFsdWUgaW4gdGhlIHNldHRpbmcsIHRoZW4gcmV0dXJuLlxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlcHJlY2F0ZWRTZXR0aW5nLnZhbHVlcy5pbmRleE9mKHB5dGhvbkNvbmZpZy5nZXQoZGVwcmVjYXRlZFNldHRpbmcuc2V0dGluZykpID49IDA7XG4gICAgfVxufTtcbkZlYXR1cmVEZXByZWNhdGlvbk1hbmFnZXIgPSBfX2RlY29yYXRlKFtcbiAgICBpbnZlcnNpZnlfMS5pbmplY3RhYmxlKCksXG4gICAgX19wYXJhbSgwLCBpbnZlcnNpZnlfMS5pbmplY3QodHlwZXNfMi5JUGVyc2lzdGVudFN0YXRlRmFjdG9yeSkpLFxuICAgIF9fcGFyYW0oMSwgaW52ZXJzaWZ5XzEuaW5qZWN0KHR5cGVzXzEuSUNvbW1hbmRNYW5hZ2VyKSksXG4gICAgX19wYXJhbSgyLCBpbnZlcnNpZnlfMS5pbmplY3QodHlwZXNfMS5JV29ya3NwYWNlU2VydmljZSkpLFxuICAgIF9fcGFyYW0oMywgaW52ZXJzaWZ5XzEuaW5qZWN0KHR5cGVzXzEuSUFwcGxpY2F0aW9uU2hlbGwpKVxuXSwgRmVhdHVyZURlcHJlY2F0aW9uTWFuYWdlcik7XG5leHBvcnRzLkZlYXR1cmVEZXByZWNhdGlvbk1hbmFnZXIgPSBGZWF0dXJlRGVwcmVjYXRpb25NYW5hZ2VyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZmVhdHVyZURlcHJlY2F0aW9uTWFuYWdlci5qcy5tYXAiXX0=
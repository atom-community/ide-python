"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __param = void 0 && (void 0).__param || function (paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
};

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

const path = require("path");

const types_1 = require("../../../ioc/types");

require("../../extensions");

const types_2 = require("../types");

const baseActivationProvider_1 = require("./baseActivationProvider");

let CommandPromptAndPowerShell = class CommandPromptAndPowerShell extends baseActivationProvider_1.BaseActivationCommandProvider {
  constructor(serviceContainer) {
    super(serviceContainer);
  }

  isShellSupported(targetShell) {
    return targetShell === types_2.TerminalShellType.commandPrompt || targetShell === types_2.TerminalShellType.powershell || targetShell === types_2.TerminalShellType.powershellCore;
  }

  getActivationCommandsForInterpreter(pythonPath, targetShell) {
    return __awaiter(this, void 0, void 0, function* () {
      // Dependending on the target shell, look for the preferred script file.
      const scriptFile = yield this.findScriptFile(pythonPath, this.getScriptsInOrderOfPreference(targetShell));

      if (!scriptFile) {
        return;
      }

      if (targetShell === types_2.TerminalShellType.commandPrompt && scriptFile.endsWith('activate.bat')) {
        return [scriptFile.fileToCommandArgument()];
      } else if ((targetShell === types_2.TerminalShellType.powershell || targetShell === types_2.TerminalShellType.powershellCore) && scriptFile.endsWith('activate.ps1')) {
        return [`& ${scriptFile.fileToCommandArgument()}`];
      } else if (targetShell === types_2.TerminalShellType.commandPrompt && scriptFile.endsWith('activate.ps1')) {
        // lets not try to run the powershell file from command prompt (user may not have powershell)
        return [];
      } else {
        return;
      }
    });
  }

  getScriptsInOrderOfPreference(targetShell) {
    const batchFiles = ['activate.bat', path.join('Scripts', 'activate.bat'), path.join('scripts', 'activate.bat')];
    const powerShellFiles = ['activate.ps1', path.join('Scripts', 'activate.ps1'), path.join('scripts', 'activate.ps1')];

    if (targetShell === types_2.TerminalShellType.commandPrompt) {
      return batchFiles.concat(powerShellFiles);
    } else {
      return powerShellFiles.concat(batchFiles);
    }
  }

};
CommandPromptAndPowerShell = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_1.IServiceContainer))], CommandPromptAndPowerShell);
exports.CommandPromptAndPowerShell = CommandPromptAndPowerShell;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbW1hbmRQcm9tcHQuanMiXSwibmFtZXMiOlsiX19kZWNvcmF0ZSIsImRlY29yYXRvcnMiLCJ0YXJnZXQiLCJrZXkiLCJkZXNjIiwiYyIsImFyZ3VtZW50cyIsImxlbmd0aCIsInIiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJkIiwiUmVmbGVjdCIsImRlY29yYXRlIiwiaSIsImRlZmluZVByb3BlcnR5IiwiX19wYXJhbSIsInBhcmFtSW5kZXgiLCJkZWNvcmF0b3IiLCJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiZXhwb3J0cyIsImludmVyc2lmeV8xIiwicmVxdWlyZSIsInBhdGgiLCJ0eXBlc18xIiwidHlwZXNfMiIsImJhc2VBY3RpdmF0aW9uUHJvdmlkZXJfMSIsIkNvbW1hbmRQcm9tcHRBbmRQb3dlclNoZWxsIiwiQmFzZUFjdGl2YXRpb25Db21tYW5kUHJvdmlkZXIiLCJjb25zdHJ1Y3RvciIsInNlcnZpY2VDb250YWluZXIiLCJpc1NoZWxsU3VwcG9ydGVkIiwidGFyZ2V0U2hlbGwiLCJUZXJtaW5hbFNoZWxsVHlwZSIsImNvbW1hbmRQcm9tcHQiLCJwb3dlcnNoZWxsIiwicG93ZXJzaGVsbENvcmUiLCJnZXRBY3RpdmF0aW9uQ29tbWFuZHNGb3JJbnRlcnByZXRlciIsInB5dGhvblBhdGgiLCJzY3JpcHRGaWxlIiwiZmluZFNjcmlwdEZpbGUiLCJnZXRTY3JpcHRzSW5PcmRlck9mUHJlZmVyZW5jZSIsImVuZHNXaXRoIiwiZmlsZVRvQ29tbWFuZEFyZ3VtZW50IiwiYmF0Y2hGaWxlcyIsImpvaW4iLCJwb3dlclNoZWxsRmlsZXMiLCJjb25jYXQiLCJpbmplY3RhYmxlIiwiaW5q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QUEsNkJBQTZCLENBQUNULFdBQUQsRUFBYztBQUN2QyxVQUFNWSxVQUFVLEdBQUcsQ0FBQyxjQUFELEVBQWlCckIsSUFBSSxDQUFDc0IsSUFBTCxDQUFVLFNBQVYsRUFBcUIsY0FBckIsQ0FBakIsRUFBdUR0QixJQUFJLENBQUNzQixJQUFMLENBQVUsU0FBVixFQUFxQixjQUFyQixDQUF2RCxDQUFuQjtBQUNBLFVBQU1DLGVBQWUsR0FBRyxDQUFDLGNBQUQsRUFBaUJ2QixJQUFJLENBQUNzQixJQUFMLENBQVUsU0FBVixFQUFxQixjQUFyQixDQUFqQixFQUF1RHRCLElBQUksQ0FBQ3NCLElBQUwsQ0FBVSxTQUFWLEVBQXFCLGNBQXJCLENBQXZELENBQXhCOztBQUNBLFFBQUliLFdBQVcsS0FBS1AsT0FBTyxDQUFDUSxpQkFBUixDQUEwQkMsYUFBOUMsRUFBNkQ7QUFDekQsYUFBT1UsVUFBVSxDQUFDRyxNQUFYLENBQWtCRCxlQUFsQixDQUFQO0FBQ0gsS0FGRCxNQUdLO0FBQ0QsYUFBT0EsZUFBZSxDQUFDQyxNQUFoQixDQUF1QkgsVUFBdkIsQ0FBUDtBQUNIO0FBQ0o7O0FBeEM0SCxDQUFqSTtBQTBDQWpCLDBCQUEwQixHQUFHNUMsVUFBVSxDQUFDLENBQ3BDc0MsV0FBVyxDQUFDMkIsVUFBWixFQURvQyxFQUVwQ2pELE9BQU8sQ0FBQyxDQUFELEVBQUlzQixXQUFXLENBQUM0QixNQUFaLENBQW1CekIsT0FBTyxDQUFDMEIsaUJBQTNCLENBQUosQ0FGNkIsQ0FBRCxFQUdwQ3ZCLDBCQUhvQyxDQUF2QztBQUlBUCxPQUFPLENBQUNPLDBCQUFSLEdBQXFDQSwwQkFBckMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XG59O1xudmFyIF9fcGFyYW0gPSAodGhpcyAmJiB0aGlzLl9fcGFyYW0pIHx8IGZ1bmN0aW9uIChwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cbn07XG52YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IGludmVyc2lmeV8xID0gcmVxdWlyZShcImludmVyc2lmeVwiKTtcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi4vLi4vLi4vaW9jL3R5cGVzXCIpO1xucmVxdWlyZShcIi4uLy4uL2V4dGVuc2lvbnNcIik7XG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uL3R5cGVzXCIpO1xuY29uc3QgYmFzZUFjdGl2YXRpb25Qcm92aWRlcl8xID0gcmVxdWlyZShcIi4vYmFzZUFjdGl2YXRpb25Qcm92aWRlclwiKTtcbmxldCBDb21tYW5kUHJvbXB0QW5kUG93ZXJTaGVsbCA9IGNsYXNzIENvbW1hbmRQcm9tcHRBbmRQb3dlclNoZWxsIGV4dGVuZHMgYmFzZUFjdGl2YXRpb25Qcm92aWRlcl8xLkJhc2VBY3RpdmF0aW9uQ29tbWFuZFByb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihzZXJ2aWNlQ29udGFpbmVyKSB7XG4gICAgICAgIHN1cGVyKHNlcnZpY2VDb250YWluZXIpO1xuICAgIH1cbiAgICBpc1NoZWxsU3VwcG9ydGVkKHRhcmdldFNoZWxsKSB7XG4gICAgICAgIHJldHVybiB0YXJnZXRTaGVsbCA9PT0gdHlwZXNfMi5UZXJtaW5hbFNoZWxsVHlwZS5jb21tYW5kUHJvbXB0IHx8XG4gICAgICAgICAgICB0YXJnZXRTaGVsbCA9PT0gdHlwZXNfMi5UZXJtaW5hbFNoZWxsVHlwZS5wb3dlcnNoZWxsIHx8XG4gICAgICAgICAgICB0YXJnZXRTaGVsbCA9PT0gdHlwZXNfMi5UZXJtaW5hbFNoZWxsVHlwZS5wb3dlcnNoZWxsQ29yZTtcbiAgICB9XG4gICAgZ2V0QWN0aXZhdGlvbkNvbW1hbmRzRm9ySW50ZXJwcmV0ZXIocHl0aG9uUGF0aCwgdGFyZ2V0U2hlbGwpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIC8vIERlcGVuZGVuZGluZyBvbiB0aGUgdGFyZ2V0IHNoZWxsLCBsb29rIGZvciB0aGUgcHJlZmVycmVkIHNjcmlwdCBmaWxlLlxuICAgICAgICAgICAgY29uc3Qgc2NyaXB0RmlsZSA9IHlpZWxkIHRoaXMuZmluZFNjcmlwdEZpbGUocHl0aG9uUGF0aCwgdGhpcy5nZXRTY3JpcHRzSW5PcmRlck9mUHJlZmVyZW5jZSh0YXJnZXRTaGVsbCkpO1xuICAgICAgICAgICAgaWYgKCFzY3JpcHRGaWxlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRhcmdldFNoZWxsID09PSB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLmNvbW1hbmRQcm9tcHQgJiYgc2NyaXB0RmlsZS5lbmRzV2l0aCgnYWN0aXZhdGUuYmF0JykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gW3NjcmlwdEZpbGUuZmlsZVRvQ29tbWFuZEFyZ3VtZW50KCldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoKHRhcmdldFNoZWxsID09PSB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLnBvd2Vyc2hlbGwgfHwgdGFyZ2V0U2hlbGwgPT09IHR5cGVzXzIuVGVybWluYWxTaGVsbFR5cGUucG93ZXJzaGVsbENvcmUpICYmIHNjcmlwdEZpbGUuZW5kc1dpdGgoJ2FjdGl2YXRlLnBzMScpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtgJiAke3NjcmlwdEZpbGUuZmlsZVRvQ29tbWFuZEFyZ3VtZW50KCl9YF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0YXJnZXRTaGVsbCA9PT0gdHlwZXNfMi5UZXJtaW5hbFNoZWxsVHlwZS5jb21tYW5kUHJvbXB0ICYmIHNjcmlwdEZpbGUuZW5kc1dpdGgoJ2FjdGl2YXRlLnBzMScpKSB7XG4gICAgICAgICAgICAgICAgLy8gbGV0cyBub3QgdHJ5IHRvIHJ1biB0aGUgcG93ZXJzaGVsbCBmaWxlIGZyb20gY29tbWFuZCBwcm9tcHQgKHVzZXIgbWF5IG5vdCBoYXZlIHBvd2Vyc2hlbGwpXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0U2NyaXB0c0luT3JkZXJPZlByZWZlcmVuY2UodGFyZ2V0U2hlbGwpIHtcbiAgICAgICAgY29uc3QgYmF0Y2hGaWxlcyA9IFsnYWN0aXZhdGUuYmF0JywgcGF0aC5qb2luKCdTY3JpcHRzJywgJ2FjdGl2YXRlLmJhdCcpLCBwYXRoLmpvaW4oJ3NjcmlwdHMnLCAnYWN0aXZhdGUuYmF0JyldO1xuICAgICAgICBjb25zdCBwb3dlclNoZWxsRmlsZXMgPSBbJ2FjdGl2YXRlLnBzMScsIHBhdGguam9pbignU2NyaXB0cycsICdhY3RpdmF0ZS5wczEnKSwgcGF0aC5qb2luKCdzY3JpcHRzJywgJ2FjdGl2YXRlLnBzMScpXTtcbiAgICAgICAgaWYgKHRhcmdldFNoZWxsID09PSB0eXBlc18yLlRlcm1pbmFsU2hlbGxUeXBlLmNvbW1hbmRQcm9tcHQpIHtcbiAgICAgICAgICAgIHJldHVybiBiYXRjaEZpbGVzLmNvbmNhdChwb3dlclNoZWxsRmlsZXMpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHBvd2VyU2hlbGxGaWxlcy5jb25jYXQoYmF0Y2hGaWxlcyk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuQ29tbWFuZFByb21wdEFuZFBvd2VyU2hlbGwgPSBfX2RlY29yYXRlKFtcbiAgICBpbnZlcnNpZnlfMS5pbmplY3RhYmxlKCksXG4gICAgX19wYXJhbSgwLCBpbnZlcnNpZnlfMS5pbmplY3QodHlwZXNfMS5JU2VydmljZUNvbnRhaW5lcikpXG5dLCBDb21tYW5kUHJvbXB0QW5kUG93ZXJTaGVsbCk7XG5leHBvcnRzLkNvbW1hbmRQcm9tcHRBbmRQb3dlclNoZWxsID0gQ29tbWFuZFByb21wdEFuZFBvd2VyU2hlbGw7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb21tYW5kUHJvbXB0LmpzLm1hcCJdfQ==
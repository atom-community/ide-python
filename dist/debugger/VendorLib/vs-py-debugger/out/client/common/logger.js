"use strict"; // tslint:disable:no-console

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

Object.defineProperty(exports, "__esModule", {
  value: true
});
var Logger_1;

const inversify_1 = require("inversify");

const helpers_1 = require("./helpers");

const types_1 = require("./types");

const PREFIX = 'Python Extension: ';
let Logger = Logger_1 = class Logger {
  // tslint:disable-next-line:no-any
  static error(title = '', message) {
    new Logger_1().logError(`${title}, ${message}`);
  } // tslint:disable-next-line:no-any


  static warn(title = '', message = '') {
    new Logger_1().logWarning(`${title}, ${message}`);
  } // tslint:disable-next-line:no-any


  static verbose(title = '') {
    new Logger_1().logInformation(title);
  }

  logError(message, ex) {
    if (ex) {
      console.error(`${PREFIX}${message}`, ex);
    } else {
      console.error(`${PREFIX}${message}`);
    }
  }

  logWarning(message, ex) {
    if (ex) {
      console.warn(`${PREFIX}${message}`, ex);
    } else {
      console.warn(`${PREFIX}${message}`);
    }
  }

  logInformation(message, ex) {
    if (ex) {
      console.info(`${PREFIX}${message}`, ex);
    } else {
      console.info(`${PREFIX}${message}`);
    }
  }

};

__decorate([helpers_1.skipIfTest(false)], Logger.prototype, "logError", null);

__decorate([helpers_1.skipIfTest(false)], Logger.prototype, "logWarning", null);

__decorate([helpers_1.skipIfTest(false)], Logger.prototype, "logInformation", null);

Logger = Logger_1 = __decorate([inversify_1.injectable()], Logger);
exports.Logger = Logger;
var LogOptions;

(function (LogOptions) {
  LogOptions[LogOptions["None"] = 0] = "None";
  LogOptions[LogOptions["Arguments"] = 1] = "Arguments";
  LogOptions[LogOptions["ReturnValue"] = 2] = "ReturnValue";
})(LogOptions || (LogOptions = {})); // tslint:disable-next-line:no-any


function argsToLogString(args) {
  try {
    return (args || []).map((item, index) => {
      try {
        return `Arg ${index + 1}: ${JSON.stringify(item)}`;
      } catch (_a) {
        return `Arg ${index + 1}: UNABLE TO DETERMINE VALUE`;
      }
    }).join(', ');
  } catch (_a) {
    return '';
  }
} // tslint:disable-next-line:no-any


function returnValueToLogString(returnValue) {
  let returnValueMessage = 'Return Value: ';

  if (returnValue) {
    try {
      returnValueMessage += `${JSON.stringify(returnValue)}`;
    } catch (_a) {
      returnValueMessage += 'UNABLE TO DETERMINE VALUE';
    }
  }

  return returnValueMessage;
}

function traceVerbose(message) {
  return trace(message, LogOptions.Arguments | LogOptions.ReturnValue);
}

exports.traceVerbose = traceVerbose;

function traceError(message, ex) {
  return trace(message, LogOptions.Arguments | LogOptions.ReturnValue, types_1.LogLevel.Error);
}

exports.traceError = traceError;

function traceInfo(message) {
  return trace(message);
}

exports.traceInfo = traceInfo;

function trace(message, options = LogOptions.None, logLevel) {
  // tslint:disable-next-line:no-function-expression no-any
  return function (_, __, descriptor) {
    const originalMethod = descriptor.value; // tslint:disable-next-line:no-function-expression no-any

    descriptor.value = function (...args) {
      // tslint:disable-next-line:no-any
      function writeSuccess(returnValue) {
        if (logLevel === types_1.LogLevel.Error) {
          return;
        }

        writeToLog(returnValue);
      }

      function writeError(ex) {
        writeToLog(undefined, ex);
      } // tslint:disable-next-line:no-any


      function writeToLog(returnValue, ex) {
        const messagesToLog = [message];

        if ((options && LogOptions.Arguments) === LogOptions.Arguments) {
          messagesToLog.push(argsToLogString(args));
        }

        if ((options & LogOptions.ReturnValue) === LogOptions.ReturnValue) {
          messagesToLog.push(returnValueToLogString(returnValue));
        }

        if (ex) {
          new Logger().logError(messagesToLog.join(', '), ex);
        } else {
          new Logger().logInformation(messagesToLog.join(', '));
        }
      }

      try {
        // tslint:disable-next-line:no-invalid-this no-use-before-declare no-unsafe-any
        const result = originalMethod.apply(this, args); // If method being wrapped returns a promise then wait for it.
        // tslint:disable-next-line:no-unsafe-any

        if (result && typeof result.then === 'function' && typeof result.catch === 'function') {
          // tslint:disable-next-line:prefer-type-cast
          result.then(data => {
            writeSuccess(data);
            return data;
          }).catch(ex => {
            writeError(ex);
            return Promise.reject(ex);
          });
        } else {
          writeSuccess(result);
        }

        return result;
      } catch (ex) {
        writeError(ex);
        throw ex;
      }
    };

    return descriptor;
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxvZ2dlci5qcyJdLCJuYW1lcyI6WyJfX2RlY29yYXRlIiwiZGVjb3JhdG9ycyIsInRhcmdldCIsImtleSIsImRlc2MiLCJjIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImQiLCJSZWZsZWN0IiwiZGVjb3JhdGUiLCJpIiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJMb2dnZXJfMSIsImludmVyc2lmeV8xIiwicmVxdWlyZSIsImhlbHBlcnNfMSIsInR5cGVzXzEiLCJQUkVGSVgiLCJMb2dnZXIiLCJlcnJvciIsInRpdGxlIiwibWVzc2FnZSIsImxvZ0Vycm9yIiwid2FybiIsImxvZ1dhcm5pbmciLCJ2ZXJib3NlIiwibG9nSW5mb3JtYXRpb24iLCJleCIsImNvbnNvbGUiLCJpbmZvIiwic2tpcElmVGVzdCIsInByb3RvdHlwZSIsImluamVjdGFibGUiLCJMb2dPcHRpb25zIiwiYXJnc1RvTG9nU3RyaW5nIiwiYXJncyIsIm1hcCIsIml0ZW0iLCJpbmRleCIsIkpTT04iLCJzdHJpbmdpZnkiLCJfYSIsImpvaW4iLCJyZXR1cm5WYWx1ZVRvTG9nU3RyaW5nIiwicmV0dXJuVmFsdWUiLCJyZXR1cm5WYWx1ZU1lc3NhZ2UiLCJ0cmFjZVZlcmJvc2UiLCJ0cmFjZSIsIkFyZ3VtZW50cyIsIlJldHVyblZhbHVlIiwidHJhY2VFcnJvciIsIkxvZ0xldmVsIiwiRXJyb3IiLCJ0cmFjZUluZm8iLCJvcHRpb25zIiwiTm9uZSIsImxvZ0xldmVsIiwiXyIsIl9fIiwiZGVzY3JpcHRvciIsIm9yaWdpbmFsTWV0aG9kIiwid3JpdGVTdWNjZXNzIiwid3JpdGVUb0xvZyIsIndyaXRlRXJyb3IiLCJ1bmRlZmluZWQiLCJtZXNzYWdlc1RvTG9nIiwicHVzaCIsInJlc3VsdCIsImFwcGx5IiwidGhlbiIsImNhdGNoIiwiZGF0YSIsIlByb21pc2UiLCJyZWplY3QiXSwibWFwcGluZ3MiOiJBQUFBLGEsQ0FDQTs7QUFDQSxJQUFJQSxVQUFVLEdBQUksVUFBUSxTQUFLQSxVQUFkLElBQTZCLFVBQVVDLFVBQVYsRUFBc0JDLE1BQXRCLEVBQThCQyxHQUE5QixFQUFtQ0MsSUFBbkMsRUFBeUM7QUFDbkYsTUFBSUMsQ0FBQyxHQUFHQyxTQUFTLENBQUNDLE1BQWxCO0FBQUEsTUFBMEJDLENBQUMsR0FBR0gsQ0FBQyxHQUFHLENBQUosR0FBUUgsTUFBUixHQUFpQkUsSUFBSSxLQUFLLElBQVQsR0FBZ0JBLElBQUksR0FBR0ssTUFBTSxDQUFDQyx3QkFBUCxDQUFnQ1IsTUFBaEMsRUFBd0NDLEdBQXhDLENBQXZCLEdBQXNFQyxJQUFySDtBQUFBLE1BQTJITyxDQUEzSDtBQUNBLE1BQUksT0FBT0MsT0FBUCxLQUFtQixRQUFuQixJQUErQixPQUFPQSxPQUFPLENBQUNDLFFBQWYsS0FBNEIsVUFBL0QsRUFBMkVMLENBQUMsR0FBR0ksT0FBTyxDQUFDQyxRQUFSLENBQWlCWixVQUFqQixFQUE2QkMsTUFBN0IsRUFBcUNDLEdBQXJDLEVBQTBDQyxJQUExQyxDQUFKLENBQTNFLEtBQ0ssS0FBSyxJQUFJVSxDQUFDLEdBQUdiLFVBQVUsQ0FBQ00sTUFBWCxHQUFvQixDQUFqQyxFQUFvQ08sQ0FBQyxJQUFJLENBQXpDLEVBQTRDQSxDQUFDLEVBQTdDLEVBQWlELElBQUlILENBQUMsR0FBR1YsVUFBVSxDQUFDYSxDQUFELENBQWxCLEVBQXVCTixDQUFDLEdBQUcsQ0FBQ0gsQ0FBQyxHQUFHLENBQUosR0FBUU0sQ0FBQyxDQUFDSCxDQUFELENBQVQsR0FBZUgsQ0FBQyxHQUFHLENBQUosR0FBUU0sQ0FBQyxDQUFDVCxNQUFELEVBQVNDLEdBQVQsRUFBY0ssQ0FBZCxDQUFULEdBQTRCRyxDQUFDLENBQUNULE1BQUQsRUFBU0MsR0FBVCxDQUE3QyxLQUErREssQ0FBbkU7QUFDN0UsU0FBT0gsQ0FBQyxHQUFHLENBQUosSUFBU0csQ0FBVCxJQUFjQyxNQUFNLENBQUNNLGNBQVAsQ0FBc0JiLE1BQXRCLEVBQThCQyxHQUE5QixFQUFtQ0ssQ0FBbkMsQ0FBZCxFQUFxREEsQ0FBNUQ7QUFDSCxDQUxEOztBQU1BQyxNQUFNLENBQUNNLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQUVDLEVBQUFBLEtBQUssRUFBRTtBQUFULENBQTdDO0FBQ0EsSUFBSUMsUUFBSjs7QUFDQSxNQUFNQyxXQUFXLEdBQUdDLE9BQU8sQ0FBQyxXQUFELENBQTNCOztBQUNBLE1BQU1DLFNBQVMsR0FBR0QsT0FBTyxDQUFDLFdBQUQsQ0FBekI7O0FBQ0EsTUFBTUUsT0FBTyxHQUFHRixPQUFPLENBQUMsU0FBRCxDQUF2Qjs7QUFDQSxNQUFNRyxNQUFNLEdBQUcsb0JBQWY7QUFDQSxJQUFJQyxNQUFNLEdBQUdOLFFBQVEsR0FBRyxNQUFNTSxNQUFOLENBQWE7QUFDakM7QUFDWSxTQUFMQyxLQUFLLENBQUNDLEtBQUssR0FBRyxFQUFULEVBQWFDLE9BQWIsRUFBc0I7QUFDOUIsUUFBSVQsUUFBSixHQUFlVSxRQUFmLENBQXlCLEdBQUVGLEtBQU0sS0FBSUMsT0FBUSxFQUE3QztBQUNILEdBSmdDLENBS2pDOzs7QUFDVyxTQUFKRSxJQUFJLENBQUNILEtBQUssR0FBRyxFQUFULEVBQWFDLE9BQU8sR0FBRyxFQUF2QixFQUEyQjtBQUNsQyxRQUFJVCxRQUFKLEdBQWVZLFVBQWYsQ0FBMkIsR0FBRUosS0FBTSxLQUFJQyxPQUFRLEVBQS9DO0FBQ0gsR0FSZ0MsQ0FTakM7OztBQUNjLFNBQVBJLE9BQU8sQ0FBQ0wsS0FBSyxHQUFHLEVBQVQsRUFBYTtBQUN2QixRQUFJUixRQUFKLEdBQWVjLGNBQWYsQ0FBOEJOLEtBQTlCO0FBQ0g7O0FBQ0RFLEVBQUFBLFFBQVEsQ0FBQ0QsT0FBRCxFQUFVTSxFQUFWLEVBQWM7QUFDbEIsUUFBSUEsRUFBSixFQUFRO0FBQ0pDLE1BQUFBLE9BQU8sQ0FBQ1QsS0FBUixDQUFlLEdBQUVGLE1BQU8sR0FBRUksT0FBUSxFQUFsQyxFQUFxQ00sRUFBckM7QUFDSCxLQUZELE1BR0s7QUFDREMsTUFBQUEsT0FBTyxDQUFDVCxLQUFSLENBQWUsR0FBRUYsTUFBTyxHQUFFSSxPQUFRLEVBQWxDO0FBQ0g7QUFDSjs7QUFDREcsRUFBQUEsVUFBVSxDQUFDSCxPQUFELEVBQVVNLEVBQVYsRUFBYztBQUNwQixRQUFJQSxFQUFKLEVBQVE7QUFDSkMsTUFBQUEsT0FBTyxDQUFDTCxJQUFSLENBQWMsR0FBRU4sTUFBTyxHQUFFSSxPQUFRLEVBQWpDLEVBQW9DTSxFQUFwQztBQUNILEtBRkQsTUFHSztBQUNEQyxNQUFBQSxPQUFPLENBQUNMLElBQVIsQ0FBYyxHQUFFTixNQUFPLEdBQUVJLE9BQVEsRUFBakM7QUFDSDtBQUNKOztBQUNESyxFQUFBQSxjQUFjLENBQUNMLE9BQUQsRUFBVU0sRUFBVixFQUFjO0FBQ3hCLFFBQUlBLEVBQUosRUFBUTtBQUNKQyxNQUFBQSxPQUFPLENBQUNDLElBQVIsQ0FBYyxHQUFFWixNQUFPLEdBQUVJLE9BQVEsRUFBakMsRUFBb0NNLEVBQXBDO0FBQ0gsS0FGRCxNQUdLO0FBQ0RDLE1BQUFBLE9BQU8sQ0FBQ0MsSUFBUixDQUFjLEdBQUVaLE1BQU8sR0FBRUksT0FBUSxFQUFqQztBQUNIO0FBQ0o7O0FBcENnQyxDQUFyQzs7QUFzQ0EzQixVQUFVLENBQUMsQ0FDUHFCLFNBQVMsQ0FBQ2UsVUFBVixDQUFxQixLQUFyQixDQURPLENBQUQsRUFFUFosTUFBTSxDQUFDYSxTQUZBLEVBRVcsVUFGWCxFQUV1QixJQUZ2QixDQUFWOztBQUdBckMsVUFBVSxDQUFDLENBQ1BxQixTQUFTLENBQUNlLFVBQVYsQ0FBcUIsS0FBckIsQ0FETyxDQUFELEVBRVBaLE1BQU0sQ0FBQ2EsU0FGQSxFQUVXLFlBRlgsRUFFeUIsSUFGekIsQ0FBVjs7QUFHQXJDLFVBQVUsQ0FBQyxDQUNQcUIsU0FBUyxDQUFDZSxVQUFWLENBQXFCLEtBQXJCLENBRE8sQ0FBRCxFQUVQWixNQUFNLENBQUNhLFNBRkEsRUFFVyxnQkFGWCxFQUU2QixJQUY3QixDQUFWOztBQUdBYixNQUFNLEdBQUdOLFFBQVEsR0FBR2xCLFVBQVUsQ0FBQyxDQUMzQm1CLFdBQVcsQ0FBQ21CLFVBQVosRUFEMkIsQ0FBRCxFQUUzQmQsTUFGMkIsQ0FBOUI7QUFHQVIsT0FBTyxDQUFDUSxNQUFSLEdBQWlCQSxNQUFqQjtBQUNBLElBQUllLFVBQUo7O0FBQ0EsQ0FBQyxVQUFVQSxVQUFWLEVBQXNCO0FBQ25CQSxFQUFBQSxVQUFVLENBQUNBLFVBQVUsQ0FBQyxNQUFELENBQVYsR0FBcUIsQ0FBdEIsQ0FBVixHQUFxQyxNQUFyQztBQUNBQSxFQUFBQSxVQUFVLENBQUNBLFVBQVUsQ0FBQyxXQUFELENBQVYsR0FBMEIsQ0FBM0IsQ0FBVixHQUEwQyxXQUExQztBQUNBQSxFQUFBQSxVQUFVLENBQUNBLFVBQVUsQ0FBQyxhQUFELENBQVYsR0FBNEIsQ0FBN0IsQ0FBVixHQUE0QyxhQUE1QztBQUNILENBSkQsRUFJR0EsVUFBVSxLQUFLQSxVQUFVLEdBQUcsRUFBbEIsQ0FKYixFLENBS0E7OztBQUNBLFNBQVNDLGVBQVQsQ0FBeUJDLElBQXpCLEVBQStCO0FBQzNCLE1BQUk7QUFDQSxXQUFPLENBQUNBLElBQUksSUFBSSxFQUFULEVBQWFDLEdBQWIsQ0FBaUIsQ0FBQ0MsSUFBRCxFQUFPQyxLQUFQLEtBQWlCO0FBQ3JDLFVBQUk7QUFDQSxlQUFRLE9BQU1BLEtBQUssR0FBRyxDQUFFLEtBQUlDLElBQUksQ0FBQ0MsU0FBTCxDQUFlSCxJQUFmLENBQXFCLEVBQWpEO0FBQ0gsT0FGRCxDQUdBLE9BQU9JLEVBQVAsRUFBVztBQUNQLGVBQVEsT0FBTUgsS0FBSyxHQUFHLENBQUUsNkJBQXhCO0FBQ0g7QUFDSixLQVBNLEVBT0pJLElBUEksQ0FPQyxJQVBELENBQVA7QUFRSCxHQVRELENBVUEsT0FBT0QsRUFBUCxFQUFXO0FBQ1AsV0FBTyxFQUFQO0FBQ0g7QUFDSixDLENBQ0Q7OztBQUNBLFNBQVNFLHNCQUFULENBQWdDQyxXQUFoQyxFQUE2QztBQUN6QyxNQUFJQyxrQkFBa0IsR0FBRyxnQkFBekI7O0FBQ0EsTUFBSUQsV0FBSixFQUFpQjtBQUNiLFFBQUk7QUFDQUMsTUFBQUEsa0JBQWtCLElBQUssR0FBRU4sSUFBSSxDQUFDQyxTQUFMLENBQWVJLFdBQWYsQ0FBNEIsRUFBckQ7QUFDSCxLQUZELENBR0EsT0FBT0gsRUFBUCxFQUFXO0FBQ1BJLE1BQUFBLGtCQUFrQixJQUFJLDJCQUF0QjtBQUNIO0FBQ0o7O0FBQ0QsU0FBT0Esa0JBQVA7QUFDSDs7QUFDRCxTQUFTQyxZQUFULENBQXNCekIsT0FBdEIsRUFBK0I7QUFDM0IsU0FBTzBCLEtBQUssQ0FBQzFCLE9BQUQsRUFBVVksVUFBVSxDQUFDZSxTQUFYLEdBQXVCZixVQUFVLENBQUNnQixXQUE1QyxDQUFaO0FBQ0g7O0FBQ0R2QyxPQUFPLENBQUNvQyxZQUFSLEdBQXVCQSxZQUF2Qjs7QUFDQSxTQUFTSSxVQUFULENBQW9CN0IsT0FBcEIsRUFBNkJNLEVBQTdCLEVBQWlDO0FBQzdCLFNBQU9vQixLQUFLLENBQUMxQixPQUFELEVBQVVZLFVBQVUsQ0FBQ2UsU0FBWCxHQUF1QmYsVUFBVSxDQUFDZ0IsV0FBNUMsRUFBeURqQyxPQUFPLENBQUNtQyxRQUFSLENBQWlCQyxLQUExRSxDQUFaO0FBQ0g7O0FBQ0QxQyxPQUFPLENBQUN3QyxVQUFSLEdBQXFCQSxVQUFyQjs7QUFDQSxTQUFTRyxTQUFULENBQW1CaEMsT0FBbkIsRUFBNEI7QUFDeEIsU0FBTzBCLEtBQUssQ0FBQzFCLE9BQUQsQ0FBWjtBQUNIOztBQUNEWCxPQUFPLENBQUMyQyxTQUFSLEdBQW9CQSxTQUFwQjs7QUFDQSxTQUFTTixLQUFULENBQWUxQixPQUFmLEVBQXdCaUMsT0FBTyxHQUFHckIsVUFBVSxDQUFDc0IsSUFBN0MsRUFBbURDLFFBQW5ELEVBQTZEO0FBQ3pEO0FBQ0EsU0FBTyxVQUFVQyxDQUFWLEVBQWFDLEVBQWIsRUFBaUJDLFVBQWpCLEVBQTZCO0FBQ2hDLFVBQU1DLGNBQWMsR0FBR0QsVUFBVSxDQUFDaEQsS0FBbEMsQ0FEZ0MsQ0FFaEM7O0FBQ0FnRCxJQUFBQSxVQUFVLENBQUNoRCxLQUFYLEdBQW1CLFVBQVUsR0FBR3dCLElBQWIsRUFBbUI7QUFDbEM7QUFDQSxlQUFTMEIsWUFBVCxDQUFzQmpCLFdBQXRCLEVBQW1DO0FBQy9CLFlBQUlZLFFBQVEsS0FBS3hDLE9BQU8sQ0FBQ21DLFFBQVIsQ0FBaUJDLEtBQWxDLEVBQXlDO0FBQ3JDO0FBQ0g7O0FBQ0RVLFFBQUFBLFVBQVUsQ0FBQ2xCLFdBQUQsQ0FBVjtBQUNIOztBQUNELGVBQVNtQixVQUFULENBQW9CcEMsRUFBcEIsRUFBd0I7QUFDcEJtQyxRQUFBQSxVQUFVLENBQUNFLFNBQUQsRUFBWXJDLEVBQVosQ0FBVjtBQUNILE9BVmlDLENBV2xDOzs7QUFDQSxlQUFTbUMsVUFBVCxDQUFvQmxCLFdBQXBCLEVBQWlDakIsRUFBakMsRUFBcUM7QUFDakMsY0FBTXNDLGFBQWEsR0FBRyxDQUFDNUMsT0FBRCxDQUF0Qjs7QUFDQSxZQUFJLENBQUNpQyxPQUFPLElBQUlyQixVQUFVLENBQUNlLFNBQXZCLE1BQXNDZixVQUFVLENBQUNlLFNBQXJELEVBQWdFO0FBQzVEaUIsVUFBQUEsYUFBYSxDQUFDQyxJQUFkLENBQW1CaEMsZUFBZSxDQUFDQyxJQUFELENBQWxDO0FBQ0g7O0FBQ0QsWUFBSSxDQUFDbUIsT0FBTyxHQUFHckIsVUFBVSxDQUFDZ0IsV0FBdEIsTUFBdUNoQixVQUFVLENBQUNnQixXQUF0RCxFQUFtRTtBQUMvRGdCLFVBQUFBLGFBQWEsQ0FBQ0MsSUFBZCxDQUFtQnZCLHNCQUFzQixDQUFDQyxXQUFELENBQXpDO0FBQ0g7O0FBQ0QsWUFBSWpCLEVBQUosRUFBUTtBQUNKLGNBQUlULE1BQUosR0FBYUksUUFBYixDQUFzQjJDLGFBQWEsQ0FBQ3ZCLElBQWQsQ0FBbUIsSUFBbkIsQ0FBdEIsRUFBZ0RmLEVBQWhEO0FBQ0gsU0FGRCxNQUdLO0FBQ0QsY0FBSVQsTUFBSixHQUFhUSxjQUFiLENBQTRCdUMsYUFBYSxDQUFDdkIsSUFBZCxDQUFtQixJQUFuQixDQUE1QjtBQUNIO0FBQ0o7O0FBQ0QsVUFBSTtBQUNBO0FBQ0EsY0FBTXlCLE1BQU0sR0FBR1AsY0FBYyxDQUFDUSxLQUFmLENBQXFCLElBQXJCLEVBQTJCakMsSUFBM0IsQ0FBZixDQUZBLENBR0E7QUFDQTs7QUFDQSxZQUFJZ0MsTUFBTSxJQUFJLE9BQU9BLE1BQU0sQ0FBQ0UsSUFBZCxLQUF1QixVQUFqQyxJQUErQyxPQUFPRixNQUFNLENBQUNHLEtBQWQsS0FBd0IsVUFBM0UsRUFBdUY7QUFDbkY7QUFDQUgsVUFBQUEsTUFBTSxDQUNERSxJQURMLENBQ1VFLElBQUksSUFBSTtBQUNkVixZQUFBQSxZQUFZLENBQUNVLElBQUQsQ0FBWjtBQUNBLG1CQUFPQSxJQUFQO0FBQ0gsV0FKRCxFQUtLRCxLQUxMLENBS1czQyxFQUFFLElBQUk7QUFDYm9DLFlBQUFBLFVBQVUsQ0FBQ3BDLEVBQUQsQ0FBVjtBQUNBLG1CQUFPNkMsT0FBTyxDQUFDQyxNQUFSLENBQWU5QyxFQUFmLENBQVA7QUFDSCxXQVJEO0FBU0gsU0FYRCxNQVlLO0FBQ0RrQyxVQUFBQSxZQUFZLENBQUNNLE1BQUQsQ0FBWjtBQUNIOztBQUNELGVBQU9BLE1BQVA7QUFDSCxPQXJCRCxDQXNCQSxPQUFPeEMsRUFBUCxFQUFXO0FBQ1BvQyxRQUFBQSxVQUFVLENBQUNwQyxFQUFELENBQVY7QUFDQSxjQUFNQSxFQUFOO0FBQ0g7QUFDSixLQXJERDs7QUFzREEsV0FBT2dDLFVBQVA7QUFDSCxHQTFERDtBQTJESCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuLy8gdHNsaW50OmRpc2FibGU6bm8tY29uc29sZVxudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIExvZ2dlcl8xO1xuY29uc3QgaW52ZXJzaWZ5XzEgPSByZXF1aXJlKFwiaW52ZXJzaWZ5XCIpO1xuY29uc3QgaGVscGVyc18xID0gcmVxdWlyZShcIi4vaGVscGVyc1wiKTtcbmNvbnN0IHR5cGVzXzEgPSByZXF1aXJlKFwiLi90eXBlc1wiKTtcbmNvbnN0IFBSRUZJWCA9ICdQeXRob24gRXh0ZW5zaW9uOiAnO1xubGV0IExvZ2dlciA9IExvZ2dlcl8xID0gY2xhc3MgTG9nZ2VyIHtcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55XG4gICAgc3RhdGljIGVycm9yKHRpdGxlID0gJycsIG1lc3NhZ2UpIHtcbiAgICAgICAgbmV3IExvZ2dlcl8xKCkubG9nRXJyb3IoYCR7dGl0bGV9LCAke21lc3NhZ2V9YCk7XG4gICAgfVxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcbiAgICBzdGF0aWMgd2Fybih0aXRsZSA9ICcnLCBtZXNzYWdlID0gJycpIHtcbiAgICAgICAgbmV3IExvZ2dlcl8xKCkubG9nV2FybmluZyhgJHt0aXRsZX0sICR7bWVzc2FnZX1gKTtcbiAgICB9XG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWFueVxuICAgIHN0YXRpYyB2ZXJib3NlKHRpdGxlID0gJycpIHtcbiAgICAgICAgbmV3IExvZ2dlcl8xKCkubG9nSW5mb3JtYXRpb24odGl0bGUpO1xuICAgIH1cbiAgICBsb2dFcnJvcihtZXNzYWdlLCBleCkge1xuICAgICAgICBpZiAoZXgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYCR7UFJFRklYfSR7bWVzc2FnZX1gLCBleCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGAke1BSRUZJWH0ke21lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbG9nV2FybmluZyhtZXNzYWdlLCBleCkge1xuICAgICAgICBpZiAoZXgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgJHtQUkVGSVh9JHttZXNzYWdlfWAsIGV4KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgJHtQUkVGSVh9JHttZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgfVxuICAgIGxvZ0luZm9ybWF0aW9uKG1lc3NhZ2UsIGV4KSB7XG4gICAgICAgIGlmIChleCkge1xuICAgICAgICAgICAgY29uc29sZS5pbmZvKGAke1BSRUZJWH0ke21lc3NhZ2V9YCwgZXgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5pbmZvKGAke1BSRUZJWH0ke21lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuX19kZWNvcmF0ZShbXG4gICAgaGVscGVyc18xLnNraXBJZlRlc3QoZmFsc2UpXG5dLCBMb2dnZXIucHJvdG90eXBlLCBcImxvZ0Vycm9yXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgaGVscGVyc18xLnNraXBJZlRlc3QoZmFsc2UpXG5dLCBMb2dnZXIucHJvdG90eXBlLCBcImxvZ1dhcm5pbmdcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBoZWxwZXJzXzEuc2tpcElmVGVzdChmYWxzZSlcbl0sIExvZ2dlci5wcm90b3R5cGUsIFwibG9nSW5mb3JtYXRpb25cIiwgbnVsbCk7XG5Mb2dnZXIgPSBMb2dnZXJfMSA9IF9fZGVjb3JhdGUoW1xuICAgIGludmVyc2lmeV8xLmluamVjdGFibGUoKVxuXSwgTG9nZ2VyKTtcbmV4cG9ydHMuTG9nZ2VyID0gTG9nZ2VyO1xudmFyIExvZ09wdGlvbnM7XG4oZnVuY3Rpb24gKExvZ09wdGlvbnMpIHtcbiAgICBMb2dPcHRpb25zW0xvZ09wdGlvbnNbXCJOb25lXCJdID0gMF0gPSBcIk5vbmVcIjtcbiAgICBMb2dPcHRpb25zW0xvZ09wdGlvbnNbXCJBcmd1bWVudHNcIl0gPSAxXSA9IFwiQXJndW1lbnRzXCI7XG4gICAgTG9nT3B0aW9uc1tMb2dPcHRpb25zW1wiUmV0dXJuVmFsdWVcIl0gPSAyXSA9IFwiUmV0dXJuVmFsdWVcIjtcbn0pKExvZ09wdGlvbnMgfHwgKExvZ09wdGlvbnMgPSB7fSkpO1xuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWFueVxuZnVuY3Rpb24gYXJnc1RvTG9nU3RyaW5nKGFyZ3MpIHtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gKGFyZ3MgfHwgW10pLm1hcCgoaXRlbSwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGBBcmcgJHtpbmRleCArIDF9OiAke0pTT04uc3RyaW5naWZ5KGl0ZW0pfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoX2EpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYEFyZyAke2luZGV4ICsgMX06IFVOQUJMRSBUTyBERVRFUk1JTkUgVkFMVUVgO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KS5qb2luKCcsICcpO1xuICAgIH1cbiAgICBjYXRjaCAoX2EpIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH1cbn1cbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcbmZ1bmN0aW9uIHJldHVyblZhbHVlVG9Mb2dTdHJpbmcocmV0dXJuVmFsdWUpIHtcbiAgICBsZXQgcmV0dXJuVmFsdWVNZXNzYWdlID0gJ1JldHVybiBWYWx1ZTogJztcbiAgICBpZiAocmV0dXJuVmFsdWUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVyblZhbHVlTWVzc2FnZSArPSBgJHtKU09OLnN0cmluZ2lmeShyZXR1cm5WYWx1ZSl9YDtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoX2EpIHtcbiAgICAgICAgICAgIHJldHVyblZhbHVlTWVzc2FnZSArPSAnVU5BQkxFIFRPIERFVEVSTUlORSBWQUxVRSc7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJldHVyblZhbHVlTWVzc2FnZTtcbn1cbmZ1bmN0aW9uIHRyYWNlVmVyYm9zZShtZXNzYWdlKSB7XG4gICAgcmV0dXJuIHRyYWNlKG1lc3NhZ2UsIExvZ09wdGlvbnMuQXJndW1lbnRzIHwgTG9nT3B0aW9ucy5SZXR1cm5WYWx1ZSk7XG59XG5leHBvcnRzLnRyYWNlVmVyYm9zZSA9IHRyYWNlVmVyYm9zZTtcbmZ1bmN0aW9uIHRyYWNlRXJyb3IobWVzc2FnZSwgZXgpIHtcbiAgICByZXR1cm4gdHJhY2UobWVzc2FnZSwgTG9nT3B0aW9ucy5Bcmd1bWVudHMgfCBMb2dPcHRpb25zLlJldHVyblZhbHVlLCB0eXBlc18xLkxvZ0xldmVsLkVycm9yKTtcbn1cbmV4cG9ydHMudHJhY2VFcnJvciA9IHRyYWNlRXJyb3I7XG5mdW5jdGlvbiB0cmFjZUluZm8obWVzc2FnZSkge1xuICAgIHJldHVybiB0cmFjZShtZXNzYWdlKTtcbn1cbmV4cG9ydHMudHJhY2VJbmZvID0gdHJhY2VJbmZvO1xuZnVuY3Rpb24gdHJhY2UobWVzc2FnZSwgb3B0aW9ucyA9IExvZ09wdGlvbnMuTm9uZSwgbG9nTGV2ZWwpIHtcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tZnVuY3Rpb24tZXhwcmVzc2lvbiBuby1hbnlcbiAgICByZXR1cm4gZnVuY3Rpb24gKF8sIF9fLCBkZXNjcmlwdG9yKSB7XG4gICAgICAgIGNvbnN0IG9yaWdpbmFsTWV0aG9kID0gZGVzY3JpcHRvci52YWx1ZTtcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWZ1bmN0aW9uLWV4cHJlc3Npb24gbm8tYW55XG4gICAgICAgIGRlc2NyaXB0b3IudmFsdWUgPSBmdW5jdGlvbiAoLi4uYXJncykge1xuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWFueVxuICAgICAgICAgICAgZnVuY3Rpb24gd3JpdGVTdWNjZXNzKHJldHVyblZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGxvZ0xldmVsID09PSB0eXBlc18xLkxvZ0xldmVsLkVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgd3JpdGVUb0xvZyhyZXR1cm5WYWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmdW5jdGlvbiB3cml0ZUVycm9yKGV4KSB7XG4gICAgICAgICAgICAgICAgd3JpdGVUb0xvZyh1bmRlZmluZWQsIGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcbiAgICAgICAgICAgIGZ1bmN0aW9uIHdyaXRlVG9Mb2cocmV0dXJuVmFsdWUsIGV4KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZXNUb0xvZyA9IFttZXNzYWdlXTtcbiAgICAgICAgICAgICAgICBpZiAoKG9wdGlvbnMgJiYgTG9nT3B0aW9ucy5Bcmd1bWVudHMpID09PSBMb2dPcHRpb25zLkFyZ3VtZW50cykge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlc1RvTG9nLnB1c2goYXJnc1RvTG9nU3RyaW5nKGFyZ3MpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKChvcHRpb25zICYgTG9nT3B0aW9ucy5SZXR1cm5WYWx1ZSkgPT09IExvZ09wdGlvbnMuUmV0dXJuVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZXNUb0xvZy5wdXNoKHJldHVyblZhbHVlVG9Mb2dTdHJpbmcocmV0dXJuVmFsdWUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIG5ldyBMb2dnZXIoKS5sb2dFcnJvcihtZXNzYWdlc1RvTG9nLmpvaW4oJywgJyksIGV4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG5ldyBMb2dnZXIoKS5sb2dJbmZvcm1hdGlvbihtZXNzYWdlc1RvTG9nLmpvaW4oJywgJykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWludmFsaWQtdGhpcyBuby11c2UtYmVmb3JlLWRlY2xhcmUgbm8tdW5zYWZlLWFueVxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IG9yaWdpbmFsTWV0aG9kLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgICAgICAgICAgIC8vIElmIG1ldGhvZCBiZWluZyB3cmFwcGVkIHJldHVybnMgYSBwcm9taXNlIHRoZW4gd2FpdCBmb3IgaXQuXG4gICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXVuc2FmZS1hbnlcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICYmIHR5cGVvZiByZXN1bHQudGhlbiA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgcmVzdWx0LmNhdGNoID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpwcmVmZXItdHlwZS1jYXN0XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZVN1Y2Nlc3MoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChleCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZUVycm9yKGV4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChleCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVTdWNjZXNzKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXgpIHtcbiAgICAgICAgICAgICAgICB3cml0ZUVycm9yKGV4KTtcbiAgICAgICAgICAgICAgICB0aHJvdyBleDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRlc2NyaXB0b3I7XG4gICAgfTtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWxvZ2dlci5qcy5tYXAiXX0=
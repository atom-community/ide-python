// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __param = void 0 && (void 0).__param || function (paramIndex, decorator) {
  return function (target, key) {
    decorator(target, key, paramIndex);
  };
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:max-classes-per-file

const inversify_1 = require("inversify");

const path = require("path");

const types_1 = require("../../formatters/types");

const types_2 = require("../../ioc/types");

const types_3 = require("../../linters/types");

const types_4 = require("../../unittests/common/types");

const types_5 = require("../types");

let BaseProductPathsService = class BaseProductPathsService {
  constructor(serviceContainer) {
    this.serviceContainer = serviceContainer;
    this.configService = serviceContainer.get(types_5.IConfigurationService);
    this.productInstaller = serviceContainer.get(types_5.IInstaller);
  }

  isExecutableAModule(product, resource) {
    let moduleName;

    try {
      moduleName = this.productInstaller.translateProductToModuleName(product, types_5.ModuleNamePurpose.run); // tslint:disable-next-line:no-empty
    } catch (_a) {} // User may have customized the module name or provided the fully qualifieid path.


    const executableName = this.getExecutableNameFromSettings(product, resource);
    return typeof moduleName === 'string' && moduleName.length > 0 && path.basename(executableName) === executableName;
  }

};
BaseProductPathsService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_2.IServiceContainer))], BaseProductPathsService);
let CTagsProductPathService = class CTagsProductPathService extends BaseProductPathsService {
  constructor(serviceContainer) {
    super(serviceContainer);
  }

  getExecutableNameFromSettings(_, resource) {
    const settings = this.configService.getSettings(resource);
    return settings.workspaceSymbols.ctagsPath;
  }

};
CTagsProductPathService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_2.IServiceContainer))], CTagsProductPathService);
exports.CTagsProductPathService = CTagsProductPathService;
let FormatterProductPathService = class FormatterProductPathService extends BaseProductPathsService {
  constructor(serviceContainer) {
    super(serviceContainer);
  }

  getExecutableNameFromSettings(product, resource) {
    const settings = this.configService.getSettings(resource);
    const formatHelper = this.serviceContainer.get(types_1.IFormatterHelper);
    const settingsPropNames = formatHelper.getSettingsPropertyNames(product);
    return settings.formatting[settingsPropNames.pathName];
  }

};
FormatterProductPathService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_2.IServiceContainer))], FormatterProductPathService);
exports.FormatterProductPathService = FormatterProductPathService;
let LinterProductPathService = class LinterProductPathService extends BaseProductPathsService {
  constructor(serviceContainer) {
    super(serviceContainer);
  }

  getExecutableNameFromSettings(product, resource) {
    const linterManager = this.serviceContainer.get(types_3.ILinterManager);
    return linterManager.getLinterInfo(product).pathName(resource);
  }

};
LinterProductPathService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_2.IServiceContainer))], LinterProductPathService);
exports.LinterProductPathService = LinterProductPathService;
let TestFrameworkProductPathService = class TestFrameworkProductPathService extends BaseProductPathsService {
  constructor(serviceContainer) {
    super(serviceContainer);
  }

  getExecutableNameFromSettings(product, resource) {
    const testHelper = this.serviceContainer.get(types_4.ITestsHelper);
    const settingsPropNames = testHelper.getSettingsPropertyNames(product);

    if (!settingsPropNames.pathName) {
      // E.g. in the case of UnitTests we don't allow customizing the paths.
      return this.productInstaller.translateProductToModuleName(product, types_5.ModuleNamePurpose.run);
    }

    const settings = this.configService.getSettings(resource);
    return settings.unitTest[settingsPropNames.pathName];
  }

};
TestFrameworkProductPathService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_2.IServiceContainer))], TestFrameworkProductPathService);
exports.TestFrameworkProductPathService = TestFrameworkProductPathService;
let RefactoringLibraryProductPathService = class RefactoringLibraryProductPathService extends BaseProductPathsService {
  constructor(serviceContainer) {
    super(serviceContainer);
  }

  getExecutableNameFromSettings(product, _) {
    return this.productInstaller.translateProductToModuleName(product, types_5.ModuleNamePurpose.run);
  }

};
RefactoringLibraryProductPathService = __decorate([inversify_1.injectable(), __param(0, inversify_1.inject(types_2.IServiceContainer))], RefactoringLibraryProductPathService);
exports.RefactoringLibraryProductPathService = RefactoringLibraryProductPathService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2R1Y3RQYXRoLmpzIl0sIm5hbWVzIjpbIl9fZGVjb3JhdGUiLCJkZWNvcmF0b3JzIiwidGFyZ2V0Iiwia2V5IiwiZGVzYyIsImMiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJyIiwiT2JqZWN0IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZCIsIlJlZmxlY3QiLCJkZWNvcmF0ZSIsImkiLCJkZWZpbmVQcm9wZXJ0eSIsIl9fcGFyYW0iLCJwYXJhbUluZGV4IiwiZGVjb3JhdG9yIiwiZXhwb3J0cyIsInZhbHVlIiwiaW52ZXJzaWZ5XzEiLCJyZXF1aXJlIiwicGF0aCIsInR5cGVzXzEiLCJ0eXBlc18yIiwidHlwZXNfMyIsInR5cGVzXzQiLCJ0eXBlc181IiwiQmFzZVByb2R1Y3RQYXRoc1NlcnZpY2UiLCJjb25zdHJ1Y3RvciIsInNlcnZpY2VDb250YWluZXIiLCJjb25maWdTZXJ2aWNlIiwiZ2V0IiwiSUNvbmZpZ3VyYXRpb25TZXJ2aWNlIiwicHJvZHVjdEluc3RhbGxlciIsIklJbnN0YWxsZXIiLCJpc0V4ZWN1dGFibGVBTW9kdWxlIiwicHJvZHVjdCIsInJlc291cmNlIiwibW9kdWxlTmFtZSIsInRyYW5zbGF0ZVByb2R1Y3RUb01vZHVsZU5hbWUiLCJNb2R1bGVOYW1lUHVycG9zZSIsInJ1biIsIl9hIiwiZXhlY3V0YWJsZU5hbWUiLCJnZXRFeGVjdXRhYmxlTmFtZUZyb21TZXR0aW5ncyIsImJhc2VuYW1lIiwiaW5qZWN0YWJsZSIsImluamVjdCIsIklTZXJ2aWNlQ29udGFpbmVyIiwiQ1RhZ3NQcm9kdWN0UGF0aFNlcnZpY2UiLCJfIiwic2V0dGluZ3MiLCJnZXRTZXR0aW5ncyIsIndvcmtzcGFjZVN5bWJvbHMiLCJjdGFnc1BhdGgiLCJGb3JtYXR0ZXJQcm9kdWN0UGF0aFNlcnZpY2UiLCJmb3JtYXRIZWxwZXIiLCJJRm9ybWF0dGVySGVscGVyIiwic2V0dGluZ3NQcm9wTmFtZXMiLCJnZXRTZXR0aW5nc1Byb3BlcnR5TmFtZXMiLCJmb3JtYXR0aW5nIiwicGF0aE5hbWUiLCJMaW50ZXJQcm9kdWN0UGF0aFNlcnZpY2UiLCJsaW50ZXJNYW5hZ2VyIiwiSUxpbnRlck1hbmFnZXIiLCJnZXRMaW50ZXJJbmZvIiwiVGVzdEZyYW1ld29ya1Byb2R1Y3RQYXRoU2VydmljZSIsInRlc3RIZWxwZXIiLCJJVGVzdHNIZWxwZXIiLCJ1bml0VGVzdCIsIlJlZmFjdG9yaW5nTGlicmFyeVByb2R1Y3RQYXRoU2VydmljZSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUNBLElBQUlBLFVBQVUsR0FBSSxVQUFRLFNBQUtBLFVBQWQsSUFBNkIsVUFBVUMsVUFBVixFQUFzQkMsTUFBdEIsRUFBOEJDLEdBQTlCLEVBQW1DQyxJQUFuQyxFQUF5QztBQUNuRixNQUFJQyxDQUFDLEdBQUdDLFNBQVMsQ0FBQ0MsTUFBbEI7QUFBQSxNQUEwQkMsQ0FBQyxHQUFHSCxDQUFDLEdBQUcsQ0FBSixHQUFRSCxNQUFSLEdBQWlCRSxJQUFJLEtBQUssSUFBVCxHQUFnQkEsSUFBSSxHQUFHSyxNQUFNLENBQUNDLHdCQUFQLENBQWdDUixNQUFoQyxFQUF3Q0MsR0FBeEMsQ0FBdkIsR0FBc0VDLElBQXJIO0FBQUEsTUFBMkhPLENBQTNIO0FBQ0EsTUFBSSxPQUFPQyxPQUFQLEtBQW1CLFFBQW5CLElBQStCLE9BQU9BLE9BQU8sQ0FBQ0MsUUFBZixLQUE0QixVQUEvRCxFQUEyRUwsQ0FBQyxHQUFHSSxPQUFPLENBQUNDLFFBQVIsQ0FBaUJaLFVBQWpCLEVBQTZCQyxNQUE3QixFQUFxQ0MsR0FBckMsRUFBMENDLElBQTFDLENBQUosQ0FBM0UsS0FDSyxLQUFLLElBQUlVLENBQUMsR0FBR2IsVUFBVSxDQUFDTSxNQUFYLEdBQW9CLENBQWpDLEVBQW9DTyxDQUFDLElBQUksQ0FBekMsRUFBNENBLENBQUMsRUFBN0MsRUFBaUQsSUFBSUgsQ0FBQyxHQUFHVixVQUFVLENBQUNhLENBQUQsQ0FBbEIsRUFBdUJOLENBQUMsR0FBRyxDQUFDSCxDQUFDLEdBQUcsQ0FBSixHQUFR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LENBQVA7QUFDSDs7QUFOaUgsQ0FBdEg7QUFRQTZCLG9DQUFvQyxHQUFHeEUsVUFBVSxDQUFDLENBQzlDcUIsV0FBVyxDQUFDMkIsVUFBWixFQUQ4QyxFQUU5Q2hDLE9BQU8sQ0FBQyxDQUFELEVBQUlLLFdBQVcsQ0FBQzRCLE1BQVosQ0FBbUJ4QixPQUFPLENBQUN5QixpQkFBM0IsQ0FBSixDQUZ1QyxDQUFELEVBRzlDc0Isb0NBSDhDLENBQWpEO0FBSUFyRCxPQUFPLENBQUNxRCxvQ0FBUixHQUErQ0Esb0NBQS9DIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXG4ndXNlIHN0cmljdCc7XG52YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcbn07XG52YXIgX19wYXJhbSA9ICh0aGlzICYmIHRoaXMuX19wYXJhbSkgfHwgZnVuY3Rpb24gKHBhcmFtSW5kZXgsIGRlY29yYXRvcikge1xuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsgfVxufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbi8vIHRzbGludDpkaXNhYmxlOm1heC1jbGFzc2VzLXBlci1maWxlXG5jb25zdCBpbnZlcnNpZnlfMSA9IHJlcXVpcmUoXCJpbnZlcnNpZnlcIik7XG5jb25zdCBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uL2Zvcm1hdHRlcnMvdHlwZXNcIik7XG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uLy4uL2lvYy90eXBlc1wiKTtcbmNvbnN0IHR5cGVzXzMgPSByZXF1aXJlKFwiLi4vLi4vbGludGVycy90eXBlc1wiKTtcbmNvbnN0IHR5cGVzXzQgPSByZXF1aXJlKFwiLi4vLi4vdW5pdHRlc3RzL2NvbW1vbi90eXBlc1wiKTtcbmNvbnN0IHR5cGVzXzUgPSByZXF1aXJlKFwiLi4vdHlwZXNcIik7XG5sZXQgQmFzZVByb2R1Y3RQYXRoc1NlcnZpY2UgPSBjbGFzcyBCYXNlUHJvZHVjdFBhdGhzU2VydmljZSB7XG4gICAgY29uc3RydWN0b3Ioc2VydmljZUNvbnRhaW5lcikge1xuICAgICAgICB0aGlzLnNlcnZpY2VDb250YWluZXIgPSBzZXJ2aWNlQ29udGFpbmVyO1xuICAgICAgICB0aGlzLmNvbmZpZ1NlcnZpY2UgPSBzZXJ2aWNlQ29udGFpbmVyLmdldCh0eXBlc181LklDb25maWd1cmF0aW9uU2VydmljZSk7XG4gICAgICAgIHRoaXMucHJvZHVjdEluc3RhbGxlciA9IHNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzUuSUluc3RhbGxlcik7XG4gICAgfVxuICAgIGlzRXhlY3V0YWJsZUFNb2R1bGUocHJvZHVjdCwgcmVzb3VyY2UpIHtcbiAgICAgICAgbGV0IG1vZHVsZU5hbWU7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBtb2R1bGVOYW1lID0gdGhpcy5wcm9kdWN0SW5zdGFsbGVyLnRyYW5zbGF0ZVByb2R1Y3RUb01vZHVsZU5hbWUocHJvZHVjdCwgdHlwZXNfNS5Nb2R1bGVOYW1lUHVycG9zZS5ydW4pO1xuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWVtcHR5XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKF9hKSB7IH1cbiAgICAgICAgLy8gVXNlciBtYXkgaGF2ZSBjdXN0b21pemVkIHRoZSBtb2R1bGUgbmFtZSBvciBwcm92aWRlZCB0aGUgZnVsbHkgcXVhbGlmaWVpZCBwYXRoLlxuICAgICAgICBjb25zdCBleGVjdXRhYmxlTmFtZSA9IHRoaXMuZ2V0RXhlY3V0YWJsZU5hbWVGcm9tU2V0dGluZ3MocHJvZHVjdCwgcmVzb3VyY2UpO1xuICAgICAgICByZXR1cm4gdHlwZW9mIG1vZHVsZU5hbWUgPT09ICdzdHJpbmcnICYmIG1vZHVsZU5hbWUubGVuZ3RoID4gMCAmJiBwYXRoLmJhc2VuYW1lKGV4ZWN1dGFibGVOYW1lKSA9PT0gZXhlY3V0YWJsZU5hbWU7XG4gICAgfVxufTtcbkJhc2VQcm9kdWN0UGF0aHNTZXJ2aWNlID0gX19kZWNvcmF0ZShbXG4gICAgaW52ZXJzaWZ5XzEuaW5qZWN0YWJsZSgpLFxuICAgIF9fcGFyYW0oMCwgaW52ZXJzaWZ5XzEuaW5qZWN0KHR5cGVzXzIuSVNlcnZpY2VDb250YWluZXIpKVxuXSwgQmFzZVByb2R1Y3RQYXRoc1NlcnZpY2UpO1xubGV0IENUYWdzUHJvZHVjdFBhdGhTZXJ2aWNlID0gY2xhc3MgQ1RhZ3NQcm9kdWN0UGF0aFNlcnZpY2UgZXh0ZW5kcyBCYXNlUHJvZHVjdFBhdGhzU2VydmljZSB7XG4gICAgY29uc3RydWN0b3Ioc2VydmljZUNvbnRhaW5lcikge1xuICAgICAgICBzdXBlcihzZXJ2aWNlQ29udGFpbmVyKTtcbiAgICB9XG4gICAgZ2V0RXhlY3V0YWJsZU5hbWVGcm9tU2V0dGluZ3MoXywgcmVzb3VyY2UpIHtcbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0U2V0dGluZ3MocmVzb3VyY2UpO1xuICAgICAgICByZXR1cm4gc2V0dGluZ3Mud29ya3NwYWNlU3ltYm9scy5jdGFnc1BhdGg7XG4gICAgfVxufTtcbkNUYWdzUHJvZHVjdFBhdGhTZXJ2aWNlID0gX19kZWNvcmF0ZShbXG4gICAgaW52ZXJzaWZ5XzEuaW5qZWN0YWJsZSgpLFxuICAgIF9fcGFyYW0oMCwgaW52ZXJzaWZ5XzEuaW5qZWN0KHR5cGVzXzIuSVNlcnZpY2VDb250YWluZXIpKVxuXSwgQ1RhZ3NQcm9kdWN0UGF0aFNlcnZpY2UpO1xuZXhwb3J0cy5DVGFnc1Byb2R1Y3RQYXRoU2VydmljZSA9IENUYWdzUHJvZHVjdFBhdGhTZXJ2aWNlO1xubGV0IEZvcm1hdHRlclByb2R1Y3RQYXRoU2VydmljZSA9IGNsYXNzIEZvcm1hdHRlclByb2R1Y3RQYXRoU2VydmljZSBleHRlbmRzIEJhc2VQcm9kdWN0UGF0aHNTZXJ2aWNlIHtcbiAgICBjb25zdHJ1Y3RvcihzZXJ2aWNlQ29udGFpbmVyKSB7XG4gICAgICAgIHN1cGVyKHNlcnZpY2VDb250YWluZXIpO1xuICAgIH1cbiAgICBnZXRFeGVjdXRhYmxlTmFtZUZyb21TZXR0aW5ncyhwcm9kdWN0LCByZXNvdXJjZSkge1xuICAgICAgICBjb25zdCBzZXR0aW5ncyA9IHRoaXMuY29uZmlnU2VydmljZS5nZXRTZXR0aW5ncyhyZXNvdXJjZSk7XG4gICAgICAgIGNvbnN0IGZvcm1hdEhlbHBlciA9IHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMS5JRm9ybWF0dGVySGVscGVyKTtcbiAgICAgICAgY29uc3Qgc2V0dGluZ3NQcm9wTmFtZXMgPSBmb3JtYXRIZWxwZXIuZ2V0U2V0dGluZ3NQcm9wZXJ0eU5hbWVzKHByb2R1Y3QpO1xuICAgICAgICByZXR1cm4gc2V0dGluZ3MuZm9ybWF0dGluZ1tzZXR0aW5nc1Byb3BOYW1lcy5wYXRoTmFtZV07XG4gICAgfVxufTtcbkZvcm1hdHRlclByb2R1Y3RQYXRoU2VydmljZSA9IF9fZGVjb3JhdGUoW1xuICAgIGludmVyc2lmeV8xLmluamVjdGFibGUoKSxcbiAgICBfX3BhcmFtKDAsIGludmVyc2lmeV8xLmluamVjdCh0eXBlc18yLklTZXJ2aWNlQ29udGFpbmVyKSlcbl0sIEZvcm1hdHRlclByb2R1Y3RQYXRoU2VydmljZSk7XG5leHBvcnRzLkZvcm1hdHRlclByb2R1Y3RQYXRoU2VydmljZSA9IEZvcm1hdHRlclByb2R1Y3RQYXRoU2VydmljZTtcbmxldCBMaW50ZXJQcm9kdWN0UGF0aFNlcnZpY2UgPSBjbGFzcyBMaW50ZXJQcm9kdWN0UGF0aFNlcnZpY2UgZXh0ZW5kcyBCYXNlUHJvZHVjdFBhdGhzU2VydmljZSB7XG4gICAgY29uc3RydWN0b3Ioc2VydmljZUNvbnRhaW5lcikge1xuICAgICAgICBzdXBlcihzZXJ2aWNlQ29udGFpbmVyKTtcbiAgICB9XG4gICAgZ2V0RXhlY3V0YWJsZU5hbWVGcm9tU2V0dGluZ3MocHJvZHVjdCwgcmVzb3VyY2UpIHtcbiAgICAgICAgY29uc3QgbGludGVyTWFuYWdlciA9IHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMy5JTGludGVyTWFuYWdlcik7XG4gICAgICAgIHJldHVybiBsaW50ZXJNYW5hZ2VyLmdldExpbnRlckluZm8ocHJvZHVjdCkucGF0aE5hbWUocmVzb3VyY2UpO1xuICAgIH1cbn07XG5MaW50ZXJQcm9kdWN0UGF0aFNlcnZpY2UgPSBfX2RlY29yYXRlKFtcbiAgICBpbnZlcnNpZnlfMS5pbmplY3RhYmxlKCksXG4gICAgX19wYXJhbSgwLCBpbnZlcnNpZnlfMS5pbmplY3QodHlwZXNfMi5JU2VydmljZUNvbnRhaW5lcikpXG5dLCBMaW50ZXJQcm9kdWN0UGF0aFNlcnZpY2UpO1xuZXhwb3J0cy5MaW50ZXJQcm9kdWN0UGF0aFNlcnZpY2UgPSBMaW50ZXJQcm9kdWN0UGF0aFNlcnZpY2U7XG5sZXQgVGVzdEZyYW1ld29ya1Byb2R1Y3RQYXRoU2VydmljZSA9IGNsYXNzIFRlc3RGcmFtZXdvcmtQcm9kdWN0UGF0aFNlcnZpY2UgZXh0ZW5kcyBCYXNlUHJvZHVjdFBhdGhzU2VydmljZSB7XG4gICAgY29uc3RydWN0b3Ioc2VydmljZUNvbnRhaW5lcikge1xuICAgICAgICBzdXBlcihzZXJ2aWNlQ29udGFpbmVyKTtcbiAgICB9XG4gICAgZ2V0RXhlY3V0YWJsZU5hbWVGcm9tU2V0dGluZ3MocHJvZHVjdCwgcmVzb3VyY2UpIHtcbiAgICAgICAgY29uc3QgdGVzdEhlbHBlciA9IHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfNC5JVGVzdHNIZWxwZXIpO1xuICAgICAgICBjb25zdCBzZXR0aW5nc1Byb3BOYW1lcyA9IHRlc3RIZWxwZXIuZ2V0U2V0dGluZ3NQcm9wZXJ0eU5hbWVzKHByb2R1Y3QpO1xuICAgICAgICBpZiAoIXNldHRpbmdzUHJvcE5hbWVzLnBhdGhOYW1lKSB7XG4gICAgICAgICAgICAvLyBFLmcuIGluIHRoZSBjYXNlIG9mIFVuaXRUZXN0cyB3ZSBkb24ndCBhbGxvdyBjdXN0b21pemluZyB0aGUgcGF0aHMuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wcm9kdWN0SW5zdGFsbGVyLnRyYW5zbGF0ZVByb2R1Y3RUb01vZHVsZU5hbWUocHJvZHVjdCwgdHlwZXNfNS5Nb2R1bGVOYW1lUHVycG9zZS5ydW4pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0gdGhpcy5jb25maWdTZXJ2aWNlLmdldFNldHRpbmdzKHJlc291cmNlKTtcbiAgICAgICAgcmV0dXJuIHNldHRpbmdzLnVuaXRUZXN0W3NldHRpbmdzUHJvcE5hbWVzLnBhdGhOYW1lXTtcbiAgICB9XG59O1xuVGVzdEZyYW1ld29ya1Byb2R1Y3RQYXRoU2VydmljZSA9IF9fZGVjb3JhdGUoW1xuICAgIGludmVyc2lmeV8xLmluamVjdGFibGUoKSxcbiAgICBfX3BhcmFtKDAsIGludmVyc2lmeV8xLmluamVjdCh0eXBlc18yLklTZXJ2aWNlQ29udGFpbmVyKSlcbl0sIFRlc3RGcmFtZXdvcmtQcm9kdWN0UGF0aFNlcnZpY2UpO1xuZXhwb3J0cy5UZXN0RnJhbWV3b3JrUHJvZHVjdFBhdGhTZXJ2aWNlID0gVGVzdEZyYW1ld29ya1Byb2R1Y3RQYXRoU2VydmljZTtcbmxldCBSZWZhY3RvcmluZ0xpYnJhcnlQcm9kdWN0UGF0aFNlcnZpY2UgPSBjbGFzcyBSZWZhY3RvcmluZ0xpYnJhcnlQcm9kdWN0UGF0aFNlcnZpY2UgZXh0ZW5kcyBCYXNlUHJvZHVjdFBhdGhzU2VydmljZSB7XG4gICAgY29uc3RydWN0b3Ioc2VydmljZUNvbnRhaW5lcikge1xuICAgICAgICBzdXBlcihzZXJ2aWNlQ29udGFpbmVyKTtcbiAgICB9XG4gICAgZ2V0RXhlY3V0YWJsZU5hbWVGcm9tU2V0dGluZ3MocHJvZHVjdCwgXykge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9kdWN0SW5zdGFsbGVyLnRyYW5zbGF0ZVByb2R1Y3RUb01vZHVsZU5hbWUocHJvZHVjdCwgdHlwZXNfNS5Nb2R1bGVOYW1lUHVycG9zZS5ydW4pO1xuICAgIH1cbn07XG5SZWZhY3RvcmluZ0xpYnJhcnlQcm9kdWN0UGF0aFNlcnZpY2UgPSBfX2RlY29yYXRlKFtcbiAgICBpbnZlcnNpZnlfMS5pbmplY3RhYmxlKCksXG4gICAgX19wYXJhbSgwLCBpbnZlcnNpZnlfMS5pbmplY3QodHlwZXNfMi5JU2VydmljZUNvbnRhaW5lcikpXG5dLCBSZWZhY3RvcmluZ0xpYnJhcnlQcm9kdWN0UGF0aFNlcnZpY2UpO1xuZXhwb3J0cy5SZWZhY3RvcmluZ0xpYnJhcnlQcm9kdWN0UGF0aFNlcnZpY2UgPSBSZWZhY3RvcmluZ0xpYnJhcnlQcm9kdWN0UGF0aFNlcnZpY2U7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1wcm9kdWN0UGF0aC5qcy5tYXAiXX0=
"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable-next-line:no-require-imports no-var-requires

const sudo = require('sudo-prompt');

const fs = require("fs");

const inversify_1 = require("inversify");

const path = require("path");

const vscode = require("vscode");

const contracts_1 = require("../../interpreter/contracts");

const constants_1 = require("../constants");

const types_1 = require("../terminal/types");

const types_2 = require("../types");

const misc_1 = require("../utils/misc");

let ModuleInstaller = class ModuleInstaller {
  constructor(serviceContainer) {
    this.serviceContainer = serviceContainer;
  }

  installModule(name, resource) {
    return __awaiter(this, void 0, void 0, function* () {
      const executionInfo = yield this.getExecutionInfo(name, resource);
      const terminalService = this.serviceContainer.get(types_1.ITerminalServiceFactory).getTerminalService(resource);
      const executionInfoArgs = yield this.processInstallArgs(executionInfo.args, resource);

      if (executionInfo.moduleName) {
        const configService = this.serviceContainer.get(types_2.IConfigurationService);
        const settings = configService.getSettings(resource);
        const args = ['-m', executionInfo.moduleName].concat(executionInfoArgs);
        const pythonPath = settings.pythonPath;
        const interpreterService = this.serviceContainer.get(contracts_1.IInterpreterService);
        const currentInterpreter = yield interpreterService.getActiveInterpreter(resource);

        if (!currentInterpreter || currentInterpreter.type !== contracts_1.InterpreterType.Unknown) {
          yield terminalService.sendCommand(pythonPath, args);
        } else if (settings.globalModuleInstallation) {
          if (yield this.isPathWritableAsync(path.dirname(pythonPath))) {
            yield terminalService.sendCommand(pythonPath, args);
          } else {
            this.elevatedInstall(pythonPath, args);
          }
        } else {
          yield terminalService.sendCommand(pythonPath, args.concat(['--user']));
        }
      } else {
        yield terminalService.sendCommand(executionInfo.execPath, executionInfoArgs);
      }
    });
  }

  processInstallArgs(args, resource) {
    return __awaiter(this, void 0, void 0, function* () {
      const indexOfPylint = args.findIndex(arg => arg.toUpperCase() === 'PYLINT');

      if (indexOfPylint === -1) {
        return args;
      } // If installing pylint on python 2.x, then use pylint~=1.9.0


      const interpreterService = this.serviceContainer.get(contracts_1.IInterpreterService);
      const currentInterpreter = yield interpreterService.getActiveInterpreter(resource);

      if (currentInterpreter && currentInterpreter.version_info && currentInterpreter.version_info[0] === 2) {
        const newArgs = [...args]; // This command could be sent to the terminal, hence '<' needs to be escaped for UNIX.

        newArgs[indexOfPylint] = '"pylint<2.0.0"';
        return newArgs;
      }

      return args;
    });
  }

  isPathWritableAsync(directoryPath) {
    return __awaiter(this, void 0, void 0, function* () {
      const filePath = `${directoryPath}${path.sep}___vscpTest___`;
      return new Promise(resolve => {
        fs.open(filePath, fs.constants.O_CREAT | fs.constants.O_RDWR, (error, fd) => {
          if (!error) {
            fs.close(fd, e => {
              fs.unlink(filePath, misc_1.noop);
            });
          }

          return resolve(!error);
        });
      });
    });
  }

  elevatedInstall(execPath, args) {
    const options = {
      name: 'VS Code Python'
    };
    const outputChannel = this.serviceContainer.get(types_2.IOutputChannel, constants_1.STANDARD_OUTPUT_CHANNEL);
    const command = `"${execPath.replace(/\\/g, '/')}" ${args.join(' ')}`;
    outputChannel.appendLine('');
    outputChannel.appendLine(`[Elevated] ${command}`);
    sudo.exec(command, options, (error, stdout, stderr) => {
      if (error) {
        vscode.window.showErrorMessage(error);
      } else {
        outputChannel.show();

        if (stdout) {
          outputChannel.appendLine('');
          outputChannel.append(stdout);
        }

        if (stderr) {
          outputChannel.appendLine('');
          outputChannel.append(`Warning: ${stderr}`);
        }
      }
    });
  }

};
ModuleInstaller = __decorate([inversify_1.injectable()], ModuleInstaller);
exports.ModuleInstaller = ModuleInstaller;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZUluc3RhbGxlci5qcyJdLCJuYW1lcyI6WyJfX2RlY29yYXRlIiwiZGVjb3JhdG9ycyIsInRhcmdldCIsImtleSIsImRlc2MiLCJjIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImQiLCJSZWZsZWN0IiwiZGVjb3JhdGUiLCJpIiwiZGVmaW5lUHJvcGVydHkiLCJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiZXhwb3J0cyIsInN1ZG8iLCJyZXF1aXJlIiwiZnMiLCJpbnZlcnNpZnlfMSIsInBhdGgiLCJ2c2NvZGUiLCJjb250cmFjdHNfMSIsImNvbnN0YW50c18xIiwidHlwZXNfMSIsInR5cGVzXzIiLCJtaXNjXzEiLCJNb2R1bGVJbnN0YWxsZXIiLCJjb25zdHJ1Y3RvciIsInNlcnZpY2VDb250YWluZXIiLCJpbnN0YWxsTW9kdWxlIiwibmFtZSIsInJlc291cmNlIiwiZXhlY3V0aW9uSW5mbyIsImdldEV4ZWN1dGlvbkluZm8iLCJ0ZXJtaW5hbFNlcnZpY2UiLCJnZXQiLCJJVGVybWluYWxTZXJ2aWNlRmFjdG9yeSIsImdldFRlcm1pbmFsU2VydmljZSIsImV4ZWN1dGlvbkluZm9BcmdzIiwicHJvY2Vzc0luc3RhbGxBcmdzIiwiYXJncyIsIm1vZHVsZU5hbWUiLCJjb25maWdTZXJ2aWNlIiwiSUNvbmZpZ3VyYXRpb25TZXJ2aWNlIiwic2V0dGluZ3MiLCJnZXRTZXR0aW5ncyIsImNvbmNhdCIsInB5dGhvblBhdGgiLCJpbnRlcnByZXRlclNlcnZpY2UiLCJJSW50ZXJwcmV0ZXJTZXJ2aWNlIiwiY3VycmVudEludGVycHJldGVyIiwiZ2V0QWN0aXZlSW50ZXJwcmV0ZXIiLCJ0eXBlIiwiSW50ZXJwcmV0ZXJUeXBlIiwiVW5rbm93biIsInNlbmRDb21tYW5kIiwiZ2xvYmFsTW9kdWxlSW5zdGFsbGF0aW9uIiwiaXNQYXRoV3JpdGFibGVBc3luYyIsImRpcm5hbWUiLCJlbGV2YXRlZEluc3RhbGwiLCJleGVjUGF0aCIsImluZGV4T2ZQeWxpbnQiLCJmaW5kSW5kZXgiLCJhcmciLCJ0b1VwcGVyQ2FzZSIsInZlcnNpb25faW5mbyIsIm5ld0FyZ3MiLCJkaXJlY3RvcnlQYXRoIiwiZmlsZVBhdGgiLCJzZXAiLCJvcGVuIiwiY29uc3RhbnRzIiwiT19DUkVBVCIsIk9fUkRXUiIsImVycm9yIiwiZmQiLCJjbG9zZSIsInVubGluayIsIm5vb3AiLCJvcHRpb25zIiwib3V0cHV0Q2hhbm5lbCIsIklPdXRwdXRDaGFubmVsIiwiU1RBTkRBUkRfT1VUUFVUX0NIQU5ORUwiLCJjb21tYW5kIiwicmVwbGFjZSIsImpvaW4iLCJhcHBlbmRMaW5lIiwiZXhlYyIsInN0ZG91dCIsInN0ZGVyciIsIndpbmRvdyIsInNob3dFcnJvck1lc3NhZ2UiLCJzaG93IiwiYXBwZW5kIiwiaW5qZWN0YWJsZSJdLCJtYXBwaW5ncyI6IkFBQUEsYSxDQUNBO0FBQ0E7O0FBQ0EsSUFBSUEsVUFBVSxHQUFJLFVBQVEsU0FBS0EsVUFBZCxJQUE2QixVQUFVQyxVQUFWLEVBQXNCQyxNQUF0QixFQUE4QkMsR0FBOUIsRUFBbUNDLElBQW5DLEVBQXlDO0FBQ25GLE1BQUlDLENBQUMsR0FBR0MsU0FBUyxDQUFDQyxNQUFsQjtBQUFBLE1BQTBCQyxDQUFDLEdBQUdILENBQUMsR0FBRyxDQUFKLEdBQVFILE1BQVIsR0FBaUJFLElBQUksS0FBSyxJQUFULEdBQWdCQSxJQUFJLEdBQUdLLE1BQU0sQ0FBQ0Msd0JBQVAsQ0FBZ0NSLE1BQWhDLEVBQXdDQyxHQUF4QyxDQUF2QixHQUFzRUMsSUFBckg7QUFBQSxNQUEySE8sQ0FBM0g7QUFDQSxNQUFJLE9BQU9DLE9BQVAsS0FBbUIsUUFBbkIs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QUNBcEUsSUFBQUEsSUFBSSxDQUFDd0UsSUFBTCxDQUFVSixPQUFWLEVBQW1CSixPQUFuQixFQUE0QixDQUFDTCxLQUFELEVBQVFjLE1BQVIsRUFBZ0JDLE1BQWhCLEtBQTJCO0FBQ25ELFVBQUlmLEtBQUosRUFBVztBQUNQdEQsUUFBQUEsTUFBTSxDQUFDc0UsTUFBUCxDQUFjQyxnQkFBZCxDQUErQmpCLEtBQS9CO0FBQ0gsT0FGRCxNQUdLO0FBQ0RNLFFBQUFBLGFBQWEsQ0FBQ1ksSUFBZDs7QUFDQSxZQUFJSixNQUFKLEVBQVk7QUFDUlIsVUFBQUEsYUFBYSxDQUFDTSxVQUFkLENBQXlCLEVBQXpCO0FBQ0FOLFVBQUFBLGFBQWEsQ0FBQ2EsTUFBZCxDQUFxQkwsTUFBckI7QUFDSDs7QUFDRCxZQUFJQyxNQUFKLEVBQVk7QUFDUlQsVUFBQUEsYUFBYSxDQUFDTSxVQUFkLENBQXlCLEVBQXpCO0FBQ0FOLFVBQUFBLGFBQWEsQ0FBQ2EsTUFBZCxDQUFzQixZQUFXSixNQUFPLEVBQXhDO0FBQ0g7QUFDSjtBQUNKLEtBZkQ7QUFnQkg7O0FBN0Z1QyxDQUE1QztBQStGQS9ELGVBQWUsR0FBRzlDLFVBQVUsQ0FBQyxDQUN6QnNDLFdBQVcsQ0FBQzRFLFVBQVosRUFEeUIsQ0FBRCxFQUV6QnBFLGVBRnlCLENBQTVCO0FBR0FaLE9BQU8sQ0FBQ1ksZUFBUixHQUEwQkEsZUFBMUIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tcmVxdWlyZS1pbXBvcnRzIG5vLXZhci1yZXF1aXJlc1xuY29uc3Qgc3VkbyA9IHJlcXVpcmUoJ3N1ZG8tcHJvbXB0Jyk7XG5jb25zdCBmcyA9IHJlcXVpcmUoXCJmc1wiKTtcbmNvbnN0IGludmVyc2lmeV8xID0gcmVxdWlyZShcImludmVyc2lmeVwiKTtcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcbmNvbnN0IHZzY29kZSA9IHJlcXVpcmUoXCJ2c2NvZGVcIik7XG5jb25zdCBjb250cmFjdHNfMSA9IHJlcXVpcmUoXCIuLi8uLi9pbnRlcnByZXRlci9jb250cmFjdHNcIik7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuLi9jb25zdGFudHNcIik7XG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uL3Rlcm1pbmFsL3R5cGVzXCIpO1xuY29uc3QgdHlwZXNfMiA9IHJlcXVpcmUoXCIuLi90eXBlc1wiKTtcbmNvbnN0IG1pc2NfMSA9IHJlcXVpcmUoXCIuLi91dGlscy9taXNjXCIpO1xubGV0IE1vZHVsZUluc3RhbGxlciA9IGNsYXNzIE1vZHVsZUluc3RhbGxlciB7XG4gICAgY29uc3RydWN0b3Ioc2VydmljZUNvbnRhaW5lcikge1xuICAgICAgICB0aGlzLnNlcnZpY2VDb250YWluZXIgPSBzZXJ2aWNlQ29udGFpbmVyO1xuICAgIH1cbiAgICBpbnN0YWxsTW9kdWxlKG5hbWUsIHJlc291cmNlKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBleGVjdXRpb25JbmZvID0geWllbGQgdGhpcy5nZXRFeGVjdXRpb25JbmZvKG5hbWUsIHJlc291cmNlKTtcbiAgICAgICAgICAgIGNvbnN0IHRlcm1pbmFsU2VydmljZSA9IHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMS5JVGVybWluYWxTZXJ2aWNlRmFjdG9yeSkuZ2V0VGVybWluYWxTZXJ2aWNlKHJlc291cmNlKTtcbiAgICAgICAgICAgIGNvbnN0IGV4ZWN1dGlvbkluZm9BcmdzID0geWllbGQgdGhpcy5wcm9jZXNzSW5zdGFsbEFyZ3MoZXhlY3V0aW9uSW5mby5hcmdzLCByZXNvdXJjZSk7XG4gICAgICAgICAgICBpZiAoZXhlY3V0aW9uSW5mby5tb2R1bGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29uZmlnU2VydmljZSA9IHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMi5JQ29uZmlndXJhdGlvblNlcnZpY2UpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzID0gY29uZmlnU2VydmljZS5nZXRTZXR0aW5ncyhyZXNvdXJjZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgYXJncyA9IFsnLW0nLCBleGVjdXRpb25JbmZvLm1vZHVsZU5hbWVdLmNvbmNhdChleGVjdXRpb25JbmZvQXJncyk7XG4gICAgICAgICAgICAgICAgY29uc3QgcHl0aG9uUGF0aCA9IHNldHRpbmdzLnB5dGhvblBhdGg7XG4gICAgICAgICAgICAgICAgY29uc3QgaW50ZXJwcmV0ZXJTZXJ2aWNlID0gdGhpcy5zZXJ2aWNlQ29udGFpbmVyLmdldChjb250cmFjdHNfMS5JSW50ZXJwcmV0ZXJTZXJ2aWNlKTtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50SW50ZXJwcmV0ZXIgPSB5aWVsZCBpbnRlcnByZXRlclNlcnZpY2UuZ2V0QWN0aXZlSW50ZXJwcmV0ZXIocmVzb3VyY2UpO1xuICAgICAgICAgICAgICAgIGlmICghY3VycmVudEludGVycHJldGVyIHx8IGN1cnJlbnRJbnRlcnByZXRlci50eXBlICE9PSBjb250cmFjdHNfMS5JbnRlcnByZXRlclR5cGUuVW5rbm93bikge1xuICAgICAgICAgICAgICAgICAgICB5aWVsZCB0ZXJtaW5hbFNlcnZpY2Uuc2VuZENvbW1hbmQocHl0aG9uUGF0aCwgYXJncyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNldHRpbmdzLmdsb2JhbE1vZHVsZUluc3RhbGxhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoeWllbGQgdGhpcy5pc1BhdGhXcml0YWJsZUFzeW5jKHBhdGguZGlybmFtZShweXRob25QYXRoKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHlpZWxkIHRlcm1pbmFsU2VydmljZS5zZW5kQ29tbWFuZChweXRob25QYXRoLCBhcmdzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWxldmF0ZWRJbnN0YWxsKHB5dGhvblBhdGgsIGFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB5aWVsZCB0ZXJtaW5hbFNlcnZpY2Uuc2VuZENvbW1hbmQocHl0aG9uUGF0aCwgYXJncy5jb25jYXQoWyctLXVzZXInXSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHlpZWxkIHRlcm1pbmFsU2VydmljZS5zZW5kQ29tbWFuZChleGVjdXRpb25JbmZvLmV4ZWNQYXRoLCBleGVjdXRpb25JbmZvQXJncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBwcm9jZXNzSW5zdGFsbEFyZ3MoYXJncywgcmVzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IGluZGV4T2ZQeWxpbnQgPSBhcmdzLmZpbmRJbmRleChhcmcgPT4gYXJnLnRvVXBwZXJDYXNlKCkgPT09ICdQWUxJTlQnKTtcbiAgICAgICAgICAgIGlmIChpbmRleE9mUHlsaW50ID09PSAtMSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhcmdzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSWYgaW5zdGFsbGluZyBweWxpbnQgb24gcHl0aG9uIDIueCwgdGhlbiB1c2UgcHlsaW50fj0xLjkuMFxuICAgICAgICAgICAgY29uc3QgaW50ZXJwcmV0ZXJTZXJ2aWNlID0gdGhpcy5zZXJ2aWNlQ29udGFpbmVyLmdldChjb250cmFjdHNfMS5JSW50ZXJwcmV0ZXJTZXJ2aWNlKTtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRJbnRlcnByZXRlciA9IHlpZWxkIGludGVycHJldGVyU2VydmljZS5nZXRBY3RpdmVJbnRlcnByZXRlcihyZXNvdXJjZSk7XG4gICAgICAgICAgICBpZiAoY3VycmVudEludGVycHJldGVyICYmIGN1cnJlbnRJbnRlcnByZXRlci52ZXJzaW9uX2luZm8gJiYgY3VycmVudEludGVycHJldGVyLnZlcnNpb25faW5mb1swXSA9PT0gMikge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0FyZ3MgPSBbLi4uYXJnc107XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBjb21tYW5kIGNvdWxkIGJlIHNlbnQgdG8gdGhlIHRlcm1pbmFsLCBoZW5jZSAnPCcgbmVlZHMgdG8gYmUgZXNjYXBlZCBmb3IgVU5JWC5cbiAgICAgICAgICAgICAgICBuZXdBcmdzW2luZGV4T2ZQeWxpbnRdID0gJ1wicHlsaW50PDIuMC4wXCInO1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXdBcmdzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFyZ3M7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBpc1BhdGhXcml0YWJsZUFzeW5jKGRpcmVjdG9yeVBhdGgpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7ZGlyZWN0b3J5UGF0aH0ke3BhdGguc2VwfV9fX3ZzY3BUZXN0X19fYDtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgICAgICAgICBmcy5vcGVuKGZpbGVQYXRoLCBmcy5jb25zdGFudHMuT19DUkVBVCB8IGZzLmNvbnN0YW50cy5PX1JEV1IsIChlcnJvciwgZmQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZnMuY2xvc2UoZmQsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnMudW5saW5rKGZpbGVQYXRoLCBtaXNjXzEubm9vcCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSghZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbGV2YXRlZEluc3RhbGwoZXhlY1BhdGgsIGFyZ3MpIHtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIG5hbWU6ICdWUyBDb2RlIFB5dGhvbidcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3Qgb3V0cHV0Q2hhbm5lbCA9IHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMi5JT3V0cHV0Q2hhbm5lbCwgY29uc3RhbnRzXzEuU1RBTkRBUkRfT1VUUFVUX0NIQU5ORUwpO1xuICAgICAgICBjb25zdCBjb21tYW5kID0gYFwiJHtleGVjUGF0aC5yZXBsYWNlKC9cXFxcL2csICcvJyl9XCIgJHthcmdzLmpvaW4oJyAnKX1gO1xuICAgICAgICBvdXRwdXRDaGFubmVsLmFwcGVuZExpbmUoJycpO1xuICAgICAgICBvdXRwdXRDaGFubmVsLmFwcGVuZExpbmUoYFtFbGV2YXRlZF0gJHtjb21tYW5kfWApO1xuICAgICAgICBzdWRvLmV4ZWMoY29tbWFuZCwgb3B0aW9ucywgKGVycm9yLCBzdGRvdXQsIHN0ZGVycikgPT4ge1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdnNjb2RlLndpbmRvdy5zaG93RXJyb3JNZXNzYWdlKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG91dHB1dENoYW5uZWwuc2hvdygpO1xuICAgICAgICAgICAgICAgIGlmIChzdGRvdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0Q2hhbm5lbC5hcHBlbmRMaW5lKCcnKTtcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0Q2hhbm5lbC5hcHBlbmQoc3Rkb3V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHN0ZGVycikge1xuICAgICAgICAgICAgICAgICAgICBvdXRwdXRDaGFubmVsLmFwcGVuZExpbmUoJycpO1xuICAgICAgICAgICAgICAgICAgICBvdXRwdXRDaGFubmVsLmFwcGVuZChgV2FybmluZzogJHtzdGRlcnJ9YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59O1xuTW9kdWxlSW5zdGFsbGVyID0gX19kZWNvcmF0ZShbXG4gICAgaW52ZXJzaWZ5XzEuaW5qZWN0YWJsZSgpXG5dLCBNb2R1bGVJbnN0YWxsZXIpO1xuZXhwb3J0cy5Nb2R1bGVJbnN0YWxsZXIgPSBNb2R1bGVJbnN0YWxsZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tb2R1bGVJbnN0YWxsZXIuanMubWFwIl19
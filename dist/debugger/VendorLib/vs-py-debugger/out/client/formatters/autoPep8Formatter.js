"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

const productInstaller_1 = require("../common/installer/productInstaller");

const types_1 = require("../common/types");

const stopWatch_1 = require("../common/utils/stopWatch");

const telemetry_1 = require("../telemetry");

const constants_1 = require("../telemetry/constants");

const baseFormatter_1 = require("./baseFormatter");

class AutoPep8Formatter extends baseFormatter_1.BaseFormatter {
  constructor(serviceContainer) {
    super('autopep8', productInstaller_1.Product.autopep8, serviceContainer);
  }

  formatDocument(document, options, token, range) {
    const stopWatch = new stopWatch_1.StopWatch();
    const settings = this.serviceContainer.get(types_1.IConfigurationService).getSettings(document.uri);
    const hasCustomArgs = Array.isArray(settings.formatting.autopep8Args) && settings.formatting.autopep8Args.length > 0;
    const formatSelection = range ? !range.isEmpty : false;
    const autoPep8Args = ['--diff'];

    if (formatSelection) {
      // tslint:disable-next-line:no-non-null-assertion
      autoPep8Args.push(...['--line-range', (range.start.line + 1).toString(), (range.end.line + 1).toString()]);
    }

    const promise = super.provideDocumentFormattingEdits(document, options, token, autoPep8Args);
    telemetry_1.sendTelemetryWhenDone(constants_1.FORMAT, promise, stopWatch, {
      tool: 'autopep8',
      hasCustomArgs,
      formatSelection
    });
    return promise;
  }

}

exports.AutoPep8Formatter = AutoPep8Formatter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dG9QZXA4Rm9ybWF0dGVyLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwicHJvZHVjdEluc3RhbGxlcl8xIiwicmVxdWlyZSIsInR5cGVzXzEiLCJzdG9wV2F0Y2hfMSIsInRlbGVtZXRyeV8xIiwiY29uc3RhbnRzXzEiLCJiYXNlRm9ybWF0dGVyXzEiLCJBdXRvUGVwOEZvcm1hdHRlciIsIkJhc2VGb3JtYXR0ZXIiLCJjb25zdHJ1Y3RvciIsInNlcnZpY2VDb250YWluZXIiLCJQcm9kdWN0IiwiYXV0b3BlcDgiLCJmb3JtYXREb2N1bWVudCIsImRvY3VtZW50Iiwib3B0aW9ucyIsInRva2VuIiwicmFuZ2UiLCJzdG9wV2F0Y2giLCJTdG9wV2F0Y2giLCJzZXR0aW5ncyIsImdldCIsIklDb25maWd1cmF0aW9uU2VydmljZSIsImdldFNldHRpbmdzIiwidXJpIiwiaGFzQ3VzdG9tQXJncyIsIkFycmF5IiwiaXNBcnJheSIsImZvcm1hdHRpbmciLCJhdXRvcGVwOEFyZ3MiLCJsZW5ndGgiLCJmb3JtYXRTZWxlY3Rpb24iLCJpc0VtcHR5IiwiYXV0b1BlcDhBcmdzIiwicHVzaCIsInN0YXJ0IiwibGluZSIsInRvU3RyaW5nIiwiZW5kIiwicHJvbWlzZSIsInByb3ZpZGVEb2N1bWVudEZvcm1hdHRpbmdFZGl0cyIsInNlbmRUZWxlbWV0cnlXaGVuRG9uZSIsIkZPUk1BVCIsInRvb2wiXSwibWFwcGluZ3MiOiJBQUFBOztBQUNBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQUVDLEVBQUFBLEtBQUssRUFBRTtBQUFULENBQTdDOztBQUNBLE1BQU1DLGtCQUFrQixHQUFHQyxPQUFPLENBQUMsc0NBQUQsQ0FBbEM7O0FBQ0EsTUFBTUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsaUJBQUQsQ0FBdkI7O0FBQ0EsTUFBTUUsV0FBVyxHQUFHRixPQUFPLENBQUMsMkJBQUQsQ0FBM0I7O0FBQ0EsTUFBTUcsV0FBVyxHQUFHSCxPQUFPLENBQUMsY0FBRCxDQUEzQjs7QUFDQSxNQUFNSSxXQUFXLEdBQUdKLE9BQU8sQ0FBQyx3QkFBRCxDQUEzQjs7QUFDQSxNQUFNSyxlQUFlLEdBQUdMLE9BQU8sQ0FBQyxpQkFBRCxDQUEvQjs7QUFDQSxNQUFNTSxpQkFBTixTQUFnQ0QsZUFBZSxDQUFDRSxhQUFoRCxDQUE4RDtBQUMxREMsRUFBQUEsV0FBVyxDQUFDQyxnQkFBRCxFQUFtQjtBQUMxQixVQUFNLFVBQU4sRUFBa0JWLGtCQUFrQixDQUFDVyxPQUFuQixDQUEyQkMsUUFBN0MsRUFBdURGLGdCQUF2RDtBQUNIOztBQUNERyxFQUFBQSxjQUFjLENBQUNDLFFBQUQsRUFBV0MsT0FBWCxFQUFvQkMsS0FBcEIsRUFBMkJDLEtBQTNCLEVBQWtDO0FBQzVDLFVBQU1DLFNBQVMsR0FBRyxJQUFJZixXQUFXLENBQUNnQixTQUFoQixFQUFsQjtBQUNBLFVBQU1DLFFBQVEsR0FBRyxLQUFLVixnQkFBTCxDQUFzQlcsR0FBdEIsQ0FBMEJuQixPQUFPLENBQUNvQixxQkFBbEMsRUFBeURDLFdBQXpELENBQXFFVCxRQUFRLENBQUNVLEdBQTlFLENBQWpCO0FBQ0EsVUFBTUMsYUFBYSxHQUFHQyxLQUFLLENBQUNDLE9BQU4sQ0FBY1AsUUFBUSxDQUFDUSxVQUFULENBQW9CQyxZQUFsQyxLQUFtRFQsUUFBUSxDQUFDUSxVQUFULENBQW9CQyxZQUFwQixDQUFpQ0MsTUFBakMsR0FBMEMsQ0FBbkg7QUFDQSxVQUFNQyxlQUFlLEdBQUdkLEtBQUssR0FBRyxDQUFDQSxLQUFLLENBQUNlLE9BQVYsR0FBb0IsS0FBakQ7QUFDQSxVQUFNQyxZQUFZLEdBQUcsQ0FBQyxRQUFELENBQXJCOztBQUNBLFFBQUlGLGVBQUosRUFBcUI7QUFDakI7QUFDQUUsTUFBQUEsWUFBWSxDQUFDQyxJQUFiLENBQWtCLEdBQUcsQ0FBQyxjQUFELEVBQWlCLENBQUNqQixLQUFLLENBQUNrQixLQUFOLENBQVlDLElBQVosR0FBbUIsQ0FBcEIsRUFBdUJDLFFBQXZCLEVBQWpCLEVBQW9ELENBQUNwQixLQUFLLENBQUNxQixHQUFOLENBQVVGLElBQVYsR0FBaUIsQ0FBbEIsRUFBcUJDLFFBQXJCLEVBQXBELENBQXJCO0FBQ0g7O0FBQ0QsVUFBTUUsT0FBTyxHQUFHLE1BQU1DLDhCQUFOLENBQXFDMUIsUUFBckMsRUFBK0NDLE9BQS9DLEVBQXdEQyxLQUF4RCxFQUErRGlCLFlBQS9ELENBQWhCO0FBQ0E3QixJQUFBQSxXQUFXLENBQUNxQyxxQkFBWixDQUFrQ3BDLFdBQVcsQ0FBQ3FDLE1BQTlDLEVBQXNESCxPQUF0RCxFQUErRHJCLFNBQS9ELEVBQTBFO0FBQUV5QixNQUFBQSxJQUFJLEVBQUUsVUFBUjtBQUFvQmxCLE1BQUFBLGFBQXBCO0FBQW1DTSxNQUFBQTtBQUFuQyxLQUExRTtBQUNBLFdBQU9RLE9BQVA7QUFDSDs7QUFqQnlEOztBQW1COUR6QyxPQUFPLENBQUNTLGlCQUFSLEdBQTRCQSxpQkFBNUIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IHByb2R1Y3RJbnN0YWxsZXJfMSA9IHJlcXVpcmUoXCIuLi9jb21tb24vaW5zdGFsbGVyL3Byb2R1Y3RJbnN0YWxsZXJcIik7XG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uL2NvbW1vbi90eXBlc1wiKTtcbmNvbnN0IHN0b3BXYXRjaF8xID0gcmVxdWlyZShcIi4uL2NvbW1vbi91dGlscy9zdG9wV2F0Y2hcIik7XG5jb25zdCB0ZWxlbWV0cnlfMSA9IHJlcXVpcmUoXCIuLi90ZWxlbWV0cnlcIik7XG5jb25zdCBjb25zdGFudHNfMSA9IHJlcXVpcmUoXCIuLi90ZWxlbWV0cnkvY29uc3RhbnRzXCIpO1xuY29uc3QgYmFzZUZvcm1hdHRlcl8xID0gcmVxdWlyZShcIi4vYmFzZUZvcm1hdHRlclwiKTtcbmNsYXNzIEF1dG9QZXA4Rm9ybWF0dGVyIGV4dGVuZHMgYmFzZUZvcm1hdHRlcl8xLkJhc2VGb3JtYXR0ZXIge1xuICAgIGNvbnN0cnVjdG9yKHNlcnZpY2VDb250YWluZXIpIHtcbiAgICAgICAgc3VwZXIoJ2F1dG9wZXA4JywgcHJvZHVjdEluc3RhbGxlcl8xLlByb2R1Y3QuYXV0b3BlcDgsIHNlcnZpY2VDb250YWluZXIpO1xuICAgIH1cbiAgICBmb3JtYXREb2N1bWVudChkb2N1bWVudCwgb3B0aW9ucywgdG9rZW4sIHJhbmdlKSB7XG4gICAgICAgIGNvbnN0IHN0b3BXYXRjaCA9IG5ldyBzdG9wV2F0Y2hfMS5TdG9wV2F0Y2goKTtcbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSB0aGlzLnNlcnZpY2VDb250YWluZXIuZ2V0KHR5cGVzXzEuSUNvbmZpZ3VyYXRpb25TZXJ2aWNlKS5nZXRTZXR0aW5ncyhkb2N1bWVudC51cmkpO1xuICAgICAgICBjb25zdCBoYXNDdXN0b21BcmdzID0gQXJyYXkuaXNBcnJheShzZXR0aW5ncy5mb3JtYXR0aW5nLmF1dG9wZXA4QXJncykgJiYgc2V0dGluZ3MuZm9ybWF0dGluZy5hdXRvcGVwOEFyZ3MubGVuZ3RoID4gMDtcbiAgICAgICAgY29uc3QgZm9ybWF0U2VsZWN0aW9uID0gcmFuZ2UgPyAhcmFuZ2UuaXNFbXB0eSA6IGZhbHNlO1xuICAgICAgICBjb25zdCBhdXRvUGVwOEFyZ3MgPSBbJy0tZGlmZiddO1xuICAgICAgICBpZiAoZm9ybWF0U2VsZWN0aW9uKSB7XG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgICAgICAgICBhdXRvUGVwOEFyZ3MucHVzaCguLi5bJy0tbGluZS1yYW5nZScsIChyYW5nZS5zdGFydC5saW5lICsgMSkudG9TdHJpbmcoKSwgKHJhbmdlLmVuZC5saW5lICsgMSkudG9TdHJpbmcoKV0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHByb21pc2UgPSBzdXBlci5wcm92aWRlRG9jdW1lbnRGb3JtYXR0aW5nRWRpdHMoZG9jdW1lbnQsIG9wdGlvbnMsIHRva2VuLCBhdXRvUGVwOEFyZ3MpO1xuICAgICAgICB0ZWxlbWV0cnlfMS5zZW5kVGVsZW1ldHJ5V2hlbkRvbmUoY29uc3RhbnRzXzEuRk9STUFULCBwcm9taXNlLCBzdG9wV2F0Y2gsIHsgdG9vbDogJ2F1dG9wZXA4JywgaGFzQ3VzdG9tQXJncywgZm9ybWF0U2VsZWN0aW9uIH0pO1xuICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICB9XG59XG5leHBvcnRzLkF1dG9QZXA4Rm9ybWF0dGVyID0gQXV0b1BlcDhGb3JtYXR0ZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hdXRvUGVwOEZvcm1hdHRlci5qcy5tYXAiXX0=
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

const net_1 = require("net");

const BaseDebugServer_1 = require("./BaseDebugServer");

class RemoteDebugServerV2 extends BaseDebugServer_1.BaseDebugServer {
  constructor(debugSession, args) {
    super(debugSession);
    this.args = args;
  }

  Stop() {
    if (this.socket) {
      this.socket.destroy();
    }
  }

  Start() {
    return new Promise((resolve, reject) => {
      const port = this.args.port;
      const options = {
        port
      };

      if (typeof this.args.host === 'string' && this.args.host.length > 0) {
        // tslint:disable-next-line:no-any
        options.host = this.args.host;
      }

      try {
        let connected = false;
        const socket = new net_1.Socket();
        socket.on('error', ex => {
          if (connected) {
            return;
          }

          reject(ex);
        });
        socket.connect(options, () => {
          connected = true;
          this.socket = socket;
          this.clientSocket.resolve(socket);
          resolve(options);
        });
      } catch (ex) {
        reject(ex);
      }
    });
  }

}

exports.RemoteDebugServerV2 = RemoteDebugServerV2;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlJlbW90ZURlYnVnU2VydmVydjIuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJuZXRfMSIsInJlcXVpcmUiLCJCYXNlRGVidWdTZXJ2ZXJfMSIsIlJlbW90ZURlYnVnU2VydmVyVjIiLCJCYXNlRGVidWdTZXJ2ZXIiLCJjb25zdHJ1Y3RvciIsImRlYnVnU2Vzc2lvbiIsImFyZ3MiLCJTdG9wIiwic29ja2V0IiwiZGVzdHJveSIsIlN0YXJ0IiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJwb3J0Iiwib3B0aW9ucyIsImhvc3QiLCJsZW5ndGgiLCJjb25uZWN0ZWQiLCJTb2NrZXQiLCJvbiIsImV4IiwiY29ubmVjdCIsImNsaWVudFNvY2tldCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUNBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQUVDLEVBQUFBLEtBQUssRUFBRTtBQUFULENBQTdDOztBQUNBLE1BQU1DLEtBQUssR0FBR0MsT0FBTyxDQUFDLEtBQUQsQ0FBckI7O0FBQ0EsTUFBTUMsaUJBQWlCLEdBQUdELE9BQU8sQ0FBQyxtQkFBRCxDQUFqQzs7QUFDQSxNQUFNRSxtQkFBTixTQUFrQ0QsaUJBQWlCLENBQUNFLGVBQXBELENBQW9FO0FBQ2hFQyxFQUFBQSxXQUFXLENBQUNDLFlBQUQsRUFBZUMsSUFBZixFQUFxQjtBQUM1QixVQUFNRCxZQUFOO0FBQ0EsU0FBS0MsSUFBTCxHQUFZQSxJQUFaO0FBQ0g7O0FBQ0RDLEVBQUFBLElBQUksR0FBRztBQUNILFFBQUksS0FBS0MsTUFBVCxFQUFpQjtBQUNiLFdBQUtBLE1BQUwsQ0FBWUMsT0FBWjtBQUNIO0FBQ0o7O0FBQ0RDLEVBQUFBLEtBQUssR0FBRztBQUNKLFdBQU8sSUFBSUMsT0FBSixDQUFZLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUNwQyxZQUFNQyxJQUFJLEdBQUcsS0FBS1IsSUFBTCxDQUFVUSxJQUF2QjtBQUNBLFlBQU1DLE9BQU8sR0FBRztBQUFFRCxRQUFBQTtBQUFGLE9BQWhCOztBQUNBLFVBQUksT0FBTyxLQUFLUixJQUFMLENBQVVVLElBQWpCLEtBQTBCLFFBQTFCLElBQXNDLEtBQUtWLElBQUwsQ0FBVVUsSUFBVixDQUFlQyxNQUFmLEdBQXdCLENBQWxFLEVBQXFFO0FBQ2pFO0FBQ0FGLFFBQUFBLE9BQU8sQ0FBQ0MsSUFBUixHQUFlLEtBQUtWLElBQUwsQ0FBVVUsSUFBekI7QUFDSDs7QUFDRCxVQUFJO0FBQ0EsWUFBSUUsU0FBUyxHQUFHLEtBQWhCO0FBQ0EsY0FBTVYsTUFBTSxHQUFHLElBQUlULEtBQUssQ0FBQ29CLE1BQVYsRUFBZjtBQUNBWCxRQUFBQSxNQUFNLENBQUNZLEVBQVAsQ0FBVSxPQUFWLEVBQW1CQyxFQUFFLElBQUk7QUFDckIsY0FBSUgsU0FBSixFQUFlO0FBQ1g7QUFDSDs7QUFDREwsVUFBQUEsTUFBTSxDQUFDUSxFQUFELENBQU47QUFDSCxTQUxEO0FBTUFiLFFBQUFBLE1BQU0sQ0FBQ2MsT0FBUCxDQUFlUCxPQUFmLEVBQXdCLE1BQU07QUFDMUJHLFVBQUFBLFNBQVMsR0FBRyxJQUFaO0FBQ0EsZUFBS1YsTUFBTCxHQUFjQSxNQUFkO0FBQ0EsZUFBS2UsWUFBTCxDQUFrQlgsT0FBbEIsQ0FBMEJKLE1BQTFCO0FBQ0FJLFVBQUFBLE9BQU8sQ0FBQ0csT0FBRCxDQUFQO0FBQ0gsU0FMRDtBQU1ILE9BZkQsQ0FnQkEsT0FBT00sRUFBUCxFQUFXO0FBQ1BSLFFBQUFBLE1BQU0sQ0FBQ1EsRUFBRCxDQUFOO0FBQ0g7QUFDSixLQTFCTSxDQUFQO0FBMkJIOztBQXRDK0Q7O0FBd0NwRXhCLE9BQU8sQ0FBQ0ssbUJBQVIsR0FBOEJBLG1CQUE5QiIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxuJ3VzZSBzdHJpY3QnO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgbmV0XzEgPSByZXF1aXJlKFwibmV0XCIpO1xuY29uc3QgQmFzZURlYnVnU2VydmVyXzEgPSByZXF1aXJlKFwiLi9CYXNlRGVidWdTZXJ2ZXJcIik7XG5jbGFzcyBSZW1vdGVEZWJ1Z1NlcnZlclYyIGV4dGVuZHMgQmFzZURlYnVnU2VydmVyXzEuQmFzZURlYnVnU2VydmVyIHtcbiAgICBjb25zdHJ1Y3RvcihkZWJ1Z1Nlc3Npb24sIGFyZ3MpIHtcbiAgICAgICAgc3VwZXIoZGVidWdTZXNzaW9uKTtcbiAgICAgICAgdGhpcy5hcmdzID0gYXJncztcbiAgICB9XG4gICAgU3RvcCgpIHtcbiAgICAgICAgaWYgKHRoaXMuc29ja2V0KSB7XG4gICAgICAgICAgICB0aGlzLnNvY2tldC5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgU3RhcnQoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBwb3J0ID0gdGhpcy5hcmdzLnBvcnQ7XG4gICAgICAgICAgICBjb25zdCBvcHRpb25zID0geyBwb3J0IH07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMuYXJncy5ob3N0ID09PSAnc3RyaW5nJyAmJiB0aGlzLmFyZ3MuaG9zdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWFueVxuICAgICAgICAgICAgICAgIG9wdGlvbnMuaG9zdCA9IHRoaXMuYXJncy5ob3N0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBsZXQgY29ubmVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgY29uc3Qgc29ja2V0ID0gbmV3IG5ldF8xLlNvY2tldCgpO1xuICAgICAgICAgICAgICAgIHNvY2tldC5vbignZXJyb3InLCBleCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25uZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHNvY2tldC5jb25uZWN0KG9wdGlvbnMsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zb2NrZXQgPSBzb2NrZXQ7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xpZW50U29ja2V0LnJlc29sdmUoc29ja2V0KTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvcHRpb25zKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChleCkge1xuICAgICAgICAgICAgICAgIHJlamVjdChleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydHMuUmVtb3RlRGVidWdTZXJ2ZXJWMiA9IFJlbW90ZURlYnVnU2VydmVyVjI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1SZW1vdGVEZWJ1Z1NlcnZlcnYyLmpzLm1hcCJdfQ==
"use strict";

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const types_1 = require("../../common/process/types");

const types_2 = require("../types");

const baseErrorHandler_1 = require("./baseErrorHandler");

class NotInstalledErrorHandler extends baseErrorHandler_1.BaseErrorHandler {
  constructor(product, outputChannel, serviceContainer) {
    super(product, outputChannel, serviceContainer);
  }

  handleError(error, resource, execInfo) {
    return __awaiter(this, void 0, void 0, function* () {
      const pythonExecutionService = yield this.serviceContainer.get(types_1.IPythonExecutionFactory).create({
        resource
      });
      const isModuleInstalled = yield pythonExecutionService.isModuleInstalled(execInfo.moduleName);

      if (isModuleInstalled) {
        return this.nextHandler ? this.nextHandler.handleError(error, resource, execInfo) : false;
      }

      this.installer.promptToInstall(this.product, resource).catch(this.logger.logError.bind(this, 'NotInstalledErrorHandler.promptToInstall'));
      const linterManager = this.serviceContainer.get(types_2.ILinterManager);
      const info = linterManager.getLinterInfo(execInfo.product);
      const customError = `Linter '${info.id}' is not installed. Please install it or select another linter".`;
      this.outputChannel.appendLine(`\n${customError}\n${error}`);
      this.logger.logWarning(customError, error);
      return true;
    });
  }

}

exports.NotInstalledErrorHandler = NotInstalledErrorHandler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vdEluc3RhbGxlZC5qcyJdLCJuYW1lcyI6WyJfX2F3YWl0ZXIiLCJ0aGlzQXJnIiwiX2FyZ3VtZW50cyIsIlAiLCJnZW5lcmF0b3IiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZ1bGZpbGxlZCIsInZhbHVlIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidHlwZXNfMSIsInJlcXVpcmUiLCJ0eXBlc18yIiwiYmFzZUVycm9ySGFuZGxlcl8xIiwiTm90SW5zdGFsbGVkRXJyb3JIYW5kbGVyIiwiQmFzZUVycm9ySGFuZGxlciIsImNvbnN0cnVjdG9yIiwicHJvZHVjdCIsIm91dHB1dENoYW5uZWwiLCJzZXJ2aWNlQ29udGFpbmVyIiwiaGFuZGxlRXJyb3IiLCJlcnJvciIsInJlc291cmNlIiwiZXhlY0luZm8iLCJweXRob25FeGVjdXRpb25TZXJ2aWNlIiwiZ2V0IiwiSVB5dGhvbkV4ZWN1dGlvbkZhY3RvcnkiLCJjcmVhdGUiLCJpc01vZHVsZUluc3RhbGxlZCIsIm1vZHVsZU5hbWUiLCJuZXh0SGFuZGxlciIsImluc3RhbGxlciIsInByb21wdFRvSW5zdGFsbCIsImNhdGNoIiwibG9nZ2VyIiwibG9nRXJyb3IiLCJiaW5kIiwibGludGVyTWFuYWdlciIsIklMaW50ZXJNYW5hZ2VyIiwiaW5mbyIsImdldExpbnRlckluZm8iLCJjdXN0b21FcnJvciIsImlkIiwiYXBwZW5kTGluZSIsImxvZ1dhcm5pbmciXSwibWFwcGluZ3MiOiJBQUFBOztBQUNBLElBQUlBLFNBQVMsR0FBSSxVQUFRLFNBQUtBLFNBQWQsSUFBNEIsVUFBVUMsT0FBVixFQUFtQkMsVUFBbkIsRUFBK0JDLENBQS9CLEVBQWtDQyxTQUFsQyxFQUE2QztBQUNyRixTQUFPLEtBQUtELENBQUMsS0FBS0EsQ0FBQyxHQUFHRSxPQUFULENBQU4sRUFBeUIsVUFBVUMsT0FBVixFQUFtQkMsTUFBbkIsRUFBMkI7QUFDdkQsYUFBU0MsU0FBVCxDQUFtQkMsS0FBbkIsRUFBMEI7QUFBRSxVQUFJO0FBQUVDLFFBQUFBLElBQUksQ0FBQ04sU0FBUyxDQUFDTyxJQUFWLENBQWVGLEtBQWYsQ0FBRCxDQUFKO0FBQThCLE9BQXBDLENBQXFDLE9BQU9HLENBQVAsRUFBVTtBQUFFTCxRQUFBQSxNQUFNLENBQUNLLENBQUQsQ0FBTjtBQUFZO0FBQUU7O0FBQzNGLGFBQVNDLFFBQVQsQ0FBa0JKLEtBQWxCLEVBQXlCO0FBQUUsVUFBSTtBQUFFQyxRQUFBQSxJQUFJLENBQUNOLFNBQVMsQ0FBQyxPQUFELENBQVQsQ0FBbUJLLEtBQW5CLENBQUQsQ0FBSjtBQUFrQyxPQUF4QyxDQUF5QyxPQUFPRyxDQUFQLEVBQVU7QUFBRUwsUUFBQUEsTUFBTSxDQUFDSyxDQUFELENBQU47QUFBWTtBQUFFOztBQUM5RixhQUFTRixJQUFULENBQWNJLE1BQWQsRUFBc0I7QUFBRUEsTUFBQUEsTUFBTSxDQUFDQyxJQUFQLEdBQWNULE9BQU8sQ0FBQ1EsTUFBTSxDQUFDTCxLQUFSLENBQXJCLEdBQXNDLElBQUlOLENBQUosQ0FBTSxVQUFVRyxPQUFWLEVBQW1CO0FBQUVBLFFBQUFBLE9BQU8sQ0FBQ1EsTUFBTSxDQUFDTCxLQUFSLENBQVA7QUFBd0IsT0FBbkQsRUFBcURPLElBQXJELENBQTBEUixTQUExRCxFQUFxRUssUUFBckUsQ0FBdEM7QUFBdUg7O0FBQy9JSCxJQUFBQSxJQUFJLENBQUMsQ0FBQ04sU0FBUyxHQUFHQSxTQUFTLENBQUNhLEtBQVYsQ0FBZ0JoQixPQUFoQixFQUF5QkMsVUFBVSxJQUFJLEVBQXZDLENBQWIsRUFBeURTLElBQXpELEVBQUQsQ0FBSjtBQUNILEdBTE0sQ0FBUDtBQU1ILENBUEQ7O0FBUUFPLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFBRVgsRUFBQUEsS0FBSyxFQUFFO0FBQVQsQ0FBN0M7O0FBQ0EsTUFBTVksT0FBTyxHQUFHQyxPQUFPLENBQUMsNEJBQUQsQ0FBdkI7O0FBQ0EsTUFBTUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsVUFBRCxDQUF2Qjs7QUFDQSxNQUFNRSxrQkFBa0IsR0FBR0YsT0FBTyxDQUFDLG9CQUFELENBQWxDOztBQUNBLE1BQU1HLHdCQUFOLFNBQXVDRCxrQkFBa0IsQ0FBQ0UsZ0JBQTFELENBQTJFO0FBQ3ZFQyxFQUFBQSxXQUFXLENBQUNDLE9BQUQsRUFBVUMsYUFBVixFQUF5QkMsZ0JBQXpCLEVBQTJDO0FBQ2xELFVBQU1GLE9BQU4sRUFBZUMsYUFBZixFQUE4QkMsZ0JBQTlCO0FBQ0g7O0FBQ0RDLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFRQyxRQUFSLEVBQWtCQyxRQUFsQixFQUE0QjtBQUNuQyxXQUFPbEMsU0FBUyxDQUFDLElBQUQsRUFBTyxLQUFLLENBQVosRUFBZSxLQUFLLENBQXBCLEVBQXVCLGFBQWE7QUFDaEQsWUFBTW1DLHNCQUFzQixHQUFHLE1BQU0sS0FBS0wsZ0JBQUwsQ0FBc0JNLEdBQXRCLENBQTBCZixPQUFPLENBQUNnQix1QkFBbEMsRUFBMkRDLE1BQTNELENBQWtFO0FBQUVMLFFBQUFBO0FBQUYsT0FBbEUsQ0FBckM7QUFDQSxZQUFNTSxpQkFBaUIsR0FBRyxNQUFNSixzQkFBc0IsQ0FBQ0ksaUJBQXZCLENBQXlDTCxRQUFRLENBQUNNLFVBQWxELENBQWhDOztBQUNBLFVBQUlELGlCQUFKLEVBQXVCO0FBQ25CLGVBQU8sS0FBS0UsV0FBTCxHQUFtQixLQUFLQSxXQUFMLENBQWlCVixXQUFqQixDQUE2QkMsS0FBN0IsRUFBb0NDLFFBQXBDLEVBQThDQyxRQUE5QyxDQUFuQixHQUE2RSxLQUFwRjtBQUNIOztBQUNELFdBQUtRLFNBQUwsQ0FBZUMsZUFBZixDQUErQixLQUFLZixPQUFwQyxFQUE2Q0ssUUFBN0MsRUFDS1csS0FETCxDQUNXLEtBQUtDLE1BQUwsQ0FBWUMsUUFBWixDQUFxQkMsSUFBckIsQ0FBMEIsSUFBMUIsRUFBZ0MsMENBQWhDLENBRFg7QUFFQSxZQUFNQyxhQUFhLEdBQUcsS0FBS2xCLGdCQUFMLENBQXNCTSxHQUF0QixDQUEwQmIsT0FBTyxDQUFDMEIsY0FBbEMsQ0FBdEI7QUFDQSxZQUFNQyxJQUFJLEdBQUdGLGFBQWEsQ0FBQ0csYUFBZCxDQUE0QmpCLFFBQVEsQ0FBQ04sT0FBckMsQ0FBYjtBQUNBLFlBQU13QixXQUFXLEdBQUksV0FBVUYsSUFBSSxDQUFDRyxFQUFHLGtFQUF2QztBQUNBLFdBQUt4QixhQUFMLENBQW1CeUIsVUFBbkIsQ0FBK0IsS0FBSUYsV0FBWSxLQUFJcEIsS0FBTSxFQUF6RDtBQUNBLFdBQUthLE1BQUwsQ0FBWVUsVUFBWixDQUF1QkgsV0FBdkIsRUFBb0NwQixLQUFwQztBQUNBLGFBQU8sSUFBUDtBQUNILEtBZGUsQ0FBaEI7QUFlSDs7QUFwQnNFOztBQXNCM0VaLE9BQU8sQ0FBQ0ssd0JBQVIsR0FBbUNBLHdCQUFuQyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9wcm9jZXNzL3R5cGVzXCIpO1xuY29uc3QgdHlwZXNfMiA9IHJlcXVpcmUoXCIuLi90eXBlc1wiKTtcbmNvbnN0IGJhc2VFcnJvckhhbmRsZXJfMSA9IHJlcXVpcmUoXCIuL2Jhc2VFcnJvckhhbmRsZXJcIik7XG5jbGFzcyBOb3RJbnN0YWxsZWRFcnJvckhhbmRsZXIgZXh0ZW5kcyBiYXNlRXJyb3JIYW5kbGVyXzEuQmFzZUVycm9ySGFuZGxlciB7XG4gICAgY29uc3RydWN0b3IocHJvZHVjdCwgb3V0cHV0Q2hhbm5lbCwgc2VydmljZUNvbnRhaW5lcikge1xuICAgICAgICBzdXBlcihwcm9kdWN0LCBvdXRwdXRDaGFubmVsLCBzZXJ2aWNlQ29udGFpbmVyKTtcbiAgICB9XG4gICAgaGFuZGxlRXJyb3IoZXJyb3IsIHJlc291cmNlLCBleGVjSW5mbykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgcHl0aG9uRXhlY3V0aW9uU2VydmljZSA9IHlpZWxkIHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMS5JUHl0aG9uRXhlY3V0aW9uRmFjdG9yeSkuY3JlYXRlKHsgcmVzb3VyY2UgfSk7XG4gICAgICAgICAgICBjb25zdCBpc01vZHVsZUluc3RhbGxlZCA9IHlpZWxkIHB5dGhvbkV4ZWN1dGlvblNlcnZpY2UuaXNNb2R1bGVJbnN0YWxsZWQoZXhlY0luZm8ubW9kdWxlTmFtZSk7XG4gICAgICAgICAgICBpZiAoaXNNb2R1bGVJbnN0YWxsZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0SGFuZGxlciA/IHRoaXMubmV4dEhhbmRsZXIuaGFuZGxlRXJyb3IoZXJyb3IsIHJlc291cmNlLCBleGVjSW5mbykgOiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuaW5zdGFsbGVyLnByb21wdFRvSW5zdGFsbCh0aGlzLnByb2R1Y3QsIHJlc291cmNlKVxuICAgICAgICAgICAgICAgIC5jYXRjaCh0aGlzLmxvZ2dlci5sb2dFcnJvci5iaW5kKHRoaXMsICdOb3RJbnN0YWxsZWRFcnJvckhhbmRsZXIucHJvbXB0VG9JbnN0YWxsJykpO1xuICAgICAgICAgICAgY29uc3QgbGludGVyTWFuYWdlciA9IHRoaXMuc2VydmljZUNvbnRhaW5lci5nZXQodHlwZXNfMi5JTGludGVyTWFuYWdlcik7XG4gICAgICAgICAgICBjb25zdCBpbmZvID0gbGludGVyTWFuYWdlci5nZXRMaW50ZXJJbmZvKGV4ZWNJbmZvLnByb2R1Y3QpO1xuICAgICAgICAgICAgY29uc3QgY3VzdG9tRXJyb3IgPSBgTGludGVyICcke2luZm8uaWR9JyBpcyBub3QgaW5zdGFsbGVkLiBQbGVhc2UgaW5zdGFsbCBpdCBvciBzZWxlY3QgYW5vdGhlciBsaW50ZXJcIi5gO1xuICAgICAgICAgICAgdGhpcy5vdXRwdXRDaGFubmVsLmFwcGVuZExpbmUoYFxcbiR7Y3VzdG9tRXJyb3J9XFxuJHtlcnJvcn1gKTtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZ1dhcm5pbmcoY3VzdG9tRXJyb3IsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLk5vdEluc3RhbGxlZEVycm9ySGFuZGxlciA9IE5vdEluc3RhbGxlZEVycm9ySGFuZGxlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW5vdEluc3RhbGxlZC5qcy5tYXAiXX0=
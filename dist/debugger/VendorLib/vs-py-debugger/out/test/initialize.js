"use strict"; // tslint:disable:no-string-literal

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

function __export(m) {
  for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}

Object.defineProperty(exports, "__esModule", {
  value: true
});

const path = require("path");

const vscode = require("vscode");

const configSettings_1 = require("../client/common/configSettings");

const constants_1 = require("../client/common/constants");

const common_1 = require("./common");

__export(require("./constants"));

__export(require("./ciConstants"));

const dummyPythonFile = path.join(__dirname, '..', '..', 'src', 'test', 'pythonFiles', 'dummy.py');
exports.multirootPath = path.join(__dirname, '..', '..', 'src', 'testMultiRootWkspc');
const workspace3Uri = vscode.Uri.file(path.join(exports.multirootPath, 'workspace3')); //First thing to be executed.

process.env['VSC_PYTHON_CI_TEST'] = '1'; // Ability to use custom python environments for testing

function initializePython() {
  return __awaiter(this, void 0, void 0, function* () {
    yield common_1.resetGlobalPythonPathSetting();
    yield common_1.clearPythonPathInWorkspaceFolder(dummyPythonFile);
    yield common_1.clearPythonPathInWorkspaceFolder(workspace3Uri);
    yield common_1.setPythonPathInWorkspaceRoot(common_1.PYTHON_PATH);
  });
}

exports.initializePython = initializePython; // tslint:disable-next-line:no-any

function initialize() {
  return __awaiter(this, void 0, void 0, function* () {
    yield initializePython();
    const api = yield activateExtension(); // Dispose any cached python settings (used only in test env).

    configSettings_1.PythonSettings.dispose(); // tslint:disable-next-line:no-any

    return api;
  });
}

exports.initialize = initialize;

function activateExtension() {
  return __awaiter(this, void 0, void 0, function* () {
    const extension = vscode.extensions.getExtension(constants_1.PVSC_EXTENSION_ID);
    const api = yield extension.activate(); // Wait untill its ready to use.

    yield api.ready;
    return api;
  });
}

exports.activateExtension = activateExtension; // tslint:disable-next-line:no-any

function initializeTest() {
  return __awaiter(this, void 0, void 0, function* () {
    yield initializePython();
    yield closeActiveWindows(); // Dispose any cached python settings (used only in test env).

    configSettings_1.PythonSettings.dispose();
  });
}

exports.initializeTest = initializeTest;

function closeActiveWindows() {
  return __awaiter(this, void 0, void 0, function* () {
    return new Promise((resolve, reject) => {
      vscode.commands.executeCommand('workbench.action.closeAllEditors') // tslint:disable-next-line:no-unnecessary-callback-wrapper
      .then(() => resolve(), reject); // Attempt to fix #1301.
      // Lets not waste too much time.

      setTimeout(() => {
        reject(new Error('Command \'workbench.action.closeAllEditors\' timedout'));
      }, 15000);
    });
  });
}

exports.closeActiveWindows = closeActiveWindows;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluaXRpYWxpemUuanMiXSwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsIl9fZXhwb3J0IiwibSIsInAiLCJleHBvcnRzIiwiaGFzT3duUHJvcGVydHkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsInBhdGgiLCJyZXF1aXJlIiwidnNjb2RlIiwiY29uZmlnU2V0dGluZ3NfMSIsImNvbnN0YW50c18xIiwiY29tbW9uXzEiLCJkdW1teVB5dGhvbkZpbGUiLCJqb2luIiwiX19kaXJuYW1lIiwibXVsdGlyb290UGF0aCIsIndvcmtzcGFjZTNVcmkiLCJVcmkiLCJmaWxlIiwicHJvY2VzcyIsImVudiIsImluaXRpYWxpemVQeXRob24iLCJyZXNldEdsb2JhbFB5dGhvblBhdGhTZXR0aW5nIiwiY2xlYXJQeXRob25QYXRoSW5Xb3Jrc3BhY2VGb2xkZXIiLCJzZXRQeXRob25QYXRoSW5Xb3Jrc3BhY2VSb290IiwiUFlUSE9OX1BBVEgiLCJpbml0aWFsaXplIiwiYXBpIiwiYWN0aXZhdGVFeHRlbnNpb24iLCJQeXRob25TZXR0aW5ncyIsImRpc3Bvc2UiLCJleHRlbnNpb24iLCJleHRlbnNpb25zIiwiZ2V0RXh0ZW5zaW9uIiwiUFZTQ19FWFRFTlNJT05fSUQiLCJhY3RpdmF0ZSIsInJlYWR5IiwiaW5pdGlhbGl6ZVRlc3QiLCJjbG9zZUFjdGl2ZVdpbmRvd3MiLCJjb21tYW5kcyIsImV4ZWN1dGVDb21tYW5kIiwic2V0VGltZW91dCIsIkVycm9yIl0sIm1hcHBpbmdzIjoiQUFBQSxhLENBQ0E7O0FBQ0EsSUFBSUEsU0FBUyxHQUFJLFVBQVEsU0FBS0EsU0FBZCxJQUE0QixVQUFVQyxPQUFWLEVBQW1CQyxV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QyxrQkFBUixHQUE2QkEsa0JBQTdCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG4vLyB0c2xpbnQ6ZGlzYWJsZTpuby1zdHJpbmctbGl0ZXJhbFxudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5mdW5jdGlvbiBfX2V4cG9ydChtKSB7XG4gICAgZm9yICh2YXIgcCBpbiBtKSBpZiAoIWV4cG9ydHMuaGFzT3duUHJvcGVydHkocCkpIGV4cG9ydHNbcF0gPSBtW3BdO1xufVxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xuY29uc3QgdnNjb2RlID0gcmVxdWlyZShcInZzY29kZVwiKTtcbmNvbnN0IGNvbmZpZ1NldHRpbmdzXzEgPSByZXF1aXJlKFwiLi4vY2xpZW50L2NvbW1vbi9jb25maWdTZXR0aW5nc1wiKTtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uL2NsaWVudC9jb21tb24vY29uc3RhbnRzXCIpO1xuY29uc3QgY29tbW9uXzEgPSByZXF1aXJlKFwiLi9jb21tb25cIik7XG5fX2V4cG9ydChyZXF1aXJlKFwiLi9jb25zdGFudHNcIikpO1xuX19leHBvcnQocmVxdWlyZShcIi4vY2lDb25zdGFudHNcIikpO1xuY29uc3QgZHVtbXlQeXRob25GaWxlID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJy4uJywgJ3NyYycsICd0ZXN0JywgJ3B5dGhvbkZpbGVzJywgJ2R1bW15LnB5Jyk7XG5leHBvcnRzLm11bHRpcm9vdFBhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAnLi4nLCAnc3JjJywgJ3Rlc3RNdWx0aVJvb3RXa3NwYycpO1xuY29uc3Qgd29ya3NwYWNlM1VyaSA9IHZzY29kZS5VcmkuZmlsZShwYXRoLmpvaW4oZXhwb3J0cy5tdWx0aXJvb3RQYXRoLCAnd29ya3NwYWNlMycpKTtcbi8vRmlyc3QgdGhpbmcgdG8gYmUgZXhlY3V0ZWQuXG5wcm9jZXNzLmVudlsnVlNDX1BZVEhPTl9DSV9URVNUJ10gPSAnMSc7XG4vLyBBYmlsaXR5IHRvIHVzZSBjdXN0b20gcHl0aG9uIGVudmlyb25tZW50cyBmb3IgdGVzdGluZ1xuZnVuY3Rpb24gaW5pdGlhbGl6ZVB5dGhvbigpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICB5aWVsZCBjb21tb25fMS5yZXNldEdsb2JhbFB5dGhvblBhdGhTZXR0aW5nKCk7XG4gICAgICAgIHlpZWxkIGNvbW1vbl8xLmNsZWFyUHl0aG9uUGF0aEluV29ya3NwYWNlRm9sZGVyKGR1bW15UHl0aG9uRmlsZSk7XG4gICAgICAgIHlpZWxkIGNvbW1vbl8xLmNsZWFyUHl0aG9uUGF0aEluV29ya3NwYWNlRm9sZGVyKHdvcmtzcGFjZTNVcmkpO1xuICAgICAgICB5aWVsZCBjb21tb25fMS5zZXRQeXRob25QYXRoSW5Xb3Jrc3BhY2VSb290KGNvbW1vbl8xLlBZVEhPTl9QQVRIKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuaW5pdGlhbGl6ZVB5dGhvbiA9IGluaXRpYWxpemVQeXRob247XG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tYW55XG5mdW5jdGlvbiBpbml0aWFsaXplKCkge1xuICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgIHlpZWxkIGluaXRpYWxpemVQeXRob24oKTtcbiAgICAgICAgY29uc3QgYXBpID0geWllbGQgYWN0aXZhdGVFeHRlbnNpb24oKTtcbiAgICAgICAgLy8gRGlzcG9zZSBhbnkgY2FjaGVkIHB5dGhvbiBzZXR0aW5ncyAodXNlZCBvbmx5IGluIHRlc3QgZW52KS5cbiAgICAgICAgY29uZmlnU2V0dGluZ3NfMS5QeXRob25TZXR0aW5ncy5kaXNwb3NlKCk7XG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcbiAgICAgICAgcmV0dXJuIGFwaTtcbiAgICB9KTtcbn1cbmV4cG9ydHMuaW5pdGlhbGl6ZSA9IGluaXRpYWxpemU7XG5mdW5jdGlvbiBhY3RpdmF0ZUV4dGVuc2lvbigpIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICBjb25zdCBleHRlbnNpb24gPSB2c2NvZGUuZXh0ZW5zaW9ucy5nZXRFeHRlbnNpb24oY29uc3RhbnRzXzEuUFZTQ19FWFRFTlNJT05fSUQpO1xuICAgICAgICBjb25zdCBhcGkgPSB5aWVsZCBleHRlbnNpb24uYWN0aXZhdGUoKTtcbiAgICAgICAgLy8gV2FpdCB1bnRpbGwgaXRzIHJlYWR5IHRvIHVzZS5cbiAgICAgICAgeWllbGQgYXBpLnJlYWR5O1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5hY3RpdmF0ZUV4dGVuc2lvbiA9IGFjdGl2YXRlRXh0ZW5zaW9uO1xuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWFueVxuZnVuY3Rpb24gaW5pdGlhbGl6ZVRlc3QoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgeWllbGQgaW5pdGlhbGl6ZVB5dGhvbigpO1xuICAgICAgICB5aWVsZCBjbG9zZUFjdGl2ZVdpbmRvd3MoKTtcbiAgICAgICAgLy8gRGlzcG9zZSBhbnkgY2FjaGVkIHB5dGhvbiBzZXR0aW5ncyAodXNlZCBvbmx5IGluIHRlc3QgZW52KS5cbiAgICAgICAgY29uZmlnU2V0dGluZ3NfMS5QeXRob25TZXR0aW5ncy5kaXNwb3NlKCk7XG4gICAgfSk7XG59XG5leHBvcnRzLmluaXRpYWxpemVUZXN0ID0gaW5pdGlhbGl6ZVRlc3Q7XG5mdW5jdGlvbiBjbG9zZUFjdGl2ZVdpbmRvd3MoKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHZzY29kZS5jb21tYW5kcy5leGVjdXRlQ29tbWFuZCgnd29ya2JlbmNoLmFjdGlvbi5jbG9zZUFsbEVkaXRvcnMnKVxuICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby11bm5lY2Vzc2FyeS1jYWxsYmFjay13cmFwcGVyXG4gICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gcmVzb2x2ZSgpLCByZWplY3QpO1xuICAgICAgICAgICAgLy8gQXR0ZW1wdCB0byBmaXggIzEzMDEuXG4gICAgICAgICAgICAvLyBMZXRzIG5vdCB3YXN0ZSB0b28gbXVjaCB0aW1lLlxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignQ29tbWFuZCBcXCd3b3JrYmVuY2guYWN0aW9uLmNsb3NlQWxsRWRpdG9yc1xcJyB0aW1lZG91dCcpKTtcbiAgICAgICAgICAgIH0sIDE1MDAwKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5leHBvcnRzLmNsb3NlQWN0aXZlV2luZG93cyA9IGNsb3NlQWN0aXZlV2luZG93cztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluaXRpYWxpemUuanMubWFwIl19
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var vscUri;

(function (vscUri) {
  const platform = {
    isWindows: /^win/.test(process.platform)
  }; // tslint:disable:all

  function _encode(ch) {
    return '%' + ch.charCodeAt(0).toString(16).toUpperCase();
  } // see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent


  function encodeURIComponent2(str) {
    return encodeURIComponent(str).replace(/[!'()*]/g, _encode);
  }

  function encodeNoop(str) {
    return str.replace(/[#?]/, _encode);
  }

  const _schemePattern = /^\w[\w\d+.-]*$/;
  const _singleSlashStart = /^\//;
  const _doubleSlashStart = /^\/\//;

  function _validateUri(ret) {
    // scheme, https://tools.ietf.org/html/rfc3986#section-3.1
    // ALPHA *( ALPHA / DIGIT / "+" / "-" / "." )
    if (ret.scheme && !_schemePattern.test(ret.scheme)) {
      throw new Error('[UriError]: Scheme contains illegal characters.');
    } // path, http://tools.ietf.org/html/rfc3986#section-3.3
    // If a URI contains an authority component, then the path component
    // must either be empty or begin with a slash ("/") character.  If a URI
    // does not contain an authority component, then the path cannot begin
    // with two slash characters ("//").


    if (ret.path) {
      if (ret.authority) {
        if (!_singleSlashStart.test(ret.path)) {
          throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character');
        }
      } else {
        if (_doubleSlashStart.test(ret.path)) {
          throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")');
        }
      }
    }
  }

  const _empty = '';
  const _slash = '/';
  const _regexp = /^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;
  const _driveLetterPath = /^\/[a-zA-Z]:/;
  const _upperCaseDrive = /^(\/)?([A-Z]:)/;
  const _driveLetter = /^[a-zA-Z]:/;
  /**
   * Uniform Resource Identifier (URI) http://tools.ietf.org/html/rfc3986.
   * This class is a simple parser which creates the basic component paths
   * (http://tools.ietf.org/html/rfc3986#section-3) with minimal validation
   * and encoding.
   *
   *       foo://example.com:8042/over/there?name=ferret#nose
   *       \_/   \______________/\_________/ \_________/ \__/
   *        |           |            |            |        |
   *     scheme     authority       path        query   fragment
   *        |   _____________________|__
   *       / \ /                        \
   *       urn:example:animal:ferret:nose
   *
   *
   */

  class URI {
    /**
     * @internal
     */
    constructor(schemeOrData, authority, path, query, fragment) {
      if (typeof schemeOrData === 'object') {
        this.scheme = schemeOrData.scheme || _empty;
        this.authority = schemeOrData.authority || _empty;
        this.path = schemeOrData.path || _empty;
        this.query = schemeOrData.query || _empty;
        this.fragment = schemeOrData.fragment || _empty; // no validation because it's this URI
        // that creates uri components.
        // _validateUri(this);
      } else {
        this.scheme = schemeOrData || _empty;
        this.authority = authority || _empty;
        this.path = path || _empty;
        this.query = query || _empty;
        this.fragment = fragment || _empty;

        _validateUri(this);
      }
    }

    static isUri(thing) {
      if (thing instanceof URI) {
        return true;
      }

      if (!thing) {
        return false;
      }

      return typeof thing.authority === 'string' && typeof thing.fragment === 'string' && typeof thing.path === 'string' && typeof thing.query === 'string' && typeof thing.scheme === 'string';
    } // ---- filesystem path -----------------------

    /**
     * Returns a string representing the corresponding file system path of this URI.
     * Will handle UNC paths and normalize windows drive letters to lower-case. Also
     * uses the platform specific path separator. Will *not* validate the path for
     * invalid characters and semantics. Will *not* look at the scheme of this URI.
     */


    get fsPath() {
      return _makeFsPath(this);
    } // ---- modify to new -------------------------


    with(change) {
      if (!change) {
        return this;
      }

      let {
        scheme,
        authority,
        path,
        query,
        fragment
      } = change;

      if (scheme === void 0) {
        scheme = this.scheme;
      } else if (scheme === null) {
        scheme = _empty;
      }

      if (authority === void 0) {
        authority = this.authority;
      } else if (authority === null) {
        authority = _empty;
      }

      if (path === void 0) {
        path = this.path;
      } else if (path === null) {
        path = _empty;
      }

      if (query === void 0) {
        query = this.query;
      } else if (query === null) {
        query = _empty;
      }

      if (fragment === void 0) {
        fragment = this.fragment;
      } else if (fragment === null) {
        fragment = _empty;
      }

      if (scheme === this.scheme && authority === this.authority && path === this.path && query === this.query && fragment === this.fragment) {
        return this;
      }

      return new _URI(scheme, authority, path, query, fragment);
    } // ---- parse & validate ------------------------


    static parse(value) {
      const match = _regexp.exec(value);

      if (!match) {
        return new _URI(_empty, _empty, _empty, _empty, _empty);
      }

      return new _URI(match[2] || _empty, decodeURIComponent(match[4] || _empty), decodeURIComponent(match[5] || _empty), decodeURIComponent(match[7] || _empty), decodeURIComponent(match[9] || _empty));
    }

    static file(path) {
      let authority = _empty; // normalize to fwd-slashes on windows,
      // on other systems bwd-slashes are valid
      // filename character, eg /f\oo/ba\r.txt

      if (platform.isWindows) {
        path = path.replace(/\\/g, _slash);
      } // check for authority as used in UNC shares
      // or use the path as given


      if (path[0] === _slash && path[1] === _slash) {
        let idx = path.indexOf(_slash, 2);

        if (idx === -1) {
          authority = path.substring(2);
          path = _slash;
        } else {
          authority = path.substring(2, idx);
          path = path.substring(idx) || _slash;
        }
      } // Ensure that path starts with a slash
      // or that it is at least a slash


      if (_driveLetter.test(path)) {
        path = _slash + path;
      } else if (path[0] !== _slash) {
        // tricky -> makes invalid paths
        // but otherwise we have to stop
        // allowing relative paths...
        path = _slash + path;
      }

      return new _URI('file', authority, path, _empty, _empty);
    }

    static from(components) {
      return new _URI(components.scheme, components.authority, components.path, components.query, components.fragment);
    } // ---- printing/externalize ---------------------------

    /**
     *
     * @param skipEncoding Do not encode the result, default is `false`
     */


    toString(skipEncoding = false) {
      return _asFormatted(this, skipEncoding);
    }

    toJSON() {
      const res = {
        $mid: 1,
        fsPath: this.fsPath,
        external: this.toString()
      };

      if (this.path) {
        res.path = this.path;
      }

      if (this.scheme) {
        res.scheme = this.scheme;
      }

      if (this.authority) {
        res.authority = this.authority;
      }

      if (this.query) {
        res.query = this.query;
      }

      if (this.fragment) {
        res.fragment = this.fragment;
      }

      return res;
    }

    static revive(data) {
      if (!data) {
        return data;
      } else if (data instanceof URI) {
        return data;
      } else {
        let result = new _URI(data);
        result._fsPath = data.fsPath;
        result._formatted = data.external;
        return result;
      }
    }

  }

  vscUri.URI = URI; // tslint:disable-next-line:class-name

  class _URI extends URI {
    constructor() {
      super(...arguments);
      this._formatted = null;
      this._fsPath = null;
    }

    get fsPath() {
      if (!this._fsPath) {
        this._fsPath = _makeFsPath(this);
      }

      return this._fsPath;
    }

    toString(skipEncoding = false) {
      if (!skipEncoding) {
        if (!this._formatted) {
          this._formatted = _asFormatted(this, false);
        }

        return this._formatted;
      } else {
        // we don't cache that
        return _asFormatted(this, true);
      }
    }

  }
  /**
   * Compute `fsPath` for the given uri
   * @param uri
   */


  function _makeFsPath(uri) {
    let value;

    if (uri.authority && uri.path && uri.scheme === 'file') {
      // unc path: file://shares/c$/far/boo
      value = `//${uri.authority}${uri.path}`;
    } else if (_driveLetterPath.test(uri.path)) {
      // windows drive letter: file:///c:/far/boo
      value = uri.path[1].toLowerCase() + uri.path.substr(2);
    } else {
      // other path
      value = uri.path;
    }

    if (platform.isWindows) {
      value = value.replace(/\//g, '\\');
    }

    return value;
  }
  /**
   * Create the external version of a uri
   */


  function _asFormatted(uri, skipEncoding) {
    const encoder = !skipEncoding ? encodeURIComponent2 : encodeNoop;
    const parts = [];
    let {
      scheme,
      authority,
      path,
      query,
      fragment
    } = uri;

    if (scheme) {
      parts.push(scheme, ':');
    }

    if (authority || scheme === 'file') {
      parts.push('//');
    }

    if (authority) {
      let idx = authority.indexOf('@');

      if (idx !== -1) {
        const userinfo = authority.substr(0, idx);
        authority = authority.substr(idx + 1);
        idx = userinfo.indexOf(':');

        if (idx === -1) {
          parts.push(encoder(userinfo));
        } else {
          parts.push(encoder(userinfo.substr(0, idx)), ':', encoder(userinfo.substr(idx + 1)));
        }

        parts.push('@');
      }

      authority = authority.toLowerCase();
      idx = authority.indexOf(':');

      if (idx === -1) {
        parts.push(encoder(authority));
      } else {
        parts.push(encoder(authority.substr(0, idx)), authority.substr(idx));
      }
    }

    if (path) {
      // lower-case windows drive letters in /C:/fff or C:/fff
      const m = _upperCaseDrive.exec(path);

      if (m) {
        if (m[1]) {
          path = '/' + m[2].toLowerCase() + path.substr(3); // "/c:".length === 3
        } else {
          path = m[2].toLowerCase() + path.substr(2); // // "c:".length === 2
        }
      } // encode every segement but not slashes
      // make sure that # and ? are always encoded
      // when occurring in paths - otherwise the result
      // cannot be parsed back again


      let lastIdx = 0;

      while (true) {
        let idx = path.indexOf(_slash, lastIdx);

        if (idx === -1) {
          parts.push(encoder(path.substring(lastIdx)));
          break;
        }

        parts.push(encoder(path.substring(lastIdx, idx)), _slash);
        lastIdx = idx + 1;
      }
    }

    if (query) {
      parts.push('?', encoder(query));
    }

    if (fragment) {
      parts.push('#', encoder(fragment));
    }

    return parts.join(_empty);
  }
})(vscUri = exports.vscUri || (exports.vscUri = {}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVyaS5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInZzY1VyaSIsInBsYXRmb3JtIiwiaXNXaW5kb3dzIiwidGVzdCIsInByb2Nlc3MiLCJfZW5jb2RlIiwiY2giLCJjaGFyQ29kZUF0IiwidG9TdHJpbmciLCJ0b1VwcGVyQ2FzZSIsImVuY29kZVVSSUNvbXBvbmVudDIiLCJzdHIiLCJlbmNvZGVVUklDb21wb25lbnQiLCJyZXBsYWNlIiwiZW5jb2RlTm9vcCIsIl9zY2hlbWVQYXR0ZXJuIiwiX3NpbmdsZVNsYXNoU3RhcnQiLCJfZG91YmxlU2xhc2hTdGFydCIsIl92YWxpZGF0ZVVyaSIsInJldCIsInNjaGVtZSIsIkVycm9yIiwicGF0aCIsImF1dGhvcml0eSIsIl9lbXB0eSIsIl9zbGFzaCIsIl9yZWdleHAiLCJfZHJpdmVMZXR0ZXJQYXRoIiwiX3VwcGVyQ2FzZURyaXZlIiwiX2RyaXZlTGV0dGVyIiwiVVJJIiwiY29uc3RydWN0b3IiLCJzY2hlbWVPckRhdGEiLCJxdWVyeSIsImZyYWdtZW50IiwiaXNVcmkiLCJ0aGluZyIsImZzUGF0aCIsIl9tYWtlRnNQYXRoIiwid2l0aCIsImNoYW5nZSIsIl9VUkkiLCJwYXJzZSIsIm1hdGNoIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCIsImZpbGUiLCJpZHgiLCJpbmRleE9mIiwic3Vic3RyaW5nIiwiZnJvbSIsImNvbXBvbmVudHMiLCJza2lwRW5jb2RpbmciLCJfYXNGb3JtYXR0ZWQiLCJ0b0pTT04iLCJyZXMiLCIkbWlkIiwiZXh0ZXJuYWwiLCJyZXZpdmUiLCJkYXRhIiwicmVzdWx0IiwiX2ZzUGF0aCIsIl9mb3JtYXR0ZWQiLCJhcmd1bWVudHMiLCJ1cmkiLCJ0b0xvd2VyQ2FzZSIsInN1YnN0ciIsImVuY29kZXIiLCJwYXJ0cyIsInB1c2giLCJ1c2VyaW5mbyIsIm0iLCJsYXN0SWR4Iiwiam9pbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFD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Q0FBYixFQUFnQjtBQUNacUIsVUFBQUEsS0FBSyxDQUFDQyxJQUFOLENBQVdGLE9BQU8sQ0FBQzdDLElBQUksQ0FBQzJCLFNBQUwsQ0FBZXVCLE9BQWYsQ0FBRCxDQUFsQjtBQUNBO0FBQ0g7O0FBQ0RKLFFBQUFBLEtBQUssQ0FBQ0MsSUFBTixDQUFXRixPQUFPLENBQUM3QyxJQUFJLENBQUMyQixTQUFMLENBQWV1QixPQUFmLEVBQXdCekIsR0FBeEIsQ0FBRCxDQUFsQixFQUFrRHRCLE1BQWxEO0FBQ0ErQyxRQUFBQSxPQUFPLEdBQUd6QixHQUFHLEdBQUcsQ0FBaEI7QUFDSDtBQUNKOztBQUNELFFBQUlkLEtBQUosRUFBVztBQUNQbUMsTUFBQUEsS0FBSyxDQUFDQyxJQUFOLENBQVcsR0FBWCxFQUFnQkYsT0FBTyxDQUFDbEMsS0FBRCxDQUF2QjtBQUNIOztBQUNELFFBQUlDLFFBQUosRUFBYztBQUNWa0MsTUFBQUEsS0FBSyxDQUFDQyxJQUFOLENBQVcsR0FBWCxFQUFnQkYsT0FBTyxDQUFDakMsUUFBRCxDQUF2QjtBQUNIOztBQUNELFdBQU9rQyxLQUFLLENBQUNLLElBQU4sQ0FBV2pELE1BQVgsQ0FBUDtBQUNIO0FBQ0osQ0FqWEQsRUFpWEd4QixNQUFNLEdBQUdGLE9BQU8sQ0FBQ0UsTUFBUixLQUFtQkYsT0FBTyxDQUFDRSxNQUFSLEdBQWlCLEVBQXBDLENBalhaIiwic291cmNlc0NvbnRlbnQiOlsiLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqICBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuIFNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG4ndXNlIHN0cmljdCc7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgdnNjVXJpO1xuKGZ1bmN0aW9uICh2c2NVcmkpIHtcbiAgICBjb25zdCBwbGF0Zm9ybSA9IHtcbiAgICAgICAgaXNXaW5kb3dzOiAvXndpbi8udGVzdChwcm9jZXNzLnBsYXRmb3JtKVxuICAgIH07XG4gICAgLy8gdHNsaW50OmRpc2FibGU6YWxsXG4gICAgZnVuY3Rpb24gX2VuY29kZShjaCkge1xuICAgICAgICByZXR1cm4gJyUnICsgY2guY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKTtcbiAgICB9XG4gICAgLy8gc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL2VuY29kZVVSSUNvbXBvbmVudFxuICAgIGZ1bmN0aW9uIGVuY29kZVVSSUNvbXBvbmVudDIoc3RyKSB7XG4gICAgICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQoc3RyKS5yZXBsYWNlKC9bIScoKSpdL2csIF9lbmNvZGUpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBlbmNvZGVOb29wKHN0cikge1xuICAgICAgICByZXR1cm4gc3RyLnJlcGxhY2UoL1sjP10vLCBfZW5jb2RlKTtcbiAgICB9XG4gICAgY29uc3QgX3NjaGVtZVBhdHRlcm4gPSAvXlxcd1tcXHdcXGQrLi1dKiQvO1xuICAgIGNvbnN0IF9zaW5nbGVTbGFzaFN0YXJ0ID0gL15cXC8vO1xuICAgIGNvbnN0IF9kb3VibGVTbGFzaFN0YXJ0ID0gL15cXC9cXC8vO1xuICAgIGZ1bmN0aW9uIF92YWxpZGF0ZVVyaShyZXQpIHtcbiAgICAgICAgLy8gc2NoZW1lLCBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjMzk4NiNzZWN0aW9uLTMuMVxuICAgICAgICAvLyBBTFBIQSAqKCBBTFBIQSAvIERJR0lUIC8gXCIrXCIgLyBcIi1cIiAvIFwiLlwiIClcbiAgICAgICAgaWYgKHJldC5zY2hlbWUgJiYgIV9zY2hlbWVQYXR0ZXJuLnRlc3QocmV0LnNjaGVtZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignW1VyaUVycm9yXTogU2NoZW1lIGNvbnRhaW5zIGlsbGVnYWwgY2hhcmFjdGVycy4nKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBwYXRoLCBodHRwOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmMzOTg2I3NlY3Rpb24tMy4zXG4gICAgICAgIC8vIElmIGEgVVJJIGNvbnRhaW5zIGFuIGF1dGhvcml0eSBjb21wb25lbnQsIHRoZW4gdGhlIHBhdGggY29tcG9uZW50XG4gICAgICAgIC8vIG11c3QgZWl0aGVyIGJlIGVtcHR5IG9yIGJlZ2luIHdpdGggYSBzbGFzaCAoXCIvXCIpIGNoYXJhY3Rlci4gIElmIGEgVVJJXG4gICAgICAgIC8vIGRvZXMgbm90IGNvbnRhaW4gYW4gYXV0aG9yaXR5IGNvbXBvbmVudCwgdGhlbiB0aGUgcGF0aCBjYW5ub3QgYmVnaW5cbiAgICAgICAgLy8gd2l0aCB0d28gc2xhc2ggY2hhcmFjdGVycyAoXCIvL1wiKS5cbiAgICAgICAgaWYgKHJldC5wYXRoKSB7XG4gICAgICAgICAgICBpZiAocmV0LmF1dGhvcml0eSkge1xuICAgICAgICAgICAgICAgIGlmICghX3NpbmdsZVNsYXNoU3RhcnQudGVzdChyZXQucGF0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdbVXJpRXJyb3JdOiBJZiBhIFVSSSBjb250YWlucyBhbiBhdXRob3JpdHkgY29tcG9uZW50LCB0aGVuIHRoZSBwYXRoIGNvbXBvbmVudCBtdXN0IGVpdGhlciBiZSBlbXB0eSBvciBiZWdpbiB3aXRoIGEgc2xhc2ggKFwiL1wiKSBjaGFyYWN0ZXInKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoX2RvdWJsZVNsYXNoU3RhcnQudGVzdChyZXQucGF0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdbVXJpRXJyb3JdOiBJZiBhIFVSSSBkb2VzIG5vdCBjb250YWluIGFuIGF1dGhvcml0eSBjb21wb25lbnQsIHRoZW4gdGhlIHBhdGggY2Fubm90IGJlZ2luIHdpdGggdHdvIHNsYXNoIGNoYXJhY3RlcnMgKFwiLy9cIiknKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgX2VtcHR5ID0gJyc7XG4gICAgY29uc3QgX3NsYXNoID0gJy8nO1xuICAgIGNvbnN0IF9yZWdleHAgPSAvXigoW146Lz8jXSs/KTopPyhcXC9cXC8oW14vPyNdKikpPyhbXj8jXSopKFxcPyhbXiNdKikpPygjKC4qKSk/LztcbiAgICBjb25zdCBfZHJpdmVMZXR0ZXJQYXRoID0gL15cXC9bYS16QS1aXTovO1xuICAgIGNvbnN0IF91cHBlckNhc2VEcml2ZSA9IC9eKFxcLyk/KFtBLVpdOikvO1xuICAgIGNvbnN0IF9kcml2ZUxldHRlciA9IC9eW2EtekEtWl06LztcbiAgICAvKipcbiAgICAgKiBVbmlmb3JtIFJlc291cmNlIElkZW50aWZpZXIgKFVSSSkgaHR0cDovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjMzk4Ni5cbiAgICAgKiBUaGlzIGNsYXNzIGlzIGEgc2ltcGxlIHBhcnNlciB3aGljaCBjcmVhdGVzIHRoZSBiYXNpYyBjb21wb25lbnQgcGF0aHNcbiAgICAgKiAoaHR0cDovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjMzk4NiNzZWN0aW9uLTMpIHdpdGggbWluaW1hbCB2YWxpZGF0aW9uXG4gICAgICogYW5kIGVuY29kaW5nLlxuICAgICAqXG4gICAgICogICAgICAgZm9vOi8vZXhhbXBsZS5jb206ODA0Mi9vdmVyL3RoZXJlP25hbWU9ZmVycmV0I25vc2VcbiAgICAgKiAgICAgICBcXF8vICAgXFxfX19fX19fX19fX19fXy9cXF9fX19fX19fXy8gXFxfX19fX19fX18vIFxcX18vXG4gICAgICogICAgICAgIHwgICAgICAgICAgIHwgICAgICAgICAgICB8ICAgICAgICAgICAgfCAgICAgICAgfFxuICAgICAqICAgICBzY2hlbWUgICAgIGF1dGhvcml0eSAgICAgICBwYXRoICAgICAgICBxdWVyeSAgIGZyYWdtZW50XG4gICAgICogICAgICAgIHwgICBfX19fX19fX19fX19fX19fX19fX198X19cbiAgICAgKiAgICAgICAvIFxcIC8gICAgICAgICAgICAgICAgICAgICAgICBcXFxuICAgICAqICAgICAgIHVybjpleGFtcGxlOmFuaW1hbDpmZXJyZXQ6bm9zZVxuICAgICAqXG4gICAgICpcbiAgICAgKi9cbiAgICBjbGFzcyBVUkkge1xuICAgICAgICAvKipcbiAgICAgICAgICogQGludGVybmFsXG4gICAgICAgICAqL1xuICAgICAgICBjb25zdHJ1Y3RvcihzY2hlbWVPckRhdGEsIGF1dGhvcml0eSwgcGF0aCwgcXVlcnksIGZyYWdtZW50KSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHNjaGVtZU9yRGF0YSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNjaGVtZSA9IHNjaGVtZU9yRGF0YS5zY2hlbWUgfHwgX2VtcHR5O1xuICAgICAgICAgICAgICAgIHRoaXMuYXV0aG9yaXR5ID0gc2NoZW1lT3JEYXRhLmF1dGhvcml0eSB8fCBfZW1wdHk7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXRoID0gc2NoZW1lT3JEYXRhLnBhdGggfHwgX2VtcHR5O1xuICAgICAgICAgICAgICAgIHRoaXMucXVlcnkgPSBzY2hlbWVPckRhdGEucXVlcnkgfHwgX2VtcHR5O1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhZ21lbnQgPSBzY2hlbWVPckRhdGEuZnJhZ21lbnQgfHwgX2VtcHR5O1xuICAgICAgICAgICAgICAgIC8vIG5vIHZhbGlkYXRpb24gYmVjYXVzZSBpdCdzIHRoaXMgVVJJXG4gICAgICAgICAgICAgICAgLy8gdGhhdCBjcmVhdGVzIHVyaSBjb21wb25lbnRzLlxuICAgICAgICAgICAgICAgIC8vIF92YWxpZGF0ZVVyaSh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2NoZW1lID0gc2NoZW1lT3JEYXRhIHx8IF9lbXB0eTtcbiAgICAgICAgICAgICAgICB0aGlzLmF1dGhvcml0eSA9IGF1dGhvcml0eSB8fCBfZW1wdHk7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXRoID0gcGF0aCB8fCBfZW1wdHk7XG4gICAgICAgICAgICAgICAgdGhpcy5xdWVyeSA9IHF1ZXJ5IHx8IF9lbXB0eTtcbiAgICAgICAgICAgICAgICB0aGlzLmZyYWdtZW50ID0gZnJhZ21lbnQgfHwgX2VtcHR5O1xuICAgICAgICAgICAgICAgIF92YWxpZGF0ZVVyaSh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzdGF0aWMgaXNVcmkodGhpbmcpIHtcbiAgICAgICAgICAgIGlmICh0aGluZyBpbnN0YW5jZW9mIFVSSSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGluZykge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgdGhpbmcuYXV0aG9yaXR5ID09PSAnc3RyaW5nJ1xuICAgICAgICAgICAgICAgICYmIHR5cGVvZiB0aGluZy5mcmFnbWVudCA9PT0gJ3N0cmluZydcbiAgICAgICAgICAgICAgICAmJiB0eXBlb2YgdGhpbmcucGF0aCA9PT0gJ3N0cmluZydcbiAgICAgICAgICAgICAgICAmJiB0eXBlb2YgdGhpbmcucXVlcnkgPT09ICdzdHJpbmcnXG4gICAgICAgICAgICAgICAgJiYgdHlwZW9mIHRoaW5nLnNjaGVtZSA9PT0gJ3N0cmluZyc7XG4gICAgICAgIH1cbiAgICAgICAgLy8gLS0tLSBmaWxlc3lzdGVtIHBhdGggLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBjb3JyZXNwb25kaW5nIGZpbGUgc3lzdGVtIHBhdGggb2YgdGhpcyBVUkkuXG4gICAgICAgICAqIFdpbGwgaGFuZGxlIFVOQyBwYXRocyBhbmQgbm9ybWFsaXplIHdpbmRvd3MgZHJpdmUgbGV0dGVycyB0byBsb3dlci1jYXNlLiBBbHNvXG4gICAgICAgICAqIHVzZXMgdGhlIHBsYXRmb3JtIHNwZWNpZmljIHBhdGggc2VwYXJhdG9yLiBXaWxsICpub3QqIHZhbGlkYXRlIHRoZSBwYXRoIGZvclxuICAgICAgICAgKiBpbnZhbGlkIGNoYXJhY3RlcnMgYW5kIHNlbWFudGljcy4gV2lsbCAqbm90KiBsb29rIGF0IHRoZSBzY2hlbWUgb2YgdGhpcyBVUkkuXG4gICAgICAgICAqL1xuICAgICAgICBnZXQgZnNQYXRoKCkge1xuICAgICAgICAgICAgcmV0dXJuIF9tYWtlRnNQYXRoKHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIC8vIC0tLS0gbW9kaWZ5IHRvIG5ldyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgIHdpdGgoY2hhbmdlKSB7XG4gICAgICAgICAgICBpZiAoIWNoYW5nZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHsgc2NoZW1lLCBhdXRob3JpdHksIHBhdGgsIHF1ZXJ5LCBmcmFnbWVudCB9ID0gY2hhbmdlO1xuICAgICAgICAgICAgaWYgKHNjaGVtZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICAgICAgc2NoZW1lID0gdGhpcy5zY2hlbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChzY2hlbWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBzY2hlbWUgPSBfZW1wdHk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYXV0aG9yaXR5ID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgICAgICBhdXRob3JpdHkgPSB0aGlzLmF1dGhvcml0eTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGF1dGhvcml0eSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGF1dGhvcml0eSA9IF9lbXB0eTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwYXRoID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgICAgICBwYXRoID0gdGhpcy5wYXRoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocGF0aCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHBhdGggPSBfZW1wdHk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocXVlcnkgPT09IHZvaWQgMCkge1xuICAgICAgICAgICAgICAgIHF1ZXJ5ID0gdGhpcy5xdWVyeTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHF1ZXJ5ID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcXVlcnkgPSBfZW1wdHk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZnJhZ21lbnQgPT09IHZvaWQgMCkge1xuICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gdGhpcy5mcmFnbWVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZyYWdtZW50ID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgZnJhZ21lbnQgPSBfZW1wdHk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2NoZW1lID09PSB0aGlzLnNjaGVtZVxuICAgICAgICAgICAgICAgICYmIGF1dGhvcml0eSA9PT0gdGhpcy5hdXRob3JpdHlcbiAgICAgICAgICAgICAgICAmJiBwYXRoID09PSB0aGlzLnBhdGhcbiAgICAgICAgICAgICAgICAmJiBxdWVyeSA9PT0gdGhpcy5xdWVyeVxuICAgICAgICAgICAgICAgICYmIGZyYWdtZW50ID09PSB0aGlzLmZyYWdtZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IF9VUkkoc2NoZW1lLCBhdXRob3JpdHksIHBhdGgsIHF1ZXJ5LCBmcmFnbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gLS0tLSBwYXJzZSAmIHZhbGlkYXRlIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICBzdGF0aWMgcGFyc2UodmFsdWUpIHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gX3JlZ2V4cC5leGVjKHZhbHVlKTtcbiAgICAgICAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IF9VUkkoX2VtcHR5LCBfZW1wdHksIF9lbXB0eSwgX2VtcHR5LCBfZW1wdHkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBfVVJJKG1hdGNoWzJdIHx8IF9lbXB0eSwgZGVjb2RlVVJJQ29tcG9uZW50KG1hdGNoWzRdIHx8IF9lbXB0eSksIGRlY29kZVVSSUNvbXBvbmVudChtYXRjaFs1XSB8fCBfZW1wdHkpLCBkZWNvZGVVUklDb21wb25lbnQobWF0Y2hbN10gfHwgX2VtcHR5KSwgZGVjb2RlVVJJQ29tcG9uZW50KG1hdGNoWzldIHx8IF9lbXB0eSkpO1xuICAgICAgICB9XG4gICAgICAgIHN0YXRpYyBmaWxlKHBhdGgpIHtcbiAgICAgICAgICAgIGxldCBhdXRob3JpdHkgPSBfZW1wdHk7XG4gICAgICAgICAgICAvLyBub3JtYWxpemUgdG8gZndkLXNsYXNoZXMgb24gd2luZG93cyxcbiAgICAgICAgICAgIC8vIG9uIG90aGVyIHN5c3RlbXMgYndkLXNsYXNoZXMgYXJlIHZhbGlkXG4gICAgICAgICAgICAvLyBmaWxlbmFtZSBjaGFyYWN0ZXIsIGVnIC9mXFxvby9iYVxcci50eHRcbiAgICAgICAgICAgIGlmIChwbGF0Zm9ybS5pc1dpbmRvd3MpIHtcbiAgICAgICAgICAgICAgICBwYXRoID0gcGF0aC5yZXBsYWNlKC9cXFxcL2csIF9zbGFzaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBjaGVjayBmb3IgYXV0aG9yaXR5IGFzIHVzZWQgaW4gVU5DIHNoYXJlc1xuICAgICAgICAgICAgLy8gb3IgdXNlIHRoZSBwYXRoIGFzIGdpdmVuXG4gICAgICAgICAgICBpZiAocGF0aFswXSA9PT0gX3NsYXNoICYmIHBhdGhbMV0gPT09IF9zbGFzaCkge1xuICAgICAgICAgICAgICAgIGxldCBpZHggPSBwYXRoLmluZGV4T2YoX3NsYXNoLCAyKTtcbiAgICAgICAgICAgICAgICBpZiAoaWR4ID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBhdXRob3JpdHkgPSBwYXRoLnN1YnN0cmluZygyKTtcbiAgICAgICAgICAgICAgICAgICAgcGF0aCA9IF9zbGFzaDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGhvcml0eSA9IHBhdGguc3Vic3RyaW5nKDIsIGlkeCk7XG4gICAgICAgICAgICAgICAgICAgIHBhdGggPSBwYXRoLnN1YnN0cmluZyhpZHgpIHx8IF9zbGFzaDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBFbnN1cmUgdGhhdCBwYXRoIHN0YXJ0cyB3aXRoIGEgc2xhc2hcbiAgICAgICAgICAgIC8vIG9yIHRoYXQgaXQgaXMgYXQgbGVhc3QgYSBzbGFzaFxuICAgICAgICAgICAgaWYgKF9kcml2ZUxldHRlci50ZXN0KHBhdGgpKSB7XG4gICAgICAgICAgICAgICAgcGF0aCA9IF9zbGFzaCArIHBhdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwYXRoWzBdICE9PSBfc2xhc2gpIHtcbiAgICAgICAgICAgICAgICAvLyB0cmlja3kgLT4gbWFrZXMgaW52YWxpZCBwYXRoc1xuICAgICAgICAgICAgICAgIC8vIGJ1dCBvdGhlcndpc2Ugd2UgaGF2ZSB0byBzdG9wXG4gICAgICAgICAgICAgICAgLy8gYWxsb3dpbmcgcmVsYXRpdmUgcGF0aHMuLi5cbiAgICAgICAgICAgICAgICBwYXRoID0gX3NsYXNoICsgcGF0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgX1VSSSgnZmlsZScsIGF1dGhvcml0eSwgcGF0aCwgX2VtcHR5LCBfZW1wdHkpO1xuICAgICAgICB9XG4gICAgICAgIHN0YXRpYyBmcm9tKGNvbXBvbmVudHMpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgX1VSSShjb21wb25lbnRzLnNjaGVtZSwgY29tcG9uZW50cy5hdXRob3JpdHksIGNvbXBvbmVudHMucGF0aCwgY29tcG9uZW50cy5xdWVyeSwgY29tcG9uZW50cy5mcmFnbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gLS0tLSBwcmludGluZy9leHRlcm5hbGl6ZSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgLyoqXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBza2lwRW5jb2RpbmcgRG8gbm90IGVuY29kZSB0aGUgcmVzdWx0LCBkZWZhdWx0IGlzIGBmYWxzZWBcbiAgICAgICAgICovXG4gICAgICAgIHRvU3RyaW5nKHNraXBFbmNvZGluZyA9IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm4gX2FzRm9ybWF0dGVkKHRoaXMsIHNraXBFbmNvZGluZyk7XG4gICAgICAgIH1cbiAgICAgICAgdG9KU09OKCkge1xuICAgICAgICAgICAgY29uc3QgcmVzID0ge1xuICAgICAgICAgICAgICAgICRtaWQ6IDEsXG4gICAgICAgICAgICAgICAgZnNQYXRoOiB0aGlzLmZzUGF0aCxcbiAgICAgICAgICAgICAgICBleHRlcm5hbDogdGhpcy50b1N0cmluZygpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmICh0aGlzLnBhdGgpIHtcbiAgICAgICAgICAgICAgICByZXMucGF0aCA9IHRoaXMucGF0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnNjaGVtZSkge1xuICAgICAgICAgICAgICAgIHJlcy5zY2hlbWUgPSB0aGlzLnNjaGVtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmF1dGhvcml0eSkge1xuICAgICAgICAgICAgICAgIHJlcy5hdXRob3JpdHkgPSB0aGlzLmF1dGhvcml0eTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnF1ZXJ5KSB7XG4gICAgICAgICAgICAgICAgcmVzLnF1ZXJ5ID0gdGhpcy5xdWVyeTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmZyYWdtZW50KSB7XG4gICAgICAgICAgICAgICAgcmVzLmZyYWdtZW50ID0gdGhpcy5mcmFnbWVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGljIHJldml2ZShkYXRhKSB7XG4gICAgICAgICAgICBpZiAoIWRhdGEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGRhdGEgaW5zdGFuY2VvZiBVUkkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSBuZXcgX1VSSShkYXRhKTtcbiAgICAgICAgICAgICAgICByZXN1bHQuX2ZzUGF0aCA9IGRhdGEuZnNQYXRoO1xuICAgICAgICAgICAgICAgIHJlc3VsdC5fZm9ybWF0dGVkID0gZGF0YS5leHRlcm5hbDtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHZzY1VyaS5VUkkgPSBVUkk7XG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmNsYXNzLW5hbWVcbiAgICBjbGFzcyBfVVJJIGV4dGVuZHMgVVJJIHtcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuICAgICAgICAgICAgdGhpcy5fZm9ybWF0dGVkID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuX2ZzUGF0aCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZ2V0IGZzUGF0aCgpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5fZnNQYXRoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZnNQYXRoID0gX21ha2VGc1BhdGgodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZnNQYXRoO1xuICAgICAgICB9XG4gICAgICAgIHRvU3RyaW5nKHNraXBFbmNvZGluZyA9IGZhbHNlKSB7XG4gICAgICAgICAgICBpZiAoIXNraXBFbmNvZGluZykge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fZm9ybWF0dGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zvcm1hdHRlZCA9IF9hc0Zvcm1hdHRlZCh0aGlzLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mb3JtYXR0ZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyB3ZSBkb24ndCBjYWNoZSB0aGF0XG4gICAgICAgICAgICAgICAgcmV0dXJuIF9hc0Zvcm1hdHRlZCh0aGlzLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb21wdXRlIGBmc1BhdGhgIGZvciB0aGUgZ2l2ZW4gdXJpXG4gICAgICogQHBhcmFtIHVyaVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIF9tYWtlRnNQYXRoKHVyaSkge1xuICAgICAgICBsZXQgdmFsdWU7XG4gICAgICAgIGlmICh1cmkuYXV0aG9yaXR5ICYmIHVyaS5wYXRoICYmIHVyaS5zY2hlbWUgPT09ICdmaWxlJykge1xuICAgICAgICAgICAgLy8gdW5jIHBhdGg6IGZpbGU6Ly9zaGFyZXMvYyQvZmFyL2Jvb1xuICAgICAgICAgICAgdmFsdWUgPSBgLy8ke3VyaS5hdXRob3JpdHl9JHt1cmkucGF0aH1gO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKF9kcml2ZUxldHRlclBhdGgudGVzdCh1cmkucGF0aCkpIHtcbiAgICAgICAgICAgIC8vIHdpbmRvd3MgZHJpdmUgbGV0dGVyOiBmaWxlOi8vL2M6L2Zhci9ib29cbiAgICAgICAgICAgIHZhbHVlID0gdXJpLnBhdGhbMV0udG9Mb3dlckNhc2UoKSArIHVyaS5wYXRoLnN1YnN0cigyKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIG90aGVyIHBhdGhcbiAgICAgICAgICAgIHZhbHVlID0gdXJpLnBhdGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBsYXRmb3JtLmlzV2luZG93cykge1xuICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9cXC8vZywgJ1xcXFwnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZSB0aGUgZXh0ZXJuYWwgdmVyc2lvbiBvZiBhIHVyaVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIF9hc0Zvcm1hdHRlZCh1cmksIHNraXBFbmNvZGluZykge1xuICAgICAgICBjb25zdCBlbmNvZGVyID0gIXNraXBFbmNvZGluZ1xuICAgICAgICAgICAgPyBlbmNvZGVVUklDb21wb25lbnQyXG4gICAgICAgICAgICA6IGVuY29kZU5vb3A7XG4gICAgICAgIGNvbnN0IHBhcnRzID0gW107XG4gICAgICAgIGxldCB7IHNjaGVtZSwgYXV0aG9yaXR5LCBwYXRoLCBxdWVyeSwgZnJhZ21lbnQgfSA9IHVyaTtcbiAgICAgICAgaWYgKHNjaGVtZSkge1xuICAgICAgICAgICAgcGFydHMucHVzaChzY2hlbWUsICc6Jyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGF1dGhvcml0eSB8fCBzY2hlbWUgPT09ICdmaWxlJykge1xuICAgICAgICAgICAgcGFydHMucHVzaCgnLy8nKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYXV0aG9yaXR5KSB7XG4gICAgICAgICAgICBsZXQgaWR4ID0gYXV0aG9yaXR5LmluZGV4T2YoJ0AnKTtcbiAgICAgICAgICAgIGlmIChpZHggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdXNlcmluZm8gPSBhdXRob3JpdHkuc3Vic3RyKDAsIGlkeCk7XG4gICAgICAgICAgICAgICAgYXV0aG9yaXR5ID0gYXV0aG9yaXR5LnN1YnN0cihpZHggKyAxKTtcbiAgICAgICAgICAgICAgICBpZHggPSB1c2VyaW5mby5pbmRleE9mKCc6Jyk7XG4gICAgICAgICAgICAgICAgaWYgKGlkeCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFydHMucHVzaChlbmNvZGVyKHVzZXJpbmZvKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBwYXJ0cy5wdXNoKGVuY29kZXIodXNlcmluZm8uc3Vic3RyKDAsIGlkeCkpLCAnOicsIGVuY29kZXIodXNlcmluZm8uc3Vic3RyKGlkeCArIDEpKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHBhcnRzLnB1c2goJ0AnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF1dGhvcml0eSA9IGF1dGhvcml0eS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgaWR4ID0gYXV0aG9yaXR5LmluZGV4T2YoJzonKTtcbiAgICAgICAgICAgIGlmIChpZHggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgcGFydHMucHVzaChlbmNvZGVyKGF1dGhvcml0eSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcGFydHMucHVzaChlbmNvZGVyKGF1dGhvcml0eS5zdWJzdHIoMCwgaWR4KSksIGF1dGhvcml0eS5zdWJzdHIoaWR4KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhdGgpIHtcbiAgICAgICAgICAgIC8vIGxvd2VyLWNhc2Ugd2luZG93cyBkcml2ZSBsZXR0ZXJzIGluIC9DOi9mZmYgb3IgQzovZmZmXG4gICAgICAgICAgICBjb25zdCBtID0gX3VwcGVyQ2FzZURyaXZlLmV4ZWMocGF0aCk7XG4gICAgICAgICAgICBpZiAobSkge1xuICAgICAgICAgICAgICAgIGlmIChtWzFdKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhdGggPSAnLycgKyBtWzJdLnRvTG93ZXJDYXNlKCkgKyBwYXRoLnN1YnN0cigzKTsgLy8gXCIvYzpcIi5sZW5ndGggPT09IDNcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHBhdGggPSBtWzJdLnRvTG93ZXJDYXNlKCkgKyBwYXRoLnN1YnN0cigyKTsgLy8gLy8gXCJjOlwiLmxlbmd0aCA9PT0gMlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGVuY29kZSBldmVyeSBzZWdlbWVudCBidXQgbm90IHNsYXNoZXNcbiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGF0ICMgYW5kID8gYXJlIGFsd2F5cyBlbmNvZGVkXG4gICAgICAgICAgICAvLyB3aGVuIG9jY3VycmluZyBpbiBwYXRocyAtIG90aGVyd2lzZSB0aGUgcmVzdWx0XG4gICAgICAgICAgICAvLyBjYW5ub3QgYmUgcGFyc2VkIGJhY2sgYWdhaW5cbiAgICAgICAgICAgIGxldCBsYXN0SWR4ID0gMDtcbiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgbGV0IGlkeCA9IHBhdGguaW5kZXhPZihfc2xhc2gsIGxhc3RJZHgpO1xuICAgICAgICAgICAgICAgIGlmIChpZHggPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnRzLnB1c2goZW5jb2RlcihwYXRoLnN1YnN0cmluZyhsYXN0SWR4KSkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcGFydHMucHVzaChlbmNvZGVyKHBhdGguc3Vic3RyaW5nKGxhc3RJZHgsIGlkeCkpLCBfc2xhc2gpO1xuICAgICAgICAgICAgICAgIGxhc3RJZHggPSBpZHggKyAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChxdWVyeSkge1xuICAgICAgICAgICAgcGFydHMucHVzaCgnPycsIGVuY29kZXIocXVlcnkpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZnJhZ21lbnQpIHtcbiAgICAgICAgICAgIHBhcnRzLnB1c2goJyMnLCBlbmNvZGVyKGZyYWdtZW50KSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBhcnRzLmpvaW4oX2VtcHR5KTtcbiAgICB9XG59KSh2c2NVcmkgPSBleHBvcnRzLnZzY1VyaSB8fCAoZXhwb3J0cy52c2NVcmkgPSB7fSkpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXJpLmpzLm1hcCJdfQ==
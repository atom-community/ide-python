/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
}); // tslint:disable:all

const position_1 = require("./position");

var vscMockRange;

(function (vscMockRange) {
  /**
   * A range in the editor. (startLineNumber,startColumn) is <= (endLineNumber,endColumn)
   */
  class Range {
    constructor(startLineNumber, startColumn, endLineNumber, endColumn) {
      if (startLineNumber > endLineNumber || startLineNumber === endLineNumber && startColumn > endColumn) {
        this.startLineNumber = endLineNumber;
        this.startColumn = endColumn;
        this.endLineNumber = startLineNumber;
        this.endColumn = startColumn;
      } else {
        this.startLineNumber = startLineNumber;
        this.startColumn = startColumn;
        this.endLineNumber = endLineNumber;
        this.endColumn = endColumn;
      }
    }
    /**
     * Test if this range is empty.
     */


    isEmpty() {
      return Range.isEmpty(this);
    }
    /**
     * Test if `range` is empty.
     */


    static isEmpty(range) {
      return range.startLineNumber === range.endLineNumber && range.startColumn === range.endColumn;
    }
    /**
     * Test if position is in this range. If the position is at the edges, will return true.
     */


    containsPosition(position) {
      return Range.containsPosition(this, position);
    }
    /**
     * Test if `position` is in `range`. If the position is at the edges, will return true.
     */


    static containsPosition(range, position) {
      if (position.lineNumber < range.startLineNumber || position.lineNumber > range.endLineNumber) {
        return false;
      }

      if (position.lineNumber === range.startLineNumber && position.column < range.startColumn) {
        return false;
      }

      if (position.lineNumber === range.endLineNumber && position.column > range.endColumn) {
        return false;
      }

      return true;
    }
    /**
     * Test if range is in this range. If the range is equal to this range, will return true.
     */


    containsRange(range) {
      return Range.containsRange(this, range);
    }
    /**
     * Test if `otherRange` is in `range`. If the ranges are equal, will return true.
     */


    static containsRange(range, otherRange) {
      if (otherRange.startLineNumber < range.startLineNumber || otherRange.endLineNumber < range.startLineNumber) {
        return false;
      }

      if (otherRange.startLineNumber > range.endLineNumber || otherRange.endLineNumber > range.endLineNumber) {
        return false;
      }

      if (otherRange.startLineNumber === range.startLineNumber && otherRange.startColumn < range.startColumn) {
        return false;
      }

      if (otherRange.endLineNumber === range.endLineNumber && otherRange.endColumn > range.endColumn) {
        return false;
      }

      return true;
    }
    /**
     * A reunion of the two ranges.
     * The smallest position will be used as the start point, and the largest one as the end point.
     */


    plusRange(range) {
      return Range.plusRange(this, range);
    }
    /**
     * A reunion of the two ranges.
     * The smallest position will be used as the start point, and the largest one as the end point.
     */


    static plusRange(a, b) {
      var startLineNumber, startColumn, endLineNumber, endColumn;

      if (b.startLineNumber < a.startLineNumber) {
        startLineNumber = b.startLineNumber;
        startColumn = b.startColumn;
      } else if (b.startLineNumber === a.startLineNumber) {
        startLineNumber = b.startLineNumber;
        startColumn = Math.min(b.startColumn, a.startColumn);
      } else {
        startLineNumber = a.startLineNumber;
        startColumn = a.startColumn;
      }

      if (b.endLineNumber > a.endLineNumber) {
        endLineNumber = b.endLineNumber;
        endColumn = b.endColumn;
      } else if (b.endLineNumber === a.endLineNumber) {
        endLineNumber = b.endLineNumber;
        endColumn = Math.max(b.endColumn, a.endColumn);
      } else {
        endLineNumber = a.endLineNumber;
        endColumn = a.endColumn;
      }

      return new Range(startLineNumber, startColumn, endLineNumber, endColumn);
    }
    /**
     * A intersection of the two ranges.
     */


    intersectRanges(range) {
      return Range.intersectRanges(this, range);
    }
    /**
     * A intersection of the two ranges.
     */


    static intersectRanges(a, b) {
      var resultStartLineNumber = a.startLineNumber,
          resultStartColumn = a.startColumn,
          resultEndLineNumber = a.endLineNumber,
          resultEndColumn = a.endColumn,
          otherStartLineNumber = b.startLineNumber,
          otherStartColumn = b.startColumn,
          otherEndLineNumber = b.endLineNumber,
          otherEndColumn = b.endColumn;

      if (resultStartLineNumber < otherStartLineNumber) {
        resultStartLineNumber = otherStartLineNumber;
        resultStartColumn = otherStartColumn;
      } else if (resultStartLineNumber === otherStartLineNumber) {
        resultStartColumn = Math.max(resultStartColumn, otherStartColumn);
      }

      if (resultEndLineNumber > otherEndLineNumber) {
        resultEndLineNumber = otherEndLineNumber;
        resultEndColumn = otherEndColumn;
      } else if (resultEndLineNumber === otherEndLineNumber) {
        resultEndColumn = Math.min(resultEndColumn, otherEndColumn);
      } // Check if selection is now empty


      if (resultStartLineNumber > resultEndLineNumber) {
        return null;
      }

      if (resultStartLineNumber === resultEndLineNumber && resultStartColumn > resultEndColumn) {
        return null;
      }

      return new Range(resultStartLineNumber, resultStartColumn, resultEndLineNumber, resultEndColumn);
    }
    /**
     * Test if this range equals other.
     */


    equalsRange(other) {
      return Range.equalsRange(this, other);
    }
    /**
     * Test if range `a` equals `b`.
     */


    static equalsRange(a, b) {
      return !!a && !!b && a.startLineNumber === b.startLineNumber && a.startColumn === b.startColumn && a.endLineNumber === b.endLineNumber && a.endColumn === b.endColumn;
    }
    /**
     * Return the end position (which will be after or equal to the start position)
     */


    getEndPosition() {
      return new position_1.vscMockPosition.Position(this.endLineNumber, this.endColumn);
    }
    /**
     * Return the start position (which will be before or equal to the end position)
     */


    getStartPosition() {
      return new position_1.vscMockPosition.Position(this.startLineNumber, this.startColumn);
    }
    /**
     * Transform to a user presentable string representation.
     */


    toString() {
      return '[' + this.startLineNumber + ',' + this.startColumn + ' -> ' + this.endLineNumber + ',' + this.endColumn + ']';
    }
    /**
     * Create a new range using this range's start position, and using endLineNumber and endColumn as the end position.
     */


    setEndPosition(endLineNumber, endColumn) {
      return new Range(this.startLineNumber, this.startColumn, endLineNumber, endColumn);
    }
    /**
     * Create a new range using this range's end position, and using startLineNumber and startColumn as the start position.
     */


    setStartPosition(startLineNumber, startColumn) {
      return new Range(startLineNumber, startColumn, this.endLineNumber, this.endColumn);
    }
    /**
     * Create a new empty range using this range's start position.
     */


    collapseToStart() {
      return Range.collapseToStart(this);
    }
    /**
     * Create a new empty range using this range's start position.
     */


    static collapseToStart(range) {
      return new Range(range.startLineNumber, range.startColumn, range.startLineNumber, range.startColumn);
    } // ---


    static fromPositions(start, end = start) {
      return new Range(start.lineNumber, start.column, end.lineNumber, end.column);
    }
    /**
     * Create a `Range` from an `IRange`.
     */


    static lift(range) {
      if (!range) {
        return null;
      }

      return new Range(range.startLineNumber, range.startColumn, range.endLineNumber, range.endColumn);
    }
    /**
     * Test if `obj` is an `IRange`.
     */


    static isIRange(obj) {
      return obj && typeof obj.startLineNumber === 'number' && typeof obj.startColumn === 'number' && typeof obj.endLineNumber === 'number' && typeof obj.endColumn === 'number';
    }
    /**
     * Test if the two ranges are touching in any way.
     */


    static areIntersectingOrTouching(a, b) {
      // Check if `a` is before `b`
      if (a.endLineNumber < b.startLineNumber || a.endLineNumber === b.startLineNumber && a.endColumn < b.startColumn) {
        return false;
      } // Check if `b` is before `a`


      if (b.endLineNumber < a.startLineNumber || b.endLineNumber === a.startLineNumber && b.endColumn < a.startColumn) {
        return false;
      } // These ranges must intersect


      return true;
    }
    /**
     * A function that compares ranges, useful for sorting ranges
     * It will first compare ranges on the startPosition and then on the endPosition
     */


    static compareRangesUsingStarts(a, b) {
      let aStartLineNumber = a.startLineNumber | 0;
      let bStartLineNumber = b.startLineNumber | 0;

      if (aStartLineNumber === bStartLineNumber) {
        let aStartColumn = a.startColumn | 0;
        let bStartColumn = b.startColumn | 0;

        if (aStartColumn === bStartColumn) {
          let aEndLineNumber = a.endLineNumber | 0;
          let bEndLineNumber = b.endLineNumber | 0;

          if (aEndLineNumber === bEndLineNumber) {
            let aEndColumn = a.endColumn | 0;
            let bEndColumn = b.endColumn | 0;
            return aEndColumn - bEndColumn;
          }

          return aEndLineNumber - bEndLineNumber;
        }

        return aStartColumn - bStartColumn;
      }

      return aStartLineNumber - bStartLineNumber;
    }
    /**
     * A function that compares ranges, useful for sorting ranges
     * It will first compare ranges on the endPosition and then on the startPosition
     */


    static compareRangesUsingEnds(a, b) {
      if (a.endLineNumber === b.endLineNumber) {
        if (a.endColumn === b.endColumn) {
          if (a.startLineNumber === b.startLineNumber) {
            return a.startColumn - b.startColumn;
          }

          return a.startLineNumber - b.startLineNumber;
        }

        return a.endColumn - b.endColumn;
      }

      return a.endLineNumber - b.endLineNumber;
    }
    /**
     * Test if the range spans multiple lines.
     */


    static spansMultipleLines(range) {
      return range.endLineNumber > range.startLineNumber;
    }

  }

  vscMockRange.Range = Range;
})(vscMockRange = exports.vscMockRange || (exports.vscMockRange = {}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJhbmdlLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwicG9zaXRpb25fMSIsInJlcXVpcmUiLCJ2c2NNb2NrUmFuZ2UiLCJSYW5nZSIsImNvbnN0cnVjdG9yIiwic3RhcnRMaW5lTnVtYmVyIiwic3RhcnRDb2x1bW4iLCJlbmRMaW5lTnVtYmVyIiwiZW5kQ29sdW1uIiwiaXNFbXB0eSIsInJhbmdlIiwiY29udGFpbnNQb3NpdGlvbiIsInBvc2l0aW9uIiwibGluZU51bWJlciIsImNvbHVtbiIsImNvbnRhaW5zUmFuZ2UiLCJvdGhlclJhbmdlIiwicGx1c1JhbmdlIiwiYSIsImIiLCJNYXRoIiwibWluIiwibWF4IiwiaW50ZXJzZWN0UmFuZ2VzIiwicmVzdWx0U3RhcnRMaW5lTnVtYmVyIiwicmVzdWx0U3RhcnRDb2x1bW4iLCJyZXN1bHRFbmRMaW5lTnVtYmVyIiwicmVzdWx0RW5kQ29sdW1uIiwib3RoZXJTdGFydExpbmVOdW1iZXIiLCJvdGhlclN0YXJ0Q29sdW1uIiwib3RoZXJFbmRMaW5lTnVtYmVyIiwib3RoZXJFbmRDb2x1bW4iLCJlcXVhbHNSYW5nZSIsIm90aGVyIiwiZ2V0RW5kUG9zaXRpb24iLCJ2c2NNb2NrUG9zaXRpb24iLCJQb3NpdGlvbiIsImdldFN0YXJ0UG9zaXRpb24iLCJ0b1N0cmluZyIsInNldEVuZFBvc2l0aW9uIiwic2V0U3RhcnRQb3NpdGlvbiIsImNvbGxhcHNlVG9TdGFydCIsImZyb21Qb3NpdGlvbnMiLCJzdGFydCIsImVuZCIsImxpZnQiLCJpc0lSYW5nZSIsIm9iaiIsImFyZUludGVyc2VjdGluZ09yVG91Y2hpbmciLCJjb21wYXJlUmFuZ2VzVXNpbmdTdGFydHMiLCJhU3RhcnRMaW5lTnVtYmVyIiwiYlN0YXJ0TGluZU51bWJlciIsImFTdGFydENvbHVtbiIsImJTdGFydENvbHVtbiIsImFFbmRMaW5lTnVtYmVyIiwiYkVuZExpbmVOdW1iZXIiLCJhRW5kQ29sdW1uIiwiYkVuZENvbHVtbiIsImNvbXBhcmVSYW5nZXNVc2luZ0VuZHMiLCJzcGFuc011bHRpcGxlTGluZXMiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0FBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFBRUMsRUFBQUEsS0FBSyxFQUFFO0FBQVQsQ0FBN0MsRSxDQUNBOztBQUNBLE1BQU1DLFVBQVUsR0FBR0MsT0FBTyxDQUFDLFlBQUQsQ0FBMUI7O0FBQ0EsSUFBSUMsWUFBSjs7QUFDQSxDQUFDLFVBQVVBLFlBQVYsRUFBd0I7QUFDckI7QUFDSjtBQUNBO0FBQ0ksUUFBTUMsS0FBTixDQUFZO0FBQ1JDLElBQUFBLFdBQVcsQ0FBQ0MsZUFBRCxFQUFrQkMsV0FBbEIsRUFBK0JDLGFBQS9CLEVBQThDQyxTQUE5QyxFQUF5RDtBQUNoRSxVQUFLSCxlQUFlLEdBQUdFLGFBQW5CLElBQXNDRixlQUFlLEtBQUtFLGFBQXBCLElBQXFDRCxXQUFXLEdBQUdFLFNBQTdGLEVBQXlHO0FBQ3JHLGFBQUtILGVBQUwsR0FBdUJFLGFBQXZCO0FBQ0EsYUFBS0QsV0FBTCxHQUFtQkUsU0FBbkI7QUFDQSxhQUFLRCxhQUFMLEdBQXFCRixlQUFyQjtBQUNBLGFBQUtHLFNBQUwsR0FBaUJGLFdBQWpCO0FBQ0gsT0FMRCxNQU1LO0FBQ0QsYUFBS0QsZUFBTCxHQUF1QkEsZUFBdkI7QUFDQSxhQUFLQyxXQUFMLEdBQW1CQSxXQUFuQjtBQUNBLGFBQUtDLGFBQUwsR0FBcUJBLGFBQXJCO0FBQ0EsYUFBS0MsU0FBTCxHQUFpQkEsU0FBakI7QUFDSDtBQUNKO0FBQ0Q7QUFDUjtBQUNBOzs7QUFDUUMsSUFBQUEsT0FBTyxHQUFHO0FBQ04sYUFBT04sS0FBSyxDQUFDTSxPQUFOLENBQWMsSUFBZCxDQUFQO0FBQ0g7QUFDRDtBQUNSO0FBQ0E7OztBQUNzQixXQUFQQSxPQUFPLENBQUNDLEtBQUQsRUFBUTtBQUNsQixhQUFRQSxLQUFLLENBQUNMLGVBQU4s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QUF5QztBQUNyQyxZQUFJVyxDQUFDLENBQUNWLFNBQUYsS0FBZ0JXLENBQUMsQ0FBQ1gsU0FBdEIsRUFBaUM7QUFDN0IsY0FBSVUsQ0FBQyxDQUFDYixlQUFGLEtBQXNCYyxDQUFDLENBQUNkLGVBQTVCLEVBQTZDO0FBQ3pDLG1CQUFPYSxDQUFDLENBQUNaLFdBQUYsR0FBZ0JhLENBQUMsQ0FBQ2IsV0FBekI7QUFDSDs7QUFDRCxpQkFBT1ksQ0FBQyxDQUFDYixlQUFGLEdBQW9CYyxDQUFDLENBQUNkLGVBQTdCO0FBQ0g7O0FBQ0QsZUFBT2EsQ0FBQyxDQUFDVixTQUFGLEdBQWNXLENBQUMsQ0FBQ1gsU0FBdkI7QUFDSDs7QUFDRCxhQUFPVSxDQUFDLENBQUNYLGFBQUYsR0FBa0JZLENBQUMsQ0FBQ1osYUFBM0I7QUFDSDtBQUNEO0FBQ1I7QUFDQTs7O0FBQ2lDLFdBQWxCb0Qsa0JBQWtCLENBQUNqRCxLQUFELEVBQVE7QUFDN0IsYUFBT0EsS0FBSyxDQUFDSCxhQUFOLEdBQXNCRyxLQUFLLENBQUNMLGVBQW5DO0FBQ0g7O0FBL1JPOztBQWlTWkgsRUFBQUEsWUFBWSxDQUFDQyxLQUFiLEdBQXFCQSxLQUFyQjtBQUNILENBdFNELEVBc1NHRCxZQUFZLEdBQUdKLE9BQU8sQ0FBQ0ksWUFBUixLQUF5QkosT0FBTyxDQUFDSSxZQUFSLEdBQXVCLEVBQWhELENBdFNsQiIsInNvdXJjZXNDb250ZW50IjpbIi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiAgQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi5cbiAqLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuJ3VzZSBzdHJpY3QnO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuLy8gdHNsaW50OmRpc2FibGU6YWxsXG5jb25zdCBwb3NpdGlvbl8xID0gcmVxdWlyZShcIi4vcG9zaXRpb25cIik7XG52YXIgdnNjTW9ja1JhbmdlO1xuKGZ1bmN0aW9uICh2c2NNb2NrUmFuZ2UpIHtcbiAgICAvKipcbiAgICAgKiBBIHJhbmdlIGluIHRoZSBlZGl0b3IuIChzdGFydExpbmVOdW1iZXIsc3RhcnRDb2x1bW4pIGlzIDw9IChlbmRMaW5lTnVtYmVyLGVuZENvbHVtbilcbiAgICAgKi9cbiAgICBjbGFzcyBSYW5nZSB7XG4gICAgICAgIGNvbnN0cnVjdG9yKHN0YXJ0TGluZU51bWJlciwgc3RhcnRDb2x1bW4sIGVuZExpbmVOdW1iZXIsIGVuZENvbHVtbikge1xuICAgICAgICAgICAgaWYgKChzdGFydExpbmVOdW1iZXIgPiBlbmRMaW5lTnVtYmVyKSB8fCAoc3RhcnRMaW5lTnVtYmVyID09PSBlbmRMaW5lTnVtYmVyICYmIHN0YXJ0Q29sdW1uID4gZW5kQ29sdW1uKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRMaW5lTnVtYmVyID0gZW5kTGluZU51bWJlcjtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXJ0Q29sdW1uID0gZW5kQ29sdW1uO1xuICAgICAgICAgICAgICAgIHRoaXMuZW5kTGluZU51bWJlciA9IHN0YXJ0TGluZU51bWJlcjtcbiAgICAgICAgICAgICAgICB0aGlzLmVuZENvbHVtbiA9IHN0YXJ0Q29sdW1uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydExpbmVOdW1iZXIgPSBzdGFydExpbmVOdW1iZXI7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydENvbHVtbiA9IHN0YXJ0Q29sdW1uO1xuICAgICAgICAgICAgICAgIHRoaXMuZW5kTGluZU51bWJlciA9IGVuZExpbmVOdW1iZXI7XG4gICAgICAgICAgICAgICAgdGhpcy5lbmRDb2x1bW4gPSBlbmRDb2x1bW47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRlc3QgaWYgdGhpcyByYW5nZSBpcyBlbXB0eS5cbiAgICAgICAgICovXG4gICAgICAgIGlzRW1wdHkoKSB7XG4gICAgICAgICAgICByZXR1cm4gUmFuZ2UuaXNFbXB0eSh0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogVGVzdCBpZiBgcmFuZ2VgIGlzIGVtcHR5LlxuICAgICAgICAgKi9cbiAgICAgICAgc3RhdGljIGlzRW1wdHkocmFuZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiAocmFuZ2Uuc3RhcnRMaW5lTnVtYmVyID09PSByYW5nZS5lbmRMaW5lTnVtYmVyICYmIHJhbmdlLnN0YXJ0Q29sdW1uID09PSByYW5nZS5lbmRDb2x1bW4pO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUZXN0IGlmIHBvc2l0aW9uIGlzIGluIHRoaXMgcmFuZ2UuIElmIHRoZSBwb3NpdGlvbiBpcyBhdCB0aGUgZWRnZXMsIHdpbGwgcmV0dXJuIHRydWUuXG4gICAgICAgICAqL1xuICAgICAgICBjb250YWluc1Bvc2l0aW9uKHBvc2l0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gUmFuZ2UuY29udGFpbnNQb3NpdGlvbih0aGlzLCBwb3NpdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRlc3QgaWYgYHBvc2l0aW9uYCBpcyBpbiBgcmFuZ2VgLiBJZiB0aGUgcG9zaXRpb24gaXMgYXQgdGhlIGVkZ2VzLCB3aWxsIHJldHVybiB0cnVlLlxuICAgICAgICAgKi9cbiAgICAgICAgc3RhdGljIGNvbnRhaW5zUG9zaXRpb24ocmFuZ2UsIHBvc2l0aW9uKSB7XG4gICAgICAgICAgICBpZiAocG9zaXRpb24ubGluZU51bWJlciA8IHJhbmdlLnN0YXJ0TGluZU51bWJlciB8fCBwb3NpdGlvbi5saW5lTnVtYmVyID4gcmFuZ2UuZW5kTGluZU51bWJlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwb3NpdGlvbi5saW5lTnVtYmVyID09PSByYW5nZS5zdGFydExpbmVOdW1iZXIgJiYgcG9zaXRpb24uY29sdW1uIDwgcmFuZ2Uuc3RhcnRDb2x1bW4pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocG9zaXRpb24ubGluZU51bWJlciA9PT0gcmFuZ2UuZW5kTGluZU51bWJlciAmJiBwb3NpdGlvbi5jb2x1bW4gPiByYW5nZS5lbmRDb2x1bW4pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogVGVzdCBpZiByYW5nZSBpcyBpbiB0aGlzIHJhbmdlLiBJZiB0aGUgcmFuZ2UgaXMgZXF1YWwgdG8gdGhpcyByYW5nZSwgd2lsbCByZXR1cm4gdHJ1ZS5cbiAgICAgICAgICovXG4gICAgICAgIGNvbnRhaW5zUmFuZ2UocmFuZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiBSYW5nZS5jb250YWluc1JhbmdlKHRoaXMsIHJhbmdlKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogVGVzdCBpZiBgb3RoZXJSYW5nZWAgaXMgaW4gYHJhbmdlYC4gSWYgdGhlIHJhbmdlcyBhcmUgZXF1YWwsIHdpbGwgcmV0dXJuIHRydWUuXG4gICAgICAgICAqL1xuICAgICAgICBzdGF0aWMgY29udGFpbnNSYW5nZShyYW5nZSwgb3RoZXJSYW5nZSkge1xuICAgICAgICAgICAgaWYgKG90aGVyUmFuZ2Uuc3RhcnRMaW5lTnVtYmVyIDwgcmFuZ2Uuc3RhcnRMaW5lTnVtYmVyIHx8IG90aGVyUmFuZ2UuZW5kTGluZU51bWJlciA8IHJhbmdlLnN0YXJ0TGluZU51bWJlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvdGhlclJhbmdlLnN0YXJ0TGluZU51bWJlciA+IHJhbmdlLmVuZExpbmVOdW1iZXIgfHwgb3RoZXJSYW5nZS5lbmRMaW5lTnVtYmVyID4gcmFuZ2UuZW5kTGluZU51bWJlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvdGhlclJhbmdlLnN0YXJ0TGluZU51bWJlciA9PT0gcmFuZ2Uuc3RhcnRMaW5lTnVtYmVyICYmIG90aGVyUmFuZ2Uuc3RhcnRDb2x1bW4gPCByYW5nZS5zdGFydENvbHVtbikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvdGhlclJhbmdlLmVuZExpbmVOdW1iZXIgPT09IHJhbmdlLmVuZExpbmVOdW1iZXIgJiYgb3RoZXJSYW5nZS5lbmRDb2x1bW4gPiByYW5nZS5lbmRDb2x1bW4pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogQSByZXVuaW9uIG9mIHRoZSB0d28gcmFuZ2VzLlxuICAgICAgICAgKiBUaGUgc21hbGxlc3QgcG9zaXRpb24gd2lsbCBiZSB1c2VkIGFzIHRoZSBzdGFydCBwb2ludCwgYW5kIHRoZSBsYXJnZXN0IG9uZSBhcyB0aGUgZW5kIHBvaW50LlxuICAgICAgICAgKi9cbiAgICAgICAgcGx1c1JhbmdlKHJhbmdlKSB7XG4gICAgICAgICAgICByZXR1cm4gUmFuZ2UucGx1c1JhbmdlKHRoaXMsIHJhbmdlKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogQSByZXVuaW9uIG9mIHRoZSB0d28gcmFuZ2VzLlxuICAgICAgICAgKiBUaGUgc21hbGxlc3QgcG9zaXRpb24gd2lsbCBiZSB1c2VkIGFzIHRoZSBzdGFydCBwb2ludCwgYW5kIHRoZSBsYXJnZXN0IG9uZSBhcyB0aGUgZW5kIHBvaW50LlxuICAgICAgICAgKi9cbiAgICAgICAgc3RhdGljIHBsdXNSYW5nZShhLCBiKSB7XG4gICAgICAgICAgICB2YXIgc3RhcnRMaW5lTnVtYmVyLCBzdGFydENvbHVtbiwgZW5kTGluZU51bWJlciwgZW5kQ29sdW1uO1xuICAgICAgICAgICAgaWYgKGIuc3RhcnRMaW5lTnVtYmVyIDwgYS5zdGFydExpbmVOdW1iZXIpIHtcbiAgICAgICAgICAgICAgICBzdGFydExpbmVOdW1iZXIgPSBiLnN0YXJ0TGluZU51bWJlcjtcbiAgICAgICAgICAgICAgICBzdGFydENvbHVtbiA9IGIuc3RhcnRDb2x1bW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChiLnN0YXJ0TGluZU51bWJlciA9PT0gYS5zdGFydExpbmVOdW1iZXIpIHtcbiAgICAgICAgICAgICAgICBzdGFydExpbmVOdW1iZXIgPSBiLnN0YXJ0TGluZU51bWJlcjtcbiAgICAgICAgICAgICAgICBzdGFydENvbHVtbiA9IE1hdGgubWluKGIuc3RhcnRDb2x1bW4sIGEuc3RhcnRDb2x1bW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc3RhcnRMaW5lTnVtYmVyID0gYS5zdGFydExpbmVOdW1iZXI7XG4gICAgICAgICAgICAgICAgc3RhcnRDb2x1bW4gPSBhLnN0YXJ0Q29sdW1uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGIuZW5kTGluZU51bWJlciA+IGEuZW5kTGluZU51bWJlcikge1xuICAgICAgICAgICAgICAgIGVuZExpbmVOdW1iZXIgPSBiLmVuZExpbmVOdW1iZXI7XG4gICAgICAgICAgICAgICAgZW5kQ29sdW1uID0gYi5lbmRDb2x1bW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChiLmVuZExpbmVOdW1iZXIgPT09IGEuZW5kTGluZU51bWJlcikge1xuICAgICAgICAgICAgICAgIGVuZExpbmVOdW1iZXIgPSBiLmVuZExpbmVOdW1iZXI7XG4gICAgICAgICAgICAgICAgZW5kQ29sdW1uID0gTWF0aC5tYXgoYi5lbmRDb2x1bW4sIGEuZW5kQ29sdW1uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGVuZExpbmVOdW1iZXIgPSBhLmVuZExpbmVOdW1iZXI7XG4gICAgICAgICAgICAgICAgZW5kQ29sdW1uID0gYS5lbmRDb2x1bW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHN0YXJ0TGluZU51bWJlciwgc3RhcnRDb2x1bW4sIGVuZExpbmVOdW1iZXIsIGVuZENvbHVtbik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgaW50ZXJzZWN0aW9uIG9mIHRoZSB0d28gcmFuZ2VzLlxuICAgICAgICAgKi9cbiAgICAgICAgaW50ZXJzZWN0UmFuZ2VzKHJhbmdlKSB7XG4gICAgICAgICAgICByZXR1cm4gUmFuZ2UuaW50ZXJzZWN0UmFuZ2VzKHRoaXMsIHJhbmdlKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogQSBpbnRlcnNlY3Rpb24gb2YgdGhlIHR3byByYW5nZXMuXG4gICAgICAgICAqL1xuICAgICAgICBzdGF0aWMgaW50ZXJzZWN0UmFuZ2VzKGEsIGIpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHRTdGFydExpbmVOdW1iZXIgPSBhLnN0YXJ0TGluZU51bWJlciwgcmVzdWx0U3RhcnRDb2x1bW4gPSBhLnN0YXJ0Q29sdW1uLCByZXN1bHRFbmRMaW5lTnVtYmVyID0gYS5lbmRMaW5lTnVtYmVyLCByZXN1bHRFbmRDb2x1bW4gPSBhLmVuZENvbHVtbiwgb3RoZXJTdGFydExpbmVOdW1iZXIgPSBiLnN0YXJ0TGluZU51bWJlciwgb3RoZXJTdGFydENvbHVtbiA9IGIuc3RhcnRDb2x1bW4sIG90aGVyRW5kTGluZU51bWJlciA9IGIuZW5kTGluZU51bWJlciwgb3RoZXJFbmRDb2x1bW4gPSBiLmVuZENvbHVtbjtcbiAgICAgICAgICAgIGlmIChyZXN1bHRTdGFydExpbmVOdW1iZXIgPCBvdGhlclN0YXJ0TGluZU51bWJlcikge1xuICAgICAgICAgICAgICAgIHJlc3VsdFN0YXJ0TGluZU51bWJlciA9IG90aGVyU3RhcnRMaW5lTnVtYmVyO1xuICAgICAgICAgICAgICAgIHJlc3VsdFN0YXJ0Q29sdW1uID0gb3RoZXJTdGFydENvbHVtbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHJlc3VsdFN0YXJ0TGluZU51bWJlciA9PT0gb3RoZXJTdGFydExpbmVOdW1iZXIpIHtcbiAgICAgICAgICAgICAgICByZXN1bHRTdGFydENvbHVtbiA9IE1hdGgubWF4KHJlc3VsdFN0YXJ0Q29sdW1uLCBvdGhlclN0YXJ0Q29sdW1uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXN1bHRFbmRMaW5lTnVtYmVyID4gb3RoZXJFbmRMaW5lTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0RW5kTGluZU51bWJlciA9IG90aGVyRW5kTGluZU51bWJlcjtcbiAgICAgICAgICAgICAgICByZXN1bHRFbmRDb2x1bW4gPSBvdGhlckVuZENvbHVtbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHJlc3VsdEVuZExpbmVOdW1iZXIgPT09IG90aGVyRW5kTGluZU51bWJlcikge1xuICAgICAgICAgICAgICAgIHJlc3VsdEVuZENvbHVtbiA9IE1hdGgubWluKHJlc3VsdEVuZENvbHVtbiwgb3RoZXJFbmRDb2x1bW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgc2VsZWN0aW9uIGlzIG5vdyBlbXB0eVxuICAgICAgICAgICAgaWYgKHJlc3VsdFN0YXJ0TGluZU51bWJlciA+IHJlc3VsdEVuZExpbmVOdW1iZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXN1bHRTdGFydExpbmVOdW1iZXIgPT09IHJlc3VsdEVuZExpbmVOdW1iZXIgJiYgcmVzdWx0U3RhcnRDb2x1bW4gPiByZXN1bHRFbmRDb2x1bW4pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgUmFuZ2UocmVzdWx0U3RhcnRMaW5lTnVtYmVyLCByZXN1bHRTdGFydENvbHVtbiwgcmVzdWx0RW5kTGluZU51bWJlciwgcmVzdWx0RW5kQ29sdW1uKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogVGVzdCBpZiB0aGlzIHJhbmdlIGVxdWFscyBvdGhlci5cbiAgICAgICAgICovXG4gICAgICAgIGVxdWFsc1JhbmdlKG90aGVyKSB7XG4gICAgICAgICAgICByZXR1cm4gUmFuZ2UuZXF1YWxzUmFuZ2UodGhpcywgb3RoZXIpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUZXN0IGlmIHJhbmdlIGBhYCBlcXVhbHMgYGJgLlxuICAgICAgICAgKi9cbiAgICAgICAgc3RhdGljIGVxdWFsc1JhbmdlKGEsIGIpIHtcbiAgICAgICAgICAgIHJldHVybiAoISFhICYmXG4gICAgICAgICAgICAgICAgISFiICYmXG4gICAgICAgICAgICAgICAgYS5zdGFydExpbmVOdW1iZXIgPT09IGIuc3RhcnRMaW5lTnVtYmVyICYmXG4gICAgICAgICAgICAgICAgYS5zdGFydENvbHVtbiA9PT0gYi5zdGFydENvbHVtbiAmJlxuICAgICAgICAgICAgICAgIGEuZW5kTGluZU51bWJlciA9PT0gYi5lbmRMaW5lTnVtYmVyICYmXG4gICAgICAgICAgICAgICAgYS5lbmRDb2x1bW4gPT09IGIuZW5kQ29sdW1uKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0dXJuIHRoZSBlbmQgcG9zaXRpb24gKHdoaWNoIHdpbGwgYmUgYWZ0ZXIgb3IgZXF1YWwgdG8gdGhlIHN0YXJ0IHBvc2l0aW9uKVxuICAgICAgICAgKi9cbiAgICAgICAgZ2V0RW5kUG9zaXRpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IHBvc2l0aW9uXzEudnNjTW9ja1Bvc2l0aW9uLlBvc2l0aW9uKHRoaXMuZW5kTGluZU51bWJlciwgdGhpcy5lbmRDb2x1bW4pO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXR1cm4gdGhlIHN0YXJ0IHBvc2l0aW9uICh3aGljaCB3aWxsIGJlIGJlZm9yZSBvciBlcXVhbCB0byB0aGUgZW5kIHBvc2l0aW9uKVxuICAgICAgICAgKi9cbiAgICAgICAgZ2V0U3RhcnRQb3NpdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgcG9zaXRpb25fMS52c2NNb2NrUG9zaXRpb24uUG9zaXRpb24odGhpcy5zdGFydExpbmVOdW1iZXIsIHRoaXMuc3RhcnRDb2x1bW4pO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUcmFuc2Zvcm0gdG8gYSB1c2VyIHByZXNlbnRhYmxlIHN0cmluZyByZXByZXNlbnRhdGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIHRvU3RyaW5nKCkge1xuICAgICAgICAgICAgcmV0dXJuICdbJyArIHRoaXMuc3RhcnRMaW5lTnVtYmVyICsgJywnICsgdGhpcy5zdGFydENvbHVtbiArICcgLT4gJyArIHRoaXMuZW5kTGluZU51bWJlciArICcsJyArIHRoaXMuZW5kQ29sdW1uICsgJ10nO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDcmVhdGUgYSBuZXcgcmFuZ2UgdXNpbmcgdGhpcyByYW5nZSdzIHN0YXJ0IHBvc2l0aW9uLCBhbmQgdXNpbmcgZW5kTGluZU51bWJlciBhbmQgZW5kQ29sdW1uIGFzIHRoZSBlbmQgcG9zaXRpb24uXG4gICAgICAgICAqL1xuICAgICAgICBzZXRFbmRQb3NpdGlvbihlbmRMaW5lTnVtYmVyLCBlbmRDb2x1bW4pIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmFuZ2UodGhpcy5zdGFydExpbmVOdW1iZXIsIHRoaXMuc3RhcnRDb2x1bW4sIGVuZExpbmVOdW1iZXIsIGVuZENvbHVtbik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENyZWF0ZSBhIG5ldyByYW5nZSB1c2luZyB0aGlzIHJhbmdlJ3MgZW5kIHBvc2l0aW9uLCBhbmQgdXNpbmcgc3RhcnRMaW5lTnVtYmVyIGFuZCBzdGFydENvbHVtbiBhcyB0aGUgc3RhcnQgcG9zaXRpb24uXG4gICAgICAgICAqL1xuICAgICAgICBzZXRTdGFydFBvc2l0aW9uKHN0YXJ0TGluZU51bWJlciwgc3RhcnRDb2x1bW4pIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUmFuZ2Uoc3RhcnRMaW5lTnVtYmVyLCBzdGFydENvbHVtbiwgdGhpcy5lbmRMaW5lTnVtYmVyLCB0aGlzLmVuZENvbHVtbik7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENyZWF0ZSBhIG5ldyBlbXB0eSByYW5nZSB1c2luZyB0aGlzIHJhbmdlJ3Mgc3RhcnQgcG9zaXRpb24uXG4gICAgICAgICAqL1xuICAgICAgICBjb2xsYXBzZVRvU3RhcnQoKSB7XG4gICAgICAgICAgICByZXR1cm4gUmFuZ2UuY29sbGFwc2VUb1N0YXJ0KHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDcmVhdGUgYSBuZXcgZW1wdHkgcmFuZ2UgdXNpbmcgdGhpcyByYW5nZSdzIHN0YXJ0IHBvc2l0aW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgc3RhdGljIGNvbGxhcHNlVG9TdGFydChyYW5nZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBSYW5nZShyYW5nZS5zdGFydExpbmVOdW1iZXIsIHJhbmdlLnN0YXJ0Q29sdW1uLCByYW5nZS5zdGFydExpbmVOdW1iZXIsIHJhbmdlLnN0YXJ0Q29sdW1uKTtcbiAgICAgICAgfVxuICAgICAgICAvLyAtLS1cbiAgICAgICAgc3RhdGljIGZyb21Qb3NpdGlvbnMoc3RhcnQsIGVuZCA9IHN0YXJ0KSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFJhbmdlKHN0YXJ0LmxpbmVOdW1iZXIsIHN0YXJ0LmNvbHVtbiwgZW5kLmxpbmVOdW1iZXIsIGVuZC5jb2x1bW4pO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDcmVhdGUgYSBgUmFuZ2VgIGZyb20gYW4gYElSYW5nZWAuXG4gICAgICAgICAqL1xuICAgICAgICBzdGF0aWMgbGlmdChyYW5nZSkge1xuICAgICAgICAgICAgaWYgKCFyYW5nZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBSYW5nZShyYW5nZS5zdGFydExpbmVOdW1iZXIsIHJhbmdlLnN0YXJ0Q29sdW1uLCByYW5nZS5lbmRMaW5lTnVtYmVyLCByYW5nZS5lbmRDb2x1bW4pO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUZXN0IGlmIGBvYmpgIGlzIGFuIGBJUmFuZ2VgLlxuICAgICAgICAgKi9cbiAgICAgICAgc3RhdGljIGlzSVJhbmdlKG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIChvYmpcbiAgICAgICAgICAgICAgICAmJiAodHlwZW9mIG9iai5zdGFydExpbmVOdW1iZXIgPT09ICdudW1iZXInKVxuICAgICAgICAgICAgICAgICYmICh0eXBlb2Ygb2JqLnN0YXJ0Q29sdW1uID09PSAnbnVtYmVyJylcbiAgICAgICAgICAgICAgICAmJiAodHlwZW9mIG9iai5lbmRMaW5lTnVtYmVyID09PSAnbnVtYmVyJylcbiAgICAgICAgICAgICAgICAmJiAodHlwZW9mIG9iai5lbmRDb2x1bW4gPT09ICdudW1iZXInKSk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRlc3QgaWYgdGhlIHR3byByYW5nZXMgYXJlIHRvdWNoaW5nIGluIGFueSB3YXkuXG4gICAgICAgICAqL1xuICAgICAgICBzdGF0aWMgYXJlSW50ZXJzZWN0aW5nT3JUb3VjaGluZyhhLCBiKSB7XG4gICAgICAgICAgICAvLyBDaGVjayBpZiBgYWAgaXMgYmVmb3JlIGBiYFxuICAgICAgICAgICAgaWYgKGEuZW5kTGluZU51bWJlciA8IGIuc3RhcnRMaW5lTnVtYmVyIHx8IChhLmVuZExpbmVOdW1iZXIgPT09IGIuc3RhcnRMaW5lTnVtYmVyICYmIGEuZW5kQ29sdW1uIDwgYi5zdGFydENvbHVtbikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBDaGVjayBpZiBgYmAgaXMgYmVmb3JlIGBhYFxuICAgICAgICAgICAgaWYgKGIuZW5kTGluZU51bWJlciA8IGEuc3RhcnRMaW5lTnVtYmVyIHx8IChiLmVuZExpbmVOdW1iZXIgPT09IGEuc3RhcnRMaW5lTnVtYmVyICYmIGIuZW5kQ29sdW1uIDwgYS5zdGFydENvbHVtbikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBUaGVzZSByYW5nZXMgbXVzdCBpbnRlcnNlY3RcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGZ1bmN0aW9uIHRoYXQgY29tcGFyZXMgcmFuZ2VzLCB1c2VmdWwgZm9yIHNvcnRpbmcgcmFuZ2VzXG4gICAgICAgICAqIEl0IHdpbGwgZmlyc3QgY29tcGFyZSByYW5nZXMgb24gdGhlIHN0YXJ0UG9zaXRpb24gYW5kIHRoZW4gb24gdGhlIGVuZFBvc2l0aW9uXG4gICAgICAgICAqL1xuICAgICAgICBzdGF0aWMgY29tcGFyZVJhbmdlc1VzaW5nU3RhcnRzKGEsIGIpIHtcbiAgICAgICAgICAgIGxldCBhU3RhcnRMaW5lTnVtYmVyID0gYS5zdGFydExpbmVOdW1iZXIgfCAwO1xuICAgICAgICAgICAgbGV0IGJTdGFydExpbmVOdW1iZXIgPSBiLnN0YXJ0TGluZU51bWJlciB8IDA7XG4gICAgICAgICAgICBpZiAoYVN0YXJ0TGluZU51bWJlciA9PT0gYlN0YXJ0TGluZU51bWJlcikge1xuICAgICAgICAgICAgICAgIGxldCBhU3RhcnRDb2x1bW4gPSBhLnN0YXJ0Q29sdW1uIHwgMDtcbiAgICAgICAgICAgICAgICBsZXQgYlN0YXJ0Q29sdW1uID0gYi5zdGFydENvbHVtbiB8IDA7XG4gICAgICAgICAgICAgICAgaWYgKGFTdGFydENvbHVtbiA9PT0gYlN0YXJ0Q29sdW1uKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBhRW5kTGluZU51bWJlciA9IGEuZW5kTGluZU51bWJlciB8IDA7XG4gICAgICAgICAgICAgICAgICAgIGxldCBiRW5kTGluZU51bWJlciA9IGIuZW5kTGluZU51bWJlciB8IDA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhRW5kTGluZU51bWJlciA9PT0gYkVuZExpbmVOdW1iZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhRW5kQ29sdW1uID0gYS5lbmRDb2x1bW4gfCAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGJFbmRDb2x1bW4gPSBiLmVuZENvbHVtbiB8IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYUVuZENvbHVtbiAtIGJFbmRDb2x1bW47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFFbmRMaW5lTnVtYmVyIC0gYkVuZExpbmVOdW1iZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBhU3RhcnRDb2x1bW4gLSBiU3RhcnRDb2x1bW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYVN0YXJ0TGluZU51bWJlciAtIGJTdGFydExpbmVOdW1iZXI7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgZnVuY3Rpb24gdGhhdCBjb21wYXJlcyByYW5nZXMsIHVzZWZ1bCBmb3Igc29ydGluZyByYW5nZXNcbiAgICAgICAgICogSXQgd2lsbCBmaXJzdCBjb21wYXJlIHJhbmdlcyBvbiB0aGUgZW5kUG9zaXRpb24gYW5kIHRoZW4gb24gdGhlIHN0YXJ0UG9zaXRpb25cbiAgICAgICAgICovXG4gICAgICAgIHN0YXRpYyBjb21wYXJlUmFuZ2VzVXNpbmdFbmRzKGEsIGIpIHtcbiAgICAgICAgICAgIGlmIChhLmVuZExpbmVOdW1iZXIgPT09IGIuZW5kTGluZU51bWJlcikge1xuICAgICAgICAgICAgICAgIGlmIChhLmVuZENvbHVtbiA9PT0gYi5lbmRDb2x1bW4pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGEuc3RhcnRMaW5lTnVtYmVyID09PSBiLnN0YXJ0TGluZU51bWJlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuc3RhcnRDb2x1bW4gLSBiLnN0YXJ0Q29sdW1uO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhLnN0YXJ0TGluZU51bWJlciAtIGIuc3RhcnRMaW5lTnVtYmVyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYS5lbmRDb2x1bW4gLSBiLmVuZENvbHVtbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhLmVuZExpbmVOdW1iZXIgLSBiLmVuZExpbmVOdW1iZXI7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRlc3QgaWYgdGhlIHJhbmdlIHNwYW5zIG11bHRpcGxlIGxpbmVzLlxuICAgICAgICAgKi9cbiAgICAgICAgc3RhdGljIHNwYW5zTXVsdGlwbGVMaW5lcyhyYW5nZSkge1xuICAgICAgICAgICAgcmV0dXJuIHJhbmdlLmVuZExpbmVOdW1iZXIgPiByYW5nZS5zdGFydExpbmVOdW1iZXI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdnNjTW9ja1JhbmdlLlJhbmdlID0gUmFuZ2U7XG59KSh2c2NNb2NrUmFuZ2UgPSBleHBvcnRzLnZzY01vY2tSYW5nZSB8fCAoZXhwb3J0cy52c2NNb2NrUmFuZ2UgPSB7fSkpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cmFuZ2UuanMubWFwIl19
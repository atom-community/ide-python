"use strict";

var __decorate = void 0 && (void 0).__decorate || function (decorators, target, key, desc) {
  var c = arguments.length,
      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,
      d;
  if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
  return c > 3 && r && Object.defineProperty(target, key, r), r;
};

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

let MockRegistry = class MockRegistry {
  constructor(keys, values) {
    this.keys = keys;
    this.values = values;
  }

  getKeys(key, hive, arch) {
    return __awaiter(this, void 0, void 0, function* () {
      const items = this.keys.find(item => {
        if (typeof item.arch === 'number') {
          return item.key === key && item.hive === hive && item.arch === arch;
        }

        return item.key === key && item.hive === hive;
      });
      return items ? Promise.resolve(items.values) : Promise.resolve([]);
    });
  }

  getValue(key, hive, arch, name) {
    return __awaiter(this, void 0, void 0, function* () {
      const items = this.values.find(item => {
        if (item.key !== key || item.hive !== hive) {
          return false;
        }

        if (typeof item.arch === 'number' && item.arch !== arch) {
          return false;
        }

        if (name && item.name !== name) {
          return false;
        }

        return true;
      });
      return items ? Promise.resolve(items.value) : Promise.resolve(null);
    });
  }

};
MockRegistry = __decorate([inversify_1.injectable()], MockRegistry);
exports.MockRegistry = MockRegistry; // tslint:disable-next-line:max-classes-per-file

let MockInterpreterVersionProvider = class MockInterpreterVersionProvider {
  constructor(displayName, useDefaultDisplayName = false, pipVersionPromise) {
    this.displayName = displayName;
    this.useDefaultDisplayName = useDefaultDisplayName;
    this.pipVersionPromise = pipVersionPromise;
  }

  getVersion(pythonPath, defaultDisplayName) {
    return __awaiter(this, void 0, void 0, function* () {
      return this.useDefaultDisplayName ? Promise.resolve(defaultDisplayName) : Promise.resolve(this.displayName);
    });
  }

  getPipVersion(pythonPath) {
    return __awaiter(this, void 0, void 0, function* () {
      // tslint:disable-next-line:no-non-null-assertion
      return this.pipVersionPromise;
    });
  } // tslint:disable-next-line:no-empty


  dispose() {}

};
MockInterpreterVersionProvider = __decorate([inversify_1.injectable()], MockInterpreterVersionProvider);
exports.MockInterpreterVersionProvider = MockInterpreterVersionProvider; // tslint:disable-next-line:no-any max-classes-per-file

class MockState {
  // tslint:disable-next-line:no-any
  constructor(data) {
    this.data = data;
  } // tslint:disable-next-line:no-any


  get value() {
    return this.data;
  }

  updateValue(data) {
    return __awaiter(this, void 0, void 0, function* () {
      this.data = data;
    });
  }

}

exports.MockState = MockState;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vY2tzLmpzIl0sIm5hbWVzIjpbIl9fZGVjb3JhdGUiLCJkZWNvcmF0b3JzIiwidGFyZ2V0Iiwia2V5IiwiZGVzYyIsImMiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJyIiwiT2JqZWN0IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZCIsIlJlZmxlY3QiLCJkZWNvcmF0ZSIsImkiLCJkZWZpbmVQcm9wZXJ0eSIsIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJleHBvcnRzIiwiaW52ZXJzaWZ5XzEiLCJyZXF1aXJlIiwiTW9ja1JlZ2lzdHJ5IiwiY29uc3RydWN0b3IiLCJrZXlzIiwidmFsdWVzIiwiZ2V0S2V5cyIsImhpdmUiLCJhcmNoIiwiaXRlbXMiLCJmaW5kIiwiaXRlbSIsImdldFZhbHVlIiwibmFtZSIsImluamVjdGFibGUiLCJNb2NrSW50ZXJwcmV0ZXJWZXJzaW9uUHJvdmlkZXIiLCJkaXNwbGF5TmFtZSIsInVzZURlZmF1bHREaXNwbGF5TmFtZSIsInBpcFZlcnNpb25Qcm9taXNlIiwiZ2V0VmVyc2lvbiIsInB5dGhvblBhdGgiLCJkZWZhdWx0RGlzcGxheU5hbWUiLCJnZXRQaXBWZXJzaW9uIiwiZGlzcG9zZSIsIk1vY2tTdGF0ZSIsImRhdGEiLCJ1cGRhdGVWYWx1ZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0EsSUFBSUEsVUFBVSxHQUFJLFVBQVEsU0FBS0EsVUFBZCxJQUE2QixVQUFVQyxVQUFWLEVBQXNCQyxNQUF0QixFQUE4QkMsR0FBOUIsRUFBbUNDLElBQW5DLEVBQXlDO0FBQ25GLE1BQUlDLENBQUMsR0FBR0MsU0FBUyxDQUFDQyxNQUFsQjtBQUFBLE1BQTBCQyxDQUFDLEdBQUdILENB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QUFiVzs7QUFlaEIxQixPQUFPLENBQUN5QixTQUFSLEdBQW9CQSxTQUFwQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XG59O1xudmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBpbnZlcnNpZnlfMSA9IHJlcXVpcmUoXCJpbnZlcnNpZnlcIik7XG5sZXQgTW9ja1JlZ2lzdHJ5ID0gY2xhc3MgTW9ja1JlZ2lzdHJ5IHtcbiAgICBjb25zdHJ1Y3RvcihrZXlzLCB2YWx1ZXMpIHtcbiAgICAgICAgdGhpcy5rZXlzID0ga2V5cztcbiAgICAgICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXM7XG4gICAgfVxuICAgIGdldEtleXMoa2V5LCBoaXZlLCBhcmNoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICBjb25zdCBpdGVtcyA9IHRoaXMua2V5cy5maW5kKGl0ZW0gPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbS5hcmNoID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5rZXkgPT09IGtleSAmJiBpdGVtLmhpdmUgPT09IGhpdmUgJiYgaXRlbS5hcmNoID09PSBhcmNoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5rZXkgPT09IGtleSAmJiBpdGVtLmhpdmUgPT09IGhpdmU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBpdGVtcyA/IFByb21pc2UucmVzb2x2ZShpdGVtcy52YWx1ZXMpIDogUHJvbWlzZS5yZXNvbHZlKFtdKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldFZhbHVlKGtleSwgaGl2ZSwgYXJjaCwgbmFtZSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLnZhbHVlcy5maW5kKGl0ZW0gPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLmtleSAhPT0ga2V5IHx8IGl0ZW0uaGl2ZSAhPT0gaGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbS5hcmNoID09PSAnbnVtYmVyJyAmJiBpdGVtLmFyY2ggIT09IGFyY2gpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobmFtZSAmJiBpdGVtLm5hbWUgIT09IG5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW1zID8gUHJvbWlzZS5yZXNvbHZlKGl0ZW1zLnZhbHVlKSA6IFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgICAgICAgfSk7XG4gICAgfVxufTtcbk1vY2tSZWdpc3RyeSA9IF9fZGVjb3JhdGUoW1xuICAgIGludmVyc2lmeV8xLmluamVjdGFibGUoKVxuXSwgTW9ja1JlZ2lzdHJ5KTtcbmV4cG9ydHMuTW9ja1JlZ2lzdHJ5ID0gTW9ja1JlZ2lzdHJ5O1xuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1jbGFzc2VzLXBlci1maWxlXG5sZXQgTW9ja0ludGVycHJldGVyVmVyc2lvblByb3ZpZGVyID0gY2xhc3MgTW9ja0ludGVycHJldGVyVmVyc2lvblByb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihkaXNwbGF5TmFtZSwgdXNlRGVmYXVsdERpc3BsYXlOYW1lID0gZmFsc2UsIHBpcFZlcnNpb25Qcm9taXNlKSB7XG4gICAgICAgIHRoaXMuZGlzcGxheU5hbWUgPSBkaXNwbGF5TmFtZTtcbiAgICAgICAgdGhpcy51c2VEZWZhdWx0RGlzcGxheU5hbWUgPSB1c2VEZWZhdWx0RGlzcGxheU5hbWU7XG4gICAgICAgIHRoaXMucGlwVmVyc2lvblByb21pc2UgPSBwaXBWZXJzaW9uUHJvbWlzZTtcbiAgICB9XG4gICAgZ2V0VmVyc2lvbihweXRob25QYXRoLCBkZWZhdWx0RGlzcGxheU5hbWUpIHtcbiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnVzZURlZmF1bHREaXNwbGF5TmFtZSA/IFByb21pc2UucmVzb2x2ZShkZWZhdWx0RGlzcGxheU5hbWUpIDogUHJvbWlzZS5yZXNvbHZlKHRoaXMuZGlzcGxheU5hbWUpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0UGlwVmVyc2lvbihweXRob25QYXRoKSB7XG4gICAgICAgIHJldHVybiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5waXBWZXJzaW9uUHJvbWlzZTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1lbXB0eVxuICAgIGRpc3Bvc2UoKSB7IH1cbn07XG5Nb2NrSW50ZXJwcmV0ZXJWZXJzaW9uUHJvdmlkZXIgPSBfX2RlY29yYXRlKFtcbiAgICBpbnZlcnNpZnlfMS5pbmplY3RhYmxlKClcbl0sIE1vY2tJbnRlcnByZXRlclZlcnNpb25Qcm92aWRlcik7XG5leHBvcnRzLk1vY2tJbnRlcnByZXRlclZlcnNpb25Qcm92aWRlciA9IE1vY2tJbnRlcnByZXRlclZlcnNpb25Qcm92aWRlcjtcbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnkgbWF4LWNsYXNzZXMtcGVyLWZpbGVcbmNsYXNzIE1vY2tTdGF0ZSB7XG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWFueVxuICAgIGNvbnN0cnVjdG9yKGRhdGEpIHtcbiAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgICB9XG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWFueVxuICAgIGdldCB2YWx1ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YTtcbiAgICB9XG4gICAgdXBkYXRlVmFsdWUoZGF0YSkge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZXhwb3J0cy5Nb2NrU3RhdGUgPSBNb2NrU3RhdGU7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1tb2Nrcy5qcy5tYXAiXX0=
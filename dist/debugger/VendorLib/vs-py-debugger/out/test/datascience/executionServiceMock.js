// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

var __awaiter = void 0 && (void 0).__awaiter || function (thisArg, _arguments, P, generator) {
  return new (P || (P = Promise))(function (resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }

    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }

    function step(result) {
      result.done ? resolve(result.value) : new P(function (resolve) {
        resolve(result.value);
      }).then(fulfilled, rejected);
    }

    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};

Object.defineProperty(exports, "__esModule", {
  value: true
});

const errorUtils_1 = require("../../client/common/errors/errorUtils");

const moduleNotInstalledError_1 = require("../../client/common/errors/moduleNotInstalledError");

const decoder_1 = require("../../client/common/process/decoder");

const proc_1 = require("../../client/common/process/proc");

const platform_1 = require("../../client/common/utils/platform");

class MockPythonExecutionService {
  constructor() {
    this.pythonPath = 'python';
    this.procService = new proc_1.ProcessService(new decoder_1.BufferDecoder());
  }

  getInterpreterInformation() {
    return Promise.resolve({
      path: '',
      version: '3.6',
      sysVersion: '1.0',
      sysPrefix: '1.0',
      architecture: platform_1.Architecture.x64,
      version_info: [3, 6, 0, 'beta']
    });
  }

  getExecutablePath() {
    return Promise.resolve(this.pythonPath);
  }

  isModuleInstalled(moduleName) {
    return this.procService.exec(this.pythonPath, ['-c', `import ${moduleName}`], {
      throwOnStdErr: true
    }).then(() => true).catch(() => false);
  }

  execObservable(args, options) {
    const opts = Object.assign({}, options);
    return this.procService.execObservable(this.pythonPath, args, opts);
  }

  execModuleObservable(moduleName, args, options) {
    const opts = Object.assign({}, options);
    return this.procService.execObservable(this.pythonPath, ['-m', moduleName, ...args], opts);
  }

  exec(args, options) {
    const opts = Object.assign({}, options);
    return this.procService.exec(this.pythonPath, args, opts);
  }

  execModule(moduleName, args, options) {
    return __awaiter(this, void 0, void 0, function* () {
      const opts = Object.assign({}, options);
      const result = yield this.procService.exec(this.pythonPath, ['-m', moduleName, ...args], opts); // If a module is not installed we'll have something in stderr.

      if (moduleName && errorUtils_1.ErrorUtils.outputHasModuleNotInstalledError(moduleName, result.stderr)) {
        const isInstalled = yield this.isModuleInstalled(moduleName);

        if (!isInstalled) {
          throw new moduleNotInstalledError_1.ModuleNotInstalledError(moduleName);
        }
      }

      return result;
    });
  }

}

exports.MockPythonExecutionService = MockPythonExecutionService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4ZWN1dGlvblNlcnZpY2VNb2NrLmpzIl0sIm5hbWVzIjpbIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJlcnJvclV0aWxzXzEiLCJyZXF1aXJlIiwibW9kdWxlTm90SW5zdGFsbGVkRXJyb3JfMSIsImRlY29kZXJfMSIsInByb2NfMSIsInBsYXRmb3JtXzEiLCJNb2NrUHl0aG9uRXhlY3V0aW9uU2VydmljZSIsImNvbnN0cnVjdG9yIiwicHl0aG9uUGF0aCIsInByb2NTZXJ2aWNlIiwiUHJvY2Vzc1NlcnZpY2UiLCJCdWZmZXJEZWNvZGVyIiwiZ2V0SW50ZXJwcmV0ZXJJbmZvcm1hdGlvbiIsInBhdGgiLCJ2ZXJzaW9uIiwic3lzVmVyc2lvbiIsInN5c1ByZWZpeCIsImFyY2hpdGVjdHVyZSIsIkFyY2hpdGVjdHVyZSIsIng2NCIsInZlcnNpb25faW5mbyIsImdldEV4ZWN1dGFibGVQYXRoIiwiaXNNb2R1bGVJbnN0YWxsZWQiLCJtb2R1bGVOYW1lIiwiZXhlYyIsInRocm93T25TdGRFcnIiLCJjYXRjaCIsImV4ZWNPYnNlcnZhYmxlIiwiYXJncyIsIm9wdGlvbnMiLCJvcHRzIiwiYXNzaWduIiwiZXhlY01vZHVsZU9ic2VydmFibGUiLCJleGVjTW9kdWxlIiwiRXJyb3JVdGlscyIsIm91dHB1dEhhc01vZHVsZU5vdEluc3RhbGxlZEVycm9yIiwic3RkZXJyIiwiaXNJbnN0YWxsZWQiLCJNb2R1bGVOb3RJbnN0YWxsZWRFcnJvciJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUNBLElBQUlBLFNBQVMsR0FBSSxVQUFRLFNBQUtBLFNBQWQs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QUNERyxFQUFBQSxVQUFVLENBQUNWLFVBQUQsRUFBYUssSUFBYixFQUFtQkMsT0FBbkIsRUFBNEI7QUFDbEMsV0FBT2xELFNBQVMsQ0FBQyxJQUFELEVBQU8sS0FBSyxDQUFaLEVBQWUsS0FBSyxDQUFwQixFQUF1QixhQUFhO0FBQ2hELFlBQU1tRCxJQUFJLEdBQUdqQyxNQUFNLENBQUNrQyxNQUFQLENBQWMsRUFBZCxFQUFrQkYsT0FBbEIsQ0FBYjtBQUNBLFlBQU1wQyxNQUFNLEdBQUcsTUFBTSxLQUFLZ0IsV0FBTCxDQUFpQmUsSUFBakIsQ0FBc0IsS0FBS2hCLFVBQTNCLEVBQXVDLENBQUMsSUFBRCxFQUFPZSxVQUFQLEVBQW1CLEdBQUdLLElBQXRCLENBQXZDLEVBQW9FRSxJQUFwRSxDQUFyQixDQUZnRCxDQUdoRDs7QUFDQSxVQUFJUCxVQUFVLElBQUl2QixZQUFZLENBQUNrQyxVQUFiLENBQXdCQyxnQ0FBeEIsQ0FBeURaLFVBQXpELEVBQXFFOUIsTUFBTSxDQUFDMkMsTUFBNUUsQ0FBbEIsRUFBdUc7QUFDbkcsY0FBTUMsV0FBVyxHQUFHLE1BQU0sS0FBS2YsaUJBQUwsQ0FBdUJDLFVBQXZCLENBQTFCOztBQUNBLFlBQUksQ0FBQ2MsV0FBTCxFQUFrQjtBQUNkLGdCQUFNLElBQUluQyx5QkFBeUIsQ0FBQ29DLHVCQUE5QixDQUFzRGYsVUFBdEQsQ0FBTjtBQUNIO0FBQ0o7O0FBQ0QsYUFBTzlCLE1BQVA7QUFDSCxLQVhlLENBQWhCO0FBWUg7O0FBL0M0Qjs7QUFpRGpDTSxPQUFPLENBQUNPLDBCQUFSLEdBQXFDQSwwQkFBckMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cbid1c2Ugc3RyaWN0JztcbnZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICAgIHJldHVybiBuZXcgKFAgfHwgKFAgPSBQcm9taXNlKSkoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUocmVzdWx0LnZhbHVlKTsgfSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfVxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gICAgfSk7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuY29uc3QgZXJyb3JVdGlsc18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vZXJyb3JzL2Vycm9yVXRpbHNcIik7XG5jb25zdCBtb2R1bGVOb3RJbnN0YWxsZWRFcnJvcl8xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vZXJyb3JzL21vZHVsZU5vdEluc3RhbGxlZEVycm9yXCIpO1xuY29uc3QgZGVjb2Rlcl8xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vcHJvY2Vzcy9kZWNvZGVyXCIpO1xuY29uc3QgcHJvY18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vcHJvY2Vzcy9wcm9jXCIpO1xuY29uc3QgcGxhdGZvcm1fMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL3V0aWxzL3BsYXRmb3JtXCIpO1xuY2xhc3MgTW9ja1B5dGhvbkV4ZWN1dGlvblNlcnZpY2Uge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnB5dGhvblBhdGggPSAncHl0aG9uJztcbiAgICAgICAgdGhpcy5wcm9jU2VydmljZSA9IG5ldyBwcm9jXzEuUHJvY2Vzc1NlcnZpY2UobmV3IGRlY29kZXJfMS5CdWZmZXJEZWNvZGVyKCkpO1xuICAgIH1cbiAgICBnZXRJbnRlcnByZXRlckluZm9ybWF0aW9uKCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgICAgICAgIHBhdGg6ICcnLFxuICAgICAgICAgICAgdmVyc2lvbjogJzMuNicsXG4gICAgICAgICAgICBzeXNWZXJzaW9uOiAnMS4wJyxcbiAgICAgICAgICAgIHN5c1ByZWZpeDogJzEuMCcsXG4gICAgICAgICAgICBhcmNoaXRlY3R1cmU6IHBsYXRmb3JtXzEuQXJjaGl0ZWN0dXJlLng2NCxcbiAgICAgICAgICAgIHZlcnNpb25faW5mbzogWzMsIDYsIDAsICdiZXRhJ11cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGdldEV4ZWN1dGFibGVQYXRoKCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMucHl0aG9uUGF0aCk7XG4gICAgfVxuICAgIGlzTW9kdWxlSW5zdGFsbGVkKG1vZHVsZU5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY1NlcnZpY2UuZXhlYyh0aGlzLnB5dGhvblBhdGgsIFsnLWMnLCBgaW1wb3J0ICR7bW9kdWxlTmFtZX1gXSwgeyB0aHJvd09uU3RkRXJyOiB0cnVlIH0pXG4gICAgICAgICAgICAudGhlbigoKSA9PiB0cnVlKS5jYXRjaCgoKSA9PiBmYWxzZSk7XG4gICAgfVxuICAgIGV4ZWNPYnNlcnZhYmxlKGFyZ3MsIG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3Qgb3B0cyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMpO1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9jU2VydmljZS5leGVjT2JzZXJ2YWJsZSh0aGlzLnB5dGhvblBhdGgsIGFyZ3MsIG9wdHMpO1xuICAgIH1cbiAgICBleGVjTW9kdWxlT2JzZXJ2YWJsZShtb2R1bGVOYW1lLCBhcmdzLCBvcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IG9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY1NlcnZpY2UuZXhlY09ic2VydmFibGUodGhpcy5weXRob25QYXRoLCBbJy1tJywgbW9kdWxlTmFtZSwgLi4uYXJnc10sIG9wdHMpO1xuICAgIH1cbiAgICBleGVjKGFyZ3MsIG9wdGlvbnMpIHtcbiAgICAgICAgY29uc3Qgb3B0cyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMpO1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9jU2VydmljZS5leGVjKHRoaXMucHl0aG9uUGF0aCwgYXJncywgb3B0cyk7XG4gICAgfVxuICAgIGV4ZWNNb2R1bGUobW9kdWxlTmFtZSwgYXJncywgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc3Qgb3B0cyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0geWllbGQgdGhpcy5wcm9jU2VydmljZS5leGVjKHRoaXMucHl0aG9uUGF0aCwgWyctbScsIG1vZHVsZU5hbWUsIC4uLmFyZ3NdLCBvcHRzKTtcbiAgICAgICAgICAgIC8vIElmIGEgbW9kdWxlIGlzIG5vdCBpbnN0YWxsZWQgd2UnbGwgaGF2ZSBzb21ldGhpbmcgaW4gc3RkZXJyLlxuICAgICAgICAgICAgaWYgKG1vZHVsZU5hbWUgJiYgZXJyb3JVdGlsc18xLkVycm9yVXRpbHMub3V0cHV0SGFzTW9kdWxlTm90SW5zdGFsbGVkRXJyb3IobW9kdWxlTmFtZSwgcmVzdWx0LnN0ZGVycikpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpc0luc3RhbGxlZCA9IHlpZWxkIHRoaXMuaXNNb2R1bGVJbnN0YWxsZWQobW9kdWxlTmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKCFpc0luc3RhbGxlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgbW9kdWxlTm90SW5zdGFsbGVkRXJyb3JfMS5Nb2R1bGVOb3RJbnN0YWxsZWRFcnJvcihtb2R1bGVOYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9KTtcbiAgICB9XG59XG5leHBvcnRzLk1vY2tQeXRob25FeGVjdXRpb25TZXJ2aWNlID0gTW9ja1B5dGhvbkV4ZWN1dGlvblNlcnZpY2U7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1leGVjdXRpb25TZXJ2aWNlTW9jay5qcy5tYXAiXX0=
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

const TypeMoq = require("typemoq");

const vscode_1 = require("vscode");

const types_1 = require("../../client/common/application/types");

const currentProcess_1 = require("../../client/common/process/currentProcess");

const types_2 = require("../../client/common/process/types");

const types_3 = require("../../client/common/types");

const codeCssGenerator_1 = require("../../client/datascience/codeCssGenerator");

const history_1 = require("../../client/datascience/history");

const historyProvider_1 = require("../../client/datascience/historyProvider");

const jupyterExecution_1 = require("../../client/datascience/jupyterExecution");

const jupyterImporter_1 = require("../../client/datascience/jupyterImporter");

const jupyterProcess_1 = require("../../client/datascience/jupyterProcess");

const jupyterServer_1 = require("../../client/datascience/jupyterServer");

const statusProvider_1 = require("../../client/datascience/statusProvider");

const types_4 = require("../../client/datascience/types");

const contracts_1 = require("../../client/interpreter/contracts");

const serviceRegistry_1 = require("../unittests/serviceRegistry");

const executionServiceMock_1 = require("./executionServiceMock");

class DataScienceIocContainer extends serviceRegistry_1.UnitTestIocContainer {
  constructor() {
    super();
  }

  registerDataScienceTypes() {
    this.registerFileSystemTypes();
    this.serviceManager.addSingleton(types_4.IJupyterExecution, jupyterExecution_1.JupyterExecution);
    this.serviceManager.addSingleton(types_4.IHistoryProvider, historyProvider_1.HistoryProvider);
    this.serviceManager.add(types_4.IHistory, history_1.History);
    this.serviceManager.add(types_4.INotebookImporter, jupyterImporter_1.JupyterImporter);
    this.serviceManager.add(types_4.INotebookServer, jupyterServer_1.JupyterServer);
    this.serviceManager.add(types_4.INotebookProcess, jupyterProcess_1.JupyterProcess);
    this.serviceManager.addSingleton(types_4.ICodeCssGenerator, codeCssGenerator_1.CodeCssGenerator);
    this.serviceManager.addSingleton(types_4.IStatusProvider, statusProvider_1.StatusProvider); // Also setup a mock execution service and interpreter service

    const logger = TypeMoq.Mock.ofType();
    const pythonExecutionService = new executionServiceMock_1.MockPythonExecutionService();
    const factory = TypeMoq.Mock.ofType();
    const interpreterService = TypeMoq.Mock.ofType();
    const condaService = TypeMoq.Mock.ofType();
    const appShell = TypeMoq.Mock.ofType();
    const documentManager = TypeMoq.Mock.ofType();
    const workspaceService = TypeMoq.Mock.ofType();
    const configurationService = TypeMoq.Mock.ofType();
    const currentProcess = new currentProcess_1.CurrentProcess();
    const pythonSettings = TypeMoq.Mock.ofType();
    const workspaceConfig = TypeMoq.Mock.ofType();
    this.serviceManager.addSingletonInstance(types_3.ILogger, logger.object);
    this.serviceManager.addSingletonInstance(types_2.IPythonExecutionFactory, factory.object);
    this.serviceManager.addSingletonInstance(contracts_1.IInterpreterService, interpreterService.object);
    this.serviceManager.addSingletonInstance(contracts_1.ICondaService, condaService.object);
    this.serviceManager.addSingletonInstance(types_1.IApplicationShell, appShell.object);
    this.serviceManager.addSingletonInstance(types_1.IDocumentManager, documentManager.object);
    this.serviceManager.addSingletonInstance(types_1.IWorkspaceService, workspaceService.object);
    this.serviceManager.addSingletonInstance(types_3.IConfigurationService, configurationService.object);
    this.serviceManager.addSingletonInstance(types_3.ICurrentProcess, currentProcess);
    const dummyDisposable = {
      dispose: () => {
        return;
      }
    };
    appShell.setup(a => a.showErrorMessage(TypeMoq.It.isAnyString())).returns(() => Promise.resolve(''));
    appShell.setup(a => a.showInformationMessage(TypeMoq.It.isAny(), TypeMoq.It.isAny())).returns(() => Promise.resolve(''));
    appShell.setup(a => a.showSaveDialog(TypeMoq.It.isAny())).returns(() => Promise.resolve(vscode_1.Uri.file('')));
    appShell.setup(a => a.setStatusBarMessage(TypeMoq.It.isAny())).returns(() => dummyDisposable);
    factory.setup(f => f.create(TypeMoq.It.isAny())).returns(() => Promise.resolve(pythonExecutionService));
    const e = new vscode_1.EventEmitter();
    interpreterService.setup(x => x.onDidChangeInterpreter).returns(() => e.event);
    configurationService.setup(c => c.getSettings(TypeMoq.It.isAny())).returns(() => pythonSettings.object);
    workspaceService.setup(c => c.getConfiguration(TypeMoq.It.isAny())).returns(() => workspaceConfig.object);
    workspaceService.setup(c => c.getConfiguration(TypeMoq.It.isAny(), TypeMoq.It.isAny())).returns(() => workspaceConfig.object);
    workspaceConfig.setup(c => c.get(TypeMoq.It.isAny())).returns(() => undefined); // tslint:disable-next-line:no-empty

    logger.setup(l => l.logInformation(TypeMoq.It.isAny())).returns(m => {}); // console.log(m)); // REnable this to debug the server
  }

}

exports.DataScienceIocContainer = DataScienceIocContainer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhdGFTY2llbmNlSW9jQ29udGFpbmVyLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiVHlwZU1vcSIsInJlcXVpcmUiLCJ2c2NvZGVfMSIsInR5cGVzXzEiLCJjdXJyZW50UHJvY2Vzc18xIiwidHlwZXNfMiIsInR5cGVzXzMiLCJjb2RlQ3NzR2VuZXJhdG9yXzEiLCJoaXN0b3J5XzEiLCJoaXN0b3J5UHJvdmlkZXJfMSIsImp1cHl0ZXJFeGVjdXRpb25fMSIsImp1cHl0ZXJJbXBvcnRlcl8xIiwianVweXRlclByb2Nlc3NfMSIsImp1cHl0ZXJTZXJ2ZXJfMSIsInN0YXR1c1Byb3ZpZGVyXzEiLCJ0eXBlc180IiwiY29udHJhY3RzXzEiLCJzZXJ2aWNlUmVnaXN0cnlfMSIsImV4ZWN1dGlvblNlcnZpY2VNb2NrXzEiLCJEYXRhU2NpZW5jZUlvY0NvbnRhaW5lciIsIlVuaXRUZXN0SW9jQ29udGFpbmVyIiwiY29uc3RydWN0b3IiLCJyZWdpc3RlckRhdGFTY2llbmNlVHlwZXMiLCJyZWdpc3RlckZpbGVTeXN0ZW1UeXBlcyIsInNlcnZpY2VNYW5hZ2VyIiwiYWRkU2luZ2xldG9uIiwiSUp1cHl0ZXJFeGVjdXRpb24iLCJKdXB5dGVyRXhlY3V0aW9uIiwiSUhpc3RvcnlQcm92aWRlciIsIkhpc3RvcnlQcm92aWRlciIsImFkZCIsIklIaXN0b3J5IiwiSGlzdG9yeSIsIklOb3RlYm9va0ltcG9ydGVyIiwiSnVweXRlckltcG9ydGVyIiwiSU5vdGVib29rU2VydmVyIiwiSnVweXRlclNlcnZlciIsIklOb3RlYm9va1Byb2Nlc3MiLCJKdXB5dGVyUHJvY2VzcyIsIklDb2RlQ3NzR2VuZXJhdG9yIiwiQ29kZUNzc0dlbmVyYXRvciIsIklTdGF0dXNQcm92aWRlciIsIlN0YXR1c1Byb3ZpZGVyIiwibG9nZ2VyIiwiTW9jayIsIm9mVHlwZSIsInB5dGhvbkV4ZWN1dGlvblNlcnZpY2UiLCJNb2NrUHl0aG9uRXhlY3V0aW9uU2VydmljZSIsImZhY3RvcnkiLCJpbnRlcnByZXRlclNlcnZpY2UiLCJjb25kYVNlcnZpY2UiLCJhcHBTaGVsbCIsImRvY3VtZW50TWFuYWdlciIsIndvcmtzcGFjZVNlcnZpY2UiLCJjb25maWd1cmF0aW9uU2VydmljZSIsImN1cnJlbnRQcm9jZXNzIiwiQ3VycmVudFByb2Nlc3MiLCJweXRob25TZXR0aW5ncyIsIndvcmtzcGFjZUNvbmZpZyIsImFkZFNpbmdsZXRvbkluc3RhbmNlIiwiSUxvZ2dlciIsIm9iamVjdCIsIklQeXRob25FeGVjdXRpb25GYWN0b3J5IiwiSUludGVycHJldGVyU2VydmljZSIsIklDb25kYVNlcnZpY2UiLCJJQXBwbGljYXRpb25TaGVsbCIsIklEb2N1bWVudE1hbmFnZXIiLCJJV29ya3NwYWNlU2VydmljZSIsIklDb25maWd1cmF0aW9uU2VydmljZSIsIklDdXJyZW50UHJvY2VzcyIsImR1bW15RGlzcG9zYWJsZSIsImRpc3Bvc2UiLCJzZXR1cCIsImEiLCJzaG93RXJyb3JNZXNzYWdlIiwiSXQiLCJpc0FueVN0cmluZyIsInJldHVybnMiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNob3dJbmZvcm1hdGlvbk1lc3NhZ2UiLCJpc0FueSIsInNob3dTYXZlRGlhbG9nIiwiVXJpIiwiZmlsZSIsInNldFN0YXR1c0Jhck1lc3NhZ2UiLCJmIiwiY3JlYXRlIiwiZSIsIkV2ZW50RW1pdHRlciIsIngiLCJvbkRpZENoYW5nZUludGVycHJldGVyIiwiZXZlbnQiLCJjIiwiZ2V0U2V0dGluZ3MiLCJnZXRDb25maWd1cmF0aW9uIiwiZ2V0IiwidW5kZWZpbmVkIiwibCIsImxvZ0luZm9ybWF0aW9uIiwibSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUNBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQUVDLEVBQUFBLEtBQUssRUFBRTtBQUFULENBQTdDOztBQUNBLE1BQU1DLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQUQsQ0FBdkI7O0FBQ0EsTUFBTUMsUUFBUSxHQUFHRCxPQUFPLENBQUMsUUFBRCxDQUF4Qjs7QUFDQSxNQUFNRSxPQUFPLEdBQUdGLE9BQU8sQ0FBQyx1Q0FBRCxDQUF2Qjs7QUFDQSxNQUFNRyxnQkFBZ0IsR0FBR0gsT0FBTyxDQUFDLDRDQUFELENBQWhDOztBQUNBLE1BQU1JLE9BQU8sR0FBR0osT0FBTyxDQUFDLG1DQUFELENBQXZCOztBQUNBLE1BQU1LLE9BQU8sR0FBR0wsT0FBTyxDQUFDLDJCQUFELENBQXZCOztBQUNBLE1BQU1NLGtCQUFrQixHQUFHTixPQUFPLENBQUMsMkNBQUQsQ0FBbEM7O0FBQ0EsTUFBTU8sU0FBUyxHQUFHUCxPQUFPLENBQUMsa0NBQUQsQ0FBekI7O0FBQ0EsTUFBTVEsaUJBQWlCLEdBQUdSLE9BQU8sQ0FBQywwQ0FBRCxDQUFqQzs7QUFDQSxNQUFNUyxrQkFBa0IsR0FBR1QsT0FBTyxDQUFDLDJDQUFELENBQWxDOztBQUNBLE1BQU1VLGlCQUFpQixHQUFHVixPQUFPLENBQUMsMENBQUQsQ0FBakM7O0FBQ0EsTUFBTVcsZ0JBQWdCLEdBQUdYLE9BQU8sQ0FBQyx5Q0FBRCxDQUFoQzs7QUFDQSxNQUFNWSxlQUFlLEdBQUdaLE9BQU8sQ0FBQyx3Q0FBRCxDQUEvQjs7QUFDQSxNQUFNYSxnQkFBZ0IsR0FBR2IsT0FBTyxDQUFDLHlDQUFELENBQWhDOztBQUNBLE1BQU1jLE9BQU8sR0FBR2QsT0FBTyxDQUFDLGdDQUFELENBQXZCOztBQUNBLE1BQU1lLFdBQVcsR0FBR2YsT0FBTyxDQUFDLG9DQUFELENBQTNCOztBQUNBLE1BQU1nQixpQkFBaUIsR0FBR2hCLE9BQU8sQ0FBQyw4QkFBRCxDQUFqQzs7QUFDQSxNQUFNaUIsc0JBQXNCLEdBQUdqQixPQUFPLENBQUMsd0JBQUQsQ0FBdEM7O0FBQ0EsTUFBTWtCLHVCQUFOLFNBQXNDRixpQkFBaUIsQ0FBQ0csb0JBQXhELENBQTZFO0FBQ3pFQyxFQUFBQSxXQUFXLEdBQUc7QUFDVjtBQUNIOztBQUNEQyxFQUFBQSx3QkFBd0IsR0FBRztBQUN2QixTQUFLQyx1QkFBTDtBQUNBLFNBQUtDLGNBQUwsQ0FBb0JDLFlBQXBCLENBQWlDVixPQUFPLENBQUNXLGlCQUF6QyxFQUE0RGhCLGtCQUFrQixDQUFDaUIsZ0JBQS9FO0FBQ0EsU0FBS0gsY0FBTCxDQUFvQkMsWUFBcEIsQ0FBaUNWLE9BQU8sQ0FBQ2EsZ0JBQXpDLEVBQTJEbkIsaUJBQWlCLENBQUNvQixlQUE3RTtBQUNBLFNBQUtMLGNBQUwsQ0FBb0JNLEdBQXBCLENBQXdCZixPQUFPLENBQUNnQixRQUFoQyxFQUEwQ3ZCLFNBQVMsQ0FBQ3dCLE9BQXBEO0FBQ0EsU0FBS1IsY0FBTCxDQUFvQk0sR0FBcEIsQ0FBd0JmLE9BQU8sQ0FBQ2tCLGlCQUFoQyxFQUFtRHRCLGlCQUFpQixDQUFDdUIsZUFBckU7QUFDQSxTQUFLVixjQUFMLENBQW9CTSxHQUFwQixDQUF3QmYsT0FBTyxDQUFDb0IsZUFBaEMsRUFBaUR0QixlQUFlLENBQUN1QixhQUFqRTtBQUNBLFNBQUtaLGNBQUwsQ0FBb0JNLEdBQXBCLENBQXdCZixPQUFPLENBQUNzQixnQkFBaEMsRUFBa0R6QixnQkFBZ0IsQ0FBQzBCLGNBQW5FO0FBQ0EsU0FBS2QsY0FBTCxDQUFvQkMsWUFBcEIsQ0FBaUNWLE9BQU8sQ0FBQ3dCLGlCQUF6QyxFQUE0RGhDLGtCQUFrQixDQUFDaUMsZ0JBQS9FO0FBQ0EsU0FBS2hCLGNBQUwsQ0FBb0JDLFlBQXBCLENBQWlDVixPQUFPLENBQUMwQixlQUF6QyxFQUEwRDNCLGdCQUFnQixDQUFDNEIsY0FBM0UsRUFUdUIsQ0FVdkI7O0FBQ0EsVUFBTUMsTUFBTSxHQUFHM0MsT0FBTyxDQUFDNEMsSUFBUixDQUFhQyxNQUFiLEVBQWY7QUFDQSxVQUFNQyxzQkFBc0IsR0FBRyxJQUFJNUIsc0JBQXNCLENBQUM2QiwwQkFBM0IsRUFBL0I7QUFDQSxVQUFNQyxPQUFPLEdBQUdoRCxPQUFPLENBQUM0QyxJQUFSLENBQWFDLE1BQWIsRUFBaEI7QUFDQSxVQUFNSSxrQkFBa0IsR0FBR2pELE9BQU8sQ0FBQzRDLElBQVIsQ0FBYUMsTUFBYixFQUEzQjtBQUNBLFVBQU1LLFlBQVksR0FBR2xELE9BQU8sQ0FBQzRDLElBQVIsQ0FBYUMsTUFBYixFQUFyQjtBQUNBLFVBQU1NLFFBQVEsR0FBR25ELE9BQU8sQ0FBQzRDLElBQVIsQ0FBYUMsTUFBYixFQUFqQjtBQUNBLFVBQU1PLGVBQWUsR0FBR3BELE9BQU8sQ0FBQzRDLElBQVIsQ0FBYUMsTUFBYixFQUF4QjtBQUNBLFVBQU1RLGdCQUFnQixHQUFHckQsT0FBTyxDQUFDNEMsSUFBUixDQUFhQyxNQUFiLEVBQXpCO0FBQ0EsVUFBTVMsb0JBQW9CLEdBQUd0RCxPQUFPLENBQUM0QyxJQUFSLENBQWFDLE1BQWIsRUFBN0I7QUFDQSxVQUFNVSxjQUFjLEdBQUcsSUFBSW5ELGdCQUFnQixDQUFDb0QsY0FBckIsRUFBdkI7QUFDQSxVQUFNQyxjQUFjLEdBQUd6RCxPQUFPLENBQUM0QyxJQUFSLENBQWFDLE1BQWIsRUFBdkI7QUFDQSxVQUFNYSxlQUFlLEdBQUcxRCxPQUFPLENBQUM0QyxJQUFSLENBQWFDLE1BQWIsRUFBeEI7QUFDQSxTQUFLckIsY0FBTCxDQUFvQm1DLG9CQUFwQixDQUF5Q3JELE9BQU8sQ0FBQ3NELE9BQWpELEVBQTBEakIsTUFBTSxDQUFDa0IsTUFBakU7QUFDQSxTQUFLckMsY0FBTCxDQUFvQm1DLG9CQUFwQixDQUF5Q3RELE9BQU8sQ0FBQ3lELHVCQUFqRCxFQUEwRWQsT0FBTyxDQUFDYSxNQUFsRjtBQUNBLFNBQUtyQyxjQUFMLENBQW9CbUMsb0JBQXBCLENBQXlDM0MsV0FBVyxDQUFDK0MsbUJBQXJELEVBQTBFZCxrQkFBa0IsQ0FBQ1ksTUFBN0Y7QUFDQSxTQUFLckMsY0FBTCxDQUFvQm1DLG9CQUFwQixDQUF5QzNDLFdBQVcsQ0FBQ2dELGFBQXJELEVBQW9FZCxZQUFZLENBQUNXLE1BQWpGO0FBQ0EsU0FBS3JDLGNBQUwsQ0FBb0JtQyxvQkFBcEIsQ0FBeUN4RCxPQUFPLENBQUM4RCxpQkFBakQsRUFBb0VkLFFBQVEsQ0FBQ1UsTUFBN0U7QUFDQSxTQUFLckMsY0FBTCxDQUFvQm1DLG9CQUFwQixDQUF5Q3hELE9BQU8sQ0FBQytELGdCQUFqRCxFQUFtRWQsZUFBZSxDQUFDUyxNQUFuRjtBQUNBLFNBQUtyQyxjQUFMLENBQW9CbUMsb0JBQXBCLENBQXlDeEQsT0FBTyxDQUFDZ0UsaUJBQWpELEVBQW9FZCxnQkFBZ0IsQ0FBQ1EsTUFBckY7QUFDQSxTQUFLckMsY0FBTCxDQUFvQm1DLG9CQUFwQixDQUF5Q3JELE9BQU8sQ0FBQzhELHFCQUFqRCxFQUF3RWQsb0JBQW9CLENBQUNPLE1BQTdGO0FBQ0EsU0FBS3JDLGNBQUwsQ0FBb0JtQyxvQkFBcEIsQ0FBeUNyRCxPQUFPLENBQUMrRCxlQUFqRCxFQUFrRWQsY0FBbEU7QUFDQSxVQUFNZSxlQUFlLEdBQUc7QUFDcEJDLE1BQUFBLE9BQU8sRUFBRSxNQUFNO0FBQUU7QUFBUztBQUROLEtBQXhCO0FBR0FwQixJQUFBQSxRQUFRLENBQUNxQixLQUFULENBQWVDLENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxnQkFBRixDQUFtQjFFLE9BQU8sQ0FBQzJFLEVBQVIsQ0FBV0MsV0FBWCxFQUFuQixDQUFwQixFQUFrRUMsT0FBbEUsQ0FBMEUsTUFBTUMsT0FBTyxDQUFDQyxPQUFSLENBQWdCLEVBQWhCLENBQWhGO0FBQ0E1QixJQUFBQSxRQUFRLENBQUNxQixLQUFULENBQWVDLENBQUMsSUFBSUEsQ0FBQyxDQUFDTyxzQkFBRixDQUF5QmhGLE9BQU8sQ0FBQzJFLEVBQVIsQ0FBV00sS0FBWCxFQUF6QixFQUE2Q2pGLE9BQU8sQ0FBQzJFLEVBQVIsQ0FBV00sS0FBWCxFQUE3QyxDQUFwQixFQUFzRkosT0FBdEYsQ0FBOEYsTUFBTUMsT0FBTyxDQUFDQyxPQUFSLENBQWdCLEVBQWhCLENBQXBHO0FBQ0E1QixJQUFBQSxRQUFRLENBQUNxQixLQUFULENBQWVDLENBQUMsSUFBSUEsQ0FBQyxDQUFDUyxjQUFGLENBQWlCbEYsT0FBTyxDQUFDMkUsRUFBUixDQUFXTSxLQUFYLEVBQWpCLENBQXBCLEVBQTBESixPQUExRCxDQUFrRSxNQUFNQyxPQUFPLENBQUNDLE9BQVIsQ0FBZ0I3RSxRQUFRLENBQUNpRixHQUFULENBQWFDLElBQWIsQ0FBa0IsRUFBbEIsQ0FBaEIsQ0FBeEU7QUFDQWpDLElBQUFBLFFBQVEsQ0FBQ3FCLEtBQVQsQ0FBZUMsQ0FBQyxJQUFJQSxDQUFDLENBQUNZLG1CQUFGLENBQXNCckYsT0FBTyxDQUFDMkUsRUFBUixDQUFXTSxLQUFYLEVBQXRCLENBQXBCLEVBQStESixPQUEvRCxDQUF1RSxNQUFNUCxlQUE3RTtBQUNBdEIsSUFBQUEsT0FBTyxDQUFDd0IsS0FBUixDQUFjYyxDQUFDLElBQUlBLENBQUMsQ0FBQ0MsTUFBRixDQUFTdkYsT0FBTyxDQUFDMkUsRUFBUixDQUFXTSxLQUFYLEVBQVQsQ0FBbkIsRUFBaURKLE9BQWpELENBQXlELE1BQU1DLE9BQU8sQ0FBQ0MsT0FBUixDQUFnQmpDLHNCQUFoQixDQUEvRDtBQUNBLFVBQU0wQyxDQUFDLEdBQUcsSUFBSXRGLFFBQVEsQ0FBQ3VGLFlBQWIsRUFBVjtBQUNBeEMsSUFBQUEsa0JBQWtCLENBQUN1QixLQUFuQixDQUF5QmtCLENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxzQkFBaEMsRUFBd0RkLE9BQXhELENBQWdFLE1BQU1XLENBQUMsQ0FBQ0ksS0FBeEU7QUFDQXRDLElBQUFBLG9CQUFvQixDQUFDa0IsS0FBckIsQ0FBMkJxQixDQUFDLElBQUlBLENBQUMsQ0FBQ0MsV0FBRixDQUFjOUYsT0FBTyxDQUFDMkUsRUFBUixDQUFXTSxLQUFYLEVBQWQsQ0FBaEMsRUFBbUVKLE9BQW5FLENBQTJFLE1BQU1wQixjQUFjLENBQUNJLE1BQWhHO0FBQ0FSLElBQUFBLGdCQUFnQixDQUFDbUIsS0FBakIsQ0FBdUJxQixDQUFDLElBQUlBLENBQUMsQ0FBQ0UsZ0JBQUYsQ0FBbUIvRixPQUFPLENBQUMyRSxFQUFSLENBQVdNLEtBQVgsRUFBbkIsQ0FBNUIsRUFBb0VKLE9BQXBFLENBQTRFLE1BQU1uQixlQUFlLENBQUNHLE1BQWxHO0FBQ0FSLElBQUFBLGdCQUFnQixDQUFDbUIsS0FBakIsQ0FBdUJxQixDQUFDLElBQUlBLENBQUMsQ0FBQ0UsZ0JBQUYsQ0FBbUIvRixPQUFPLENBQUMyRSxFQUFSLENBQVdNLEtBQVgsRUFBbkIsRUFBdUNqRixPQUFPLENBQUMyRSxFQUFSLENBQVdNLEtBQVgsRUFBdkMsQ0FBNUIsRUFBd0ZKLE9BQXhGLENBQWdHLE1BQU1uQixlQUFlLENBQUNHLE1BQXRIO0FBQ0FILElBQUFBLGVBQWUsQ0FBQ2MsS0FBaEIsQ0FBc0JxQixDQUFDLElBQUlBLENBQUMsQ0FBQ0csR0FBRixDQUFNaEcsT0FBTyxDQUFDMkUsRUFBUixDQUFXTSxLQUFYLEVBQU4sQ0FBM0IsRUFBc0RKLE9BQXRELENBQThELE1BQU1vQixTQUFwRSxFQTdDdUIsQ0E4Q3ZCOztBQUNBdEQsSUFBQUEsTUFBTSxDQUFDNkIsS0FBUCxDQUFhMEIsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLGNBQUYsQ0FBaUJuRyxPQUFPLENBQUMyRSxFQUFSLENBQVdNLEtBQVgsRUFBakIsQ0FBbEIsRUFBd0RKLE9BQXhELENBQWlFdUIsQ0FBRCxJQUFPLENBQUcsQ0FBMUUsRUEvQ3VCLENBK0NzRDtBQUNoRjs7QUFwRHdFOztBQXNEN0V0RyxPQUFPLENBQUNxQix1QkFBUixHQUFrQ0EsdUJBQWxDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXG4ndXNlIHN0cmljdCc7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5jb25zdCBUeXBlTW9xID0gcmVxdWlyZShcInR5cGVtb3FcIik7XG5jb25zdCB2c2NvZGVfMSA9IHJlcXVpcmUoXCJ2c2NvZGVcIik7XG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vYXBwbGljYXRpb24vdHlwZXNcIik7XG5jb25zdCBjdXJyZW50UHJvY2Vzc18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9jb21tb24vcHJvY2Vzcy9jdXJyZW50UHJvY2Vzc1wiKTtcbmNvbnN0IHR5cGVzXzIgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2NvbW1vbi9wcm9jZXNzL3R5cGVzXCIpO1xuY29uc3QgdHlwZXNfMyA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvY29tbW9uL3R5cGVzXCIpO1xuY29uc3QgY29kZUNzc0dlbmVyYXRvcl8xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9kYXRhc2NpZW5jZS9jb2RlQ3NzR2VuZXJhdG9yXCIpO1xuY29uc3QgaGlzdG9yeV8xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9kYXRhc2NpZW5jZS9oaXN0b3J5XCIpO1xuY29uc3QgaGlzdG9yeVByb3ZpZGVyXzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2RhdGFzY2llbmNlL2hpc3RvcnlQcm92aWRlclwiKTtcbmNvbnN0IGp1cHl0ZXJFeGVjdXRpb25fMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvZGF0YXNjaWVuY2UvanVweXRlckV4ZWN1dGlvblwiKTtcbmNvbnN0IGp1cHl0ZXJJbXBvcnRlcl8xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9kYXRhc2NpZW5jZS9qdXB5dGVySW1wb3J0ZXJcIik7XG5jb25zdCBqdXB5dGVyUHJvY2Vzc18xID0gcmVxdWlyZShcIi4uLy4uL2NsaWVudC9kYXRhc2NpZW5jZS9qdXB5dGVyUHJvY2Vzc1wiKTtcbmNvbnN0IGp1cHl0ZXJTZXJ2ZXJfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvZGF0YXNjaWVuY2UvanVweXRlclNlcnZlclwiKTtcbmNvbnN0IHN0YXR1c1Byb3ZpZGVyXzEgPSByZXF1aXJlKFwiLi4vLi4vY2xpZW50L2RhdGFzY2llbmNlL3N0YXR1c1Byb3ZpZGVyXCIpO1xuY29uc3QgdHlwZXNfNCA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvZGF0YXNjaWVuY2UvdHlwZXNcIik7XG5jb25zdCBjb250cmFjdHNfMSA9IHJlcXVpcmUoXCIuLi8uLi9jbGllbnQvaW50ZXJwcmV0ZXIvY29udHJhY3RzXCIpO1xuY29uc3Qgc2VydmljZVJlZ2lzdHJ5XzEgPSByZXF1aXJlKFwiLi4vdW5pdHRlc3RzL3NlcnZpY2VSZWdpc3RyeVwiKTtcbmNvbnN0IGV4ZWN1dGlvblNlcnZpY2VNb2NrXzEgPSByZXF1aXJlKFwiLi9leGVjdXRpb25TZXJ2aWNlTW9ja1wiKTtcbmNsYXNzIERhdGFTY2llbmNlSW9jQ29udGFpbmVyIGV4dGVuZHMgc2VydmljZVJlZ2lzdHJ5XzEuVW5pdFRlc3RJb2NDb250YWluZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuICAgIH1cbiAgICByZWdpc3RlckRhdGFTY2llbmNlVHlwZXMoKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXJGaWxlU3lzdGVtVHlwZXMoKTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGRTaW5nbGV0b24odHlwZXNfNC5JSnVweXRlckV4ZWN1dGlvbiwganVweXRlckV4ZWN1dGlvbl8xLkp1cHl0ZXJFeGVjdXRpb24pO1xuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbih0eXBlc180LklIaXN0b3J5UHJvdmlkZXIsIGhpc3RvcnlQcm92aWRlcl8xLkhpc3RvcnlQcm92aWRlcik7XG4gICAgICAgIHRoaXMuc2VydmljZU1hbmFnZXIuYWRkKHR5cGVzXzQuSUhpc3RvcnksIGhpc3RvcnlfMS5IaXN0b3J5KTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGQodHlwZXNfNC5JTm90ZWJvb2tJbXBvcnRlciwganVweXRlckltcG9ydGVyXzEuSnVweXRlckltcG9ydGVyKTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGQodHlwZXNfNC5JTm90ZWJvb2tTZXJ2ZXIsIGp1cHl0ZXJTZXJ2ZXJfMS5KdXB5dGVyU2VydmVyKTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGQodHlwZXNfNC5JTm90ZWJvb2tQcm9jZXNzLCBqdXB5dGVyUHJvY2Vzc18xLkp1cHl0ZXJQcm9jZXNzKTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGRTaW5nbGV0b24odHlwZXNfNC5JQ29kZUNzc0dlbmVyYXRvciwgY29kZUNzc0dlbmVyYXRvcl8xLkNvZGVDc3NHZW5lcmF0b3IpO1xuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbih0eXBlc180LklTdGF0dXNQcm92aWRlciwgc3RhdHVzUHJvdmlkZXJfMS5TdGF0dXNQcm92aWRlcik7XG4gICAgICAgIC8vIEFsc28gc2V0dXAgYSBtb2NrIGV4ZWN1dGlvbiBzZXJ2aWNlIGFuZCBpbnRlcnByZXRlciBzZXJ2aWNlXG4gICAgICAgIGNvbnN0IGxvZ2dlciA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcbiAgICAgICAgY29uc3QgcHl0aG9uRXhlY3V0aW9uU2VydmljZSA9IG5ldyBleGVjdXRpb25TZXJ2aWNlTW9ja18xLk1vY2tQeXRob25FeGVjdXRpb25TZXJ2aWNlKCk7XG4gICAgICAgIGNvbnN0IGZhY3RvcnkgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XG4gICAgICAgIGNvbnN0IGludGVycHJldGVyU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcbiAgICAgICAgY29uc3QgY29uZGFTZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xuICAgICAgICBjb25zdCBhcHBTaGVsbCA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcbiAgICAgICAgY29uc3QgZG9jdW1lbnRNYW5hZ2VyID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xuICAgICAgICBjb25zdCB3b3Jrc3BhY2VTZXJ2aWNlID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xuICAgICAgICBjb25zdCBjb25maWd1cmF0aW9uU2VydmljZSA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcbiAgICAgICAgY29uc3QgY3VycmVudFByb2Nlc3MgPSBuZXcgY3VycmVudFByb2Nlc3NfMS5DdXJyZW50UHJvY2VzcygpO1xuICAgICAgICBjb25zdCBweXRob25TZXR0aW5ncyA9IFR5cGVNb3EuTW9jay5vZlR5cGUoKTtcbiAgICAgICAgY29uc3Qgd29ya3NwYWNlQ29uZmlnID0gVHlwZU1vcS5Nb2NrLm9mVHlwZSgpO1xuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbkluc3RhbmNlKHR5cGVzXzMuSUxvZ2dlciwgbG9nZ2VyLm9iamVjdCk7XG4gICAgICAgIHRoaXMuc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uSW5zdGFuY2UodHlwZXNfMi5JUHl0aG9uRXhlY3V0aW9uRmFjdG9yeSwgZmFjdG9yeS5vYmplY3QpO1xuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbkluc3RhbmNlKGNvbnRyYWN0c18xLklJbnRlcnByZXRlclNlcnZpY2UsIGludGVycHJldGVyU2VydmljZS5vYmplY3QpO1xuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbkluc3RhbmNlKGNvbnRyYWN0c18xLklDb25kYVNlcnZpY2UsIGNvbmRhU2VydmljZS5vYmplY3QpO1xuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbkluc3RhbmNlKHR5cGVzXzEuSUFwcGxpY2F0aW9uU2hlbGwsIGFwcFNoZWxsLm9iamVjdCk7XG4gICAgICAgIHRoaXMuc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uSW5zdGFuY2UodHlwZXNfMS5JRG9jdW1lbnRNYW5hZ2VyLCBkb2N1bWVudE1hbmFnZXIub2JqZWN0KTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGRTaW5nbGV0b25JbnN0YW5jZSh0eXBlc18xLklXb3Jrc3BhY2VTZXJ2aWNlLCB3b3Jrc3BhY2VTZXJ2aWNlLm9iamVjdCk7XG4gICAgICAgIHRoaXMuc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uSW5zdGFuY2UodHlwZXNfMy5JQ29uZmlndXJhdGlvblNlcnZpY2UsIGNvbmZpZ3VyYXRpb25TZXJ2aWNlLm9iamVjdCk7XG4gICAgICAgIHRoaXMuc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uSW5zdGFuY2UodHlwZXNfMy5JQ3VycmVudFByb2Nlc3MsIGN1cnJlbnRQcm9jZXNzKTtcbiAgICAgICAgY29uc3QgZHVtbXlEaXNwb3NhYmxlID0ge1xuICAgICAgICAgICAgZGlzcG9zZTogKCkgPT4geyByZXR1cm47IH1cbiAgICAgICAgfTtcbiAgICAgICAgYXBwU2hlbGwuc2V0dXAoYSA9PiBhLnNob3dFcnJvck1lc3NhZ2UoVHlwZU1vcS5JdC5pc0FueVN0cmluZygpKSkucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUoJycpKTtcbiAgICAgICAgYXBwU2hlbGwuc2V0dXAoYSA9PiBhLnNob3dJbmZvcm1hdGlvbk1lc3NhZ2UoVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZSgnJykpO1xuICAgICAgICBhcHBTaGVsbC5zZXR1cChhID0+IGEuc2hvd1NhdmVEaWFsb2coVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiBQcm9taXNlLnJlc29sdmUodnNjb2RlXzEuVXJpLmZpbGUoJycpKSk7XG4gICAgICAgIGFwcFNoZWxsLnNldHVwKGEgPT4gYS5zZXRTdGF0dXNCYXJNZXNzYWdlKFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gZHVtbXlEaXNwb3NhYmxlKTtcbiAgICAgICAgZmFjdG9yeS5zZXR1cChmID0+IGYuY3JlYXRlKFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHB5dGhvbkV4ZWN1dGlvblNlcnZpY2UpKTtcbiAgICAgICAgY29uc3QgZSA9IG5ldyB2c2NvZGVfMS5FdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgaW50ZXJwcmV0ZXJTZXJ2aWNlLnNldHVwKHggPT4geC5vbkRpZENoYW5nZUludGVycHJldGVyKS5yZXR1cm5zKCgpID0+IGUuZXZlbnQpO1xuICAgICAgICBjb25maWd1cmF0aW9uU2VydmljZS5zZXR1cChjID0+IGMuZ2V0U2V0dGluZ3MoVHlwZU1vcS5JdC5pc0FueSgpKSkucmV0dXJucygoKSA9PiBweXRob25TZXR0aW5ncy5vYmplY3QpO1xuICAgICAgICB3b3Jrc3BhY2VTZXJ2aWNlLnNldHVwKGMgPT4gYy5nZXRDb25maWd1cmF0aW9uKFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKCkgPT4gd29ya3NwYWNlQ29uZmlnLm9iamVjdCk7XG4gICAgICAgIHdvcmtzcGFjZVNlcnZpY2Uuc2V0dXAoYyA9PiBjLmdldENvbmZpZ3VyYXRpb24oVHlwZU1vcS5JdC5pc0FueSgpLCBUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IHdvcmtzcGFjZUNvbmZpZy5vYmplY3QpO1xuICAgICAgICB3b3Jrc3BhY2VDb25maWcuc2V0dXAoYyA9PiBjLmdldChUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IHVuZGVmaW5lZCk7XG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1lbXB0eVxuICAgICAgICBsb2dnZXIuc2V0dXAobCA9PiBsLmxvZ0luZm9ybWF0aW9uKFR5cGVNb3EuSXQuaXNBbnkoKSkpLnJldHVybnMoKG0pID0+IHsgfSk7IC8vIGNvbnNvbGUubG9nKG0pKTsgLy8gUkVuYWJsZSB0aGlzIHRvIGRlYnVnIHRoZSBzZXJ2ZXJcbiAgICB9XG59XG5leHBvcnRzLkRhdGFTY2llbmNlSW9jQ29udGFpbmVyID0gRGF0YVNjaWVuY2VJb2NDb250YWluZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1kYXRhU2NpZW5jZUlvY0NvbnRhaW5lci5qcy5tYXAiXX0=
"use strict"; // Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

Object.defineProperty(exports, "__esModule", {
  value: true
});

const inversify_1 = require("inversify");

const TypeMoq = require("typemoq");

const constants_1 = require("../client/common/constants");

const logger_1 = require("../client/common/logger");

const constants_2 = require("../client/common/platform/constants");

const fileSystem_1 = require("../client/common/platform/fileSystem");

const pathUtils_1 = require("../client/common/platform/pathUtils");

const platformService_1 = require("../client/common/platform/platformService");

const serviceRegistry_1 = require("../client/common/platform/serviceRegistry");

const types_1 = require("../client/common/platform/types");

const decoder_1 = require("../client/common/process/decoder");

const proc_1 = require("../client/common/process/proc");

const pythonExecutionFactory_1 = require("../client/common/process/pythonExecutionFactory");

const pythonToolService_1 = require("../client/common/process/pythonToolService");

const serviceRegistry_2 = require("../client/common/process/serviceRegistry");

const types_2 = require("../client/common/process/types");

const serviceRegistry_3 = require("../client/common/serviceRegistry");

const types_3 = require("../client/common/types");

const serviceRegistry_4 = require("../client/common/variables/serviceRegistry");

const serviceRegistry_5 = require("../client/formatters/serviceRegistry");

const serviceRegistry_6 = require("../client/interpreter/serviceRegistry");

const container_1 = require("../client/ioc/container");

const serviceManager_1 = require("../client/ioc/serviceManager");

const types_4 = require("../client/ioc/types");

const serviceRegistry_7 = require("../client/linters/serviceRegistry");

const constants_3 = require("../client/unittests/common/constants");

const serviceRegistry_8 = require("../client/unittests/serviceRegistry");

const mockClasses_1 = require("./mockClasses");

const mementos_1 = require("./mocks/mementos");

const proc_2 = require("./mocks/proc");

const process_1 = require("./mocks/process");

class IocContainer {
  constructor() {
    this.disposables = [];
    const cont = new inversify_1.Container();
    this.serviceManager = new serviceManager_1.ServiceManager(cont);
    this.serviceContainer = new container_1.ServiceContainer(cont);
    this.serviceManager.addSingletonInstance(types_4.IServiceContainer, this.serviceContainer);
    this.serviceManager.addSingletonInstance(types_3.IDisposableRegistry, this.disposables);
    this.serviceManager.addSingleton(types_3.IMemento, mementos_1.MockMemento, types_3.GLOBAL_MEMENTO);
    this.serviceManager.addSingleton(types_3.IMemento, mementos_1.MockMemento, types_3.WORKSPACE_MEMENTO);
    const stdOutputChannel = new mockClasses_1.MockOutputChannel('Python');
    this.disposables.push(stdOutputChannel);
    this.serviceManager.addSingletonInstance(types_3.IOutputChannel, stdOutputChannel, constants_1.STANDARD_OUTPUT_CHANNEL);
    const testOutputChannel = new mockClasses_1.MockOutputChannel('Python Test - UnitTests');
    this.disposables.push(testOutputChannel);
    this.serviceManager.addSingletonInstance(types_3.IOutputChannel, testOutputChannel, constants_3.TEST_OUTPUT_CHANNEL);
  }

  dispose() {
    this.disposables.forEach(disposable => disposable.dispose());
  }

  registerCommonTypes(registerFileSystem = true) {
    serviceRegistry_3.registerTypes(this.serviceManager);

    if (registerFileSystem) {
      this.registerFileSystemTypes();
    }
  }

  registerFileSystemTypes() {
    this.serviceManager.addSingleton(types_1.IPlatformService, platformService_1.PlatformService);
    this.serviceManager.addSingleton(types_1.IFileSystem, fileSystem_1.FileSystem);
  }

  registerProcessTypes() {
    serviceRegistry_2.registerTypes(this.serviceManager);
  }

  registerVariableTypes() {
    serviceRegistry_4.registerTypes(this.serviceManager);
  }

  registerUnitTestTypes() {
    serviceRegistry_8.registerTypes(this.serviceManager);
  }

  registerLinterTypes() {
    serviceRegistry_7.registerTypes(this.serviceManager);
  }

  registerFormatterTypes() {
    serviceRegistry_5.registerTypes(this.serviceManager);
  }

  registerPlatformTypes() {
    serviceRegistry_1.registerTypes(this.serviceManager);
  }

  registerInterpreterTypes() {
    serviceRegistry_6.registerTypes(this.serviceManager);
  }

  registerMockProcessTypes() {
    this.serviceManager.addSingleton(types_2.IBufferDecoder, decoder_1.BufferDecoder);
    const processServiceFactory = TypeMoq.Mock.ofType(); // tslint:disable-next-line:no-any

    const processService = new proc_2.MockProcessService(new proc_1.ProcessService(new decoder_1.BufferDecoder(), process.env));
    processServiceFactory.setup(f => f.create(TypeMoq.It.isAny())).returns(() => Promise.resolve(processService));
    this.serviceManager.addSingletonInstance(types_2.IProcessServiceFactory, processServiceFactory.object);
    this.serviceManager.addSingleton(types_2.IPythonExecutionFactory, pythonExecutionFactory_1.PythonExecutionFactory);
    this.serviceManager.addSingleton(types_2.IPythonToolExecutionService, pythonToolService_1.PythonToolExecutionService);
  }

  registerMockProcess() {
    this.serviceManager.addSingletonInstance(types_3.IsWindows, constants_2.IS_WINDOWS);
    this.serviceManager.addSingletonInstance(types_3.Is64Bit, constants_2.IS_64_BIT);
    this.serviceManager.addSingleton(types_3.ILogger, logger_1.Logger);
    this.serviceManager.addSingleton(types_3.IPathUtils, pathUtils_1.PathUtils);
    this.serviceManager.addSingleton(types_3.ICurrentProcess, process_1.MockProcess);
  }

}

exports.IocContainer = IocContainer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZpY2VSZWdpc3RyeS5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImludmVyc2lmeV8xIiwicmVxdWlyZSIsIlR5cGVNb3EiLCJjb25zdGFudHNfMSIsImxvZ2dlcl8xIiwiY29uc3RhbnRzXzIiLCJmaWxlU3lzdGVtXzEiLCJwYXRoVXRpbHNfMSIsInBsYXRmb3JtU2VydmljZV8xIiwic2VydmljZVJlZ2lzdHJ5XzEiLCJ0eXBlc18xIiwiZGVjb2Rlcl8xIiwicHJvY18xIiwicHl0aG9uRXhlY3V0aW9uRmFjdG9yeV8xIiwicHl0aG9uVG9vbFNlcnZpY2VfMSIsInNlcnZpY2VSZWdpc3RyeV8yIiwidHlwZXNfMiIsInNlcnZpY2VSZWdpc3RyeV8zIiwidHlwZXNfMyIsInNlcnZpY2VSZWdpc3RyeV80Iiwic2VydmljZVJlZ2lzdHJ5XzUiLCJzZXJ2aWNlUmVnaXN0cnlfNiIsImNvbnRhaW5lcl8xIiwic2VydmljZU1hbmFnZXJfMSIsInR5cGVzXzQiLCJzZXJ2aWNlUmVnaXN0cnlfNyIsImNvbnN0YW50c18zIiwic2VydmljZVJlZ2lzdHJ5XzgiLCJtb2NrQ2xhc3Nlc18xIiwibWVtZW50b3NfMSIsInByb2NfMiIsInByb2Nlc3NfMSIsIklvY0NvbnRhaW5lciIsImNvbnN0cnVjdG9yIiwiZGlzcG9zYWJsZXMiLCJjb250IiwiQ29udGFpbmVyIiwic2VydmljZU1hbmFnZXIiLCJTZXJ2aWNlTWFuYWdlciIsInNlcnZpY2VDb250YWluZXIiLCJTZXJ2aWNlQ29udGFpbmVyIiwiYWRkU2luZ2xldG9uSW5zdGFuY2UiLCJJU2VydmljZUNvbnRhaW5lciIsIklEaXNwb3NhYmxlUmVnaXN0cnkiLCJhZGRTaW5nbGV0b24iLCJJTWVtZW50byIsIk1vY2tNZW1lbnRvIiwiR0xPQkFMX01FTUVOVE8iLCJXT1JLU1BBQ0VfTUVNRU5UTyIsInN0ZE91dHB1dENoYW5uZWwiLCJNb2NrT3V0cHV0Q2hhbm5lbCIsInB1c2giLCJJT3V0cHV0Q2hhbm5lbCIsIlNUQU5EQVJEX09VVFBVVF9DSEFOTkVMIiwidGVzdE91dHB1dENoYW5uZWwiLCJURVNUX09VVFBVVF9DSEFOTkVMIiwiZGlzcG9zZSIsImZvckVhY2giLCJkaXNwb3NhYmxlIiwicmVnaXN0ZXJDb21tb25UeXBlcyIsInJlZ2lzdGVyRmlsZVN5c3RlbSIsInJlZ2lzdGVyVHlwZXMiLCJyZWdpc3RlckZpbGVTeXN0ZW1UeXBlcyIsIklQbGF0Zm9ybVNlcnZpY2UiLCJQbGF0Zm9ybVNlcnZpY2UiLCJJRmlsZVN5c3RlbSIsIkZpbGVTeXN0ZW0iLCJyZWdpc3RlclByb2Nlc3NUeXBlcyIsInJlZ2lzdGVyVmFyaWFibGVUeXBlcyIsInJlZ2lzdGVyVW5pdFRlc3RUeXBlcyIsInJlZ2lzdGVyTGludGVyVHlwZXMiLCJyZWdpc3RlckZvcm1hdHRlclR5cGVzIiwicmVnaXN0ZXJQbGF0Zm9ybVR5cGVzIiwicmVnaXN0ZXJJbnRlcnByZXRlclR5cGVzIiwicmVnaXN0ZXJNb2NrUHJvY2Vzc1R5cGVzIiwiSUJ1ZmZlckRlY29kZXIiLCJCdWZmZXJEZWNvZGVyIiwicHJvY2Vzc1NlcnZpY2VGYWN0b3J5IiwiTW9jayIsIm9mVHlwZSIsInByb2Nlc3NTZXJ2aWNlIiwiTW9ja1Byb2Nlc3NTZXJ2aWNlIiwiUHJvY2Vzc1NlcnZpY2UiLCJwcm9jZXNzIiwiZW52Iiwic2V0dXAiLCJmIiwiY3JlYXRlIiwiSXQiLCJpc0FueSIsInJldHVybnMiLCJQcm9taXNlIiwicmVzb2x2ZSIsIklQcm9jZXNzU2VydmljZUZhY3RvcnkiLCJvYmplY3QiLCJJUHl0aG9uRXhlY3V0aW9uRmFjdG9yeSIsIlB5dGhvbkV4ZWN1dGlvbkZhY3RvcnkiLCJJUHl0aG9uVG9vbEV4ZWN1dGlvblNlcnZpY2UiLCJQeXRob25Ub29sRXhlY3V0aW9uU2VydmljZSIsInJlZ2lzdGVyTW9ja1Byb2Nlc3MiLCJJc1dpbmRvd3MiLCJJU19XSU5ET1dTIiwiSXM2NEJpdCIsIklTXzY0X0JJVCIsIklMb2dnZXIiLCJMb2dnZXIiLCJJUGF0aFV0aWxzIiwiUGF0aFV0aWxzIiwiSUN1cnJlbnRQcm9jZXNzIiwiTW9ja1Byb2Nlc3MiXSwibWFwcGluZ3MiOiJBQUFBLGEsQ0FDQTtBQUNBOztBQUNBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQUVDLEVBQUFBLEtBQUssRUFBRTtBQUFULENBQTdDOztBQUNBLE1BQU1DLFdBQVcsR0FBR0MsT0FBTyxDQUFDLFdBQUQsQ0FBM0I7O0FBQ0EsTUFBTUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsU0FBRCxDQUF2Qjs7QUFDQSxNQUFNRSxXQUFXLEdBQUdGLE9BQU8sQ0FBQyw0QkFBRCxDQUEzQjs7QUFDQSxNQUFNRyxRQUFRLEdBQUdILE9BQU8sQ0FBQyx5QkFBRCxDQUF4Qjs7QUFDQSxNQUFNSSxXQUFXLEdBQUdKLE9BQU8sQ0FBQyxxQ0FBRCxDQUEzQjs7QUFDQSxNQUFNSyxZQUFZLEdBQUdMLE9BQU8sQ0FBQyxzQ0FBRCxDQUE1Qjs7QUFDQSxNQUFNTSxXQUFXLEdBQUdOLE9BQU8sQ0FBQyxxQ0FBRCxDQUEzQjs7QUFDQSxNQUFNTyxpQkFBaUIsR0FBR1AsT0FBTyxDQUFDLDJDQUFELENBQWpDOztBQUNBLE1BQU1RLGlCQUFpQixHQUFHUixPQUFPLENBQUMsMkNBQUQsQ0FBakM7O0FBQ0EsTUFBTVMsT0FBTyxHQUFHVCxPQUFPLENBQUMsaUNBQUQsQ0FBdkI7O0FBQ0EsTUFBTVUsU0FBUyxHQUFHVixPQUFPLENBQUMsa0NBQUQsQ0FBekI7O0FBQ0EsTUFBTVcsTUFBTSxHQUFHWCxPQUFPLENBQUMsK0JBQUQsQ0FBdEI7O0FBQ0EsTUFBTVksd0JBQXdCLEdBQUdaLE9BQU8sQ0FBQyxpREFBRCxDQUF4Qzs7QUFDQSxNQUFNYSxtQkFBbUIsR0FBR2IsT0FBTyxDQUFDLDRDQUFELENBQW5DOztBQUNBLE1BQU1jLGlCQUFpQixHQUFHZCxPQUFPLENBQUMsMENBQUQsQ0FBakM7O0FBQ0EsTUFBTWUsT0FBTyxHQUFHZixPQUFPLENBQUMsZ0NBQUQsQ0FBdkI7O0FBQ0EsTUFBTWdCLGlCQUFpQixHQUFHaEIsT0FBTyxDQUFDLGtDQUFELENBQWpDOztBQUNBLE1BQU1pQixPQUFPLEdBQUdqQixPQUFPLENBQUMsd0JBQUQsQ0FBdkI7O0FBQ0EsTUFBTWtCLGlCQUFpQixHQUFHbEIsT0FBTyxDQUFDLDRDQUFELENBQWpDOztBQUNBLE1BQU1tQixpQkFBaUIsR0FBR25CLE9BQU8sQ0FBQyxzQ0FBRCxDQUFqQzs7QUFDQSxNQUFNb0IsaUJBQWlCLEdBQUdwQixPQUFPLENBQUMsdUNBQUQsQ0FBakM7O0FBQ0EsTUFBTXFCLFdBQVcsR0FBR3JCLE9BQU8sQ0FBQyx5QkFBRCxDQUEzQjs7QUFDQSxNQUFNc0IsZ0JBQWdCLEdBQUd0QixPQUFPLENBQUMsOEJBQUQsQ0FBaEM7O0FBQ0EsTUFBTXVCLE9BQU8sR0FBR3ZCLE9BQU8sQ0FBQyxxQkFBRCxDQUF2Qjs7QUFDQSxNQUFNd0IsaUJBQWlCLEdBQUd4QixPQUFPLENBQUMsbUNBQUQsQ0FBakM7O0FBQ0EsTUFBTXlCLFdBQVcsR0FBR3pCLE9BQU8sQ0FBQyxzQ0FBRCxDQUEzQjs7QUFDQSxNQUFNMEIsaUJBQWlCLEdBQUcxQixPQUFPLENBQUMscUNBQUQsQ0FBakM7O0FBQ0EsTUFBTTJCLGFBQWEsR0FBRzNCLE9BQU8sQ0FBQyxlQUFELENBQTdCOztBQUNBLE1BQU00QixVQUFVLEdBQUc1QixPQUFPLENBQUMsa0JBQUQsQ0FBMUI7O0FBQ0EsTUFBTTZCLE1BQU0sR0FBRzdCLE9BQU8sQ0FBQyxjQUFELENBQXRCOztBQUNBLE1BQU04QixTQUFTLEdBQUc5QixPQUFPLENBQUMsaUJBQUQsQ0FBekI7O0FBQ0EsTUFBTStCLFlBQU4sQ0FBbUI7QUFDZkMsRUFBQUEsV0FBVyxHQUFHO0FBQ1YsU0FBS0MsV0FBTCxHQUFtQixFQUFuQjtBQUNBLFVBQU1DLElBQUksR0FBRyxJQUFJbkMsV0FBVyxDQUFDb0MsU0FBaEIsRUFBYjtBQUNBLFNBQUtDLGNBQUwsR0FBc0IsSUFBSWQsZ0JBQWdCLENBQUNlLGNBQXJCLENBQW9DSCxJQUFwQyxDQUF0QjtBQUNBLFNBQUtJLGdCQUFMLEdBQXdCLElBQUlqQixXQUFXLENBQUNrQixnQkFBaEIsQ0FBaUNMLElBQWpDLENBQXhCO0FBQ0EsU0FBS0UsY0FBTCxDQUFvQkksb0JBQXBCLENBQXlDakIsT0FBTyxDQUFDa0IsaUJBQWpELEVBQW9FLEtBQUtILGdCQUF6RTtBQUNBLFNBQUtGLGNBQUwsQ0FBb0JJLG9CQUFwQixDQUF5Q3ZCLE9BQU8sQ0FBQ3lCLG1CQUFqRCxFQUFzRSxLQUFLVCxXQUEzRTtBQUNBLFNBQUtHLGNBQUwsQ0FBb0JPLFlBQXBCLENBQWlDMUIsT0FBTyxDQUFDMkIsUUFBekMsRUFBbURoQixVQUFVLENBQUNpQixXQUE5RCxFQUEyRTVCLE9BQU8sQ0FBQzZCLGNBQW5GO0FBQ0EsU0FBS1YsY0FBTCxDQUFvQk8sWUFBcEIsQ0FBaUMxQixPQUFPLENBQUMyQixRQUF6QyxFQUFtRGhCLFVBQVUsQ0FBQ2lCLFdBQTlELEVBQTJFNUIsT0FBTyxDQUFDOEIsaUJBQW5GO0FBQ0EsVUFBTUMsZ0JBQWdCLEdBQUcsSUFBSXJCLGFBQWEsQ0FBQ3NCLGlCQUFsQixDQUFvQyxRQUFwQyxDQUF6QjtBQUNBLFNBQUtoQixXQUFMLENBQWlCaUIsSUFBakIsQ0FBc0JGLGdCQUF0QjtBQUNBLFNBQUtaLGNBQUwsQ0FBb0JJLG9CQUFwQixDQUF5Q3ZCLE9BQU8sQ0FBQ2tDLGNBQWpELEVBQWlFSCxnQkFBakUsRUFBbUY5QyxXQUFXLENBQUNrRCx1QkFBL0Y7QUFDQSxVQUFNQyxpQkFBaUIsR0FBRyxJQUFJMUIsYUFBYSxDQUFDc0IsaUJBQWxCLENBQW9DLHlCQUFwQyxDQUExQjtBQUNBLFNBQUtoQixXQUFMLENBQWlCaUIsSUFBakIsQ0FBc0JHLGlCQUF0QjtBQUNBLFNBQUtqQixjQUFMLENBQW9CSSxvQkFBcEIsQ0FBeUN2QixPQUFPLENBQUNrQyxjQUFqRCxFQUFpRUUsaUJBQWpFLEVBQW9GNUIsV0FBVyxDQUFDNkIsbUJBQWhHO0FBQ0g7O0FBQ0RDLEVBQUFBLE9BQU8sR0FBRztBQUNOLFNBQUt0QixXQUFMLENBQWlCdUIsT0FBakIsQ0FBeUJDLFVBQVUsSUFBSUEsVUFBVSxDQUFDRixPQUFYLEVBQXZDO0FBQ0g7O0FBQ0RHLEVBQUFBLG1CQUFtQixDQUFDQyxrQkFBa0IsR0FBRyxJQUF0QixFQUE0QjtBQUMzQzNDLElBQUFBLGlCQUFpQixDQUFDNEMsYUFBbEIsQ0FBZ0MsS0FBS3hCLGNBQXJDOztBQUNBLFFBQUl1QixrQkFBSixFQUF3QjtBQUNwQixXQUFLRSx1QkFBTDtBQUNIO0FBQ0o7O0FBQ0RBLEVBQUFBLHVCQUF1QixHQUFHO0FBQ3RCLFNBQUt6QixjQUFMLENBQW9CTyxZQUFwQixDQUFpQ2xDLE9BQU8sQ0FBQ3FELGdCQUF6QyxFQUEyRHZELGlCQUFpQixDQUFDd0QsZUFBN0U7QUFDQSxTQUFLM0IsY0FBTCxDQUFvQk8sWUFBcEIsQ0FBaUNsQyxPQUFPLENBQUN1RCxXQUF6QyxFQUFzRDNELFlBQVksQ0FBQzRELFVBQW5FO0FBQ0g7O0FBQ0RDLEVBQUFBLG9CQUFvQixHQUFHO0FBQ25CcEQsSUFBQUEsaUJBQWlCLENBQUM4QyxhQUFsQixDQUFnQyxLQUFLeEIsY0FBckM7QUFDSDs7QUFDRCtCLEVBQUFBLHFCQUFxQixHQUFHO0FBQ3BCakQsSUFBQUEsaUJBQWlCLENBQUMwQyxhQUFsQixDQUFnQyxLQUFLeEIsY0FBckM7QUFDSDs7QUFDRGdDLEVBQUFBLHFCQUFxQixHQUFHO0FBQ3BCMUMsSUFBQUEsaUJBQWlCLENBQUNrQyxhQUFsQixDQUFnQyxLQUFLeEIsY0FBckM7QUFDSDs7QUFDRGlDLEVBQUFBLG1CQUFtQixHQUFHO0FBQ2xCN0MsSUFBQUEsaUJBQWlCLENBQUNvQyxhQUFsQixDQUFnQyxLQUFLeEIsY0FBckM7QUFDSDs7QUFDRGtDLEVBQUFBLHNCQUFzQixHQUFHO0FBQ3JCbkQsSUFBQUEsaUJBQWlCLENBQUN5QyxhQUFsQixDQUFnQyxLQUFLeEIsY0FBckM7QUFDSDs7QUFDRG1DLEVBQUFBLHFCQUFxQixHQUFHO0FBQ3BCL0QsSUFBQUEsaUJBQWlCLENBQUNvRCxhQUFsQixDQUFnQyxLQUFLeEIsY0FBckM7QUFDSDs7QUFDRG9DLEVBQUFBLHdCQUF3QixHQUFHO0FBQ3ZCcEQsSUFBQUEsaUJBQWlCLENBQUN3QyxhQUFsQixDQUFnQyxLQUFLeEIsY0FBckM7QUFDSDs7QUFDRHFDLEVBQUFBLHdCQUF3QixHQUFHO0FBQ3ZCLFNBQUtyQyxjQUFMLENBQW9CTyxZQUFwQixDQUFpQzVCLE9BQU8sQ0FBQzJELGNBQXpDLEVBQXlEaEUsU0FBUyxDQUFDaUUsYUFBbkU7QUFDQSxVQUFNQyxxQkFBcUIsR0FBRzNFLE9BQU8sQ0FBQzRFLElBQVIsQ0FBYUMsTUFBYixFQUE5QixDQUZ1QixDQUd2Qjs7QUFDQSxVQUFNQyxjQUFjLEdBQUcsSUFBSWxELE1BQU0sQ0FBQ21ELGtCQUFYLENBQThCLElBQUlyRSxNQUFNLENBQUNzRSxjQUFYLENBQTBCLElBQUl2RSxTQUFTLENBQUNpRSxhQUFkLEVBQTFCLEVBQXlETyxPQUFPLENBQUNDLEdBQWpFLENBQTlCLENBQXZCO0FBQ0FQLElBQUFBLHFCQUFxQixDQUFDUSxLQUF0QixDQUE0QkMsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLE1BQUYsQ0FBU3JGLE9BQU8sQ0FBQ3NGLEVBQVIsQ0FBV0MsS0FBWCxFQUFULENBQWpDLEVBQStEQyxPQUEvRCxDQUF1RSxNQUFNQyxPQUFPLENBQUNDLE9BQVIsQ0FBZ0JaLGNBQWhCLENBQTdFO0FBQ0EsU0FBSzNDLGNBQUwsQ0FBb0JJLG9CQUFwQixDQUF5Q3pCLE9BQU8sQ0FBQzZFLHNCQUFqRCxFQUF5RWhCLHFCQUFxQixDQUFDaUIsTUFBL0Y7QUFDQSxTQUFLekQsY0FBTCxDQUFvQk8sWUFBcEIsQ0FBaUM1QixPQUFPLENBQUMrRSx1QkFBekMsRUFBa0VsRix3QkFBd0IsQ0FBQ21GLHNCQUEzRjtBQUNBLFNBQUszRCxjQUFMLENBQW9CTyxZQUFwQixDQUFpQzVCLE9BQU8sQ0FBQ2lGLDJCQUF6QyxFQUFzRW5GLG1CQUFtQixDQUFDb0YsMEJBQTFGO0FBQ0g7O0FBQ0RDLEVBQUFBLG1CQUFtQixHQUFHO0FBQ2xCLFNBQUs5RCxjQUFMLENBQW9CSSxvQkFBcEIsQ0FBeUN2QixPQUFPLENBQUNrRixTQUFqRCxFQUE0RC9GLFdBQVcsQ0FBQ2dHLFVBQXhFO0FBQ0EsU0FBS2hFLGNBQUwsQ0FBb0JJLG9CQUFwQixDQUF5Q3ZCLE9BQU8sQ0FBQ29GLE9BQWpELEVBQTBEakcsV0FBVyxDQUFDa0csU0FBdEU7QUFDQSxTQUFLbEUsY0FBTCxDQUFvQk8sWUFBcEIsQ0FBaUMxQixPQUFPLENBQUNzRixPQUF6QyxFQUFrRHBHLFFBQVEsQ0FBQ3FHLE1BQTNEO0FBQ0EsU0FBS3BFLGNBQUwsQ0FBb0JPLFlBQXBCLENBQWlDMUIsT0FBTyxDQUFDd0YsVUFBekMsRUFBcURuRyxXQUFXLENBQUNvRyxTQUFqRTtBQUNBLFNBQUt0RSxjQUFMLENBQW9CTyxZQUFwQixDQUFpQzFCLE9BQU8sQ0FBQzBGLGVBQXpDLEVBQTBEN0UsU0FBUyxDQUFDOEUsV0FBcEU7QUFDSDs7QUFuRWM7O0FBcUVuQi9HLE9BQU8sQ0FBQ2tDLFlBQVIsR0FBdUJBLFlBQXZCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG4vLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmNvbnN0IGludmVyc2lmeV8xID0gcmVxdWlyZShcImludmVyc2lmeVwiKTtcbmNvbnN0IFR5cGVNb3EgPSByZXF1aXJlKFwidHlwZW1vcVwiKTtcbmNvbnN0IGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4uL2NsaWVudC9jb21tb24vY29uc3RhbnRzXCIpO1xuY29uc3QgbG9nZ2VyXzEgPSByZXF1aXJlKFwiLi4vY2xpZW50L2NvbW1vbi9sb2dnZXJcIik7XG5jb25zdCBjb25zdGFudHNfMiA9IHJlcXVpcmUoXCIuLi9jbGllbnQvY29tbW9uL3BsYXRmb3JtL2NvbnN0YW50c1wiKTtcbmNvbnN0IGZpbGVTeXN0ZW1fMSA9IHJlcXVpcmUoXCIuLi9jbGllbnQvY29tbW9uL3BsYXRmb3JtL2ZpbGVTeXN0ZW1cIik7XG5jb25zdCBwYXRoVXRpbHNfMSA9IHJlcXVpcmUoXCIuLi9jbGllbnQvY29tbW9uL3BsYXRmb3JtL3BhdGhVdGlsc1wiKTtcbmNvbnN0IHBsYXRmb3JtU2VydmljZV8xID0gcmVxdWlyZShcIi4uL2NsaWVudC9jb21tb24vcGxhdGZvcm0vcGxhdGZvcm1TZXJ2aWNlXCIpO1xuY29uc3Qgc2VydmljZVJlZ2lzdHJ5XzEgPSByZXF1aXJlKFwiLi4vY2xpZW50L2NvbW1vbi9wbGF0Zm9ybS9zZXJ2aWNlUmVnaXN0cnlcIik7XG5jb25zdCB0eXBlc18xID0gcmVxdWlyZShcIi4uL2NsaWVudC9jb21tb24vcGxhdGZvcm0vdHlwZXNcIik7XG5jb25zdCBkZWNvZGVyXzEgPSByZXF1aXJlKFwiLi4vY2xpZW50L2NvbW1vbi9wcm9jZXNzL2RlY29kZXJcIik7XG5jb25zdCBwcm9jXzEgPSByZXF1aXJlKFwiLi4vY2xpZW50L2NvbW1vbi9wcm9jZXNzL3Byb2NcIik7XG5jb25zdCBweXRob25FeGVjdXRpb25GYWN0b3J5XzEgPSByZXF1aXJlKFwiLi4vY2xpZW50L2NvbW1vbi9wcm9jZXNzL3B5dGhvbkV4ZWN1dGlvbkZhY3RvcnlcIik7XG5jb25zdCBweXRob25Ub29sU2VydmljZV8xID0gcmVxdWlyZShcIi4uL2NsaWVudC9jb21tb24vcHJvY2Vzcy9weXRob25Ub29sU2VydmljZVwiKTtcbmNvbnN0IHNlcnZpY2VSZWdpc3RyeV8yID0gcmVxdWlyZShcIi4uL2NsaWVudC9jb21tb24vcHJvY2Vzcy9zZXJ2aWNlUmVnaXN0cnlcIik7XG5jb25zdCB0eXBlc18yID0gcmVxdWlyZShcIi4uL2NsaWVudC9jb21tb24vcHJvY2Vzcy90eXBlc1wiKTtcbmNvbnN0IHNlcnZpY2VSZWdpc3RyeV8zID0gcmVxdWlyZShcIi4uL2NsaWVudC9jb21tb24vc2VydmljZVJlZ2lzdHJ5XCIpO1xuY29uc3QgdHlwZXNfMyA9IHJlcXVpcmUoXCIuLi9jbGllbnQvY29tbW9uL3R5cGVzXCIpO1xuY29uc3Qgc2VydmljZVJlZ2lzdHJ5XzQgPSByZXF1aXJlKFwiLi4vY2xpZW50L2NvbW1vbi92YXJpYWJsZXMvc2VydmljZVJlZ2lzdHJ5XCIpO1xuY29uc3Qgc2VydmljZVJlZ2lzdHJ5XzUgPSByZXF1aXJlKFwiLi4vY2xpZW50L2Zvcm1hdHRlcnMvc2VydmljZVJlZ2lzdHJ5XCIpO1xuY29uc3Qgc2VydmljZVJlZ2lzdHJ5XzYgPSByZXF1aXJlKFwiLi4vY2xpZW50L2ludGVycHJldGVyL3NlcnZpY2VSZWdpc3RyeVwiKTtcbmNvbnN0IGNvbnRhaW5lcl8xID0gcmVxdWlyZShcIi4uL2NsaWVudC9pb2MvY29udGFpbmVyXCIpO1xuY29uc3Qgc2VydmljZU1hbmFnZXJfMSA9IHJlcXVpcmUoXCIuLi9jbGllbnQvaW9jL3NlcnZpY2VNYW5hZ2VyXCIpO1xuY29uc3QgdHlwZXNfNCA9IHJlcXVpcmUoXCIuLi9jbGllbnQvaW9jL3R5cGVzXCIpO1xuY29uc3Qgc2VydmljZVJlZ2lzdHJ5XzcgPSByZXF1aXJlKFwiLi4vY2xpZW50L2xpbnRlcnMvc2VydmljZVJlZ2lzdHJ5XCIpO1xuY29uc3QgY29uc3RhbnRzXzMgPSByZXF1aXJlKFwiLi4vY2xpZW50L3VuaXR0ZXN0cy9jb21tb24vY29uc3RhbnRzXCIpO1xuY29uc3Qgc2VydmljZVJlZ2lzdHJ5XzggPSByZXF1aXJlKFwiLi4vY2xpZW50L3VuaXR0ZXN0cy9zZXJ2aWNlUmVnaXN0cnlcIik7XG5jb25zdCBtb2NrQ2xhc3Nlc18xID0gcmVxdWlyZShcIi4vbW9ja0NsYXNzZXNcIik7XG5jb25zdCBtZW1lbnRvc18xID0gcmVxdWlyZShcIi4vbW9ja3MvbWVtZW50b3NcIik7XG5jb25zdCBwcm9jXzIgPSByZXF1aXJlKFwiLi9tb2Nrcy9wcm9jXCIpO1xuY29uc3QgcHJvY2Vzc18xID0gcmVxdWlyZShcIi4vbW9ja3MvcHJvY2Vzc1wiKTtcbmNsYXNzIElvY0NvbnRhaW5lciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuZGlzcG9zYWJsZXMgPSBbXTtcbiAgICAgICAgY29uc3QgY29udCA9IG5ldyBpbnZlcnNpZnlfMS5Db250YWluZXIoKTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlciA9IG5ldyBzZXJ2aWNlTWFuYWdlcl8xLlNlcnZpY2VNYW5hZ2VyKGNvbnQpO1xuICAgICAgICB0aGlzLnNlcnZpY2VDb250YWluZXIgPSBuZXcgY29udGFpbmVyXzEuU2VydmljZUNvbnRhaW5lcihjb250KTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGRTaW5nbGV0b25JbnN0YW5jZSh0eXBlc180LklTZXJ2aWNlQ29udGFpbmVyLCB0aGlzLnNlcnZpY2VDb250YWluZXIpO1xuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbkluc3RhbmNlKHR5cGVzXzMuSURpc3Bvc2FibGVSZWdpc3RyeSwgdGhpcy5kaXNwb3NhYmxlcyk7XG4gICAgICAgIHRoaXMuc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uKHR5cGVzXzMuSU1lbWVudG8sIG1lbWVudG9zXzEuTW9ja01lbWVudG8sIHR5cGVzXzMuR0xPQkFMX01FTUVOVE8pO1xuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbih0eXBlc18zLklNZW1lbnRvLCBtZW1lbnRvc18xLk1vY2tNZW1lbnRvLCB0eXBlc18zLldPUktTUEFDRV9NRU1FTlRPKTtcbiAgICAgICAgY29uc3Qgc3RkT3V0cHV0Q2hhbm5lbCA9IG5ldyBtb2NrQ2xhc3Nlc18xLk1vY2tPdXRwdXRDaGFubmVsKCdQeXRob24nKTtcbiAgICAgICAgdGhpcy5kaXNwb3NhYmxlcy5wdXNoKHN0ZE91dHB1dENoYW5uZWwpO1xuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbkluc3RhbmNlKHR5cGVzXzMuSU91dHB1dENoYW5uZWwsIHN0ZE91dHB1dENoYW5uZWwsIGNvbnN0YW50c18xLlNUQU5EQVJEX09VVFBVVF9DSEFOTkVMKTtcbiAgICAgICAgY29uc3QgdGVzdE91dHB1dENoYW5uZWwgPSBuZXcgbW9ja0NsYXNzZXNfMS5Nb2NrT3V0cHV0Q2hhbm5lbCgnUHl0aG9uIFRlc3QgLSBVbml0VGVzdHMnKTtcbiAgICAgICAgdGhpcy5kaXNwb3NhYmxlcy5wdXNoKHRlc3RPdXRwdXRDaGFubmVsKTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGRTaW5nbGV0b25JbnN0YW5jZSh0eXBlc18zLklPdXRwdXRDaGFubmVsLCB0ZXN0T3V0cHV0Q2hhbm5lbCwgY29uc3RhbnRzXzMuVEVTVF9PVVRQVVRfQ0hBTk5FTCk7XG4gICAgfVxuICAgIGRpc3Bvc2UoKSB7XG4gICAgICAgIHRoaXMuZGlzcG9zYWJsZXMuZm9yRWFjaChkaXNwb3NhYmxlID0+IGRpc3Bvc2FibGUuZGlzcG9zZSgpKTtcbiAgICB9XG4gICAgcmVnaXN0ZXJDb21tb25UeXBlcyhyZWdpc3RlckZpbGVTeXN0ZW0gPSB0cnVlKSB7XG4gICAgICAgIHNlcnZpY2VSZWdpc3RyeV8zLnJlZ2lzdGVyVHlwZXModGhpcy5zZXJ2aWNlTWFuYWdlcik7XG4gICAgICAgIGlmIChyZWdpc3RlckZpbGVTeXN0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJGaWxlU3lzdGVtVHlwZXMoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZWdpc3RlckZpbGVTeXN0ZW1UeXBlcygpIHtcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGRTaW5nbGV0b24odHlwZXNfMS5JUGxhdGZvcm1TZXJ2aWNlLCBwbGF0Zm9ybVNlcnZpY2VfMS5QbGF0Zm9ybVNlcnZpY2UpO1xuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbih0eXBlc18xLklGaWxlU3lzdGVtLCBmaWxlU3lzdGVtXzEuRmlsZVN5c3RlbSk7XG4gICAgfVxuICAgIHJlZ2lzdGVyUHJvY2Vzc1R5cGVzKCkge1xuICAgICAgICBzZXJ2aWNlUmVnaXN0cnlfMi5yZWdpc3RlclR5cGVzKHRoaXMuc2VydmljZU1hbmFnZXIpO1xuICAgIH1cbiAgICByZWdpc3RlclZhcmlhYmxlVHlwZXMoKSB7XG4gICAgICAgIHNlcnZpY2VSZWdpc3RyeV80LnJlZ2lzdGVyVHlwZXModGhpcy5zZXJ2aWNlTWFuYWdlcik7XG4gICAgfVxuICAgIHJlZ2lzdGVyVW5pdFRlc3RUeXBlcygpIHtcbiAgICAgICAgc2VydmljZVJlZ2lzdHJ5XzgucmVnaXN0ZXJUeXBlcyh0aGlzLnNlcnZpY2VNYW5hZ2VyKTtcbiAgICB9XG4gICAgcmVnaXN0ZXJMaW50ZXJUeXBlcygpIHtcbiAgICAgICAgc2VydmljZVJlZ2lzdHJ5XzcucmVnaXN0ZXJUeXBlcyh0aGlzLnNlcnZpY2VNYW5hZ2VyKTtcbiAgICB9XG4gICAgcmVnaXN0ZXJGb3JtYXR0ZXJUeXBlcygpIHtcbiAgICAgICAgc2VydmljZVJlZ2lzdHJ5XzUucmVnaXN0ZXJUeXBlcyh0aGlzLnNlcnZpY2VNYW5hZ2VyKTtcbiAgICB9XG4gICAgcmVnaXN0ZXJQbGF0Zm9ybVR5cGVzKCkge1xuICAgICAgICBzZXJ2aWNlUmVnaXN0cnlfMS5yZWdpc3RlclR5cGVzKHRoaXMuc2VydmljZU1hbmFnZXIpO1xuICAgIH1cbiAgICByZWdpc3RlckludGVycHJldGVyVHlwZXMoKSB7XG4gICAgICAgIHNlcnZpY2VSZWdpc3RyeV82LnJlZ2lzdGVyVHlwZXModGhpcy5zZXJ2aWNlTWFuYWdlcik7XG4gICAgfVxuICAgIHJlZ2lzdGVyTW9ja1Byb2Nlc3NUeXBlcygpIHtcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGRTaW5nbGV0b24odHlwZXNfMi5JQnVmZmVyRGVjb2RlciwgZGVjb2Rlcl8xLkJ1ZmZlckRlY29kZXIpO1xuICAgICAgICBjb25zdCBwcm9jZXNzU2VydmljZUZhY3RvcnkgPSBUeXBlTW9xLk1vY2sub2ZUeXBlKCk7XG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1hbnlcbiAgICAgICAgY29uc3QgcHJvY2Vzc1NlcnZpY2UgPSBuZXcgcHJvY18yLk1vY2tQcm9jZXNzU2VydmljZShuZXcgcHJvY18xLlByb2Nlc3NTZXJ2aWNlKG5ldyBkZWNvZGVyXzEuQnVmZmVyRGVjb2RlcigpLCBwcm9jZXNzLmVudikpO1xuICAgICAgICBwcm9jZXNzU2VydmljZUZhY3Rvcnkuc2V0dXAoZiA9PiBmLmNyZWF0ZShUeXBlTW9xLkl0LmlzQW55KCkpKS5yZXR1cm5zKCgpID0+IFByb21pc2UucmVzb2x2ZShwcm9jZXNzU2VydmljZSkpO1xuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbkluc3RhbmNlKHR5cGVzXzIuSVByb2Nlc3NTZXJ2aWNlRmFjdG9yeSwgcHJvY2Vzc1NlcnZpY2VGYWN0b3J5Lm9iamVjdCk7XG4gICAgICAgIHRoaXMuc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uKHR5cGVzXzIuSVB5dGhvbkV4ZWN1dGlvbkZhY3RvcnksIHB5dGhvbkV4ZWN1dGlvbkZhY3RvcnlfMS5QeXRob25FeGVjdXRpb25GYWN0b3J5KTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGRTaW5nbGV0b24odHlwZXNfMi5JUHl0aG9uVG9vbEV4ZWN1dGlvblNlcnZpY2UsIHB5dGhvblRvb2xTZXJ2aWNlXzEuUHl0aG9uVG9vbEV4ZWN1dGlvblNlcnZpY2UpO1xuICAgIH1cbiAgICByZWdpc3Rlck1vY2tQcm9jZXNzKCkge1xuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbkluc3RhbmNlKHR5cGVzXzMuSXNXaW5kb3dzLCBjb25zdGFudHNfMi5JU19XSU5ET1dTKTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGRTaW5nbGV0b25JbnN0YW5jZSh0eXBlc18zLklzNjRCaXQsIGNvbnN0YW50c18yLklTXzY0X0JJVCk7XG4gICAgICAgIHRoaXMuc2VydmljZU1hbmFnZXIuYWRkU2luZ2xldG9uKHR5cGVzXzMuSUxvZ2dlciwgbG9nZ2VyXzEuTG9nZ2VyKTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlTWFuYWdlci5hZGRTaW5nbGV0b24odHlwZXNfMy5JUGF0aFV0aWxzLCBwYXRoVXRpbHNfMS5QYXRoVXRpbHMpO1xuICAgICAgICB0aGlzLnNlcnZpY2VNYW5hZ2VyLmFkZFNpbmdsZXRvbih0eXBlc18zLklDdXJyZW50UHJvY2VzcywgcHJvY2Vzc18xLk1vY2tQcm9jZXNzKTtcbiAgICB9XG59XG5leHBvcnRzLklvY0NvbnRhaW5lciA9IElvY0NvbnRhaW5lcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXNlcnZpY2VSZWdpc3RyeS5qcy5tYXAiXX0=